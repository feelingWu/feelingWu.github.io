<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[è½¯ä»¶å¼€å‘æ‰‹å†Œ]]></title>
    <url>%2F2021%2F02%2F24%2Fsoftware-development-manual%2F</url>
    <content type="text"><![CDATA[æ— è§„çŸ©ä¸æˆæ–¹åœ† GITç³»åˆ—å¼€å‘åˆ†æ”¯è§„èŒƒ åˆ†æ”¯ å‘½å è¯´æ˜ ä¸»åˆ†æ”¯ master æ‰€æœ‰æä¾›ç»™ç”¨æˆ·ä½¿ç”¨çš„æ­£å¼ç‰ˆæœ¬ï¼Œéƒ½åœ¨è¿™ä¸ªä¸»åˆ†æ”¯ä¸Šå‘å¸ƒ å¼€å‘åˆ†æ”¯ dev æ°¸è¿œæ˜¯åŠŸèƒ½æœ€æ–°æœ€å…¨çš„åˆ†æ”¯ åŠŸèƒ½åˆ†æ”¯ feature-* æ–°åŠŸèƒ½åˆ†æ”¯ï¼ŒæŸä¸ªåŠŸèƒ½ç‚¹æ­£åœ¨å¼€å‘é˜¶æ®µ å‘å¸ƒç‰ˆæœ¬ release-* å‘å¸ƒå®šæœŸè¦ä¸Šçº¿çš„åŠŸèƒ½ ä¿®å¤åˆ†æ”¯ bug-* ä¿®å¤çº¿ä¸Šä»£ç çš„ bug document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>æ‰‹å†Œ</category>
      </categories>
      <tags>
        <tag>æ‰‹å†Œ</tag>
        <tag>è½¯ä»¶å¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®°frame/iframeå†…åµŒç½‘é¡µä¸æ˜¾ç¤ºé—®é¢˜]]></title>
    <url>%2F2021%2F02%2F23%2Fx-frame-options-sameorigin%2F</url>
    <content type="text"><![CDATA[å‰ç«¯åŒäº‹å†…åµŒç½‘é¡µ,å‘ç°ä¸ªåˆ«ç½‘é¡µæ— æ³•æ˜¾ç¤ºå¹¶æç¤º,â€in a frame because it set â€˜X-Frame-Optionsâ€™ to â€˜sameoriginâ€™â€çš„æŠ¥é”™(å¦‚ï¼šyoukuè§†é¢‘) ä¸€ã€é¢„å¤‡çŸ¥è¯†ç‚¹1.åŒæºç­–ç•¥1.1 ä»€ä¹ˆæ˜¯åŒæºURLç”±åè®®ã€åŸŸåã€ç«¯å£å’Œè·¯å¾„ç»„æˆï¼Œå¦‚æœä¸¤ä¸ªURLçš„åè®®ã€åŸŸåå’Œç«¯å£ç›¸åŒï¼Œåˆ™è¡¨ç¤ºä»–ä»¬åŒæºã€‚ç›¸åï¼Œåªè¦åè®®ï¼ŒåŸŸåï¼Œç«¯å£æœ‰ä»»ä½•ä¸€ä¸ªçš„ä¸åŒï¼Œå°±è¢«å½“ä½œæ˜¯è·¨åŸŸã€‚ 1.2 åŒæºç­–ç•¥(Same-Origin-Policy(SOP))æµè§ˆå™¨é»˜è®¤é‡‡ç”¨åŒæºç­–ç•¥ï¼Œç¦æ­¢é¡µé¢åŠ è½½æˆ–æ‰§è¡Œä¸è‡ªèº«æ¥æºä¸åŒçš„åŸŸçš„ä»»ä½•è„šæœ¬ã€‚ åœºæ™¯ï¼š ä¸€ä¸ªæ¶æ„ç½‘ç«™çš„é¡µé¢é€šè¿‡iframeåµŒå…¥äº†é“¶è¡Œçš„ç™»å½•é¡µé¢ï¼ˆäºŒè€…ä¸åŒæºï¼‰ï¼Œå¦‚æœæ²¡æœ‰åŒæºé™åˆ¶ï¼Œæ¶æ„ç½‘é¡µä¸Šçš„javascriptè„šæœ¬å°±å¯ä»¥åœ¨ç”¨æˆ·ç™»å½•é“¶è¡Œçš„æ—¶å€™è·å–ç”¨æˆ·åå’Œå¯†ç ã€‚ æµè§ˆå™¨ä¸­æœ‰å“ªäº›ä¸å—åŒæºé™åˆ¶å‘¢ï¼Ÿ &lt;script&gt;ã€&lt;img&gt;ã€&lt;iframe&gt;ã€&lt;link&gt;è¿™äº›åŒ…å« src å±æ€§çš„æ ‡ç­¾å¯ä»¥åŠ è½½è·¨åŸŸèµ„æºã€‚ä½†æµè§ˆå™¨é™åˆ¶äº†JavaScriptçš„æƒé™ä½¿å…¶ä¸èƒ½è¯»ã€å†™åŠ è½½çš„å†…å®¹ã€‚ 2.è·¨åŸŸè·¨åŸŸæ˜¯æŒ‡ä»ä¸€ä¸ªåŸŸçš„ç½‘é¡µå»è¯·æ±‚å¦ä¸€ä¸ªåŸŸçš„èµ„æºã€‚ 3.ç‚¹å‡»åŠ«æŒè¿™ç§æ”»å‡»åœ¨æ¶æ„ç«™ç‚¹è¯±å¯¼ç”¨æˆ·ç‚¹å‡»å¦ä¸€ä¸ªç«™ç‚¹çš„è¢«è¦†ç›–å…ƒç´ æ—¶å‡ºç°ï¼Œå¦ä¸€ä¸ªç«™ç‚¹å·²ç»åŠ è½½åˆ°äº†éšè—çš„frameæˆ–iframeä¸­ã€‚ ç‚¹å‡»åŠ«æŒçš„ç¤ºä¾‹ å‡è®¾ä¸€ä¸ªåœ¨çº¿å•†åº—æ‹¥æœ‰ä¸€ä¸ªé¡µé¢ï¼Œå·²ç™»å½•çš„ç”¨æˆ·å¯ä»¥ç‚¹å‡»â€œè´­ä¹°â€æŒ‰é’®æ¥è´­ä¹°ä¸€ä¸ªå•†å“ã€‚ç”¨æˆ·ä¸ºäº†æ–¹ä¾¿ï¼Œå¯ä»¥é€‰æ‹©ä¸€ç›´ä¿æŒå•†åº—çš„ç™»å½•çŠ¶æ€ã€‚ä¸€ä¸ªæ”»å‡»è€…çš„ç«™ç‚¹å¯èƒ½åœ¨ä»–ä»¬è‡ªå·±çš„é¡µé¢ä¸Šä¼šåˆ›å»ºä¸€ä¸ªâ€œæ”¶è—â€æŒ‰é’®ï¼Œå¹¶ä¸”åœ¨ä¸€ä¸ªé€æ˜çš„iframeä¸­åŠ è½½å•†åº—çš„é¡µé¢ï¼ŒæŠŠâ€œè´­ä¹°â€çš„æŒ‰é’®éšè—èµ·æ¥è¦†ç›–åœ¨â€œæ”¶è—â€ä¸Šã€‚å¦‚æœç”¨æˆ·è®¿é—®äº†æ”»å‡»è€…çš„ç«™ç‚¹ï¼Œç‚¹å‡»â€œæ”¶è—â€æŒ‰é’®ä¼šè§¦å‘å¯¹â€œè´­ä¹°â€æŒ‰é’®çš„æ— æ„è¯†çš„ç‚¹å‡»ï¼Œä¸çŸ¥ä¸è§‰ä¸­ä¾¿è´­ä¹°äº†å•†å“ã€‚ äºŒã€X-Frame-Options1.ä»€ä¹ˆæ˜¯X-Frame-OptionsX-Frame-Options HTTP å“åº”å¤´æ˜¯ç”¨æ¥ç»™æµè§ˆå™¨ æŒ‡ç¤ºå…è®¸ä¸€ä¸ªé¡µé¢ å¯å¦åœ¨&lt;frame&gt;,&lt;iframe&gt;, &lt;embed&gt; æˆ–è€… &lt;object&gt; ä¸­å±•ç°çš„æ ‡è®°ã€‚ç«™ç‚¹å¯ä»¥é€šè¿‡ç¡®ä¿ç½‘ç«™æ²¡æœ‰è¢«åµŒå…¥åˆ°åˆ«äººçš„ç«™ç‚¹é‡Œé¢ï¼Œä»è€Œé¿å… clickjacking æ”»å‡»ã€‚ 2.X-Frame-Optionsæœ‰ä»€ä¹ˆç”¨ç”¨äºç‚¹å‡»åŠ«æŒçš„é˜²å¾¡ï¼šç°ä»£æµè§ˆå™¨éµå¾ªX-Frame-Optionsåè®®å¤´(RFC 7034è§„èŒƒ),æ ¹æ®åè®®å¤´ä¸åŒé…ç½®,ä»è€Œå†³å®šä¸€ä¸ªèµ„æºæ˜¯å¦å…è®¸åŠ è½½åˆ°frameæˆ–è€…iframeä¸­ã€‚ 3.å¦‚ä½•é…ç½® Note: è®¾ç½® meta æ ‡ç­¾æ˜¯æ— æ•ˆçš„ï¼ä¾‹å¦‚ æ²¡æœ‰ä»»ä½•æ•ˆæœã€‚åªæœ‰å½“åƒä¸‹é¢ç¤ºä¾‹é‚£æ ·è®¾ç½® HTTP å¤´ X-Frame-Options æ‰ä¼šç”Ÿæ•ˆã€‚ 3.1 X-Frame-Optionsé…ç½®å‚æ•° å‚æ•° å«ä¹‰ å‘½ä»¤ deny è¡¨ç¤ºè¯¥é¡µé¢ä¸å…è®¸åœ¨ frame ä¸­å±•ç¤ºï¼Œå³ä¾¿æ˜¯åœ¨ç›¸åŒåŸŸåçš„é¡µé¢ä¸­åµŒå¥—ä¹Ÿä¸å…è®¸ã€‚ add_header X-Frame-Options deny; sameorigin è¡¨ç¤ºè¯¥é¡µé¢å¯ä»¥åœ¨ç›¸åŒåŸŸåé¡µé¢çš„ frame ä¸­å±•ç¤ºã€‚ add_header X-Frame-Options sameorigin; allow-from è¡¨ç¤ºè¯¥é¡µé¢å¯ä»¥åœ¨æŒ‡å®šæ¥æºçš„ frame ä¸­å±•ç¤ºã€‚ add_header X-Frame-Options allow-from https://example.com/; allowall å…è®¸æ‰€æœ‰ç«™ç‚¹å†…åµŒå±•ç¤ºã€‚ add_header X-Frame-Options allowall; 3.2 é…ç½® Apacheé…ç½® Apache åœ¨æ‰€æœ‰é¡µé¢ä¸Šå‘é€ X-Frame-Options å“åº”å¤´ï¼Œéœ€è¦æŠŠä¸‹é¢è¿™è¡Œæ·»åŠ åˆ° â€˜siteâ€™ çš„é…ç½®ä¸­: Header always set X-Frame-Options "sameorigin" è¦å°† Apache çš„é…ç½® X-Frame-Options è®¾ç½®æˆ deny , æŒ‰å¦‚ä¸‹é…ç½®å»è®¾ç½®ä½ çš„ç«™ç‚¹ï¼š Header set X-Frame-Options "deny" è¦å°† Apache çš„é…ç½® X-Frame-Options è®¾ç½®æˆ allow-fromï¼Œåœ¨é…ç½®é‡Œæ·»åŠ ï¼š Header set X-Frame-Options "allow-from https://example.com/" 3.3 é…ç½® nginxé…ç½® nginx å‘é€ X-Frame-Options å“åº”å¤´ï¼ŒæŠŠä¸‹é¢è¿™è¡Œæ·»åŠ åˆ° â€˜httpâ€™, â€˜serverâ€™ æˆ–è€… â€˜locationâ€™ çš„é…ç½®ä¸­: ä¾‹å¦‚ï¼š1.ä¿®æ”¹é…ç½® add_header X-Frame-Options allowall always; 2.nginxæŒ‡å®šç›®ä¸‹ç”Ÿæ•ˆé…ç½® cd ../usr/sbin/ ./nginx -s reload 3.æ£€æµ‹æ˜¯å¦é…ç½®æˆåŠŸ curl -I http://192.168.2.2:5091 3.4 é…ç½® IISé…ç½® IIS å‘é€ X-Frame-Options å“åº”å¤´ï¼Œæ·»åŠ ä¸‹é¢çš„é…ç½®åˆ° Web.config æ–‡ä»¶ä¸­ï¼š &lt;system.webServer&gt; ... &lt;httpProtocol&gt; &lt;customHeaders&gt; &lt;add name="X-Frame-Options" value="sameorigin" /&gt; &lt;/customHeaders&gt; &lt;/httpProtocol&gt; ... &lt;/system.webServer&gt; 3.5 é…ç½® HAProxyé…ç½® HAProxy å‘é€ X-Frame-Options å¤´ï¼Œæ·»åŠ è¿™äº›åˆ°ä½ çš„å‰ç«¯ã€ç›‘å¬ listenï¼Œæˆ–è€…åç«¯çš„é…ç½®é‡Œé¢ï¼š rspadd X-Frame-Options:\ sameorigin æˆ–è€…ï¼Œåœ¨æ›´åŠ æ–°çš„ç‰ˆæœ¬ä¸­ï¼š http-response set-header X-Frame-Options sameorigin 3.6 é…ç½® Expressè¦é…ç½® Express å¯ä»¥å‘é€ X-Frame-Options headerï¼Œä½ å¯ä»¥ç”¨å€ŸåŠ©äº† frameguard æ¥è®¾ç½®å¤´éƒ¨çš„ helmetã€‚åœ¨ä½ çš„æœåŠ¡å™¨é…ç½®é‡Œé¢æ·»åŠ ï¼š const helmet = require('helmet'); const app = express(); app.use(helmet.frameguard({ action: "sameorigin" })); æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ frameguardï¼š const frameguard = require('frameguard') app.use(frameguard({ action: 'sameorigin' })) 4.æµ‹è¯„ ä¸‰ã€æœ€ç»ˆç»“æœ1.çŒœæµ‹ä¼˜é…·å¼€å¯äº†åŒæºç­–ç•¥ï¼ˆsameoriginï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„iframeæ— æ³•å†…åµŒå…¶ç½‘é¡µ2.è§£å†³æ–¹æ¡ˆï¼Œäº²æµ‹å¯ä»¥ å››ã€å‚è€ƒé“¾æ¥ä¼ é€é—¨1ä¼ é€é—¨2ä¼ é€é—¨3 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>å‰ç«¯</tag>
        <tag>HTTP</tag>
        <tag>X-Frame-Options</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸‰é˜¶é­”æ–¹æ•™ç¨‹]]></title>
    <url>%2F2021%2F02%2F21%2F3ordercube%2F</url>
    <content type="text"><![CDATA[ä¸‰é˜¶é­”æ–¹æ˜¯ç©ä»»æ„é˜¶é­”æ–¹çš„åŸºç¡€ å…¬å¼æ¦‚è§ˆï¼šå…¬å¼ä¸€(å°èŠ±ã€ç™½åå­—ã€ç™½é¢åº•)ï¼šä¸Šå·¦ä¸‹å³ å…¬å¼äºŒ(ä¸­é—´å±‚)ï¼šä¸Šå³ä¸‹å·¦ å…¬å¼ä¸‰(é»„åå­—)ï¼šæ­£é¢é¡ºæ—¶é’ˆè½¬90åº¦ï¼Œå…¬å¼ä¸€ï¼ˆä¸Šå·¦ä¸‹å³ï¼‰ï¼Œé€†æ—¶é’ˆè½¬90åº¦å›å» å…¬å¼å››(å°é±¼ã€é»„é¢)ï¼šä¸‹å³ä¸Šå³ï¼Œä¸‹å³å³ä¸Š å…¬å¼äº”(é¡¶å±‚è§’å—)ï¼šä¸Šå³ä¸Šï¼Œåº•å±‚è½¬180ï¼Œä¸‹å·¦ä¸Šï¼Œåº•å±‚è½¬180åº¦ï¼Œå³è¾¹è½¬180åº¦ å…¬å¼å…­(é¡¶å±‚æ£±å—)ï¼šä¸‹å·¦ä¸‹å³ï¼Œä¸‹å³ä¸‹å·¦ï¼Œä¸Šå·¦ï¼Œå³180åº¦ è®¤è¯†é­”æ–¹é­”æ–¹é¢ç»„æˆï¼šä¸­å¿ƒå—ï¼ˆ6ï¼‰ã€æ£±å—ï¼ˆ12ï¼‰ã€è§’å—ï¼ˆ8ï¼‰å›½é™…æ ‡å‡†é­”æ–¹é…è‰²ï¼š ç™½åº•é»„é¡¶,å·¦åˆ°å³çº¢è“æ©™ç»¿ ä½¿ç”¨æ–¹æ³•: å±‚å…ˆæ³•ï¼ˆå³ä¸€å±‚ä¸€å±‚è¿˜åŸï¼‰æœ¬æ¬¡ä»¥ç™½åº•é»„é¡¶ä½œä¸ºä½œä¸ºåæ ‡ç³» æ‹¼åº•å±‚åå­—ï¼ˆå°èŠ±/ç™½åå­—ï¼‰ é¡¶å±‚é»„å¿ƒç™½åå­—(å°èŠ±) æ¯ä¸ªç™½è‰²æ£±å—å¦ä¸€é¢ä¸æ¯ä¸€é¢çš„ä¸­å¿ƒå—é¢œè‰²ä¿æŒä¸€è‡´,å¹¶è½¬åˆ°åº•å±‚(ç™½é¢)å» åº•å±‚çº¯ç™½åå­—ï¼Œå¹¶ä¸”ç™½é¢æ£±å—çš„é¢œè‰²å’Œæ¯ä¸ªé¢çš„ä¸­å¿ƒè‰²ä¿æŒä¸€è‡´ è¿˜åŸç¬¬ä¸€å±‚å…¬å¼ä¸€ï¼ˆå³æ‰‹ï¼‰ï¼šä¸Šå·¦ä¸‹å³ è¿˜åŸå››ä¸ªåº•éƒ¨è§’å—ï¼š1.æ‰¾åˆ°é¡¶å±‚æœ‰ç™½è‰²é¢çš„è§’å—,è½¬åˆ°å¦å¤–ä¸¤ä¸ªé¢œè‰²é¢ä¸­é—´ï¼ˆå¦å¤–ä¸¤ä¸ªé¢œè‰²å‡ä¸æ˜¯é»„è‰²ï¼‰2.é‡å¤åšå…¬å¼ä¸€3.ç›´åˆ°ç™½è‰²é¢æœä¸‹,å¦å¤–ä¸¤ä¸ªé¢çš„é¢œè‰²å’Œä¸­å¿ƒå—å¯¹ä¸Š å¼‚å¸¸æƒ…å†µï¼š1.é‡åˆ°é¡¶å±‚æ²¡æœ‰ç™½è‰²è§’å—ï¼Œç™½è‰²è§’å—é¢ä¸€å®šé”™ä½åœ¨åº•éƒ¨ï¼Œåšå…¬å¼ä¸€ï¼Œå°†ç™½è‰²è½¬ä¸Šå»ï¼Œç„¶åç»§ç»­æŒ‰æ­¥éª¤è¿˜åŸ è¿˜åŸç¬¬äºŒå±‚å…¬å¼äºŒï¼ˆå·¦æ‰‹ï¼‰ï¼šä¸Šå³ä¸‹å·¦ è¿˜åŸä¸­é—´å±‚ï¼š1.æ‰¾åˆ°é¡¶å±‚æ£±å—ï¼ˆæ²¡æœ‰é»„è‰²é¢çš„æ£±å—ï¼‰ï¼Œå°†å…¶ä¸­ä¸€è‰²(æ­£é¢)å¯¹å‡†ä¸­å¿ƒå—,å¦ä¸€é¢è‰²ï¼ˆé¡¶é¢è‰²ï¼‰ä¸€å®šåœ¨é­”æ–¹çš„å·¦é¢æˆ–è€…å³é¢2.é¡¶é¢è‰²è¿œç¦»ç›¸åŒè‰²çš„é¢ï¼Œé¡¶é¢å±‚è½¬åŠ¨ä¸€é¢ 2.1 é¡¶é¢å±‚å‘å³è½¬ï¼Œåšå·¦æ‰‹å…¬å¼äºŒä¸€æ¬¡,å†å°†æ•´ä½“å‘å³è½¬ä¸€é¢ï¼Œåšå³æ‰‹å…¬å¼ä¸€ä¸€æ¬¡ 2.2 å®šé¢å±‚å‘å·¦è½¬ï¼Œåšå³æ‰‹å…¬å¼ä¸€ä¸€æ¬¡,å†å°†æ•´ä½“å‘å·¦è½¬ä¸€é¢ï¼Œåšå·¦æ‰‹å…¬å¼äºŒä¸€æ¬¡ å¼‚å¸¸æƒ…å†µï¼šé¡¶é¢æ£±å—å‡ºç°éƒ½æœ‰é»„è‰²é¢,ä½†æ˜¯ç¬¬äºŒå±‚æ²¡æœ‰è¿˜åŸçš„æƒ…å†µï¼Œå°†ä¸­é—´å±‚æ²¡æœ‰è¿˜åŸçš„æ£±å—æ”¾åœ¨å³æ‰‹è¾¹ï¼Œå³æ‰‹åšä¸€æ¬¡å…¬å¼ä¸€ï¼Œå‘å·¦è½¬ä¸€é¢ï¼Œå·¦æ‰‹åšä¸€æ¬¡å…¬å¼äºŒ æ‹¼é¡¶é¢åå­—ï¼ˆé»„åå­—ï¼‰å…¬å¼ä¸‰ï¼ˆå³æ‰‹ï¼‰ï¼šæ­£é¢é¡ºæ—¶é’ˆè½¬90åº¦ï¼Œå…¬å¼ä¸€ï¼ˆä¸Šå·¦ä¸‹å³ï¼‰ï¼Œé€†æ—¶é’ˆè½¬90åº¦å›å» æƒ…å†µä¸€ï¼šå•ç‹¬çš„ä¸€ä¸ªé»„è‰²ä¸­å¿ƒç‚¹æƒ…å†µäºŒï¼šä¸­å¿ƒç‚¹+å³ä¸‹æ£±å—æ˜¯é»„è‰²æƒ…å†µä¸‰ï¼šä¸€æ¡é»„è‰²çš„ç›´çº¿æƒ…å†µå››ï¼šé»„è‰²åå­— æƒ…å†µä¸€ã€äºŒã€ä¸‰éœ€è¦è½¬æ¢æˆæƒ…å†µå›› æƒ…å†µä¸€ï¼šåšå…¬å¼ä¸‰ä¸€æ¬¡æƒ…å†µäºŒï¼šå°æ‹å¼¯æ”¾åœ¨å³æ‰‹è¾¹ï¼ˆé»„é¡¶æœä¸Šï¼‰ï¼Œåšå…¬å¼ä¸‰ä¸€æ¬¡æƒ…å†µä¸‰ï¼šé»„è‰²ç›´çº¿å¹³è¡Œäºæˆ‘ä»¬æ”¾ï¼ˆé»„é¡¶æœä¸Šï¼‰ï¼Œåšå…¬å¼ä¸‰ä¸€æ¬¡ è¿˜åŸé¡¶é¢é¢œè‰²ï¼ˆå°é±¼ï¼‰å…¬å¼å››ï¼ˆå³æ‰‹ï¼‰ï¼š ä¸‹å³ä¸Šå³ï¼Œä¸‹å³å³ä¸Š æƒ…å†µä¸€ï¼šé¡¶é¢å°‘ä¸¤ä¸ªé»„è‰²ç‚¹æƒ…å†µäºŒï¼šé¡¶é¢å°‘å››ä¸ªé»„è‰²ç‚¹æƒ…å†µä¸‰ï¼šé¡¶é¢å°‘ä¸‰ä¸ªé»„è‰²ç‚¹ï¼ˆå°é±¼ï¼‰ æƒ…å†µä¸€ã€äºŒéœ€è¦è½¬æ¢å±‚ä¸‰ æƒ…å†µä¸€ï¼šå°†å·¦åæ–¹é¡¶å±‚æ”¾é»„è‰²ï¼Œé»„é¡¶æœä¸Šï¼Œåšå…¬å¼å››æƒ…å†µäºŒ: å°†åæ–¹é¡¶å±‚ä¸è¦æœ‰é»„è‰²ï¼Œé»„é¡¶æœä¸Šï¼Œåšå…¬å¼å›› æƒ…å†µä¸‰ï¼šé±¼å¤´æ”¾åœ¨å·¦ä¸Šæ–¹,é»„é¡¶æœä¸Šï¼Œåšå…¬å¼å›› å¯¹å¥½é¡¶å±‚è§’å—é¢œè‰²å…¬å¼äº”ï¼ˆå³æ‰‹ï¼‰ï¼šä¸Šå³ä¸Šï¼Œåº•å±‚è½¬180ï¼Œä¸‹å·¦ä¸Šï¼Œåº•å±‚è½¬180ï¼Œå³è¾¹è½¬180 é»„é¡¶æœä¸Šæ—¶å€™ï¼Œé¡¶å±‚æ‰¾åˆ°ä¸¤ä¸ªè§’å—é¢æ˜¯ä¸€æ ·çš„é¢œè‰²ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä»»æ„æœä¸‹ï¼‰ï¼Œæœä¸‹ï¼Œé»„é¢æœå‰ï¼Œåšå…¬å¼äº” è°ƒæ•´é¡¶å±‚æ£±å—å…¬å¼å…­ï¼ˆå³æ‰‹ï¼‰ï¼šä¸‹å·¦ä¸‹å³ï¼Œä¸‹å³ä¸‹å·¦ï¼Œä¸Šå·¦ï¼Œå³180åº¦ é»„é¡¶æœä¸Šï¼Œæ‰¾åˆ°ä¾§é¢å·²ç»è¿˜åŸå¥½çš„ä¸€ä¸ªé¢ï¼ˆæ²¡æœ‰åˆ™ä»»æ„é¢ï¼‰ï¼Œå¯¹ç€æ­£é¢ï¼Œç„¶ååšå…¬å¼å…­ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>å¨±ä¹</category>
      </categories>
      <tags>
        <tag>ä¸‰é˜¶</tag>
        <tag>é­”æ–¹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¬è€…è®°2021]]></title>
    <url>%2F2021%2F02%2F19%2Ftingzheji2021%2F</url>
    <content type="text"><![CDATA[æ¶‰çŒé˜…æœªé—»,è¹”ä½¿å¿ƒé­‚æ¾„ ã€Šå“æœ‰æˆæ•ˆçš„ç®¡ç†è€…ã€‹[2021-2-19] çœŸæ­£é‡è¦çš„ä¸æ˜¯è¶‹åŠ¿æœ¬èº«,è€Œæ˜¯è¶‹åŠ¿æ”¹å˜ã€‚ ã€Šé«˜æƒ…å•†æ˜¯ç»ƒå‡ºæ¥çš„ã€‹[2021-2-20] å¼ºè°ƒç†æ€§ä¸æ„Ÿæ€§ï¼Œæ¥æ”¶ä¸æ”¹å˜ä¹‹é—´çš„è¾©è¯å¹³è¡¡ä¸åè°ƒ ã€Šå¾®ç²¾é€šã€‹[2021-2-21] ç»™äººç”Ÿåˆ›å»ºä¸€ä¸ªæŠ½å¥–ç³»ç»Ÿ ã€Šé­”é¬¼ç»æµå­¦1ã€‹[2021-2-22] æŠ›å¼ƒå¸¸è§„æ€ç»´ï¼Œä»â€œæ•°æ®åˆ†æâ€çš„è§†è§’,æ¥æ‰¾äº‹æƒ…çš„çœŸç›¸ ã€Šé­”é¬¼ç»æµå­¦2ã€‹[2021-2-23] ä»å®¢è§‚äº‹å®å’Œæ•°æ®å‡ºå‘ï¼Œè€ƒå¯Ÿå…·ä½“æƒ…å¢ƒé‡Œäººä»¬é“å¾·é€‰æ‹© ã€Šé­”é¬¼ç»æµå­¦3ã€‹[2021-2-24] äººå·ç§°æ˜¯ç†æ€§åŠ¨ç‰©ï¼Œä½†ç°å®ä¸­çš„è¡Œä¸ºå´å¸¸å¸¸æ˜¯éç†æ€§çš„ ã€Šé­”é¬¼ç»æµå­¦4ã€‹[2021-2-25] ç”¨æ•°æ®ä¸ºçº¿ç´¢é‡‡ç”¨é­”é¬¼å¼æ€è€ƒ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>è§†é‡</category>
      </categories>
      <tags>
        <tag>è§†é‡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¡åˆ’2021]]></title>
    <url>%2F2021%2F02%2F19%2Fplan2021%2F</url>
    <content type="text"><![CDATA[ä»¥æ•™ä¸ºå­¦,æœ‰è¾“å…¥æœ‰è¾“å‡º ä¸ŠåŠå¹´ä¸»çº¿å·¥ä½œMySQLé˜¶æ®µä¸€ï¼š2021.01.17 ~ 2021.01.23ã€ŠMySQLç»„åˆæ‹³ã€‹ JVM(2021.01.25 ~ )å¤šçº¿ç¨‹å­¦ä¹ è½¯ä»¶è®¾è®¡å¸ˆ(2021.02.20 ~ 2021.05.x)ç”Ÿæ´»å¥èº«(2021.02.20 ~ 2021.05.x)æ”¯çº¿è®¾è®¡æ¨¡å¼é˜¶æ®µä¸€ï¼š2021.01.05ã€ŠJavaè®¾è®¡æ¨¡å¼ã€‹ ç®—æ³•NettyJavaåŸºç¡€å¼ºåŒ–å¬è€…è®°ã€Šå¬è€…è®°2021ã€‹ ä¸‹åŠå¹´ä¸»çº¿å·¥ä½œä¸­é—´ä»¶æ¡†æ¶å­¦ä¹ è½¯ä»¶æ¶æ„å¸ˆ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>è®¡åˆ’</category>
      </categories>
      <tags>
        <tag>è®¡åˆ’</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLæ•°æ®åº“ä¼˜åŒ–ä¹‹ç»„åˆæ‹³(å››)]]></title>
    <url>%2F2021%2F01%2F23%2Fmysql-advanced-4%2F</url>
    <content type="text"><![CDATA[éåŸåˆ›å›¾æ–‡,å›¾æ–‡æ¥æºäºé»‘é©¬å®˜ç½‘,æ­¤å¤„ä»…ä½œä¸ºå¤‡ä»½å­¦ä¹  MySQLæ•°æ®åº“ä¼˜åŒ–æ€»æ¦‚ ç»„åˆæ‹³ï¼ˆä¸€ï¼‰ ç»„åˆæ‹³ï¼ˆäºŒï¼‰ ç»„åˆæ‹³ï¼ˆä¸‰ï¼‰ ğŸš©ç»„åˆæ‹³ï¼ˆå››ï¼‰ ç´¢å¼• ä½“ç³»ç»“æ„ åº”ç”¨ä¼˜åŒ– MySQL å¸¸ç”¨å·¥å…· è§†å›¾ å­˜å‚¨å¼•æ“ æŸ¥è¯¢ç¼“å­˜ä¼˜åŒ– MySQL æ—¥å¿— å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•° ä¼˜åŒ–SQLæ­¥éª¤ å†…å­˜ç®¡ç†åŠä¼˜åŒ– MySQL ä¸»ä»å¤åˆ¶ è§¦å‘å™¨ ç´¢å¼•ä½¿ç”¨ MySQLé”é—®é¢˜ SQLä¼˜åŒ– å¸¸ç”¨SQLæŠ€å·§ 1. MySqlä¸­å¸¸ç”¨å·¥å…·1.1 mysqlè¯¥mysqlä¸æ˜¯æŒ‡mysqlæœåŠ¡ï¼Œè€Œæ˜¯æŒ‡mysqlçš„å®¢æˆ·ç«¯å·¥å…·ã€‚ è¯­æ³• ï¼š mysql [options] [database] 1.1.1 è¿æ¥é€‰é¡¹å‚æ•° ï¼š -u, --user=name æŒ‡å®šç”¨æˆ·å -p, --password[=name] æŒ‡å®šå¯†ç  -h, --host=name æŒ‡å®šæœåŠ¡å™¨IPæˆ–åŸŸå -P, --port=# æŒ‡å®šè¿æ¥ç«¯å£ ç¤ºä¾‹ ï¼š mysql -h 127.0.0.1 -P 3306 -u root -p mysql -h127.0.0.1 -P3306 -uroot -p2143 1.1.2 æ‰§è¡Œé€‰é¡¹-e, --execute=name æ‰§è¡ŒSQLè¯­å¥å¹¶é€€å‡º æ­¤é€‰é¡¹å¯ä»¥åœ¨Mysqlå®¢æˆ·ç«¯æ‰§è¡ŒSQLè¯­å¥ï¼Œè€Œä¸ç”¨è¿æ¥åˆ°MySQLæ•°æ®åº“å†æ‰§è¡Œï¼Œå¯¹äºä¸€äº›æ‰¹å¤„ç†è„šæœ¬ï¼Œè¿™ç§æ–¹å¼å°¤å…¶æ–¹ä¾¿ã€‚ ç¤ºä¾‹ï¼š mysql -uroot -p2143 db01 -e "select * from tb_book"; 1.2 mysqladminmysqladmin æ˜¯ä¸€ä¸ªæ‰§è¡Œç®¡ç†æ“ä½œçš„å®¢æˆ·ç«¯ç¨‹åºã€‚å¯ä»¥ç”¨å®ƒæ¥æ£€æŸ¥æœåŠ¡å™¨çš„é…ç½®å’Œå½“å‰çŠ¶æ€ã€åˆ›å»ºå¹¶åˆ é™¤æ•°æ®åº“ç­‰ã€‚ å¯ä»¥é€šè¿‡ ï¼š mysqladmin â€“help æŒ‡ä»¤æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£ ç¤ºä¾‹ ï¼š mysqladmin -uroot -p2143 create 'test01'; mysqladmin -uroot -p2143 drop 'test01'; mysqladmin -uroot -p2143 version; 1.3 mysqlbinlogç”±äºæœåŠ¡å™¨ç”Ÿæˆçš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ä»¥äºŒè¿›åˆ¶æ ¼å¼ä¿å­˜ï¼Œæ‰€ä»¥å¦‚æœæƒ³è¦æ£€æŸ¥è¿™äº›æ–‡æœ¬çš„æ–‡æœ¬æ ¼å¼ï¼Œå°±ä¼šä½¿ç”¨åˆ°mysqlbinlog æ—¥å¿—ç®¡ç†å·¥å…·ã€‚ è¯­æ³• ï¼š mysqlbinlog [options] log-files1 log-files2 ... é€‰é¡¹ï¼š -d, --database=name : æŒ‡å®šæ•°æ®åº“åç§°ï¼Œåªåˆ—å‡ºæŒ‡å®šçš„æ•°æ®åº“ç›¸å…³æ“ä½œã€‚ -o, --offset=# : å¿½ç•¥æ‰æ—¥å¿—ä¸­çš„å‰nè¡Œå‘½ä»¤ã€‚ -r,--result-file=name : å°†è¾“å‡ºçš„æ–‡æœ¬æ ¼å¼æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ã€‚ -s, --short-form : æ˜¾ç¤ºç®€å•æ ¼å¼ï¼Œ çœç•¥æ‰ä¸€äº›ä¿¡æ¯ã€‚ --start-datatime=date1 --stop-datetime=date2 : æŒ‡å®šæ—¥æœŸé—´éš”å†…çš„æ‰€æœ‰æ—¥å¿—ã€‚ --start-position=pos1 --stop-position=pos2 : æŒ‡å®šä½ç½®é—´éš”å†…çš„æ‰€æœ‰æ—¥å¿—ã€‚ 1.4 mysqldumpmysqldump å®¢æˆ·ç«¯å·¥å…·ç”¨æ¥å¤‡ä»½æ•°æ®åº“æˆ–åœ¨ä¸åŒæ•°æ®åº“ä¹‹é—´è¿›è¡Œæ•°æ®è¿ç§»ã€‚å¤‡ä»½å†…å®¹åŒ…å«åˆ›å»ºè¡¨ï¼ŒåŠæ’å…¥è¡¨çš„SQLè¯­å¥ã€‚ è¯­æ³• ï¼š mysqldump [options] db_name [tables] mysqldump [options] --database/-B db1 [db2 db3...] mysqldump [options] --all-databases/-A 1.4.1 è¿æ¥é€‰é¡¹å‚æ•° ï¼š -u, --user=name æŒ‡å®šç”¨æˆ·å -p, --password[=name] æŒ‡å®šå¯†ç  -h, --host=name æŒ‡å®šæœåŠ¡å™¨IPæˆ–åŸŸå -P, --port=# æŒ‡å®šè¿æ¥ç«¯å£ 1.4.2 è¾“å‡ºå†…å®¹é€‰é¡¹å‚æ•°ï¼š --add-drop-database åœ¨æ¯ä¸ªæ•°æ®åº“åˆ›å»ºè¯­å¥å‰åŠ ä¸Š Drop database è¯­å¥ --add-drop-table åœ¨æ¯ä¸ªè¡¨åˆ›å»ºè¯­å¥å‰åŠ ä¸Š Drop table è¯­å¥ , é»˜è®¤å¼€å¯ ; ä¸å¼€å¯ (--skip-add-drop-table) -n, --no-create-db ä¸åŒ…å«æ•°æ®åº“çš„åˆ›å»ºè¯­å¥ -t, --no-create-info ä¸åŒ…å«æ•°æ®è¡¨çš„åˆ›å»ºè¯­å¥ -d --no-data ä¸åŒ…å«æ•°æ® -T, --tab=name è‡ªåŠ¨ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼šä¸€ä¸ª.sqlæ–‡ä»¶ï¼Œåˆ›å»ºè¡¨ç»“æ„çš„è¯­å¥ï¼› ä¸€ä¸ª.txtæ–‡ä»¶ï¼Œæ•°æ®æ–‡ä»¶ï¼Œç›¸å½“äºselect into outfile ç¤ºä¾‹ ï¼š mysqldump -uroot -p2143 db01 tb_book --add-drop-database --add-drop-table &gt; a mysqldump -uroot -p2143 -T /tmp test city 1.5 mysqlimport/sourcemysqlimport æ˜¯å®¢æˆ·ç«¯æ•°æ®å¯¼å…¥å·¥å…·ï¼Œç”¨æ¥å¯¼å…¥mysqldump åŠ  -T å‚æ•°åå¯¼å‡ºçš„æ–‡æœ¬æ–‡ä»¶ã€‚ è¯­æ³•ï¼š mysqlimport [options] db_name textfile1 [textfile2...] ç¤ºä¾‹ï¼š mysqlimport -uroot -p2143 test /tmp/city.txt å¦‚æœéœ€è¦å¯¼å…¥sqlæ–‡ä»¶,å¯ä»¥ä½¿ç”¨mysqlä¸­çš„source æŒ‡ä»¤ : source /root/tb_book.sql 1.6 mysqlshowmysqlshow å®¢æˆ·ç«¯å¯¹è±¡æŸ¥æ‰¾å·¥å…·ï¼Œç”¨æ¥å¾ˆå¿«åœ°æŸ¥æ‰¾å­˜åœ¨å“ªäº›æ•°æ®åº“ã€æ•°æ®åº“ä¸­çš„è¡¨ã€è¡¨ä¸­çš„åˆ—æˆ–è€…ç´¢å¼•ã€‚ è¯­æ³•ï¼š mysqlshow [options] [db_name [table_name [col_name]]] å‚æ•°ï¼š --count æ˜¾ç¤ºæ•°æ®åº“åŠè¡¨çš„ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ•°æ®åº“ï¼Œè¡¨ å‡å¯ä»¥ä¸æŒ‡å®šï¼‰ -i æ˜¾ç¤ºæŒ‡å®šæ•°æ®åº“æˆ–è€…æŒ‡å®šè¡¨çš„çŠ¶æ€ä¿¡æ¯ ç¤ºä¾‹ï¼š #æŸ¥è¯¢æ¯ä¸ªæ•°æ®åº“çš„è¡¨çš„æ•°é‡åŠè¡¨ä¸­è®°å½•çš„æ•°é‡ mysqlshow -uroot -p2143 --count #æŸ¥è¯¢teståº“ä¸­æ¯ä¸ªè¡¨ä¸­çš„å­—æ®µä¹¦ï¼ŒåŠè¡Œæ•° mysqlshow -uroot -p2143 test --count #æŸ¥è¯¢teståº“ä¸­bookè¡¨çš„è¯¦ç»†æƒ…å†µ mysqlshow -uroot -p2143 test book --count 2. Mysql æ—¥å¿—åœ¨ä»»ä½•ä¸€ç§æ•°æ®åº“ä¸­ï¼Œéƒ½ä¼šæœ‰å„ç§å„æ ·çš„æ—¥å¿—ï¼Œè®°å½•ç€æ•°æ®åº“å·¥ä½œçš„æ–¹æ–¹é¢é¢ï¼Œä»¥å¸®åŠ©æ•°æ®åº“ç®¡ç†å‘˜è¿½è¸ªæ•°æ®åº“æ›¾ç»å‘ç”Ÿè¿‡çš„å„ç§äº‹ä»¶ã€‚MySQL ä¹Ÿä¸ä¾‹å¤–ï¼Œåœ¨ MySQL ä¸­ï¼Œæœ‰ 4 ç§ä¸åŒçš„æ—¥å¿—ï¼Œåˆ†åˆ«æ˜¯é”™è¯¯æ—¥å¿—ã€äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBINLOG æ—¥å¿—ï¼‰ã€æŸ¥è¯¢æ—¥å¿—å’Œæ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè¿™äº›æ—¥å¿—è®°å½•ç€æ•°æ®åº“åœ¨ä¸åŒæ–¹é¢çš„è¸ªè¿¹ã€‚ 2.1 é”™è¯¯æ—¥å¿—é”™è¯¯æ—¥å¿—æ˜¯ MySQL ä¸­æœ€é‡è¦çš„æ—¥å¿—ä¹‹ä¸€ï¼Œå®ƒè®°å½•äº†å½“ mysqld å¯åŠ¨å’Œåœæ­¢æ—¶ï¼Œä»¥åŠæœåŠ¡å™¨åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿä»»ä½•ä¸¥é‡é”™è¯¯æ—¶çš„ç›¸å…³ä¿¡æ¯ã€‚å½“æ•°æ®åº“å‡ºç°ä»»ä½•æ•…éšœå¯¼è‡´æ— æ³•æ­£å¸¸ä½¿ç”¨æ—¶ï¼Œå¯ä»¥é¦–å…ˆæŸ¥çœ‹æ­¤æ—¥å¿—ã€‚ è¯¥æ—¥å¿—æ˜¯é»˜è®¤å¼€å¯çš„ ï¼Œ é»˜è®¤å­˜æ”¾ç›®å½•ä¸º mysql çš„æ•°æ®ç›®å½•ï¼ˆvar/lib/mysqlï¼‰, é»˜è®¤çš„æ—¥å¿—æ–‡ä»¶åä¸º hostname.errï¼ˆhostnameæ˜¯ä¸»æœºåï¼‰ã€‚ æŸ¥çœ‹æ—¥å¿—ä½ç½®æŒ‡ä»¤ ï¼š show variables like 'log_error%'; æŸ¥çœ‹æ—¥å¿—å†…å®¹ ï¼š tail -f /var/lib/mysql/xaxh-server.err 2.2 äºŒè¿›åˆ¶æ—¥å¿—2.2.1æ¦‚è¿°äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBINLOGï¼‰è®°å½•äº†æ‰€æœ‰çš„ DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰è¯­å¥å’Œ DMLï¼ˆæ•°æ®æ“çºµè¯­è¨€ï¼‰è¯­å¥ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬æ•°æ®æŸ¥è¯¢è¯­å¥ã€‚æ­¤æ—¥å¿—å¯¹äºç¾éš¾æ—¶çš„æ•°æ®æ¢å¤èµ·ç€æå…¶é‡è¦çš„ä½œç”¨ï¼ŒMySQLçš„ä¸»ä»å¤åˆ¶ï¼Œ å°±æ˜¯é€šè¿‡è¯¥binlogå®ç°çš„ã€‚ äºŒè¿›åˆ¶æ—¥å¿—ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯æ²¡æœ‰å¼€å¯çš„ï¼Œéœ€è¦åˆ°MySQLçš„é…ç½®æ–‡ä»¶ä¸­å¼€å¯ï¼Œå¹¶é…ç½®MySQLæ—¥å¿—çš„æ ¼å¼ã€‚ é…ç½®æ–‡ä»¶ä½ç½® : /usr/my.cnf æ—¥å¿—å­˜æ”¾ä½ç½® : é…ç½®æ—¶ï¼Œç»™å®šäº†æ–‡ä»¶åä½†æ˜¯æ²¡æœ‰æŒ‡å®šè·¯å¾„ï¼Œæ—¥å¿—é»˜è®¤å†™å…¥Mysqlçš„æ•°æ®ç›®å½•ã€‚ #é…ç½®å¼€å¯binlogæ—¥å¿—ï¼Œ æ—¥å¿—çš„æ–‡ä»¶å‰ç¼€ä¸º mysqlbin -----&gt; ç”Ÿæˆçš„æ–‡ä»¶åå¦‚ : mysqlbin.000001,mysqlbin.000002 log_bin=mysqlbin #é…ç½®äºŒè¿›åˆ¶æ—¥å¿—çš„æ ¼å¼ binlog_format=STATEMENT 2.2.2 æ—¥å¿—æ ¼å¼STATEMENT è¯¥æ—¥å¿—æ ¼å¼åœ¨æ—¥å¿—æ–‡ä»¶ä¸­è®°å½•çš„éƒ½æ˜¯SQLè¯­å¥ï¼ˆstatementï¼‰ï¼Œæ¯ä¸€æ¡å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹çš„SQLéƒ½ä¼šè®°å½•åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œé€šè¿‡Mysqlæä¾›çš„mysqlbinlogå·¥å…·ï¼Œå¯ä»¥æ¸…æ™°çš„æŸ¥çœ‹åˆ°æ¯æ¡è¯­å¥çš„æ–‡æœ¬ã€‚ä¸»ä»å¤åˆ¶çš„æ—¶å€™ï¼Œä»åº“ï¼ˆslaveï¼‰ä¼šå°†æ—¥å¿—è§£æä¸ºåŸæ–‡æœ¬ï¼Œå¹¶åœ¨ä»åº“é‡æ–°æ‰§è¡Œä¸€æ¬¡ã€‚ ROW è¯¥æ—¥å¿—æ ¼å¼åœ¨æ—¥å¿—æ–‡ä»¶ä¸­è®°å½•çš„æ˜¯æ¯ä¸€è¡Œçš„æ•°æ®å˜æ›´ï¼Œè€Œä¸æ˜¯è®°å½•SQLè¯­å¥ã€‚æ¯”å¦‚ï¼Œæ‰§è¡ŒSQLè¯­å¥ ï¼š update tb_book set status=â€™1â€™ , å¦‚æœæ˜¯STATEMENT æ—¥å¿—æ ¼å¼ï¼Œåœ¨æ—¥å¿—ä¸­ä¼šè®°å½•ä¸€è¡ŒSQLæ–‡ä»¶ï¼› å¦‚æœæ˜¯ROWï¼Œç”±äºæ˜¯å¯¹å…¨è¡¨è¿›è¡Œæ›´æ–°ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€è¡Œè®°å½•éƒ½ä¼šå‘ç”Ÿå˜æ›´ï¼ŒROW æ ¼å¼çš„æ—¥å¿—ä¸­ä¼šè®°å½•æ¯ä¸€è¡Œçš„æ•°æ®å˜æ›´ã€‚ MIXED è¿™æ˜¯ç›®å‰MySQLé»˜è®¤çš„æ—¥å¿—æ ¼å¼ï¼Œå³æ··åˆäº†STATEMENT å’Œ ROWä¸¤ç§æ ¼å¼ã€‚é»˜è®¤æƒ…å†µä¸‹é‡‡ç”¨STATEMENTï¼Œä½†æ˜¯åœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹é‡‡ç”¨ROWæ¥è¿›è¡Œè®°å½•ã€‚MIXED æ ¼å¼èƒ½å°½é‡åˆ©ç”¨ä¸¤ç§æ¨¡å¼çš„ä¼˜ç‚¹ï¼Œè€Œé¿å¼€ä»–ä»¬çš„ç¼ºç‚¹ã€‚ 2.2.3 æ—¥å¿—è¯»å–ç”±äºæ—¥å¿—ä»¥äºŒè¿›åˆ¶æ–¹å¼å­˜å‚¨ï¼Œä¸èƒ½ç›´æ¥è¯»å–ï¼Œéœ€è¦ç”¨mysqlbinlogå·¥å…·æ¥æŸ¥çœ‹ï¼Œè¯­æ³•å¦‚ä¸‹ ï¼š mysqlbinlog log-fileï¼› æŸ¥çœ‹STATEMENTæ ¼å¼æ—¥å¿— æ‰§è¡Œæ’å…¥è¯­å¥ ï¼š insert into tb_book values(null,'Lucene','2088-05-01','0'); æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ ï¼š mysqlbin.index : è¯¥æ–‡ä»¶æ˜¯æ—¥å¿—ç´¢å¼•æ–‡ä»¶ ï¼Œ è®°å½•æ—¥å¿—çš„æ–‡ä»¶åï¼› mysqlbing.000001 ï¼šæ—¥å¿—æ–‡ä»¶ æŸ¥çœ‹æ—¥å¿—å†…å®¹ ï¼š mysqlbinlog mysqlbing.000001ï¼› æŸ¥çœ‹ROWæ ¼å¼æ—¥å¿— é…ç½® : #é…ç½®å¼€å¯binlogæ—¥å¿—ï¼Œ æ—¥å¿—çš„æ–‡ä»¶å‰ç¼€ä¸º mysqlbin -----&gt; ç”Ÿæˆçš„æ–‡ä»¶åå¦‚ : mysqlbin.000001,mysqlbin.000002 log_bin=mysqlbin #é…ç½®äºŒè¿›åˆ¶æ—¥å¿—çš„æ ¼å¼ binlog_format=ROW æ’å…¥æ•°æ® : insert into tb_book values(null,'SpringCloudå®æˆ˜','2088-05-05','0'); å¦‚æœæ—¥å¿—æ ¼å¼æ˜¯ ROW , ç›´æ¥æŸ¥çœ‹æ•°æ® , æ˜¯æŸ¥çœ‹ä¸æ‡‚çš„ ; å¯ä»¥åœ¨mysqlbinlog åé¢åŠ ä¸Šå‚æ•° -vv mysqlbinlog -vv mysqlbin.000002 2.2.4 æ—¥å¿—åˆ é™¤å¯¹äºæ¯”è¾ƒç¹å¿™çš„ç³»ç»Ÿï¼Œç”±äºæ¯å¤©ç”Ÿæˆæ—¥å¿—é‡å¤§ ï¼Œè¿™äº›æ—¥å¿—å¦‚æœé•¿æ—¶é—´ä¸æ¸…æ¥šï¼Œå°†ä¼šå ç”¨å¤§é‡çš„ç£ç›˜ç©ºé—´ã€‚ä¸‹é¢æˆ‘ä»¬å°†ä¼šè®²è§£å‡ ç§åˆ é™¤æ—¥å¿—çš„å¸¸è§æ–¹æ³• ï¼š æ–¹å¼ä¸€ é€šè¿‡ Reset Master æŒ‡ä»¤åˆ é™¤å…¨éƒ¨ binlog æ—¥å¿—ï¼Œåˆ é™¤ä¹‹åï¼Œæ—¥å¿—ç¼–å·ï¼Œå°†ä» xxxx.000001é‡æ–°å¼€å§‹ ã€‚ æŸ¥è¯¢ä¹‹å‰ ï¼Œå…ˆæŸ¥è¯¢ä¸‹æ—¥å¿—æ–‡ä»¶ ï¼š æ‰§è¡Œåˆ é™¤æ—¥å¿—æŒ‡ä»¤ï¼š Reset Master æ‰§è¡Œä¹‹åï¼Œ æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ ï¼š æ–¹å¼äºŒ æ‰§è¡ŒæŒ‡ä»¤ purge master logs to 'mysqlbin.******' ï¼Œè¯¥å‘½ä»¤å°†åˆ é™¤ ****** ç¼–å·ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—ã€‚ æ–¹å¼ä¸‰ æ‰§è¡ŒæŒ‡ä»¤ purge master logs before 'yyyy-mm-dd hh24:mi:ss' ï¼Œè¯¥å‘½ä»¤å°†åˆ é™¤æ—¥å¿—ä¸º â€œyyyy-mm-dd hh24:mi:ssâ€ ä¹‹å‰äº§ç”Ÿçš„æ‰€æœ‰æ—¥å¿— ã€‚ æ–¹å¼å›› è®¾ç½®å‚æ•° â€“expire_logs_days=# ï¼Œæ­¤å‚æ•°çš„å«ä¹‰æ˜¯è®¾ç½®æ—¥å¿—çš„è¿‡æœŸå¤©æ•°ï¼Œ è¿‡äº†æŒ‡å®šçš„å¤©æ•°åæ—¥å¿—å°†ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œè¿™æ ·å°†æœ‰åˆ©äºå‡å°‘DBA ç®¡ç†æ—¥å¿—çš„å·¥ä½œé‡ã€‚ é…ç½®å¦‚ä¸‹ ï¼š 2.3 æŸ¥è¯¢æ—¥å¿—æŸ¥è¯¢æ—¥å¿—ä¸­è®°å½•äº†å®¢æˆ·ç«¯çš„æ‰€æœ‰æ“ä½œè¯­å¥ï¼Œè€ŒäºŒè¿›åˆ¶æ—¥å¿—ä¸åŒ…å«æŸ¥è¯¢æ•°æ®çš„SQLè¯­å¥ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ æŸ¥è¯¢æ—¥å¿—æ˜¯æœªå¼€å¯çš„ã€‚å¦‚æœéœ€è¦å¼€å¯æŸ¥è¯¢æ—¥å¿—ï¼Œå¯ä»¥è®¾ç½®ä»¥ä¸‹é…ç½® ï¼š #è¯¥é€‰é¡¹ç”¨æ¥å¼€å¯æŸ¥è¯¢æ—¥å¿— ï¼Œ å¯é€‰å€¼ ï¼š 0 æˆ–è€… 1 ï¼› 0 ä»£è¡¨å…³é—­ï¼Œ 1 ä»£è¡¨å¼€å¯ general_log=1 #è®¾ç½®æ—¥å¿—çš„æ–‡ä»¶å ï¼Œ å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œ é»˜è®¤çš„æ–‡ä»¶åä¸º host_name.log general_log_file=file_name åœ¨ mysql çš„é…ç½®æ–‡ä»¶ /usr/my.cnf ä¸­é…ç½®å¦‚ä¸‹å†…å®¹ ï¼š é…ç½®å®Œæ¯•ä¹‹åï¼Œåœ¨æ•°æ®åº“æ‰§è¡Œä»¥ä¸‹æ“ä½œ ï¼š select * from tb_book; select * from tb_book where id = 1; update tb_book set name = 'luceneå…¥é—¨æŒ‡å—' where id = 5; select * from tb_book where id &lt; 8; æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œ å†æ¬¡æ¥æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ ï¼š 2.4 æ…¢æŸ¥è¯¢æ—¥å¿—æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•äº†æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡å‚æ•° long_query_time è®¾ç½®å€¼å¹¶ä¸”æ‰«æè®°å½•æ•°ä¸å°äº min_examined_row_limit çš„æ‰€æœ‰çš„SQLè¯­å¥çš„æ—¥å¿—ã€‚long_query_time é»˜è®¤ä¸º 10 ç§’ï¼Œæœ€å°ä¸º 0ï¼Œ ç²¾åº¦å¯ä»¥åˆ°å¾®ç§’ã€‚ 2.4.1 æ–‡ä»¶ä½ç½®å’Œæ ¼å¼æ…¢æŸ¥è¯¢æ—¥å¿—é»˜è®¤æ˜¯å…³é—­çš„ ã€‚å¯ä»¥é€šè¿‡ä¸¤ä¸ªå‚æ•°æ¥æ§åˆ¶æ…¢æŸ¥è¯¢æ—¥å¿— ï¼š # è¯¥å‚æ•°ç”¨æ¥æ§åˆ¶æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¼€å¯ï¼Œ å¯å–å€¼ï¼š 1 å’Œ 0 ï¼Œ 1 ä»£è¡¨å¼€å¯ï¼Œ 0 ä»£è¡¨å…³é—­ slow_query_log=1 # è¯¥å‚æ•°ç”¨æ¥æŒ‡å®šæ…¢æŸ¥è¯¢æ—¥å¿—çš„æ–‡ä»¶å slow_query_log_file=slow_query.log # è¯¥é€‰é¡¹ç”¨æ¥é…ç½®æŸ¥è¯¢çš„æ—¶é—´é™åˆ¶ï¼Œ è¶…è¿‡è¿™ä¸ªæ—¶é—´å°†è®¤ä¸ºå€¼æ…¢æŸ¥è¯¢ï¼Œ å°†éœ€è¦è¿›è¡Œæ—¥å¿—è®°å½•ï¼Œ é»˜è®¤10s long_query_time=10 2.4.2 æ—¥å¿—çš„è¯»å–å’Œé”™è¯¯æ—¥å¿—ã€æŸ¥è¯¢æ—¥å¿—ä¸€æ ·ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•çš„æ ¼å¼ä¹Ÿæ˜¯çº¯æ–‡æœ¬ï¼Œå¯ä»¥è¢«ç›´æ¥è¯»å–ã€‚ 1ï¼‰ æŸ¥è¯¢long_query_time çš„å€¼ã€‚ 2ï¼‰ æ‰§è¡ŒæŸ¥è¯¢æ“ä½œ select id, title,price,num ,status from tb_item where id = 1; ç”±äºè¯¥è¯­å¥æ‰§è¡Œæ—¶é—´å¾ˆçŸ­ï¼Œä¸º0s ï¼Œ æ‰€ä»¥ä¸ä¼šè®°å½•åœ¨æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚ select * from tb_item where title like '%é˜¿å°”å¡ç‰¹ (OT-927) ç‚­é»‘ è”é€š3Gæ‰‹æœº åŒå¡åŒå¾…165454%' ; è¯¥SQLè¯­å¥ ï¼Œ æ‰§è¡Œæ—¶é•¿ä¸º 26.77s ï¼Œè¶…è¿‡10s ï¼Œ æ‰€ä»¥ä¼šè®°å½•åœ¨æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ä¸­ã€‚ 3ï¼‰ æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ ç›´æ¥é€šè¿‡cat æŒ‡ä»¤æŸ¥è¯¢è¯¥æ—¥å¿—æ–‡ä»¶ ï¼š å¦‚æœæ…¢æŸ¥è¯¢æ—¥å¿—å†…å®¹å¾ˆå¤šï¼Œ ç›´æ¥æŸ¥çœ‹æ–‡ä»¶ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œ è¿™ä¸ªæ—¶å€™å¯ä»¥å€ŸåŠ©äºmysqlè‡ªå¸¦çš„ mysqldumpslow å·¥å…·ï¼Œ æ¥å¯¹æ…¢æŸ¥è¯¢æ—¥å¿—è¿›è¡Œåˆ†ç±»æ±‡æ€»ã€‚ 3. Mysqlå¤åˆ¶3.1 å¤åˆ¶æ¦‚è¿°å¤åˆ¶æ˜¯æŒ‡å°†ä¸»æ•°æ®åº“çš„DDL å’Œ DML æ“ä½œé€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—ä¼ åˆ°ä»åº“æœåŠ¡å™¨ä¸­ï¼Œç„¶ååœ¨ä»åº“ä¸Šå¯¹è¿™äº›æ—¥å¿—é‡æ–°æ‰§è¡Œï¼ˆä¹Ÿå«é‡åšï¼‰ï¼Œä»è€Œä½¿å¾—ä»åº“å’Œä¸»åº“çš„æ•°æ®ä¿æŒåŒæ­¥ã€‚ MySQLæ”¯æŒä¸€å°ä¸»åº“åŒæ—¶å‘å¤šå°ä»åº“è¿›è¡Œå¤åˆ¶ï¼Œ ä»åº“åŒæ—¶ä¹Ÿå¯ä»¥ä½œä¸ºå…¶ä»–ä»æœåŠ¡å™¨çš„ä¸»åº“ï¼Œå®ç°é“¾çŠ¶å¤åˆ¶ã€‚ 3.2 å¤åˆ¶åŸç†MySQL çš„ä¸»ä»å¤åˆ¶åŸç†å¦‚ä¸‹ã€‚ ä»ä¸Šå±‚æ¥çœ‹ï¼Œå¤åˆ¶åˆ†æˆä¸‰æ­¥ï¼š Master ä¸»åº“åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œä¼šæŠŠæ•°æ®å˜æ›´ä½œä¸ºæ—¶é—´ Events è®°å½•åœ¨äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ Binlog ä¸­ã€‚ ä¸»åº“æ¨é€äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ Binlog ä¸­çš„æ—¥å¿—äº‹ä»¶åˆ°ä»åº“çš„ä¸­ç»§æ—¥å¿— Relay Log ã€‚ slaveé‡åšä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†æ”¹å˜åæ˜ å®ƒè‡ªå·±çš„æ•°æ®ã€‚ 3.3 å¤åˆ¶ä¼˜åŠ¿MySQL å¤åˆ¶çš„æœ‰ç‚¹ä¸»è¦åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š ä¸»åº“å‡ºç°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿåˆ‡æ¢åˆ°ä»åº“æä¾›æœåŠ¡ã€‚ å¯ä»¥åœ¨ä»åº“ä¸Šæ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œä»ä¸»åº“ä¸­æ›´æ–°ï¼Œå®ç°è¯»å†™åˆ†ç¦»ï¼Œé™ä½ä¸»åº“çš„è®¿é—®å‹åŠ›ã€‚ å¯ä»¥åœ¨ä»åº“ä¸­æ‰§è¡Œå¤‡ä»½ï¼Œä»¥é¿å…å¤‡ä»½æœŸé—´å½±å“ä¸»åº“çš„æœåŠ¡ã€‚ 3.4 æ­å»ºæ­¥éª¤3.4.1 master1ï¼‰ åœ¨master çš„é…ç½®æ–‡ä»¶ï¼ˆ/usr/my.cnfï¼‰ä¸­ï¼Œé…ç½®å¦‚ä¸‹å†…å®¹ï¼š #mysql æœåŠ¡ID,ä¿è¯æ•´ä¸ªé›†ç¾¤ç¯å¢ƒä¸­å”¯ä¸€ server-id=1 #mysql binlog æ—¥å¿—çš„å­˜å‚¨è·¯å¾„å’Œæ–‡ä»¶å log-bin=/var/lib/mysql/mysqlbin #é”™è¯¯æ—¥å¿—,é»˜è®¤å·²ç»å¼€å¯ #log-err #mysqlçš„å®‰è£…ç›®å½• #basedir #mysqlçš„ä¸´æ—¶ç›®å½• #tmpdir #mysqlçš„æ•°æ®å­˜æ”¾ç›®å½• #datadir #æ˜¯å¦åªè¯»,1 ä»£è¡¨åªè¯», 0 ä»£è¡¨è¯»å†™ read-only=0 #å¿½ç•¥çš„æ•°æ®, æŒ‡ä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“ binlog-ignore-db=mysql #æŒ‡å®šåŒæ­¥çš„æ•°æ®åº“ #binlog-do-db=db01 2ï¼‰ æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œéœ€è¦é‡å¯Mysqlï¼š service mysql restart ï¼› 3ï¼‰ åˆ›å»ºåŒæ­¥æ•°æ®çš„è´¦æˆ·ï¼Œå¹¶ä¸”è¿›è¡Œæˆæƒæ“ä½œï¼š grant replication slave on *.* to 'itcast'@'192.168.192.131' identified by 'itcast'; flush privileges; 4ï¼‰ æŸ¥çœ‹masterçŠ¶æ€ï¼š show master status; å­—æ®µå«ä¹‰ï¼š File : ä»å“ªä¸ªæ—¥å¿—æ–‡ä»¶å¼€å§‹æ¨é€æ—¥å¿—æ–‡ä»¶ Position ï¼š ä»å“ªä¸ªä½ç½®å¼€å§‹æ¨é€æ—¥å¿— Binlog_Ignore_DB : æŒ‡å®šä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“ 3.4.2 slave1ï¼‰ åœ¨ slave ç«¯é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®å¦‚ä¸‹å†…å®¹ï¼š #mysqlæœåŠ¡ç«¯ID,å”¯ä¸€ server-id=2 #æŒ‡å®šbinlogæ—¥å¿— log-bin=/var/lib/mysql/mysqlbin 2ï¼‰ æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œéœ€è¦é‡å¯Mysqlï¼š service mysql restartï¼› 3ï¼‰ æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ ï¼š change master to master_host= '192.168.192.130', master_user='itcast', master_password='itcast', master_log_file='mysqlbin.000001', master_log_pos=413; æŒ‡å®šå½“å‰ä»åº“å¯¹åº”çš„ä¸»åº“çš„IPåœ°å€ï¼Œç”¨æˆ·åï¼Œå¯†ç ï¼Œä»å“ªä¸ªæ—¥å¿—æ–‡ä»¶å¼€å§‹çš„é‚£ä¸ªä½ç½®å¼€å§‹åŒæ­¥æ¨é€æ—¥å¿—ã€‚ 4ï¼‰ å¼€å¯åŒæ­¥æ“ä½œ start slave; show slave status; 5ï¼‰ åœæ­¢åŒæ­¥æ“ä½œ stop slave; 3.4.3 éªŒè¯åŒæ­¥æ“ä½œ1ï¼‰ åœ¨ä¸»åº“ä¸­åˆ›å»ºæ•°æ®åº“ï¼Œåˆ›å»ºè¡¨ï¼Œå¹¶æ’å…¥æ•°æ® ï¼š create database db01; user db01; create table user( id int(11) not null auto_increment, name varchar(50) not null, sex varchar(1), primary key (id) )engine=innodb default charset=utf8; insert into user(id,name,sex) values(null,'Tom','1'); insert into user(id,name,sex) values(null,'Trigger','0'); insert into user(id,name,sex) values(null,'Dawn','1'); 2ï¼‰ åœ¨ä»åº“ä¸­æŸ¥è¯¢æ•°æ®ï¼Œè¿›è¡ŒéªŒè¯ ï¼š åœ¨ä»åº“ä¸­ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°åˆšæ‰åˆ›å»ºçš„æ•°æ®åº“ï¼š åœ¨è¯¥æ•°æ®åº“ä¸­ï¼ŒæŸ¥è¯¢userè¡¨ä¸­çš„æ•°æ®ï¼š document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQLæ•°æ®åº“ä¼˜åŒ–ä¹‹ç»„åˆæ‹³(å››)</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLæ•°æ®åº“ä¼˜åŒ–ä¹‹ç»„åˆæ‹³(ä¸‰)]]></title>
    <url>%2F2021%2F01%2F23%2Fmysql-advanced-3%2F</url>
    <content type="text"><![CDATA[éåŸåˆ›å›¾æ–‡,å›¾æ–‡æ¥æºäºé»‘é©¬å®˜ç½‘,æ­¤å¤„ä»…ä½œä¸ºå¤‡ä»½å­¦ä¹  MySQLæ•°æ®åº“ä¼˜åŒ–æ€»æ¦‚ ç»„åˆæ‹³ï¼ˆä¸€ï¼‰ ç»„åˆæ‹³ï¼ˆäºŒï¼‰ ğŸš©ç»„åˆæ‹³ï¼ˆä¸‰ï¼‰ ç»„åˆæ‹³ï¼ˆå››ï¼‰ ç´¢å¼• ä½“ç³»ç»“æ„ åº”ç”¨ä¼˜åŒ– MySQL å¸¸ç”¨å·¥å…· è§†å›¾ å­˜å‚¨å¼•æ“ æŸ¥è¯¢ç¼“å­˜ä¼˜åŒ– MySQL æ—¥å¿— å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•° ä¼˜åŒ–SQLæ­¥éª¤ å†…å­˜ç®¡ç†åŠä¼˜åŒ– MySQL ä¸»ä»å¤åˆ¶ è§¦å‘å™¨ ç´¢å¼•ä½¿ç”¨ MySQLé”é—®é¢˜ SQLä¼˜åŒ– å¸¸ç”¨SQLæŠ€å·§ 1. åº”ç”¨ä¼˜åŒ–å‰é¢ç« èŠ‚ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¾ˆå¤šæ•°æ®åº“çš„ä¼˜åŒ–æªæ–½ã€‚ä½†æ˜¯åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œç”±äºæ•°æ®åº“æœ¬èº«çš„æ€§èƒ½å±€é™ï¼Œå°±å¿…é¡»è¦å¯¹å‰å°çš„åº”ç”¨è¿›è¡Œä¸€äº›ä¼˜åŒ–ï¼Œæ¥é™ä½æ•°æ®åº“çš„è®¿é—®å‹åŠ›ã€‚ 1.1 ä½¿ç”¨è¿æ¥æ± å¯¹äºè®¿é—®æ•°æ®åº“æ¥è¯´ï¼Œå»ºç«‹è¿æ¥çš„ä»£ä»·æ˜¯æ¯”è¾ƒæ˜‚è´µçš„ï¼Œå› ä¸ºæˆ‘ä»¬é¢‘ç¹çš„åˆ›å»ºå…³é—­è¿æ¥ï¼Œæ˜¯æ¯”è¾ƒè€—è´¹èµ„æºçš„ï¼Œæˆ‘ä»¬æœ‰å¿…è¦å»ºç«‹ æ•°æ®åº“è¿æ¥æ± ï¼Œä»¥æé«˜è®¿é—®çš„æ€§èƒ½ã€‚ 1.2 å‡å°‘å¯¹MySQLçš„è®¿é—®1.2.1 é¿å…å¯¹æ•°æ®è¿›è¡Œé‡å¤æ£€ç´¢åœ¨ç¼–å†™åº”ç”¨ä»£ç æ—¶ï¼Œéœ€è¦èƒ½å¤Ÿç†æ¸…å¯¹æ•°æ®åº“çš„è®¿é—®é€»è¾‘ã€‚èƒ½å¤Ÿä¸€æ¬¡è¿æ¥å°±è·å–åˆ°ç»“æœçš„ï¼Œå°±ä¸ç”¨ä¸¤æ¬¡è¿æ¥ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§å‡å°‘å¯¹æ•°æ®åº“æ— ç”¨çš„é‡å¤è¯·æ±‚ã€‚ æ¯”å¦‚ ï¼Œéœ€è¦è·å–ä¹¦ç±çš„id å’Œnameå­—æ®µ ï¼Œ åˆ™æŸ¥è¯¢å¦‚ä¸‹ï¼š select id , name from tb_book; ä¹‹åï¼Œåœ¨ä¸šåŠ¡é€»è¾‘ä¸­æœ‰éœ€è¦è·å–åˆ°ä¹¦ç±çŠ¶æ€ä¿¡æ¯ï¼Œ åˆ™æŸ¥è¯¢å¦‚ä¸‹ï¼š select id , status from tb_book; è¿™æ ·ï¼Œå°±éœ€è¦å‘æ•°æ®åº“æäº¤ä¸¤æ¬¡è¯·æ±‚ï¼Œæ•°æ®åº“å°±è¦åšä¸¤æ¬¡æŸ¥è¯¢æ“ä½œã€‚å…¶å®å®Œå…¨å¯ä»¥ç”¨ä¸€æ¡SQLè¯­å¥å¾—åˆ°æƒ³è¦çš„ç»“æœã€‚ select id, name , status from tb_book; 1.2.2 å¢åŠ cacheå±‚åœ¨åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ä¸­å¢åŠ  ç¼“å­˜ å±‚æ¥è¾¾åˆ°å‡è½»æ•°æ®åº“è´Ÿæ‹…çš„ç›®çš„ã€‚ç¼“å­˜å±‚æœ‰å¾ˆå¤šç§ï¼Œä¹Ÿæœ‰å¾ˆå¤šå®ç°æ–¹å¼ï¼Œåªè¦èƒ½è¾¾åˆ°é™ä½æ•°æ®åº“çš„è´Ÿæ‹…åˆèƒ½æ»¡è¶³åº”ç”¨éœ€æ±‚å°±å¯ä»¥ã€‚ å› æ­¤å¯ä»¥éƒ¨åˆ†æ•°æ®ä»æ•°æ®åº“ä¸­æŠ½å–å‡ºæ¥æ”¾åˆ°åº”ç”¨ç«¯ä»¥æ–‡æœ¬æ–¹å¼å­˜å‚¨ï¼Œ æˆ–è€…ä½¿ç”¨æ¡†æ¶(Mybatis, Hibernate)æä¾›çš„ä¸€çº§ç¼“å­˜/äºŒçº§ç¼“å­˜ï¼Œæˆ–è€…ä½¿ç”¨redisæ•°æ®åº“æ¥ç¼“å­˜æ•°æ® ã€‚ 1.3 è´Ÿè½½å‡è¡¡è´Ÿè½½å‡è¡¡æ˜¯åº”ç”¨ä¸­ä½¿ç”¨éå¸¸æ™®éçš„ä¸€ç§ä¼˜åŒ–æ–¹æ³•ï¼Œå®ƒçš„æœºåˆ¶å°±æ˜¯åˆ©ç”¨æŸç§å‡è¡¡ç®—æ³•ï¼Œå°†å›ºå®šçš„è´Ÿè½½é‡åˆ†å¸ƒåˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œ ä»¥æ­¤æ¥é™ä½å•å°æœåŠ¡å™¨çš„è´Ÿè½½ï¼Œè¾¾åˆ°ä¼˜åŒ–çš„æ•ˆæœã€‚ 1.3.1 åˆ©ç”¨MySQLå¤åˆ¶åˆ†æµæŸ¥è¯¢é€šè¿‡MySQLçš„ä¸»ä»å¤åˆ¶ï¼Œå®ç°è¯»å†™åˆ†ç¦»ï¼Œä½¿å¢åˆ æ”¹æ“ä½œèµ°ä¸»èŠ‚ç‚¹ï¼ŒæŸ¥è¯¢æ“ä½œèµ°ä»èŠ‚ç‚¹ï¼Œä»è€Œå¯ä»¥é™ä½å•å°æœåŠ¡å™¨çš„è¯»å†™å‹åŠ›ã€‚ 1.3.2 é‡‡ç”¨åˆ†å¸ƒå¼æ•°æ®åº“æ¶æ„åˆ†å¸ƒå¼æ•°æ®åº“æ¶æ„é€‚åˆå¤§æ•°æ®é‡ã€è´Ÿè½½é«˜çš„æƒ…å†µï¼Œå®ƒæœ‰è‰¯å¥½çš„æ‹“å±•æ€§å’Œé«˜å¯ç”¨æ€§ã€‚é€šè¿‡åœ¨å¤šå°æœåŠ¡å™¨ä¹‹é—´åˆ†å¸ƒæ•°æ®ï¼Œå¯ä»¥å®ç°åœ¨å¤šå°æœåŠ¡å™¨ä¹‹é—´çš„è´Ÿè½½å‡è¡¡ï¼Œæé«˜è®¿é—®æ•ˆç‡ã€‚ 2. Mysqlä¸­æŸ¥è¯¢ç¼“å­˜ä¼˜åŒ–2.1 æ¦‚è¿°å¼€å¯Mysqlçš„æŸ¥è¯¢ç¼“å­˜ï¼Œå½“æ‰§è¡Œå®Œå…¨ç›¸åŒçš„SQLè¯­å¥çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨å°±ä¼šç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–ç»“æœï¼Œå½“æ•°æ®è¢«ä¿®æ”¹ï¼Œä¹‹å‰çš„ç¼“å­˜ä¼šå¤±æ•ˆï¼Œä¿®æ”¹æ¯”è¾ƒé¢‘ç¹çš„è¡¨ä¸é€‚åˆåšæŸ¥è¯¢ç¼“å­˜ã€‚ 2.2 æ“ä½œæµç¨‹ å®¢æˆ·ç«¯å‘é€ä¸€æ¡æŸ¥è¯¢ç»™æœåŠ¡å™¨ï¼› æœåŠ¡å™¨å…ˆä¼šæ£€æŸ¥æŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœå‘½ä¸­äº†ç¼“å­˜ï¼Œåˆ™ç«‹å³è¿”å›å­˜å‚¨åœ¨ç¼“å­˜ä¸­çš„ç»“æœã€‚å¦åˆ™è¿›å…¥ä¸‹ä¸€é˜¶æ®µï¼› æœåŠ¡å™¨ç«¯è¿›è¡ŒSQLè§£æã€é¢„å¤„ç†ï¼Œå†ç”±ä¼˜åŒ–å™¨ç”Ÿæˆå¯¹åº”çš„æ‰§è¡Œè®¡åˆ’ï¼› MySQLæ ¹æ®ä¼˜åŒ–å™¨ç”Ÿæˆçš„æ‰§è¡Œè®¡åˆ’ï¼Œè°ƒç”¨å­˜å‚¨å¼•æ“çš„APIæ¥æ‰§è¡ŒæŸ¥è¯¢ï¼› å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ 2.3 æŸ¥è¯¢ç¼“å­˜é…ç½® æŸ¥çœ‹å½“å‰çš„MySQLæ•°æ®åº“æ˜¯å¦æ”¯æŒæŸ¥è¯¢ç¼“å­˜ï¼š SHOW VARIABLES LIKE 'have_query_cache'; æŸ¥çœ‹å½“å‰MySQLæ˜¯å¦å¼€å¯äº†æŸ¥è¯¢ç¼“å­˜ ï¼š SHOW VARIABLES LIKE 'query_cache_type'; æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„å ç”¨å¤§å° ï¼š SHOW VARIABLES LIKE 'query_cache_size'; æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„çŠ¶æ€å˜é‡ï¼š SHOW STATUS LIKE 'Qcache%'; å„ä¸ªå˜é‡çš„å«ä¹‰å¦‚ä¸‹ï¼š | å‚æ•° | å«ä¹‰ || â€”â€”â€”â€”â€”â€”â€”â€“ | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” || Qcache_free_blocks | æŸ¥è¯¢ç¼“å­˜ä¸­çš„å¯ç”¨å†…å­˜å—æ•° || Qcache_free_memory | æŸ¥è¯¢ç¼“å­˜çš„å¯ç”¨å†…å­˜é‡ || Qcache_hits | æŸ¥è¯¢ç¼“å­˜å‘½ä¸­æ•° || Qcache_inserts | æ·»åŠ åˆ°æŸ¥è¯¢ç¼“å­˜çš„æŸ¥è¯¢æ•° || Qcache_lowmen_prunes | ç”±äºå†…å­˜ä¸è¶³è€Œä»æŸ¥è¯¢ç¼“å­˜ä¸­åˆ é™¤çš„æŸ¥è¯¢æ•° || Qcache_not_cached | éç¼“å­˜æŸ¥è¯¢çš„æ•°é‡ï¼ˆç”±äº query_cache_type è®¾ç½®è€Œæ— æ³•ç¼“å­˜æˆ–æœªç¼“å­˜ï¼‰ || Qcache_queries_in_cache | æŸ¥è¯¢ç¼“å­˜ä¸­æ³¨å†Œçš„æŸ¥è¯¢æ•° || Qcache_total_blocks | æŸ¥è¯¢ç¼“å­˜ä¸­çš„å—æ€»æ•° | 2.4 å¼€å¯æŸ¥è¯¢ç¼“å­˜MySQLçš„æŸ¥è¯¢ç¼“å­˜é»˜è®¤æ˜¯å…³é—­çš„ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®å‚æ•° query_cache_type ï¼Œ æ¥å¼€å¯æŸ¥è¯¢ç¼“å­˜ã€‚query_cache_type è¯¥å‚æ•°çš„å¯å–å€¼æœ‰ä¸‰ä¸ª ï¼š å€¼ å«ä¹‰ OFF æˆ– 0 æŸ¥è¯¢ç¼“å­˜åŠŸèƒ½å…³é—­ ON æˆ– 1 æŸ¥è¯¢ç¼“å­˜åŠŸèƒ½æ‰“å¼€ï¼ŒSELECTçš„ç»“æœç¬¦åˆç¼“å­˜æ¡ä»¶å³ä¼šç¼“å­˜ï¼Œå¦åˆ™ï¼Œä¸äºˆç¼“å­˜ï¼Œæ˜¾å¼æŒ‡å®š SQL_NO_CACHEï¼Œä¸äºˆç¼“å­˜ DEMAND æˆ– 2 æŸ¥è¯¢ç¼“å­˜åŠŸèƒ½æŒ‰éœ€è¿›è¡Œï¼Œæ˜¾å¼æŒ‡å®š SQL_CACHE çš„SELECTè¯­å¥æ‰ä¼šç¼“å­˜ï¼›å…¶å®ƒå‡ä¸äºˆç¼“å­˜ åœ¨ /usr/my.cnf é…ç½®ä¸­ï¼Œå¢åŠ ä»¥ä¸‹é…ç½® ï¼š é…ç½®å®Œæ¯•ä¹‹åï¼Œé‡å¯æœåŠ¡æ—¢å¯ç”Ÿæ•ˆ ï¼› ç„¶åå°±å¯ä»¥åœ¨å‘½ä»¤è¡Œæ‰§è¡ŒSQLè¯­å¥è¿›è¡ŒéªŒè¯ ï¼Œæ‰§è¡Œä¸€æ¡æ¯”è¾ƒè€—æ—¶çš„SQLè¯­å¥ï¼Œç„¶åå†å¤šæ‰§è¡Œå‡ æ¬¡ï¼ŒæŸ¥çœ‹åé¢å‡ æ¬¡çš„æ‰§è¡Œæ—¶é—´ï¼›è·å–é€šè¿‡æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„ç¼“å­˜å‘½ä¸­æ•°ï¼Œæ¥åˆ¤å®šæ˜¯å¦èµ°æŸ¥è¯¢ç¼“å­˜ã€‚ 2.5 æŸ¥è¯¢ç¼“å­˜SELECTé€‰é¡¹å¯ä»¥åœ¨SELECTè¯­å¥ä¸­æŒ‡å®šä¸¤ä¸ªä¸æŸ¥è¯¢ç¼“å­˜ç›¸å…³çš„é€‰é¡¹ ï¼š SQL_CACHE : å¦‚æœæŸ¥è¯¢ç»“æœæ˜¯å¯ç¼“å­˜çš„ï¼Œå¹¶ä¸” query_cache_type ç³»ç»Ÿå˜é‡çš„å€¼ä¸ºONæˆ– DEMAND ï¼Œåˆ™ç¼“å­˜æŸ¥è¯¢ç»“æœ ã€‚ SQL_NO_CACHE : æœåŠ¡å™¨ä¸ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚å®ƒæ—¢ä¸æ£€æŸ¥æŸ¥è¯¢ç¼“å­˜ï¼Œä¹Ÿä¸æ£€æŸ¥ç»“æœæ˜¯å¦å·²ç¼“å­˜ï¼Œä¹Ÿä¸ç¼“å­˜æŸ¥è¯¢ç»“æœã€‚ ä¾‹å­ï¼š SELECT SQL_CACHE id, name FROM customer; SELECT SQL_NO_CACHE id, name FROM customer; â€‹ 2.6 æŸ¥è¯¢ç¼“å­˜å¤±æ•ˆçš„æƒ…å†µ1ï¼‰ SQL è¯­å¥ä¸ä¸€è‡´çš„æƒ…å†µï¼Œ è¦æƒ³å‘½ä¸­æŸ¥è¯¢ç¼“å­˜ï¼ŒæŸ¥è¯¢çš„SQLè¯­å¥å¿…é¡»ä¸€è‡´ã€‚ SQL1 : select count(*) from tb_item; SQL2 : Select count(*) from tb_item; 2ï¼‰ å½“æŸ¥è¯¢è¯­å¥ä¸­æœ‰ä¸€äº›ä¸ç¡®å®šçš„æ—¶ï¼Œåˆ™ä¸ä¼šç¼“å­˜ã€‚å¦‚ ï¼š now() , current_date() , curdate() , curtime() , rand() , uuid() , user() , database() ã€‚ SQL1 : select * from tb_item where updatetime < now() limit 1; SQL2 : select user(); SQL3 : select database(); 3ï¼‰ ä¸ä½¿ç”¨ä»»ä½•è¡¨æŸ¥è¯¢è¯­å¥ã€‚ select 'A'; 4ï¼‰ æŸ¥è¯¢ mysqlï¼Œ information_schemaæˆ– performance_schema æ•°æ®åº“ä¸­çš„è¡¨æ—¶ï¼Œä¸ä¼šèµ°æŸ¥è¯¢ç¼“å­˜ã€‚ select * from information_schema.engines; 5ï¼‰ åœ¨å­˜å‚¨çš„å‡½æ•°ï¼Œè§¦å‘å™¨æˆ–äº‹ä»¶çš„ä¸»ä½“å†…æ‰§è¡Œçš„æŸ¥è¯¢ã€‚ 6ï¼‰ å¦‚æœè¡¨æ›´æ”¹ï¼Œåˆ™ä½¿ç”¨è¯¥è¡¨çš„æ‰€æœ‰é«˜é€Ÿç¼“å­˜æŸ¥è¯¢éƒ½å°†å˜ä¸ºæ— æ•ˆå¹¶ä»é«˜é€Ÿç¼“å­˜ä¸­åˆ é™¤ã€‚è¿™åŒ…æ‹¬ä½¿ç”¨MERGEæ˜ å°„åˆ°å·²æ›´æ”¹è¡¨çš„è¡¨çš„æŸ¥è¯¢ã€‚ä¸€ä¸ªè¡¨å¯ä»¥è¢«è®¸å¤šç±»å‹çš„è¯­å¥ï¼Œå¦‚è¢«æ”¹å˜ INSERTï¼Œ UPDATEï¼Œ DELETEï¼Œ TRUNCATE TABLEï¼Œ ALTER TABLEï¼Œ DROP TABLEï¼Œæˆ– DROP DATABASE ã€‚ 3. Mysqlå†…å­˜ç®¡ç†åŠä¼˜åŒ–3.1 å†…å­˜ä¼˜åŒ–åŸåˆ™1ï¼‰ å°†å°½é‡å¤šçš„å†…å­˜åˆ†é…ç»™MySQLåšç¼“å­˜ï¼Œä½†è¦ç»™æ“ä½œç³»ç»Ÿå’Œå…¶ä»–ç¨‹åºé¢„ç•™è¶³å¤Ÿå†…å­˜ã€‚ 2ï¼‰ MyISAM å­˜å‚¨å¼•æ“çš„æ•°æ®æ–‡ä»¶è¯»å–ä¾èµ–äºæ“ä½œç³»ç»Ÿè‡ªèº«çš„IOç¼“å­˜ï¼Œå› æ­¤ï¼Œå¦‚æœæœ‰MyISAMè¡¨ï¼Œå°±è¦é¢„ç•™æ›´å¤šçš„å†…å­˜ç»™æ“ä½œç³»ç»ŸåšIOç¼“å­˜ã€‚ 3ï¼‰ æ’åºåŒºã€è¿æ¥åŒºç­‰ç¼“å­˜æ˜¯åˆ†é…ç»™æ¯ä¸ªæ•°æ®åº“ä¼šè¯ï¼ˆsessionï¼‰ä¸“ç”¨çš„ï¼Œå…¶é»˜è®¤å€¼çš„è®¾ç½®è¦æ ¹æ®æœ€å¤§è¿æ¥æ•°åˆç†åˆ†é…ï¼Œå¦‚æœè®¾ç½®å¤ªå¤§ï¼Œä¸ä½†æµªè´¹èµ„æºï¼Œè€Œä¸”åœ¨å¹¶å‘è¿æ¥è¾ƒé«˜æ—¶ä¼šå¯¼è‡´ç‰©ç†å†…å­˜è€—å°½ã€‚ 3.2 MyISAM å†…å­˜ä¼˜åŒ–myisamå­˜å‚¨å¼•æ“ä½¿ç”¨ key_buffer ç¼“å­˜ç´¢å¼•å—ï¼ŒåŠ é€Ÿmyisamç´¢å¼•çš„è¯»å†™é€Ÿåº¦ã€‚å¯¹äºmyisamè¡¨çš„æ•°æ®å—ï¼Œmysqlæ²¡æœ‰ç‰¹åˆ«çš„ç¼“å­˜æœºåˆ¶ï¼Œå®Œå…¨ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„IOç¼“å­˜ã€‚ key_buffer_sizekey_buffer_sizeå†³å®šMyISAMç´¢å¼•å—ç¼“å­˜åŒºçš„å¤§å°ï¼Œç›´æ¥å½±å“åˆ°MyISAMè¡¨çš„å­˜å–æ•ˆç‡ã€‚å¯ä»¥åœ¨MySQLå‚æ•°æ–‡ä»¶ä¸­è®¾ç½®key_buffer_sizeçš„å€¼ï¼Œå¯¹äºä¸€èˆ¬MyISAMæ•°æ®åº“ï¼Œå»ºè®®è‡³å°‘å°†1/4å¯ç”¨å†…å­˜åˆ†é…ç»™key_buffer_sizeã€‚ åœ¨/usr/my.cnf ä¸­åšå¦‚ä¸‹é…ç½®ï¼š key_buffer_size=512M read_buffer_sizeå¦‚æœéœ€è¦ç»å¸¸é¡ºåºæ‰«æmyisamè¡¨ï¼Œå¯ä»¥é€šè¿‡å¢å¤§read_buffer_sizeçš„å€¼æ¥æ”¹å–„æ€§èƒ½ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯read_buffer_sizeæ˜¯æ¯ä¸ªsessionç‹¬å çš„ï¼Œå¦‚æœé»˜è®¤å€¼è®¾ç½®å¤ªå¤§ï¼Œå°±ä¼šé€ æˆå†…å­˜æµªè´¹ã€‚ read_rnd_buffer_sizeå¯¹äºéœ€è¦åšæ’åºçš„myisamè¡¨çš„æŸ¥è¯¢ï¼Œå¦‚å¸¦æœ‰order byå­å¥çš„sqlï¼Œé€‚å½“å¢åŠ  read_rnd_buffer_size çš„å€¼ï¼Œå¯ä»¥æ”¹å–„æ­¤ç±»çš„sqlæ€§èƒ½ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ read_rnd_buffer_size æ˜¯æ¯ä¸ªsessionç‹¬å çš„ï¼Œå¦‚æœé»˜è®¤å€¼è®¾ç½®å¤ªå¤§ï¼Œå°±ä¼šé€ æˆå†…å­˜æµªè´¹ã€‚ 3.3 InnoDB å†…å­˜ä¼˜åŒ–innodbç”¨ä¸€å—å†…å­˜åŒºåšIOç¼“å­˜æ± ï¼Œè¯¥ç¼“å­˜æ± ä¸ä»…ç”¨æ¥ç¼“å­˜innodbçš„ç´¢å¼•å—ï¼Œè€Œä¸”ä¹Ÿç”¨æ¥ç¼“å­˜innodbçš„æ•°æ®å—ã€‚ innodb_buffer_pool_sizeè¯¥å˜é‡å†³å®šäº† innodb å­˜å‚¨å¼•æ“è¡¨æ•°æ®å’Œç´¢å¼•æ•°æ®çš„æœ€å¤§ç¼“å­˜åŒºå¤§å°ã€‚åœ¨ä¿è¯æ“ä½œç³»ç»ŸåŠå…¶ä»–ç¨‹åºæœ‰è¶³å¤Ÿå†…å­˜å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œinnodb_buffer_pool_size çš„å€¼è¶Šå¤§ï¼Œç¼“å­˜å‘½ä¸­ç‡è¶Šé«˜ï¼Œè®¿é—®InnoDBè¡¨éœ€è¦çš„ç£ç›˜I/O å°±è¶Šå°‘ï¼Œæ€§èƒ½ä¹Ÿå°±è¶Šé«˜ã€‚ innodb_buffer_pool_size=512M innodb_log_buffer_sizeå†³å®šäº†innodbé‡åšæ—¥å¿—ç¼“å­˜çš„å¤§å°ï¼Œå¯¹äºå¯èƒ½äº§ç”Ÿå¤§é‡æ›´æ–°è®°å½•çš„å¤§äº‹åŠ¡ï¼Œå¢åŠ innodb_log_buffer_sizeçš„å¤§å°ï¼Œå¯ä»¥é¿å…innodbåœ¨äº‹åŠ¡æäº¤å‰å°±æ‰§è¡Œä¸å¿…è¦çš„æ—¥å¿—å†™å…¥ç£ç›˜æ“ä½œã€‚ innodb_log_buffer_size=10M 4. Mysqlå¹¶å‘å‚æ•°è°ƒæ•´ä»å®ç°ä¸Šæ¥è¯´ï¼ŒMySQL Server æ˜¯å¤šçº¿ç¨‹ç»“æ„ï¼ŒåŒ…æ‹¬åå°çº¿ç¨‹å’Œå®¢æˆ·æœåŠ¡çº¿ç¨‹ã€‚å¤šçº¿ç¨‹å¯ä»¥æœ‰æ•ˆåˆ©ç”¨æœåŠ¡å™¨èµ„æºï¼Œæé«˜æ•°æ®åº“çš„å¹¶å‘æ€§èƒ½ã€‚åœ¨Mysqlä¸­ï¼Œæ§åˆ¶å¹¶å‘è¿æ¥å’Œçº¿ç¨‹çš„ä¸»è¦å‚æ•°åŒ…æ‹¬ max_connectionsã€back_logã€thread_cache_sizeã€table_open_cahceã€‚ 4.1 max_connectionsé‡‡ç”¨max_connections æ§åˆ¶å…è®¸è¿æ¥åˆ°MySQLæ•°æ®åº“çš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤å€¼æ˜¯ 151ã€‚å¦‚æœçŠ¶æ€å˜é‡ connection_errors_max_connections ä¸ä¸ºé›¶ï¼Œå¹¶ä¸”ä¸€ç›´å¢é•¿ï¼Œåˆ™è¯´æ˜ä¸æ–­æœ‰è¿æ¥è¯·æ±‚å› æ•°æ®åº“è¿æ¥æ•°å·²è¾¾åˆ°å…è®¸æœ€å¤§å€¼è€Œå¤±è´¥ï¼Œè¿™æ˜¯å¯ä»¥è€ƒè™‘å¢å¤§max_connections çš„å€¼ã€‚ Mysql æœ€å¤§å¯æ”¯æŒçš„è¿æ¥æ•°ï¼Œå–å†³äºå¾ˆå¤šå› ç´ ï¼ŒåŒ…æ‹¬ç»™å®šæ“ä½œç³»ç»Ÿå¹³å°çš„çº¿ç¨‹åº“çš„è´¨é‡ã€å†…å­˜å¤§å°ã€æ¯ä¸ªè¿æ¥çš„è´Ÿè·ã€CPUçš„å¤„ç†é€Ÿåº¦ï¼ŒæœŸæœ›çš„å“åº”æ—¶é—´ç­‰ã€‚åœ¨Linux å¹³å°ä¸‹ï¼Œæ€§èƒ½å¥½çš„æœåŠ¡å™¨ï¼Œæ”¯æŒ 500-1000 ä¸ªè¿æ¥ä¸æ˜¯éš¾äº‹ï¼Œéœ€è¦æ ¹æ®æœåŠ¡å™¨æ€§èƒ½è¿›è¡Œè¯„ä¼°è®¾å®šã€‚ 4.2 back_logback_log å‚æ•°æ§åˆ¶MySQLç›‘å¬TCPç«¯å£æ—¶è®¾ç½®çš„ç§¯å‹è¯·æ±‚æ ˆå¤§å°ã€‚å¦‚æœMySqlçš„è¿æ¥æ•°è¾¾åˆ°max_connectionsæ—¶ï¼Œæ–°æ¥çš„è¯·æ±‚å°†ä¼šè¢«å­˜åœ¨å †æ ˆä¸­ï¼Œä»¥ç­‰å¾…æŸä¸€è¿æ¥é‡Šæ”¾èµ„æºï¼Œè¯¥å †æ ˆçš„æ•°é‡å³back_logï¼Œå¦‚æœç­‰å¾…è¿æ¥çš„æ•°é‡è¶…è¿‡back_logï¼Œå°†ä¸è¢«æˆäºˆè¿æ¥èµ„æºï¼Œå°†ä¼šæŠ¥é”™ã€‚5.6.6 ç‰ˆæœ¬ä¹‹å‰é»˜è®¤å€¼ä¸º 50 ï¼Œ ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤ä¸º 50 + ï¼ˆmax_connections / 5ï¼‰ï¼Œ ä½†æœ€å¤§ä¸è¶…è¿‡900ã€‚ å¦‚æœéœ€è¦æ•°æ®åº“åœ¨è¾ƒçŸ­çš„æ—¶é—´å†…å¤„ç†å¤§é‡è¿æ¥è¯·æ±‚ï¼Œ å¯ä»¥è€ƒè™‘é€‚å½“å¢å¤§back_log çš„å€¼ã€‚ 4.3 table_open_cacheè¯¥å‚æ•°ç”¨æ¥æ§åˆ¶æ‰€æœ‰SQLè¯­å¥æ‰§è¡Œçº¿ç¨‹å¯æ‰“å¼€è¡¨ç¼“å­˜çš„æ•°é‡ï¼Œ è€Œåœ¨æ‰§è¡ŒSQLè¯­å¥æ—¶ï¼Œæ¯ä¸€ä¸ªSQLæ‰§è¡Œçº¿ç¨‹è‡³å°‘è¦æ‰“å¼€ 1 ä¸ªè¡¨ç¼“å­˜ã€‚è¯¥å‚æ•°çš„å€¼åº”è¯¥æ ¹æ®è®¾ç½®çš„æœ€å¤§è¿æ¥æ•° max_connections ä»¥åŠæ¯ä¸ªè¿æ¥æ‰§è¡Œå…³è”æŸ¥è¯¢ä¸­æ¶‰åŠçš„è¡¨çš„æœ€å¤§æ•°é‡æ¥è®¾å®š ï¼š â€‹ max_connections x N ï¼› 4.4 thread_cache_sizeä¸ºäº†åŠ å¿«è¿æ¥æ•°æ®åº“çš„é€Ÿåº¦ï¼ŒMySQL ä¼šç¼“å­˜ä¸€å®šæ•°é‡çš„å®¢æˆ·æœåŠ¡çº¿ç¨‹ä»¥å¤‡é‡ç”¨ï¼Œé€šè¿‡å‚æ•° thread_cache_size å¯æ§åˆ¶ MySQL ç¼“å­˜å®¢æˆ·æœåŠ¡çº¿ç¨‹çš„æ•°é‡ã€‚ 4.5 innodb_lock_wait_timeoutè¯¥å‚æ•°æ˜¯ç”¨æ¥è®¾ç½®InnoDB äº‹åŠ¡ç­‰å¾…è¡Œé”çš„æ—¶é—´ï¼Œé»˜è®¤å€¼æ˜¯50ms ï¼Œ å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡ŒåŠ¨æ€è®¾ç½®ã€‚å¯¹äºéœ€è¦å¿«é€Ÿåé¦ˆçš„ä¸šåŠ¡ç³»ç»Ÿæ¥è¯´ï¼Œå¯ä»¥å°†è¡Œé”çš„ç­‰å¾…æ—¶é—´è°ƒå°ï¼Œä»¥é¿å…äº‹åŠ¡é•¿æ—¶é—´æŒ‚èµ·ï¼› å¯¹äºåå°è¿è¡Œçš„æ‰¹é‡å¤„ç†ç¨‹åºæ¥è¯´ï¼Œ å¯ä»¥å°†è¡Œé”çš„ç­‰å¾…æ—¶é—´è°ƒå¤§ï¼Œ ä»¥é¿å…å‘ç”Ÿå¤§çš„å›æ»šæ“ä½œã€‚ 5. Mysqlé”é—®é¢˜5.1 é”æ¦‚è¿°é”æ˜¯è®¡ç®—æœºåè°ƒå¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹å¹¶å‘è®¿é—®æŸä¸€èµ„æºçš„æœºåˆ¶ï¼ˆé¿å…äº‰æŠ¢ï¼‰ã€‚ åœ¨æ•°æ®åº“ä¸­ï¼Œé™¤ä¼ ç»Ÿçš„è®¡ç®—èµ„æºï¼ˆå¦‚ CPUã€RAMã€I/O ç­‰ï¼‰çš„äº‰ç”¨ä»¥å¤–ï¼Œæ•°æ®ä¹Ÿæ˜¯ä¸€ç§ä¾›è®¸å¤šç”¨æˆ·å…±äº«çš„èµ„æºã€‚å¦‚ä½•ä¿è¯æ•°æ®å¹¶å‘è®¿é—®çš„ä¸€è‡´æ€§ã€æœ‰æ•ˆæ€§æ˜¯æ‰€æœ‰æ•°æ®åº“å¿…é¡»è§£å†³çš„ä¸€ä¸ªé—®é¢˜ï¼Œé”å†²çªä¹Ÿæ˜¯å½±å“æ•°æ®åº“å¹¶å‘è®¿é—®æ€§èƒ½çš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚ä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼Œé”å¯¹æ•°æ®åº“è€Œè¨€æ˜¾å¾—å°¤å…¶é‡è¦ï¼Œä¹Ÿæ›´åŠ å¤æ‚ã€‚ 5.2 é”åˆ†ç±»ä»å¯¹æ•°æ®æ“ä½œçš„ç²’åº¦åˆ† ï¼š 1ï¼‰ è¡¨é”ï¼šæ“ä½œæ—¶ï¼Œä¼šé”å®šæ•´ä¸ªè¡¨ã€‚ 2ï¼‰ è¡Œé”ï¼šæ“ä½œæ—¶ï¼Œä¼šé”å®šå½“å‰æ“ä½œè¡Œã€‚ ä»å¯¹æ•°æ®æ“ä½œçš„ç±»å‹åˆ†ï¼š 1ï¼‰ è¯»é”ï¼ˆå…±äº«é”ï¼‰ï¼šé’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªè¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ã€‚ 2ï¼‰ å†™é”ï¼ˆæ’å®ƒé”ï¼‰ï¼šå½“å‰æ“ä½œæ²¡æœ‰å®Œæˆä¹‹å‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚ 5.3 Mysql é”ç›¸å¯¹å…¶ä»–æ•°æ®åº“è€Œè¨€ï¼ŒMySQLçš„é”æœºåˆ¶æ¯”è¾ƒç®€å•ï¼Œå…¶æœ€æ˜¾è‘—çš„ç‰¹ç‚¹æ˜¯ä¸åŒçš„å­˜å‚¨å¼•æ“æ”¯æŒä¸åŒçš„é”æœºåˆ¶ã€‚ä¸‹è¡¨ä¸­ç½—åˆ—å‡ºäº†å„å­˜å‚¨å¼•æ“å¯¹é”çš„æ”¯æŒæƒ…å†µï¼š| å­˜å‚¨å¼•æ“ | è¡¨çº§é” | è¡Œçº§é” | é¡µé¢é” || â€”â€”â€“ | â€”â€” | â€”â€” | â€”â€” || MyISAM | æ”¯æŒ | ä¸æ”¯æŒ | ä¸æ”¯æŒ || InnoDB | æ”¯æŒ | æ”¯æŒ | ä¸æ”¯æŒ || MEMORY | æ”¯æŒ | ä¸æ”¯æŒ | ä¸æ”¯æŒ || BDB | æ”¯æŒ | ä¸æ”¯æŒ | æ”¯æŒ | MySQLè¿™3ç§é”çš„ç‰¹æ€§å¯å¤§è‡´å½’çº³å¦‚ä¸‹ ï¼š é”ç±»å‹ ç‰¹ç‚¹ è¡¨çº§é” åå‘MyISAM å­˜å‚¨å¼•æ“ï¼Œå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼›ä¸ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€é«˜,å¹¶å‘åº¦æœ€ä½ã€‚ è¡Œçº§é” åå‘InnoDB å­˜å‚¨å¼•æ“ï¼Œå¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½,å¹¶å‘åº¦ä¹Ÿæœ€é«˜ã€‚ é¡µé¢é” å¼€é”€å’ŒåŠ é”æ—¶é—´ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œå¹¶å‘åº¦ä¸€èˆ¬ã€‚ ä»ä¸Šè¿°ç‰¹ç‚¹å¯è§ï¼Œå¾ˆéš¾ç¬¼ç»Ÿåœ°è¯´å“ªç§é”æ›´å¥½ï¼Œåªèƒ½å°±å…·ä½“åº”ç”¨çš„ç‰¹ç‚¹æ¥è¯´å“ªç§é”æ›´åˆé€‚ï¼ä»…ä»é”çš„è§’åº¦æ¥è¯´ï¼šè¡¨çº§é”æ›´é€‚åˆäºä»¥æŸ¥è¯¢ä¸ºä¸»ï¼Œåªæœ‰å°‘é‡æŒ‰ç´¢å¼•æ¡ä»¶æ›´æ–°æ•°æ®çš„åº”ç”¨ï¼Œå¦‚Web åº”ç”¨ï¼›è€Œè¡Œçº§é”åˆ™æ›´é€‚åˆäºæœ‰å¤§é‡æŒ‰ç´¢å¼•æ¡ä»¶å¹¶å‘æ›´æ–°å°‘é‡ä¸åŒæ•°æ®ï¼ŒåŒæ—¶åˆæœ‰å¹¶æŸ¥è¯¢çš„åº”ç”¨ï¼Œå¦‚ä¸€äº›åœ¨çº¿äº‹åŠ¡å¤„ç†ï¼ˆOLTPï¼‰ç³»ç»Ÿã€‚ 5.2 MyISAM è¡¨é”MyISAM å­˜å‚¨å¼•æ“åªæ”¯æŒè¡¨é”ï¼Œè¿™ä¹Ÿæ˜¯MySQLå¼€å§‹å‡ ä¸ªç‰ˆæœ¬ä¸­å”¯ä¸€æ”¯æŒçš„é”ç±»å‹ã€‚ 5.2.1 å¦‚ä½•åŠ è¡¨é”MyISAM åœ¨æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼ˆSELECTï¼‰å‰ï¼Œä¼šè‡ªåŠ¨ç»™æ¶‰åŠçš„æ‰€æœ‰è¡¨åŠ è¯»é”ï¼Œåœ¨æ‰§è¡Œæ›´æ–°æ“ä½œï¼ˆUPDATEã€DELETEã€INSERT ç­‰ï¼‰å‰ï¼Œä¼šè‡ªåŠ¨ç»™æ¶‰åŠçš„è¡¨åŠ å†™é”ï¼Œè¿™ä¸ªè¿‡ç¨‹å¹¶ä¸éœ€è¦ç”¨æˆ·å¹²é¢„ï¼Œå› æ­¤ï¼Œç”¨æˆ·ä¸€èˆ¬ä¸éœ€è¦ç›´æ¥ç”¨ LOCK TABLE å‘½ä»¤ç»™ MyISAM è¡¨æ˜¾å¼åŠ é”ã€‚ æ˜¾ç¤ºåŠ è¡¨é”è¯­æ³•ï¼š åŠ è¯»é” ï¼š lock table table_name read; åŠ å†™é” ï¼š lock table table_name writeï¼› 5.2.2 è¯»é”æ¡ˆä¾‹å‡†å¤‡ç¯å¢ƒ create database demo_03 default charset=utf8mb4; use demo_03; CREATE TABLE `tb_book` ( `id` INT(11) auto_increment, `name` VARCHAR(50) DEFAULT NULL, `publish_time` DATE DEFAULT NULL, `status` CHAR(1) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=myisam DEFAULT CHARSET=utf8 ; INSERT INTO tb_book (id, name, publish_time, status) VALUES(NULL,'javaç¼–ç¨‹æ€æƒ³','2088-08-01','1'); INSERT INTO tb_book (id, name, publish_time, status) VALUES(NULL,'solrç¼–ç¨‹æ€æƒ³','2088-08-08','0'); CREATE TABLE `tb_user` ( `id` INT(11) auto_increment, `name` VARCHAR(50) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=myisam DEFAULT CHARSET=utf8 ; INSERT INTO tb_user (id, name) VALUES(NULL,'ä»¤ç‹å†²'); INSERT INTO tb_user (id, name) VALUES(NULL,'ç”°ä¼¯å…‰'); å®¢æˆ·ç«¯ ä¸€ ï¼š 1ï¼‰è·å¾—tb_book è¡¨çš„è¯»é” lock table tb_book read; 2ï¼‰ æ‰§è¡ŒæŸ¥è¯¢æ“ä½œ select * from tb_book; å¯ä»¥æ­£å¸¸æ‰§è¡Œ ï¼Œ æŸ¥è¯¢å‡ºæ•°æ®ã€‚ å®¢æˆ·ç«¯ äºŒ ï¼š 3ï¼‰ æ‰§è¡ŒæŸ¥è¯¢æ“ä½œ select * from tb_book; å®¢æˆ·ç«¯ ä¸€ ï¼š 4ï¼‰æŸ¥è¯¢æœªé”å®šçš„è¡¨ select name from tb_seller; å®¢æˆ·ç«¯ äºŒ ï¼š 5ï¼‰æŸ¥è¯¢æœªé”å®šçš„è¡¨ select name from tb_seller; å¯ä»¥æ­£å¸¸æŸ¥è¯¢å‡ºæœªé”å®šçš„è¡¨ï¼› å®¢æˆ·ç«¯ ä¸€ ï¼š 6ï¼‰ æ‰§è¡Œæ’å…¥æ“ä½œ insert into tb_book values(null,'Mysqlé«˜çº§','2088-01-01','1'); æ‰§è¡Œæ’å…¥ï¼Œ ç›´æ¥æŠ¥é”™ ï¼Œ ç”±äºå½“å‰tb_book è·å¾—çš„æ˜¯ è¯»é”ï¼Œ ä¸èƒ½æ‰§è¡Œæ›´æ–°æ“ä½œã€‚ å®¢æˆ·ç«¯ äºŒ ï¼š 7ï¼‰ æ‰§è¡Œæ’å…¥æ“ä½œ insert into tb_book values(null,'Mysqlé«˜çº§','2088-01-01','1'); å½“åœ¨å®¢æˆ·ç«¯ä¸€ä¸­é‡Šæ”¾é”æŒ‡ä»¤ unlock tables å ï¼Œ å®¢æˆ·ç«¯äºŒä¸­çš„ inesrt è¯­å¥ ï¼Œ ç«‹å³æ‰§è¡Œ ï¼› 5.2.3 å†™é”æ¡ˆä¾‹å®¢æˆ·ç«¯ ä¸€ : 1ï¼‰è·å¾—tb_book è¡¨çš„å†™é” lock table tb_book write ; 2ï¼‰æ‰§è¡ŒæŸ¥è¯¢æ“ä½œ select * from tb_book ; æŸ¥è¯¢æ“ä½œæ‰§è¡ŒæˆåŠŸï¼› 3ï¼‰æ‰§è¡Œæ›´æ–°æ“ä½œ update tb_book set name = 'javaç¼–ç¨‹æ€æƒ³ï¼ˆç¬¬äºŒç‰ˆï¼‰' where id = 1; æ›´æ–°æ“ä½œæ‰§è¡ŒæˆåŠŸ ï¼› å®¢æˆ·ç«¯ äºŒ : 4ï¼‰æ‰§è¡ŒæŸ¥è¯¢æ“ä½œ select * from tb_book ; å½“åœ¨å®¢æˆ·ç«¯ä¸€ä¸­é‡Šæ”¾é”æŒ‡ä»¤ unlock tables å ï¼Œ å®¢æˆ·ç«¯äºŒä¸­çš„ select è¯­å¥ ï¼Œ ç«‹å³æ‰§è¡Œ ï¼› 5.2.4 ç»“è®ºé”æ¨¡å¼çš„ç›¸äº’å…¼å®¹æ€§å¦‚è¡¨ä¸­æ‰€ç¤ºï¼š ç”±ä¸Šè¡¨å¯è§ï¼š â€‹ 1ï¼‰ å¯¹MyISAM è¡¨çš„è¯»æ“ä½œï¼Œä¸ä¼šé˜»å¡å…¶ä»–ç”¨æˆ·å¯¹åŒä¸€è¡¨çš„è¯»è¯·æ±‚ï¼Œä½†ä¼šé˜»å¡å¯¹åŒä¸€è¡¨çš„å†™è¯·æ±‚ï¼› â€‹ 2ï¼‰ å¯¹MyISAM è¡¨çš„å†™æ“ä½œï¼Œåˆ™ä¼šé˜»å¡å…¶ä»–ç”¨æˆ·å¯¹åŒä¸€è¡¨çš„è¯»å’Œå†™æ“ä½œï¼› â€‹ ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯è¯»é”ä¼šé˜»å¡å†™ï¼Œä½†æ˜¯ä¸ä¼šé˜»å¡è¯»ã€‚è€Œå†™é”ï¼Œåˆ™æ—¢ä¼šé˜»å¡è¯»ï¼Œåˆä¼šé˜»å¡å†™ã€‚ æ­¤å¤–ï¼ŒMyISAM çš„è¯»å†™é”è°ƒåº¦æ˜¯å†™ä¼˜å…ˆï¼Œè¿™ä¹Ÿæ˜¯MyISAMä¸é€‚åˆåšå†™ä¸ºä¸»çš„è¡¨çš„å­˜å‚¨å¼•æ“çš„åŸå› ã€‚å› ä¸ºå†™é”åï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½åšä»»ä½•æ“ä½œï¼Œå¤§é‡çš„æ›´æ–°ä¼šä½¿æŸ¥è¯¢å¾ˆéš¾å¾—åˆ°é”ï¼Œä»è€Œé€ æˆæ°¸è¿œé˜»å¡ã€‚ 5.2.5 æŸ¥çœ‹é”çš„äº‰ç”¨æƒ…å†µshow open tablesï¼› In_user : è¡¨å½“å‰è¢«æŸ¥è¯¢ä½¿ç”¨çš„æ¬¡æ•°ã€‚å¦‚æœè¯¥æ•°ä¸ºé›¶ï¼Œåˆ™è¡¨æ˜¯æ‰“å¼€çš„ï¼Œä½†æ˜¯å½“å‰æ²¡æœ‰è¢«ä½¿ç”¨ã€‚ Name_lockedï¼šè¡¨åç§°æ˜¯å¦è¢«é”å®šã€‚åç§°é”å®šç”¨äºå–æ¶ˆè¡¨æˆ–å¯¹è¡¨è¿›è¡Œé‡å‘½åç­‰æ“ä½œã€‚ show status like 'Table_locks%'; Table_locks_immediate ï¼š æŒ‡çš„æ˜¯èƒ½å¤Ÿç«‹å³è·å¾—è¡¨çº§é”çš„æ¬¡æ•°ï¼Œæ¯ç«‹å³è·å–é”ï¼Œå€¼åŠ 1ã€‚ Table_locks_waited ï¼š æŒ‡çš„æ˜¯ä¸èƒ½ç«‹å³è·å–è¡¨çº§é”è€Œéœ€è¦ç­‰å¾…çš„æ¬¡æ•°ï¼Œæ¯ç­‰å¾…ä¸€æ¬¡ï¼Œè¯¥å€¼åŠ 1ï¼Œæ­¤å€¼é«˜è¯´æ˜å­˜åœ¨ç€è¾ƒä¸ºä¸¥é‡çš„è¡¨çº§é”äº‰ç”¨æƒ…å†µã€‚ 5.3 InnoDB è¡Œé”5.3.1 è¡Œé”ä»‹ç»è¡Œé”ç‰¹ç‚¹ ï¼šåå‘InnoDB å­˜å‚¨å¼•æ“ï¼Œå¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½,å¹¶å‘åº¦ä¹Ÿæœ€é«˜ã€‚ InnoDB ä¸ MyISAM çš„æœ€å¤§ä¸åŒæœ‰ä¸¤ç‚¹ï¼šä¸€æ˜¯æ”¯æŒäº‹åŠ¡ï¼›äºŒæ˜¯ é‡‡ç”¨äº†è¡Œçº§é”ã€‚ 5.3.2 èƒŒæ™¯çŸ¥è¯†äº‹åŠ¡åŠå…¶ACIDå±æ€§ äº‹åŠ¡æ˜¯ç”±ä¸€ç»„SQLè¯­å¥ç»„æˆçš„é€»è¾‘å¤„ç†å•å…ƒã€‚ äº‹åŠ¡å…·æœ‰ä»¥ä¸‹4ä¸ªç‰¹æ€§ï¼Œç®€ç§°ä¸ºäº‹åŠ¡ACIDå±æ€§ã€‚ ACIDå±æ€§ å«ä¹‰ åŸå­æ€§ï¼ˆAtomicityï¼‰ äº‹åŠ¡æ˜¯ä¸€ä¸ªåŸå­æ“ä½œå•å…ƒï¼Œå…¶å¯¹æ•°æ®çš„ä¿®æ”¹ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚ ä¸€è‡´æ€§ï¼ˆConsistentï¼‰ åœ¨äº‹åŠ¡å¼€å§‹å’Œå®Œæˆæ—¶ï¼Œæ•°æ®éƒ½å¿…é¡»ä¿æŒä¸€è‡´çŠ¶æ€ã€‚ éš”ç¦»æ€§ï¼ˆIsolationï¼‰ æ•°æ®åº“ç³»ç»Ÿæä¾›ä¸€å®šçš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ â€œç‹¬ç«‹â€ ç¯å¢ƒä¸‹è¿è¡Œã€‚ æŒä¹…æ€§ï¼ˆDurableï¼‰ äº‹åŠ¡å®Œæˆä¹‹åï¼Œå¯¹äºæ•°æ®çš„ä¿®æ”¹æ˜¯æ°¸ä¹…çš„ã€‚ å¹¶å‘äº‹åŠ¡å¤„ç†å¸¦æ¥çš„é—®é¢˜ é—®é¢˜ å«ä¹‰ ä¸¢å¤±æ›´æ–°ï¼ˆLost Updateï¼‰ å½“ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡é€‰æ‹©åŒä¸€è¡Œï¼Œæœ€åˆçš„äº‹åŠ¡ä¿®æ”¹çš„å€¼ï¼Œä¼šè¢«åé¢çš„äº‹åŠ¡ä¿®æ”¹çš„å€¼è¦†ç›–ã€‚ è„è¯»ï¼ˆDirty Readsï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨è®¿é—®æ•°æ®ï¼Œå¹¶ä¸”å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œè€Œè¿™ç§ä¿®æ”¹è¿˜æ²¡æœ‰æäº¤åˆ°æ•°æ®åº“ä¸­ï¼Œè¿™æ—¶ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®è¿™ä¸ªæ•°æ®ï¼Œç„¶åä½¿ç”¨äº†è¿™ä¸ªæ•°æ®ã€‚ ä¸å¯é‡å¤è¯»ï¼ˆNon-Repeatable Readsï¼‰ ä¸€ä¸ªäº‹åŠ¡åœ¨è¯»å–æŸäº›æ•°æ®åçš„æŸä¸ªæ—¶é—´ï¼Œå†æ¬¡è¯»å–ä»¥å‰è¯»è¿‡çš„æ•°æ®ï¼Œå´å‘ç°å’Œä»¥å‰è¯»å‡ºçš„æ•°æ®ä¸ä¸€è‡´ã€‚ å¹»è¯»ï¼ˆPhantom Readsï¼‰ ä¸€ä¸ªäº‹åŠ¡æŒ‰ç…§ç›¸åŒçš„æŸ¥è¯¢æ¡ä»¶é‡æ–°è¯»å–ä»¥å‰æŸ¥è¯¢è¿‡çš„æ•°æ®ï¼Œå´å‘ç°å…¶ä»–äº‹åŠ¡æ’å…¥äº†æ»¡è¶³å…¶æŸ¥è¯¢æ¡ä»¶çš„æ–°æ•°æ®ã€‚ äº‹åŠ¡éš”ç¦»çº§åˆ« ä¸ºäº†è§£å†³ä¸Šè¿°æåˆ°çš„äº‹åŠ¡å¹¶å‘é—®é¢˜ï¼Œæ•°æ®åº“æä¾›ä¸€å®šçš„äº‹åŠ¡éš”ç¦»æœºåˆ¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ•°æ®åº“çš„äº‹åŠ¡éš”ç¦»è¶Šä¸¥æ ¼ï¼Œå¹¶å‘å‰¯ä½œç”¨è¶Šå°ï¼Œä½†ä»˜å‡ºçš„ä»£ä»·ä¹Ÿå°±è¶Šå¤§ï¼Œå› ä¸ºäº‹åŠ¡éš”ç¦»å®è´¨ä¸Šå°±æ˜¯ä½¿ç”¨äº‹åŠ¡åœ¨ä¸€å®šç¨‹åº¦ä¸Šâ€œä¸²è¡ŒåŒ–â€ è¿›è¡Œï¼Œè¿™æ˜¾ç„¶ä¸â€œå¹¶å‘â€ æ˜¯çŸ›ç›¾çš„ã€‚ æ•°æ®åº“çš„éš”ç¦»çº§åˆ«æœ‰4ä¸ªï¼Œç”±ä½åˆ°é«˜ä¾æ¬¡ä¸ºRead uncommittedã€Read committedã€Repeatable readã€Serializableï¼Œè¿™å››ä¸ªçº§åˆ«å¯ä»¥é€ä¸ªè§£å†³è„å†™ã€è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»è¿™å‡ ç±»é—®é¢˜ã€‚ éš”ç¦»çº§åˆ« ä¸¢å¤±æ›´æ–° è„è¯» ä¸å¯é‡å¤è¯» å¹»è¯» Read uncommitted Ã— âˆš âˆš âˆš Read committed Ã— Ã— âˆš âˆš Repeatable readï¼ˆé»˜è®¤ï¼‰ Ã— Ã— Ã— âˆš Serializable Ã— Ã— Ã— Ã— å¤‡æ³¨ ï¼š âˆš ä»£è¡¨å¯èƒ½å‡ºç° ï¼Œ Ã— ä»£è¡¨ä¸ä¼šå‡ºç° ã€‚ Mysql çš„æ•°æ®åº“çš„é»˜è®¤éš”ç¦»çº§åˆ«ä¸º Repeatable read ï¼Œ æŸ¥çœ‹æ–¹å¼ï¼š show variables like 'tx_isolation'; 5.3.3 InnoDB çš„è¡Œé”æ¨¡å¼InnoDB å®ç°äº†ä»¥ä¸‹ä¸¤ç§ç±»å‹çš„è¡Œé”ã€‚ å…±äº«é”ï¼ˆSï¼‰ï¼šåˆç§°ä¸ºè¯»é”ï¼Œç®€ç§°Sé”ï¼Œå…±äº«é”å°±æ˜¯å¤šä¸ªäº‹åŠ¡å¯¹äºåŒä¸€æ•°æ®å¯ä»¥å…±äº«ä¸€æŠŠé”ï¼Œéƒ½èƒ½è®¿é—®åˆ°æ•°æ®ï¼Œä½†æ˜¯åªèƒ½è¯»ä¸èƒ½ä¿®æ”¹ã€‚ æ’ä»–é”ï¼ˆXï¼‰ï¼šåˆç§°ä¸ºå†™é”ï¼Œç®€ç§°Xé”ï¼Œæ’ä»–é”å°±æ˜¯ä¸èƒ½ä¸å…¶ä»–é”å¹¶å­˜ï¼Œå¦‚ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€ä¸ªæ•°æ®è¡Œçš„æ’ä»–é”ï¼Œå…¶ä»–äº‹åŠ¡å°±ä¸èƒ½å†è·å–è¯¥è¡Œçš„å…¶ä»–é”ï¼ŒåŒ…æ‹¬å…±äº«é”å’Œæ’ä»–é”ï¼Œä½†æ˜¯è·å–æ’ä»–é”çš„äº‹åŠ¡æ˜¯å¯ä»¥å¯¹æ•°æ®å°±è¡Œè¯»å–å’Œä¿®æ”¹ã€‚ å¯¹äºUPDATEã€DELETEå’ŒINSERTè¯­å¥ï¼ŒInnoDBä¼šè‡ªåŠ¨ç»™æ¶‰åŠæ•°æ®é›†åŠ æ’ä»–é”ï¼ˆX)ï¼› å¯¹äºæ™®é€šSELECTè¯­å¥ï¼ŒInnoDBä¸ä¼šåŠ ä»»ä½•é”ï¼› å¯ä»¥é€šè¿‡ä»¥ä¸‹è¯­å¥æ˜¾ç¤ºç»™è®°å½•é›†åŠ å…±äº«é”æˆ–æ’ä»–é” ã€‚ å…±äº«é”ï¼ˆSï¼‰ï¼šSELECT * FROM table_name WHERE ... LOCK IN SHARE MODE æ’ä»–é”ï¼ˆX) ï¼šSELECT * FROM table_name WHERE ... FOR UPDATE 5.3.4 æ¡ˆä¾‹å‡†å¤‡å·¥ä½œcreate table test_innodb_lock( id int(11), name varchar(16), sex varchar(1) )engine = innodb default charset=utf8; insert into test_innodb_lock values(1,'100','1'); insert into test_innodb_lock values(3,'3','1'); insert into test_innodb_lock values(4,'400','0'); insert into test_innodb_lock values(5,'500','1'); insert into test_innodb_lock values(6,'600','0'); insert into test_innodb_lock values(7,'700','0'); insert into test_innodb_lock values(8,'800','1'); insert into test_innodb_lock values(9,'900','1'); insert into test_innodb_lock values(1,'200','0'); create index idx_test_innodb_lock_id on test_innodb_lock(id); create index idx_test_innodb_lock_name on test_innodb_lock(name); 5.3.5 è¡Œé”åŸºæœ¬æ¼”ç¤º Session-1 Session-2 å…³é—­è‡ªåŠ¨æäº¤åŠŸèƒ½ å…³é—­è‡ªåŠ¨æäº¤åŠŸèƒ½ å¯ä»¥æ­£å¸¸çš„æŸ¥è¯¢å‡ºå…¨éƒ¨çš„æ•°æ® å¯ä»¥æ­£å¸¸çš„æŸ¥è¯¢å‡ºå…¨éƒ¨çš„æ•°æ® æŸ¥è¯¢id ä¸º3çš„æ•°æ® ï¼› è·å–idä¸º3çš„æ•°æ® ï¼› æ›´æ–°idä¸º3çš„æ•°æ®ï¼Œä½†æ˜¯ä¸æäº¤ï¼› æ›´æ–°idä¸º3 çš„æ•°æ®ï¼Œ å‡ºäºç­‰å¾…çŠ¶æ€ é€šè¿‡commitï¼Œ æäº¤äº‹åŠ¡ è§£é™¤é˜»å¡ï¼Œæ›´æ–°æ­£å¸¸è¿›è¡Œ ä»¥ä¸Šï¼Œ æ“ä½œçš„éƒ½æ˜¯åŒä¸€è¡Œçš„æ•°æ®ï¼Œæ¥ä¸‹æ¥ï¼Œæ¼”ç¤ºä¸åŒè¡Œçš„æ•°æ® ï¼š æ›´æ–°idä¸º3æ•°æ®ï¼Œæ­£å¸¸çš„è·å–åˆ°è¡Œé” ï¼Œ æ‰§è¡Œæ›´æ–° ï¼› ç”±äºä¸Session-1 æ“ä½œä¸æ˜¯åŒä¸€è¡Œï¼Œè·å–å½“å‰è¡Œé”ï¼Œæ‰§è¡Œæ›´æ–°ï¼› 5.3.6 æ— ç´¢å¼•è¡Œé”å‡çº§ä¸ºè¡¨é”å¦‚æœä¸é€šè¿‡ç´¢å¼•æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œé‚£ä¹ˆInnoDBå°†å¯¹è¡¨ä¸­çš„æ‰€æœ‰è®°å½•åŠ é”ï¼Œå®é™…æ•ˆæœè·Ÿè¡¨é”ä¸€æ ·ã€‚ æŸ¥çœ‹å½“å‰è¡¨çš„ç´¢å¼• ï¼š show index from test_innodb_lock ; Session-1 Session-2 å…³é—­äº‹åŠ¡çš„è‡ªåŠ¨æäº¤ å…³é—­äº‹åŠ¡çš„è‡ªåŠ¨æäº¤ æ‰§è¡Œæ›´æ–°è¯­å¥ ï¼š æ‰§è¡Œæ›´æ–°è¯­å¥ï¼Œ ä½†å¤„äºé˜»å¡çŠ¶æ€ï¼š æäº¤äº‹åŠ¡ï¼š è§£é™¤é˜»å¡ï¼Œæ‰§è¡Œæ›´æ–°æˆåŠŸ ï¼š æ‰§è¡Œæäº¤æ“ä½œ ï¼š ç”±äº æ‰§è¡Œæ›´æ–°æ—¶ ï¼Œ nameå­—æ®µæœ¬æ¥ä¸ºvarcharç±»å‹ï¼Œ æˆ‘ä»¬æ˜¯ä½œä¸ºæ•°ç»„ç±»å‹ä½¿ç”¨ï¼Œå­˜åœ¨ç±»å‹è½¬æ¢ï¼Œç´¢å¼•å¤±æ•ˆï¼Œæœ€ç»ˆè¡Œé”å˜ä¸ºè¡¨é” ï¼› 5.3.7 é—´éš™é”å±å®³å½“æˆ‘ä»¬ç”¨èŒƒå›´æ¡ä»¶ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç›¸ç­‰æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œå¹¶è¯·æ±‚å…±äº«æˆ–æ’ä»–é”æ—¶ï¼ŒInnoDBä¼šç»™ç¬¦åˆæ¡ä»¶çš„å·²æœ‰æ•°æ®è¿›è¡ŒåŠ é”ï¼› å¯¹äºé”®å€¼åœ¨æ¡ä»¶èŒƒå›´å†…ä½†å¹¶ä¸å­˜åœ¨çš„è®°å½•ï¼Œå«åš â€œé—´éš™ï¼ˆGAPï¼‰â€ ï¼Œ InnoDBä¹Ÿä¼šå¯¹è¿™ä¸ª â€œé—´éš™â€ åŠ é”ï¼Œè¿™ç§é”æœºåˆ¶å°±æ˜¯æ‰€è°“çš„ é—´éš™é”ï¼ˆNext-Keyé”ï¼‰ ã€‚ ç¤ºä¾‹ ï¼š Session-1 Session-2 å…³é—­äº‹åŠ¡è‡ªåŠ¨æäº¤ å…³é—­äº‹åŠ¡è‡ªåŠ¨æäº¤ æ ¹æ®idèŒƒå›´æ›´æ–°æ•°æ® æ’å…¥idä¸º2çš„è®°å½•ï¼Œ å‡ºäºé˜»å¡çŠ¶æ€ æäº¤äº‹åŠ¡ ï¼› è§£é™¤é˜»å¡ ï¼Œ æ‰§è¡Œæ’å…¥æ“ä½œ ï¼š æäº¤äº‹åŠ¡ ï¼š 5.3.8 InnoDB è¡Œé”äº‰ç”¨æƒ…å†µshow status like 'innodb_row_lock%'; Innodb_row_lock_current_waits: å½“å‰æ­£åœ¨ç­‰å¾…é”å®šçš„æ•°é‡ Innodb_row_lock_time: ä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨é”å®šæ€»æ—¶é—´é•¿åº¦ Innodb_row_lock_time_avg:æ¯æ¬¡ç­‰å¾…æ‰€èŠ±å¹³å‡æ—¶é•¿ Innodb_row_lock_time_max:ä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨ç­‰å¾…æœ€é•¿çš„ä¸€æ¬¡æ‰€èŠ±çš„æ—¶é—´ Innodb_row_lock_waits: ç³»ç»Ÿå¯åŠ¨ååˆ°ç°åœ¨æ€»å…±ç­‰å¾…çš„æ¬¡æ•° å½“ç­‰å¾…çš„æ¬¡æ•°å¾ˆé«˜ï¼Œè€Œä¸”æ¯æ¬¡ç­‰å¾…çš„æ—¶é•¿ä¹Ÿä¸å°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦åˆ†æç³»ç»Ÿä¸­ä¸ºä»€ä¹ˆä¼šæœ‰å¦‚æ­¤å¤šçš„ç­‰å¾…ï¼Œç„¶åæ ¹æ®åˆ†æç»“æœç€æ‰‹åˆ¶å®šä¼˜åŒ–è®¡åˆ’ã€‚ 5.3.9 æ€»ç»“InnoDBå­˜å‚¨å¼•æ“ç”±äºå®ç°äº†è¡Œçº§é”å®šï¼Œè™½ç„¶åœ¨é”å®šæœºåˆ¶çš„å®ç°æ–¹é¢å¸¦æ¥äº†æ€§èƒ½æŸè€—å¯èƒ½æ¯”è¡¨é”ä¼šæ›´é«˜ä¸€äº›ï¼Œä½†æ˜¯åœ¨æ•´ä½“å¹¶å‘å¤„ç†èƒ½åŠ›æ–¹é¢è¦è¿œè¿œç”±äºMyISAMçš„è¡¨é”çš„ã€‚å½“ç³»ç»Ÿå¹¶å‘é‡è¾ƒé«˜çš„æ—¶å€™ï¼ŒInnoDBçš„æ•´ä½“æ€§èƒ½å’ŒMyISAMç›¸æ¯”å°±ä¼šæœ‰æ¯”è¾ƒæ˜æ˜¾çš„ä¼˜åŠ¿ã€‚ ä½†æ˜¯ï¼ŒInnoDBçš„è¡Œçº§é”åŒæ ·ä¹Ÿæœ‰å…¶è„†å¼±çš„ä¸€é¢ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ä¸å½“çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šè®©InnoDBçš„æ•´ä½“æ€§èƒ½è¡¨ç°ä¸ä»…ä¸èƒ½æ¯”MyISAMé«˜ï¼Œç”šè‡³å¯èƒ½ä¼šæ›´å·®ã€‚ ä¼˜åŒ–å»ºè®®ï¼š å°½å¯èƒ½è®©æ‰€æœ‰æ•°æ®æ£€ç´¢éƒ½èƒ½é€šè¿‡ç´¢å¼•æ¥å®Œæˆï¼Œé¿å…æ— ç´¢å¼•è¡Œé”å‡çº§ä¸ºè¡¨é”ã€‚ åˆç†è®¾è®¡ç´¢å¼•ï¼Œå°½é‡ç¼©å°é”çš„èŒƒå›´ å°½å¯èƒ½å‡å°‘ç´¢å¼•æ¡ä»¶ï¼ŒåŠç´¢å¼•èŒƒå›´ï¼Œé¿å…é—´éš™é” å°½é‡æ§åˆ¶äº‹åŠ¡å¤§å°ï¼Œå‡å°‘é”å®šèµ„æºé‡å’Œæ—¶é—´é•¿åº¦ å°½å¯ä½¿ç”¨ä½çº§åˆ«äº‹åŠ¡éš”ç¦»ï¼ˆä½†æ˜¯éœ€è¦ä¸šåŠ¡å±‚é¢æ»¡è¶³éœ€æ±‚ï¼‰ 6. å¸¸ç”¨SQLæŠ€å·§6.1 SQLæ‰§è¡Œé¡ºåºç¼–å†™é¡ºåº SELECT DISTINCT FROM JOIN ON WHERE GROUP BY HAVING ORDER BY LIMIT æ‰§è¡Œé¡ºåº FROM &lt;left_table> ON &lt;join_condition> &lt;join_type> JOIN &lt;right_table> WHERE &lt;where_condition> GROUP BY &lt;group_by_list> HAVING &lt;having_condition> SELECT DISTINCT &lt;select list> ORDER BY &lt;order_by_condition> LIMIT &lt;limit_params> 6.2 æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼ˆRegular Expressionï¼‰æ˜¯æŒ‡ä¸€ä¸ªç”¨æ¥æè¿°æˆ–è€…åŒ¹é…ä¸€ç³»åˆ—ç¬¦åˆæŸä¸ªå¥æ³•è§„åˆ™çš„å­—ç¬¦ä¸²çš„å•ä¸ªå­—ç¬¦ä¸²ã€‚ ç¬¦å· å«ä¹‰ ^ åœ¨å­—ç¬¦ä¸²å¼€å§‹å¤„è¿›è¡ŒåŒ¹é… $ åœ¨å­—ç¬¦ä¸²æœ«å°¾å¤„è¿›è¡ŒåŒ¹é… . åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦, åŒ…æ‹¬æ¢è¡Œç¬¦ [â€¦] åŒ¹é…å‡ºæ‹¬å·å†…çš„ä»»æ„å­—ç¬¦ [^â€¦] åŒ¹é…ä¸å‡ºæ‹¬å·å†…çš„ä»»æ„å­—ç¬¦ a* åŒ¹é…é›¶ä¸ªæˆ–è€…å¤šä¸ªa(åŒ…æ‹¬ç©ºä¸²) a+ åŒ¹é…ä¸€ä¸ªæˆ–è€…å¤šä¸ªa(ä¸åŒ…æ‹¬ç©ºä¸²) a? åŒ¹é…é›¶ä¸ªæˆ–è€…ä¸€ä¸ªa a1\ a2 åŒ¹é…a1æˆ–a2 a(m) åŒ¹é…mä¸ªa a(m,) è‡³å°‘åŒ¹é…mä¸ªa a(m,n) åŒ¹é…mä¸ªa åˆ° nä¸ªa a(,n) åŒ¹é…0åˆ°nä¸ªa (â€¦) å°†æ¨¡å¼å…ƒç´ ç»„æˆå•ä¸€å…ƒç´  select * from emp where name regexp '^T'; select * from emp where name regexp '2$'; select * from emp where name regexp '[uvw]'; 6.3 MySQL å¸¸ç”¨å‡½æ•°æ•°å­—å‡½æ•° å‡½æ•°åç§° ä½œ ç”¨ ABS æ±‚ç»å¯¹å€¼ SQRT æ±‚äºŒæ¬¡æ–¹æ ¹ MOD æ±‚ä½™æ•° CEIL å’Œ CEILING ä¸¤ä¸ªå‡½æ•°åŠŸèƒ½ç›¸åŒï¼Œéƒ½æ˜¯è¿”å›ä¸å°äºå‚æ•°çš„æœ€å°æ•´æ•°ï¼Œå³å‘ä¸Šå–æ•´ FLOOR å‘ä¸‹å–æ•´ï¼Œè¿”å›å€¼è½¬åŒ–ä¸ºä¸€ä¸ªBIGINT RAND ç”Ÿæˆä¸€ä¸ª0~1ä¹‹é—´çš„éšæœºæ•°ï¼Œä¼ å…¥æ•´æ•°å‚æ•°æ˜¯ï¼Œç”¨æ¥äº§ç”Ÿé‡å¤åºåˆ— ROUND å¯¹æ‰€ä¼ å‚æ•°è¿›è¡Œå››èˆäº”å…¥ SIGN è¿”å›å‚æ•°çš„ç¬¦å· POW å’Œ POWER ä¸¤ä¸ªå‡½æ•°çš„åŠŸèƒ½ç›¸åŒï¼Œéƒ½æ˜¯æ‰€ä¼ å‚æ•°çš„æ¬¡æ–¹çš„ç»“æœå€¼ SIN æ±‚æ­£å¼¦å€¼ ASIN æ±‚åæ­£å¼¦å€¼ï¼Œä¸å‡½æ•° SIN äº’ä¸ºåå‡½æ•° COS æ±‚ä½™å¼¦å€¼ ACOS æ±‚åä½™å¼¦å€¼ï¼Œä¸å‡½æ•° COS äº’ä¸ºåå‡½æ•° TAN æ±‚æ­£åˆ‡å€¼ ATAN æ±‚åæ­£åˆ‡å€¼ï¼Œä¸å‡½æ•° TAN äº’ä¸ºåå‡½æ•° COT æ±‚ä½™åˆ‡å€¼ å­—ç¬¦ä¸²å‡½æ•° å‡½æ•°åç§° ä½œ ç”¨ LENGTH è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦å‡½æ•°ï¼Œè¿”å›å­—ç¬¦ä¸²çš„å­—èŠ‚é•¿åº¦ CONCAT åˆå¹¶å­—ç¬¦ä¸²å‡½æ•°ï¼Œè¿”å›ç»“æœä¸ºè¿æ¥å‚æ•°äº§ç”Ÿçš„å­—ç¬¦ä¸²ï¼Œå‚æ•°å¯ä»¥ä½¿ä¸€ä¸ªæˆ–å¤šä¸ª INSERT æ›¿æ¢å­—ç¬¦ä¸²å‡½æ•° LOWER å°†å­—ç¬¦ä¸²ä¸­çš„å­—æ¯è½¬æ¢ä¸ºå°å†™ UPPER å°†å­—ç¬¦ä¸²ä¸­çš„å­—æ¯è½¬æ¢ä¸ºå¤§å†™ LEFT ä»å·¦ä¾§å­—æˆªå–ç¬¦ä¸²ï¼Œè¿”å›å­—ç¬¦ä¸²å·¦è¾¹çš„è‹¥å¹²ä¸ªå­—ç¬¦ RIGHT ä»å³ä¾§å­—æˆªå–ç¬¦ä¸²ï¼Œè¿”å›å­—ç¬¦ä¸²å³è¾¹çš„è‹¥å¹²ä¸ªå­—ç¬¦ TRIM åˆ é™¤å­—ç¬¦ä¸²å·¦å³ä¸¤ä¾§çš„ç©ºæ ¼ REPLACE å­—ç¬¦ä¸²æ›¿æ¢å‡½æ•°ï¼Œè¿”å›æ›¿æ¢åçš„æ–°å­—ç¬¦ä¸² SUBSTRING æˆªå–å­—ç¬¦ä¸²ï¼Œè¿”å›ä»æŒ‡å®šä½ç½®å¼€å§‹çš„æŒ‡å®šé•¿åº¦çš„å­—ç¬¦æ¢ REVERSE å­—ç¬¦ä¸²åè½¬ï¼ˆé€†åºï¼‰å‡½æ•°ï¼Œè¿”å›ä¸åŸå§‹å­—ç¬¦ä¸²é¡ºåºç›¸åçš„å­—ç¬¦ä¸² æ—¥æœŸå‡½æ•° å‡½æ•°åç§° ä½œ ç”¨ CURDATE å’Œ CURRENT_DATE ä¸¤ä¸ªå‡½æ•°ä½œç”¨ç›¸åŒï¼Œè¿”å›å½“å‰ç³»ç»Ÿçš„æ—¥æœŸå€¼ CURTIME å’Œ CURRENT_TIME ä¸¤ä¸ªå‡½æ•°ä½œç”¨ç›¸åŒï¼Œè¿”å›å½“å‰ç³»ç»Ÿçš„æ—¶é—´å€¼ NOW å’Œ SYSDATE ä¸¤ä¸ªå‡½æ•°ä½œç”¨ç›¸åŒï¼Œè¿”å›å½“å‰ç³»ç»Ÿçš„æ—¥æœŸå’Œæ—¶é—´å€¼ MONTH è·å–æŒ‡å®šæ—¥æœŸä¸­çš„æœˆä»½ MONTHNAME è·å–æŒ‡å®šæ—¥æœŸä¸­çš„æœˆä»½è‹±æ–‡åç§° DAYNAME è·å–æŒ‡å®šæ›°æœŸå¯¹åº”çš„æ˜ŸæœŸå‡ çš„è‹±æ–‡åç§° DAYOFWEEK è·å–æŒ‡å®šæ—¥æœŸå¯¹åº”çš„ä¸€å‘¨çš„ç´¢å¼•ä½ç½®å€¼ WEEK è·å–æŒ‡å®šæ—¥æœŸæ˜¯ä¸€å¹´ä¸­çš„ç¬¬å‡ å‘¨ï¼Œè¿”å›å€¼çš„èŒƒå›´æ˜¯å¦ä¸º 0ã€œ52 æˆ– 1ã€œ53 DAYOFYEAR è·å–æŒ‡å®šæ›°æœŸæ˜¯ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©ï¼Œè¿”å›å€¼èŒƒå›´æ˜¯1~366 DAYOFMONTH è·å–æŒ‡å®šæ—¥æœŸæ˜¯ä¸€ä¸ªæœˆä¸­æ˜¯ç¬¬å‡ å¤©ï¼Œè¿”å›å€¼èŒƒå›´æ˜¯1~31 YEAR è·å–å¹´ä»½ï¼Œè¿”å›å€¼èŒƒå›´æ˜¯ 1970ã€œ2069 TIME_TO_SEC å°†æ—¶é—´å‚æ•°è½¬æ¢ä¸ºç§’æ•° SEC_TO_TIME å°†ç§’æ•°è½¬æ¢ä¸ºæ—¶é—´ï¼Œä¸TIME_TO_SEC äº’ä¸ºåå‡½æ•° DATE_ADD å’Œ ADDDATE ä¸¤ä¸ªå‡½æ•°åŠŸèƒ½ç›¸åŒï¼Œéƒ½æ˜¯å‘æ—¥æœŸæ·»åŠ æŒ‡å®šçš„æ—¶é—´é—´éš” DATE_SUB å’Œ SUBDATE ä¸¤ä¸ªå‡½æ•°åŠŸèƒ½ç›¸åŒï¼Œéƒ½æ˜¯å‘æ—¥æœŸå‡å»æŒ‡å®šçš„æ—¶é—´é—´éš” ADDTIME æ—¶é—´åŠ æ³•è¿ç®—ï¼Œåœ¨åŸå§‹æ—¶é—´ä¸Šæ·»åŠ æŒ‡å®šçš„æ—¶é—´ SUBTIME æ—¶é—´å‡æ³•è¿ç®—ï¼Œåœ¨åŸå§‹æ—¶é—´ä¸Šå‡å»æŒ‡å®šçš„æ—¶é—´ DATEDIFF è·å–ä¸¤ä¸ªæ—¥æœŸä¹‹é—´é—´éš”ï¼Œè¿”å›å‚æ•° 1 å‡å»å‚æ•° 2 çš„å€¼ DATE_FORMAT æ ¼å¼åŒ–æŒ‡å®šçš„æ—¥æœŸï¼Œæ ¹æ®å‚æ•°è¿”å›æŒ‡å®šæ ¼å¼çš„å€¼ WEEKDAY è·å–æŒ‡å®šæ—¥æœŸåœ¨ä¸€å‘¨å†…çš„å¯¹åº”çš„å·¥ä½œæ—¥ç´¢å¼• èšåˆå‡½æ•° å‡½æ•°åç§° ä½œç”¨ MAX æŸ¥è¯¢æŒ‡å®šåˆ—çš„æœ€å¤§å€¼ MIN æŸ¥è¯¢æŒ‡å®šåˆ—çš„æœ€å°å€¼ COUNT ç»Ÿè®¡æŸ¥è¯¢ç»“æœçš„è¡Œæ•° SUM æ±‚å’Œï¼Œè¿”å›æŒ‡å®šåˆ—çš„æ€»å’Œ AVG æ±‚å¹³å‡å€¼ï¼Œè¿”å›æŒ‡å®šåˆ—æ•°æ®çš„å¹³å‡å€¼ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQLæ•°æ®åº“ä¼˜åŒ–ä¹‹ç»„åˆæ‹³(ä¸‰)</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLæ•°æ®åº“ä¼˜åŒ–ä¹‹ç»„åˆæ‹³(äºŒ)]]></title>
    <url>%2F2021%2F01%2F23%2Fmysql-advanced-2%2F</url>
    <content type="text"><![CDATA[éåŸåˆ›å›¾æ–‡,å›¾æ–‡æ¥æºäºé»‘é©¬å®˜ç½‘,æ­¤å¤„ä»…ä½œä¸ºå¤‡ä»½å­¦ä¹  MySQLæ•°æ®åº“ä¼˜åŒ–æ€»æ¦‚ ç»„åˆæ‹³ï¼ˆä¸€ï¼‰ ğŸš©ç»„åˆæ‹³ï¼ˆäºŒï¼‰ ç»„åˆæ‹³ï¼ˆä¸‰ï¼‰ ç»„åˆæ‹³ï¼ˆå››ï¼‰ ç´¢å¼• ä½“ç³»ç»“æ„ åº”ç”¨ä¼˜åŒ– MySQL å¸¸ç”¨å·¥å…· è§†å›¾ å­˜å‚¨å¼•æ“ æŸ¥è¯¢ç¼“å­˜ä¼˜åŒ– MySQL æ—¥å¿— å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•° ä¼˜åŒ–SQLæ­¥éª¤ å†…å­˜ç®¡ç†åŠä¼˜åŒ– MySQL ä¸»ä»å¤åˆ¶ è§¦å‘å™¨ ç´¢å¼•ä½¿ç”¨ MySQLé”é—®é¢˜ SQLä¼˜åŒ– å¸¸ç”¨SQLæŠ€å·§ 1. Mysqlçš„ä½“ç³»ç»“æ„æ¦‚è§ˆ æ•´ä¸ªMySQL Serverç”±ä»¥ä¸‹ç»„æˆ Connection Pool : è¿æ¥æ± ç»„ä»¶ Management Services &amp; Utilities : ç®¡ç†æœåŠ¡å’Œå·¥å…·ç»„ä»¶ SQL Interface : SQLæ¥å£ç»„ä»¶ Parser : æŸ¥è¯¢åˆ†æå™¨ç»„ä»¶ Optimizer : ä¼˜åŒ–å™¨ç»„ä»¶ Caches &amp; Buffers : ç¼“å†²æ± ç»„ä»¶ Pluggable Storage Engines : å­˜å‚¨å¼•æ“ File System : æ–‡ä»¶ç³»ç»Ÿ 1ï¼‰ è¿æ¥å±‚ æœ€ä¸Šå±‚æ˜¯ä¸€äº›å®¢æˆ·ç«¯å’Œé“¾æ¥æœåŠ¡ï¼ŒåŒ…å«æœ¬åœ°sock é€šä¿¡å’Œå¤§å¤šæ•°åŸºäºå®¢æˆ·ç«¯/æœåŠ¡ç«¯å·¥å…·å®ç°çš„ç±»ä¼¼äº TCP/IPçš„é€šä¿¡ã€‚ä¸»è¦å®Œæˆä¸€äº›ç±»ä¼¼äºè¿æ¥å¤„ç†ã€æˆæƒè®¤è¯ã€åŠç›¸å…³çš„å®‰å…¨æ–¹æ¡ˆã€‚åœ¨è¯¥å±‚ä¸Šå¼•å…¥äº†çº¿ç¨‹æ± çš„æ¦‚å¿µï¼Œä¸ºé€šè¿‡è®¤è¯å®‰å…¨æ¥å…¥çš„å®¢æˆ·ç«¯æä¾›çº¿ç¨‹ã€‚åŒæ ·åœ¨è¯¥å±‚ä¸Šå¯ä»¥å®ç°åŸºäºSSLçš„å®‰å…¨é“¾æ¥ã€‚æœåŠ¡å™¨ä¹Ÿä¼šä¸ºå®‰å…¨æ¥å…¥çš„æ¯ä¸ªå®¢æˆ·ç«¯éªŒè¯å®ƒæ‰€å…·æœ‰çš„æ“ä½œæƒé™ã€‚ 2ï¼‰ æœåŠ¡å±‚ ç¬¬äºŒå±‚æ¶æ„ä¸»è¦å®Œæˆå¤§å¤šæ•°çš„æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œå¦‚SQLæ¥å£ï¼Œå¹¶å®Œæˆç¼“å­˜çš„æŸ¥è¯¢ï¼ŒSQLçš„åˆ†æå’Œä¼˜åŒ–ï¼Œéƒ¨åˆ†å†…ç½®å‡½æ•°çš„æ‰§è¡Œã€‚æ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½ä¹Ÿåœ¨è¿™ä¸€å±‚å®ç°ï¼Œå¦‚ è¿‡ç¨‹ã€å‡½æ•°ç­‰ã€‚åœ¨è¯¥å±‚ï¼ŒæœåŠ¡å™¨ä¼šè§£ææŸ¥è¯¢å¹¶åˆ›å»ºç›¸åº”çš„å†…éƒ¨è§£ææ ‘ï¼Œå¹¶å¯¹å…¶å®Œæˆç›¸åº”çš„ä¼˜åŒ–å¦‚ç¡®å®šè¡¨çš„æŸ¥è¯¢çš„é¡ºåºï¼Œæ˜¯å¦åˆ©ç”¨ç´¢å¼•ç­‰ï¼Œ æœ€åç”Ÿæˆç›¸åº”çš„æ‰§è¡Œæ“ä½œã€‚å¦‚æœæ˜¯selectè¯­å¥ï¼ŒæœåŠ¡å™¨è¿˜ä¼šæŸ¥è¯¢å†…éƒ¨çš„ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ç©ºé—´è¶³å¤Ÿå¤§ï¼Œè¿™æ ·åœ¨è§£å†³å¤§é‡è¯»æ“ä½œçš„ç¯å¢ƒä¸­èƒ½å¤Ÿå¾ˆå¥½çš„æå‡ç³»ç»Ÿçš„æ€§èƒ½ã€‚ 3ï¼‰ å¼•æ“å±‚ å­˜å‚¨å¼•æ“å±‚ï¼Œ å­˜å‚¨å¼•æ“çœŸæ­£çš„è´Ÿè´£äº†MySQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼ŒæœåŠ¡å™¨é€šè¿‡APIå’Œå­˜å‚¨å¼•æ“è¿›è¡Œé€šä¿¡ã€‚ä¸åŒçš„å­˜å‚¨å¼•æ“å…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œæ¥é€‰å–åˆé€‚çš„å­˜å‚¨å¼•æ“ã€‚ 4ï¼‰å­˜å‚¨å±‚ æ•°æ®å­˜å‚¨å±‚ï¼Œ ä¸»è¦æ˜¯å°†æ•°æ®å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Šï¼Œå¹¶å®Œæˆä¸å­˜å‚¨å¼•æ“çš„äº¤äº’ã€‚ å’Œå…¶ä»–æ•°æ®åº“ç›¸æ¯”ï¼ŒMySQLæœ‰ç‚¹ä¸ä¼—ä¸åŒï¼Œå®ƒçš„æ¶æ„å¯ä»¥åœ¨å¤šç§ä¸åŒåœºæ™¯ä¸­åº”ç”¨å¹¶å‘æŒ¥è‰¯å¥½ä½œç”¨ã€‚ä¸»è¦ä½“ç°åœ¨å­˜å‚¨å¼•æ“ä¸Šï¼Œæ’ä»¶å¼çš„å­˜å‚¨å¼•æ“æ¶æ„ï¼Œå°†æŸ¥è¯¢å¤„ç†å’Œå…¶ä»–çš„ç³»ç»Ÿä»»åŠ¡ä»¥åŠæ•°æ®çš„å­˜å‚¨æå–åˆ†ç¦»ã€‚è¿™ç§æ¶æ„å¯ä»¥æ ¹æ®ä¸šåŠ¡çš„éœ€æ±‚å’Œå®é™…éœ€è¦é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“ã€‚ 2. å­˜å‚¨å¼•æ“2.1 å­˜å‚¨å¼•æ“æ¦‚è¿°â€‹ å’Œå¤§å¤šæ•°çš„æ•°æ®åº“ä¸åŒ, MySQLä¸­æœ‰ä¸€ä¸ªå­˜å‚¨å¼•æ“çš„æ¦‚å¿µ, é’ˆå¯¹ä¸åŒçš„å­˜å‚¨éœ€æ±‚å¯ä»¥é€‰æ‹©æœ€ä¼˜çš„å­˜å‚¨å¼•æ“ã€‚ â€‹ å­˜å‚¨å¼•æ“å°±æ˜¯å­˜å‚¨æ•°æ®ï¼Œå»ºç«‹ç´¢å¼•ï¼Œæ›´æ–°æŸ¥è¯¢æ•°æ®ç­‰ç­‰æŠ€æœ¯çš„å®ç°æ–¹å¼ ã€‚å­˜å‚¨å¼•æ“æ˜¯åŸºäºè¡¨çš„ï¼Œè€Œä¸æ˜¯åŸºäºåº“çš„ã€‚æ‰€ä»¥å­˜å‚¨å¼•æ“ä¹Ÿå¯è¢«ç§°ä¸ºè¡¨ç±»å‹ã€‚ â€‹ Oracleï¼ŒSqlServerç­‰æ•°æ®åº“åªæœ‰ä¸€ç§å­˜å‚¨å¼•æ“ã€‚MySQLæä¾›äº†æ’ä»¶å¼çš„å­˜å‚¨å¼•æ“æ¶æ„ã€‚æ‰€ä»¥MySQLå­˜åœ¨å¤šç§å­˜å‚¨å¼•æ“ï¼Œå¯ä»¥æ ¹æ®éœ€è¦ä½¿ç”¨ç›¸åº”å¼•æ“ï¼Œæˆ–è€…ç¼–å†™å­˜å‚¨å¼•æ“ã€‚ â€‹ MySQL5.0æ”¯æŒçš„å­˜å‚¨å¼•æ“åŒ…å« ï¼š InnoDB ã€MyISAM ã€BDBã€MEMORYã€MERGEã€EXAMPLEã€NDB Clusterã€ARCHIVEã€CSVã€BLACKHOLEã€FEDERATEDç­‰ï¼Œå…¶ä¸­InnoDBå’ŒBDBæä¾›äº‹åŠ¡å®‰å…¨è¡¨ï¼Œå…¶ä»–å­˜å‚¨å¼•æ“æ˜¯éäº‹åŠ¡å®‰å…¨è¡¨ã€‚ å¯ä»¥é€šè¿‡æŒ‡å®š show engines ï¼Œ æ¥æŸ¥è¯¢å½“å‰æ•°æ®åº“æ”¯æŒçš„å­˜å‚¨å¼•æ“ ï¼š åˆ›å»ºæ–°è¡¨æ—¶å¦‚æœä¸æŒ‡å®šå­˜å‚¨å¼•æ“ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¼šä½¿ç”¨é»˜è®¤çš„å­˜å‚¨å¼•æ“ï¼ŒMySQL5.5ä¹‹å‰çš„é»˜è®¤å­˜å‚¨å¼•æ“æ˜¯MyISAMï¼Œ5.5ä¹‹åå°±æ”¹ä¸ºäº†InnoDBã€‚ æŸ¥çœ‹Mysqlæ•°æ®åº“é»˜è®¤çš„å­˜å‚¨å¼•æ“ ï¼Œ æŒ‡ä»¤ ï¼š show variables like '%storage_engine%' ï¼› 2.2 å„ç§å­˜å‚¨å¼•æ“ç‰¹æ€§ä¸‹é¢é‡ç‚¹ä»‹ç»å‡ ç§å¸¸ç”¨çš„å­˜å‚¨å¼•æ“ï¼Œ å¹¶å¯¹æ¯”å„ä¸ªå­˜å‚¨å¼•æ“ä¹‹é—´çš„åŒºåˆ«ï¼Œ å¦‚ä¸‹è¡¨æ‰€ç¤º ï¼š ç‰¹ç‚¹ InnoDB MyISAM MEMORY MERGE NDB å­˜å‚¨é™åˆ¶ 64TB æœ‰ æœ‰ æ²¡æœ‰ æœ‰ äº‹åŠ¡å®‰å…¨ ==æ”¯æŒ== é”æœºåˆ¶ ==è¡Œé”(é€‚åˆé«˜å¹¶å‘)== ==è¡¨é”== è¡¨é” è¡¨é” è¡Œé” Bæ ‘ç´¢å¼• æ”¯æŒ æ”¯æŒ æ”¯æŒ æ”¯æŒ æ”¯æŒ å“ˆå¸Œç´¢å¼• æ”¯æŒ å…¨æ–‡ç´¢å¼• æ”¯æŒ(5.6ç‰ˆæœ¬ä¹‹å) æ”¯æŒ é›†ç¾¤ç´¢å¼• æ”¯æŒ æ•°æ®ç´¢å¼• æ”¯æŒ æ”¯æŒ æ”¯æŒ ç´¢å¼•ç¼“å­˜ æ”¯æŒ æ”¯æŒ æ”¯æŒ æ”¯æŒ æ”¯æŒ æ•°æ®å¯å‹ç¼© æ”¯æŒ ç©ºé—´ä½¿ç”¨ é«˜ ä½ N/A ä½ ä½ å†…å­˜ä½¿ç”¨ é«˜ ä½ ä¸­ç­‰ ä½ é«˜ æ‰¹é‡æ’å…¥é€Ÿåº¦ ä½ é«˜ é«˜ é«˜ é«˜ æ”¯æŒå¤–é”® ==æ”¯æŒ== ä¸‹é¢æˆ‘ä»¬å°†é‡ç‚¹ä»‹ç»æœ€é•¿ä½¿ç”¨çš„ä¸¤ç§å­˜å‚¨å¼•æ“ï¼š InnoDBã€MyISAM ï¼Œ å¦å¤–ä¸¤ç§ MEMORYã€MERGE ï¼Œ äº†è§£å³å¯ã€‚ 2.2.1 InnoDBâ€‹ InnoDBå­˜å‚¨å¼•æ“æ˜¯Mysqlçš„é»˜è®¤å­˜å‚¨å¼•æ“ã€‚InnoDBå­˜å‚¨å¼•æ“æä¾›äº†å…·æœ‰æäº¤ã€å›æ»šã€å´©æºƒæ¢å¤èƒ½åŠ›çš„äº‹åŠ¡å®‰å…¨ã€‚ä½†æ˜¯å¯¹æ¯”MyISAMçš„å­˜å‚¨å¼•æ“ï¼ŒInnoDBå†™çš„å¤„ç†æ•ˆç‡å·®ä¸€äº›ï¼Œå¹¶ä¸”ä¼šå ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ä»¥ä¿ç•™æ•°æ®å’Œç´¢å¼•ã€‚ InnoDBå­˜å‚¨å¼•æ“ä¸åŒäºå…¶ä»–å­˜å‚¨å¼•æ“çš„ç‰¹ç‚¹ ï¼š äº‹åŠ¡æ§åˆ¶ create table goods_innodb( id int NOT NULL AUTO_INCREMENT, name varchar(20) NOT NULL, primary key(id) )ENGINE=innodb DEFAULT CHARSET=utf8; start transaction; insert into goods_innodb(id,name)values(null,'Meta20'); commit; æµ‹è¯•ï¼Œå‘ç°åœ¨InnoDBä¸­æ˜¯å­˜åœ¨äº‹åŠ¡çš„ ï¼› å¤–é”®çº¦æŸ â€‹ MySQLæ”¯æŒå¤–é”®çš„å­˜å‚¨å¼•æ“åªæœ‰InnoDB ï¼Œ åœ¨åˆ›å»ºå¤–é”®çš„æ—¶å€™ï¼Œ è¦æ±‚çˆ¶è¡¨å¿…é¡»æœ‰å¯¹åº”çš„ç´¢å¼• ï¼Œ å­è¡¨åœ¨åˆ›å»ºå¤–é”®çš„æ—¶å€™ï¼Œ ä¹Ÿä¼šè‡ªåŠ¨çš„åˆ›å»ºå¯¹åº”çš„ç´¢å¼•ã€‚ â€‹ ä¸‹é¢ä¸¤å¼ è¡¨ä¸­ ï¼Œ country_innodbæ˜¯çˆ¶è¡¨ ï¼Œ country_idä¸ºä¸»é”®ç´¢å¼•ï¼Œcity_innodbè¡¨æ˜¯å­è¡¨ï¼Œcountry_idå­—æ®µä¸ºå¤–é”®ï¼Œå¯¹åº”äºcountry_innodbè¡¨çš„ä¸»é”®country_id ã€‚ create table country_innodb( country_id int NOT NULL AUTO_INCREMENT, country_name varchar(100) NOT NULL, primary key(country_id) )ENGINE=InnoDB DEFAULT CHARSET=utf8; create table city_innodb( city_id int NOT NULL AUTO_INCREMENT, city_name varchar(50) NOT NULL, country_id int NOT NULL, primary key(city_id), key idx_fk_country_id(country_id), CONSTRAINT `fk_city_country` FOREIGN KEY(country_id) REFERENCES country_innodb(country_id) ON DELETE RESTRICT ON UPDATE CASCADE )ENGINE=InnoDB DEFAULT CHARSET=utf8; insert into country_innodb values(null,'China'),(null,'America'),(null,'Japan'); insert into city_innodb values(null,'Xian',1),(null,'NewYork',2),(null,'BeiJing',1); åœ¨åˆ›å»ºç´¢å¼•æ—¶ï¼Œ å¯ä»¥æŒ‡å®šåœ¨åˆ é™¤ã€æ›´æ–°çˆ¶è¡¨æ—¶ï¼Œå¯¹å­è¡¨è¿›è¡Œçš„ç›¸åº”æ“ä½œï¼ŒåŒ…æ‹¬ RESTRICTã€CASCADEã€SET NULL å’Œ NO ACTIONã€‚ RESTRICTå’ŒNO ACTIONç›¸åŒï¼Œ æ˜¯æŒ‡é™åˆ¶åœ¨å­è¡¨æœ‰å…³è”è®°å½•çš„æƒ…å†µä¸‹ï¼Œ çˆ¶è¡¨ä¸èƒ½æ›´æ–°ï¼› CASCADEè¡¨ç¤ºçˆ¶è¡¨åœ¨æ›´æ–°æˆ–è€…åˆ é™¤æ—¶ï¼Œæ›´æ–°æˆ–è€…åˆ é™¤å­è¡¨å¯¹åº”çš„è®°å½•ï¼› SET NULL åˆ™è¡¨ç¤ºçˆ¶è¡¨åœ¨æ›´æ–°æˆ–è€…åˆ é™¤çš„æ—¶å€™ï¼Œå­è¡¨çš„å¯¹åº”å­—æ®µè¢«SET NULL ã€‚ é’ˆå¯¹ä¸Šé¢åˆ›å»ºçš„ä¸¤ä¸ªè¡¨ï¼Œ å­è¡¨çš„å¤–é”®æŒ‡å®šæ˜¯ON DELETE RESTRICT ON UPDATE CASCADE æ–¹å¼çš„ï¼Œ é‚£ä¹ˆåœ¨ä¸»è¡¨åˆ é™¤è®°å½•çš„æ—¶å€™ï¼Œ å¦‚æœå­è¡¨æœ‰å¯¹åº”è®°å½•ï¼Œ åˆ™ä¸å…è®¸åˆ é™¤ï¼Œ ä¸»è¡¨åœ¨æ›´æ–°è®°å½•çš„æ—¶å€™ï¼Œ å¦‚æœå­è¡¨æœ‰å¯¹åº”è®°å½•ï¼Œ åˆ™å­è¡¨å¯¹åº”æ›´æ–° ã€‚ è¡¨ä¸­æ•°æ®å¦‚ä¸‹å›¾æ‰€ç¤º ï¼š å¤–é”®ä¿¡æ¯å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä¸¤ç§æ–¹å¼æŸ¥çœ‹ ï¼š show create table city_innodb ; åˆ é™¤country_idä¸º1 çš„countryæ•°æ®ï¼š delete from country_innodb where country_id = 1; æ›´æ–°ä¸»è¡¨countryè¡¨çš„å­—æ®µ country_id : update country_innodb set country_id = 100 where country_id = 1; æ›´æ–°åï¼Œ å­è¡¨çš„æ•°æ®ä¿¡æ¯ä¸º ï¼š å­˜å‚¨æ–¹å¼ InnoDB å­˜å‚¨è¡¨å’Œç´¢å¼•æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ ï¼š â‘ . ä½¿ç”¨å…±äº«è¡¨ç©ºé—´å­˜å‚¨ï¼Œ è¿™ç§æ–¹å¼åˆ›å»ºçš„è¡¨çš„è¡¨ç»“æ„ä¿å­˜åœ¨.frmæ–‡ä»¶ä¸­ï¼Œ æ•°æ®å’Œç´¢å¼•ä¿å­˜åœ¨ innodb_data_home_dir å’Œ innodb_data_file_pathå®šä¹‰çš„è¡¨ç©ºé—´ä¸­ï¼Œå¯ä»¥æ˜¯å¤šä¸ªæ–‡ä»¶ã€‚ â‘¡. ä½¿ç”¨å¤šè¡¨ç©ºé—´å­˜å‚¨ï¼Œ è¿™ç§æ–¹å¼åˆ›å»ºçš„è¡¨çš„è¡¨ç»“æ„ä»ç„¶å­˜åœ¨ .frm æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯æ¯ä¸ªè¡¨çš„æ•°æ®å’Œç´¢å¼•å•ç‹¬ä¿å­˜åœ¨ .ibd ä¸­ã€‚ 2.2.2 MyISAMâ€‹ MyISAM ä¸æ”¯æŒäº‹åŠ¡ã€ä¹Ÿä¸æ”¯æŒå¤–é”®ï¼Œå…¶ä¼˜åŠ¿æ˜¯è®¿é—®çš„é€Ÿåº¦å¿«ï¼Œå¯¹äº‹åŠ¡çš„å®Œæ•´æ€§æ²¡æœ‰è¦æ±‚æˆ–è€…ä»¥SELECTã€INSERTä¸ºä¸»çš„åº”ç”¨åŸºæœ¬ä¸Šéƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¼•æ“æ¥åˆ›å»ºè¡¨ ã€‚æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„ç‰¹ç‚¹ï¼š ä¸æ”¯æŒäº‹åŠ¡ create table goods_myisam( id int NOT NULL AUTO_INCREMENT, name varchar(20) NOT NULL, primary key(id) )ENGINE=myisam DEFAULT CHARSET=utf8; é€šè¿‡æµ‹è¯•ï¼Œæˆ‘ä»¬å‘ç°ï¼Œåœ¨MyISAMå­˜å‚¨å¼•æ“ä¸­ï¼Œæ˜¯æ²¡æœ‰äº‹åŠ¡æ§åˆ¶çš„ ï¼› æ–‡ä»¶å­˜å‚¨æ–¹å¼ æ¯ä¸ªMyISAMåœ¨ç£ç›˜ä¸Šå­˜å‚¨æˆ3ä¸ªæ–‡ä»¶ï¼Œå…¶æ–‡ä»¶åéƒ½å’Œè¡¨åç›¸åŒï¼Œä½†æ‹“å±•ååˆ†åˆ«æ˜¯ ï¼š .frm (å­˜å‚¨è¡¨å®šä¹‰)ï¼› .MYD(MYData , å­˜å‚¨æ•°æ®)ï¼› .MYI(MYIndex , å­˜å‚¨ç´¢å¼•)ï¼› 2.2.3 MEMORYâ€‹ Memoryå­˜å‚¨å¼•æ“å°†è¡¨çš„æ•°æ®å­˜æ”¾åœ¨å†…å­˜ä¸­ã€‚æ¯ä¸ªMEMORYè¡¨å®é™…å¯¹åº”ä¸€ä¸ªç£ç›˜æ–‡ä»¶ï¼Œæ ¼å¼æ˜¯.frm ï¼Œè¯¥æ–‡ä»¶ä¸­åªå­˜å‚¨è¡¨çš„ç»“æ„ï¼Œè€Œå…¶æ•°æ®æ–‡ä»¶ï¼Œéƒ½æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè¿™æ ·æœ‰åˆ©äºæ•°æ®çš„å¿«é€Ÿå¤„ç†ï¼Œæé«˜æ•´ä¸ªè¡¨çš„æ•ˆç‡ã€‚MEMORY ç±»å‹çš„è¡¨è®¿é—®éå¸¸åœ°å¿«ï¼Œå› ä¸ºä»–çš„æ•°æ®æ˜¯å­˜æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œå¹¶ä¸”é»˜è®¤ä½¿ç”¨HASHç´¢å¼• ï¼Œ ä½†æ˜¯æœåŠ¡ä¸€æ—¦å…³é—­ï¼Œè¡¨ä¸­çš„æ•°æ®å°±ä¼šä¸¢å¤±ã€‚ 2.2.4 MERGEâ€‹ MERGEå­˜å‚¨å¼•æ“æ˜¯ä¸€ç»„MyISAMè¡¨çš„ç»„åˆï¼Œè¿™äº›MyISAMè¡¨å¿…é¡»ç»“æ„å®Œå…¨ç›¸åŒï¼ŒMERGEè¡¨æœ¬èº«å¹¶æ²¡æœ‰å­˜å‚¨æ•°æ®ï¼Œå¯¹MERGEç±»å‹çš„è¡¨å¯ä»¥è¿›è¡ŒæŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤æ“ä½œï¼Œè¿™äº›æ“ä½œå®é™…ä¸Šæ˜¯å¯¹å†…éƒ¨çš„MyISAMè¡¨è¿›è¡Œçš„ã€‚ â€‹ å¯¹äºMERGEç±»å‹è¡¨çš„æ’å…¥æ“ä½œï¼Œæ˜¯é€šè¿‡INSERT_METHODå­å¥å®šä¹‰æ’å…¥çš„è¡¨ï¼Œå¯ä»¥æœ‰3ä¸ªä¸åŒçš„å€¼ï¼Œä½¿ç”¨FIRST æˆ– LAST å€¼ä½¿å¾—æ’å…¥æ“ä½œè¢«ç›¸åº”åœ°ä½œç”¨åœ¨ç¬¬ä¸€æˆ–è€…æœ€åä¸€ä¸ªè¡¨ä¸Šï¼Œä¸å®šä¹‰è¿™ä¸ªå­å¥æˆ–è€…å®šä¹‰ä¸ºNOï¼Œè¡¨ç¤ºä¸èƒ½å¯¹è¿™ä¸ªMERGEè¡¨æ‰§è¡Œæ’å…¥æ“ä½œã€‚ â€‹ å¯ä»¥å¯¹MERGEè¡¨è¿›è¡ŒDROPæ“ä½œï¼Œä½†æ˜¯è¿™ä¸ªæ“ä½œåªæ˜¯åˆ é™¤MERGEè¡¨çš„å®šä¹‰ï¼Œå¯¹å†…éƒ¨çš„è¡¨æ˜¯æ²¡æœ‰ä»»ä½•å½±å“çš„ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªåˆ›å»ºå’Œä½¿ç”¨MERGEè¡¨çš„ç¤ºä¾‹ ï¼š 1ï¼‰. åˆ›å»º3ä¸ªæµ‹è¯•è¡¨ order_1990, order_1991, order_all , å…¶ä¸­order_allæ˜¯å‰ä¸¤ä¸ªè¡¨çš„MERGEè¡¨ ï¼š create table order_1990( order_id int , order_money double(10,2), order_address varchar(50), primary key (order_id) )engine = myisam default charset=utf8; create table order_1991( order_id int , order_money double(10,2), order_address varchar(50), primary key (order_id) )engine = myisam default charset=utf8; create table order_all( order_id int , order_money double(10,2), order_address varchar(50), primary key (order_id) )engine = merge union = (order_1990,order_1991) INSERT_METHOD=LAST default charset=utf8; 2ï¼‰. åˆ†åˆ«å‘ä¸¤å¼ è¡¨ä¸­æ’å…¥è®°å½• insert into order_1990 values(1,100.0,'åŒ—äº¬'); insert into order_1990 values(2,100.0,'ä¸Šæµ·'); insert into order_1991 values(10,200.0,'åŒ—äº¬'); insert into order_1991 values(11,200.0,'ä¸Šæµ·'); 3ï¼‰. æŸ¥è¯¢3å¼ è¡¨ä¸­çš„æ•°æ®ã€‚ order_1990ä¸­çš„æ•°æ® ï¼š order_1991ä¸­çš„æ•°æ® ï¼š order_allä¸­çš„æ•°æ® ï¼š â€‹ 4ï¼‰. å¾€order_allä¸­æ’å…¥ä¸€æ¡è®°å½• ï¼Œç”±äºåœ¨MERGEè¡¨å®šä¹‰æ—¶ï¼ŒINSERT_METHOD é€‰æ‹©çš„æ˜¯LASTï¼Œé‚£ä¹ˆæ’å…¥çš„æ•°æ®ä¼šæƒ³æœ€åä¸€å¼ è¡¨ä¸­æ’å…¥ã€‚ insert into order_all values(100,10000.0,'è¥¿å®‰'); 2.3 å­˜å‚¨å¼•æ“çš„é€‰æ‹©â€‹ åœ¨é€‰æ‹©å­˜å‚¨å¼•æ“æ—¶ï¼Œåº”è¯¥æ ¹æ®åº”ç”¨ç³»ç»Ÿçš„ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“ã€‚å¯¹äºå¤æ‚çš„åº”ç”¨ç³»ç»Ÿï¼Œè¿˜å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©å¤šç§å­˜å‚¨å¼•æ“è¿›è¡Œç»„åˆã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸ç”¨çš„å­˜å‚¨å¼•æ“çš„ä½¿ç”¨ç¯å¢ƒã€‚ InnoDB : æ˜¯Mysqlçš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œç”¨äºäº‹åŠ¡å¤„ç†åº”ç”¨ç¨‹åºï¼Œæ”¯æŒå¤–é”®ã€‚å¦‚æœåº”ç”¨å¯¹äº‹åŠ¡çš„å®Œæ•´æ€§æœ‰æ¯”è¾ƒé«˜çš„è¦æ±‚ï¼Œåœ¨å¹¶å‘æ¡ä»¶ä¸‹è¦æ±‚æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæ•°æ®æ“ä½œé™¤äº†æ’å…¥å’ŒæŸ¥è¯¢æ„å¤–ï¼Œè¿˜åŒ…å«å¾ˆå¤šçš„æ›´æ–°ã€åˆ é™¤æ“ä½œï¼Œé‚£ä¹ˆInnoDBå­˜å‚¨å¼•æ“æ˜¯æ¯”è¾ƒåˆé€‚çš„é€‰æ‹©ã€‚InnoDBå­˜å‚¨å¼•æ“é™¤äº†æœ‰æ•ˆçš„é™ä½ç”±äºåˆ é™¤å’Œæ›´æ–°å¯¼è‡´çš„é”å®šï¼Œ è¿˜å¯ä»¥ç¡®ä¿äº‹åŠ¡çš„å®Œæ•´æäº¤å’Œå›æ»šï¼Œå¯¹äºç±»ä¼¼äºè®¡è´¹ç³»ç»Ÿæˆ–è€…è´¢åŠ¡ç³»ç»Ÿç­‰å¯¹æ•°æ®å‡†ç¡®æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„ç³»ç»Ÿï¼ŒInnoDBæ˜¯æœ€åˆé€‚çš„é€‰æ‹©ã€‚ MyISAM ï¼š å¦‚æœåº”ç”¨æ˜¯ä»¥è¯»æ“ä½œå’Œæ’å…¥æ“ä½œä¸ºä¸»ï¼Œåªæœ‰å¾ˆå°‘çš„æ›´æ–°å’Œåˆ é™¤æ“ä½œï¼Œå¹¶ä¸”å¯¹äº‹åŠ¡çš„å®Œæ•´æ€§ã€å¹¶å‘æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œé‚£ä¹ˆé€‰æ‹©è¿™ä¸ªå­˜å‚¨å¼•æ“æ˜¯éå¸¸åˆé€‚çš„ã€‚ MEMORYï¼šå°†æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨RAMä¸­ï¼Œåœ¨éœ€è¦å¿«é€Ÿå®šä½è®°å½•å’Œå…¶ä»–ç±»ä¼¼æ•°æ®ç¯å¢ƒä¸‹ï¼Œå¯ä»¥æä¾›å‡ å—çš„è®¿é—®ã€‚MEMORYçš„ç¼ºé™·å°±æ˜¯å¯¹è¡¨çš„å¤§å°æœ‰é™åˆ¶ï¼Œå¤ªå¤§çš„è¡¨æ— æ³•ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œå…¶æ¬¡æ˜¯è¦ç¡®ä¿è¡¨çš„æ•°æ®å¯ä»¥æ¢å¤ï¼Œæ•°æ®åº“å¼‚å¸¸ç»ˆæ­¢åè¡¨ä¸­çš„æ•°æ®æ˜¯å¯ä»¥æ¢å¤çš„ã€‚MEMORYè¡¨é€šå¸¸ç”¨äºæ›´æ–°ä¸å¤ªé¢‘ç¹çš„å°è¡¨ï¼Œç”¨ä»¥å¿«é€Ÿå¾—åˆ°è®¿é—®ç»“æœã€‚ MERGEï¼šç”¨äºå°†ä¸€ç³»åˆ—ç­‰åŒçš„MyISAMè¡¨ä»¥é€»è¾‘æ–¹å¼ç»„åˆåœ¨ä¸€èµ·ï¼Œå¹¶ä½œä¸ºä¸€ä¸ªå¯¹è±¡å¼•ç”¨ä»–ä»¬ã€‚MERGEè¡¨çš„ä¼˜ç‚¹åœ¨äºå¯ä»¥çªç ´å¯¹å•ä¸ªMyISAMè¡¨çš„å¤§å°é™åˆ¶ï¼Œå¹¶ä¸”é€šè¿‡å°†ä¸åŒçš„è¡¨åˆ†å¸ƒåœ¨å¤šä¸ªç£ç›˜ä¸Šï¼Œå¯ä»¥æœ‰æ•ˆçš„æ”¹å–„MERGEè¡¨çš„è®¿é—®æ•ˆç‡ã€‚è¿™å¯¹äºå­˜å‚¨è¯¸å¦‚æ•°æ®ä»“å‚¨ç­‰VLDBç¯å¢ƒååˆ†åˆé€‚ã€‚ 3. ä¼˜åŒ–SQLæ­¥éª¤åœ¨åº”ç”¨çš„çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç”±äºåˆæœŸæ•°æ®é‡å°ï¼Œå¼€å‘äººå‘˜å†™ SQL è¯­å¥æ—¶æ›´é‡è§†åŠŸèƒ½ä¸Šçš„å®ç°ï¼Œä½†æ˜¯å½“åº”ç”¨ç³»ç»Ÿæ­£å¼ä¸Šçº¿åï¼Œéšç€ç”Ÿäº§æ•°æ®é‡çš„æ€¥å‰§å¢é•¿ï¼Œå¾ˆå¤š SQL è¯­å¥å¼€å§‹é€æ¸æ˜¾éœ²å‡ºæ€§èƒ½é—®é¢˜ï¼Œå¯¹ç”Ÿäº§çš„å½±å“ä¹Ÿè¶Šæ¥è¶Šå¤§ï¼Œæ­¤æ—¶è¿™äº›æœ‰é—®é¢˜çš„ SQL è¯­å¥å°±æˆä¸ºæ•´ä¸ªç³»ç»Ÿæ€§èƒ½çš„ç“¶é¢ˆï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»è¦å¯¹å®ƒä»¬è¿›è¡Œä¼˜åŒ–ï¼Œæœ¬ç« å°†è¯¦ç»†ä»‹ç»åœ¨ MySQL ä¸­ä¼˜åŒ– SQL è¯­å¥çš„æ–¹æ³•ã€‚ å½“é¢å¯¹ä¸€ä¸ªæœ‰ SQL æ€§èƒ½é—®é¢˜çš„æ•°æ®åº“æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥ä»ä½•å¤„å…¥æ‰‹æ¥è¿›è¡Œç³»ç»Ÿçš„åˆ†æï¼Œä½¿å¾—èƒ½å¤Ÿå°½å¿«å®šä½é—®é¢˜ SQL å¹¶å°½å¿«è§£å†³é—®é¢˜ã€‚ 3.1 æŸ¥çœ‹SQLæ‰§è¡Œé¢‘ç‡MySQL å®¢æˆ·ç«¯è¿æ¥æˆåŠŸåï¼Œé€šè¿‡ show [session|global] status å‘½ä»¤å¯ä»¥æä¾›æœåŠ¡å™¨çŠ¶æ€ä¿¡æ¯ã€‚show [session|global] status å¯ä»¥æ ¹æ®éœ€è¦åŠ ä¸Šå‚æ•°â€œsessionâ€æˆ–è€…â€œglobalâ€æ¥æ˜¾ç¤º session çº§ï¼ˆå½“å‰è¿æ¥ï¼‰çš„è®¡ç»“æœå’Œ global çº§ï¼ˆè‡ªæ•°æ®åº“ä¸Šæ¬¡å¯åŠ¨è‡³ä»Šï¼‰çš„ç»Ÿè®¡ç»“æœã€‚å¦‚æœä¸å†™ï¼Œé»˜è®¤ä½¿ç”¨å‚æ•°æ˜¯â€œsessionâ€ã€‚ ä¸‹é¢çš„å‘½ä»¤æ˜¾ç¤ºäº†å½“å‰ session ä¸­æ‰€æœ‰ç»Ÿè®¡å‚æ•°çš„å€¼ï¼š show status like 'Com_______'; show status like 'Innodb_rows_%'; Com_xxx è¡¨ç¤ºæ¯ä¸ª xxx è¯­å¥æ‰§è¡Œçš„æ¬¡æ•°ï¼Œæˆ‘ä»¬é€šå¸¸æ¯”è¾ƒå…³å¿ƒçš„æ˜¯ä»¥ä¸‹å‡ ä¸ªç»Ÿè®¡å‚æ•°ã€‚ å‚æ•° å«ä¹‰ Com_select æ‰§è¡Œ select æ“ä½œçš„æ¬¡æ•°ï¼Œä¸€æ¬¡æŸ¥è¯¢åªç´¯åŠ  1ã€‚ Com_insert æ‰§è¡Œ INSERT æ“ä½œçš„æ¬¡æ•°ï¼Œå¯¹äºæ‰¹é‡æ’å…¥çš„ INSERT æ“ä½œï¼Œåªç´¯åŠ ä¸€æ¬¡ã€‚ Com_update æ‰§è¡Œ UPDATE æ“ä½œçš„æ¬¡æ•°ã€‚ Com_delete æ‰§è¡Œ DELETE æ“ä½œçš„æ¬¡æ•°ã€‚ Innodb_rows_read select æŸ¥è¯¢è¿”å›çš„è¡Œæ•°ã€‚ Innodb_rows_inserted æ‰§è¡Œ INSERT æ“ä½œæ’å…¥çš„è¡Œæ•°ã€‚ Innodb_rows_updated æ‰§è¡Œ UPDATE æ“ä½œæ›´æ–°çš„è¡Œæ•°ã€‚ Innodb_rows_deleted æ‰§è¡Œ DELETE æ“ä½œåˆ é™¤çš„è¡Œæ•°ã€‚ Connections è¯•å›¾è¿æ¥ MySQL æœåŠ¡å™¨çš„æ¬¡æ•°ã€‚ Uptime æœåŠ¡å™¨å·¥ä½œæ—¶é—´ã€‚ Slow_queries æ…¢æŸ¥è¯¢çš„æ¬¡æ•°ã€‚ Com_*** : è¿™äº›å‚æ•°å¯¹äºæ‰€æœ‰å­˜å‚¨å¼•æ“çš„è¡¨æ“ä½œéƒ½ä¼šè¿›è¡Œç´¯è®¡ã€‚ Innodb_*** : è¿™å‡ ä¸ªå‚æ•°åªæ˜¯é’ˆå¯¹InnoDB å­˜å‚¨å¼•æ“çš„ï¼Œç´¯åŠ çš„ç®—æ³•ä¹Ÿç•¥æœ‰ä¸åŒã€‚ 3.2 å®šä½ä½æ•ˆç‡æ‰§è¡ŒSQLå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®šä½æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„ SQL è¯­å¥ã€‚ æ…¢æŸ¥è¯¢æ—¥å¿— : é€šè¿‡æ…¢æŸ¥è¯¢æ—¥å¿—å®šä½é‚£äº›æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„ SQL è¯­å¥ï¼Œç”¨â€“log-slow-queries[=file_name]é€‰é¡¹å¯åŠ¨æ—¶ï¼Œmysqld å†™ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡ long_query_time ç§’çš„ SQL è¯­å¥çš„æ—¥å¿—æ–‡ä»¶ã€‚å…·ä½“å¯ä»¥æŸ¥çœ‹æœ¬ä¹¦ç¬¬ 26 ç« ä¸­æ—¥å¿—ç®¡ç†çš„ç›¸å…³éƒ¨åˆ†ã€‚ show processlist : æ…¢æŸ¥è¯¢æ—¥å¿—åœ¨æŸ¥è¯¢ç»“æŸä»¥åæ‰çºªå½•ï¼Œæ‰€ä»¥åœ¨åº”ç”¨åæ˜ æ‰§è¡Œæ•ˆç‡å‡ºç°é—®é¢˜çš„æ—¶å€™æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—å¹¶ä¸èƒ½å®šä½é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨show processlistå‘½ä»¤æŸ¥çœ‹å½“å‰MySQLåœ¨è¿›è¡Œçš„çº¿ç¨‹ï¼ŒåŒ…æ‹¬çº¿ç¨‹çš„çŠ¶æ€ã€æ˜¯å¦é”è¡¨ç­‰ï¼Œå¯ä»¥å®æ—¶åœ°æŸ¥çœ‹ SQL çš„æ‰§è¡Œæƒ…å†µï¼ŒåŒæ—¶å¯¹ä¸€äº›é”è¡¨æ“ä½œè¿›è¡Œä¼˜åŒ–ã€‚ 1ï¼‰ idåˆ—ï¼Œç”¨æˆ·ç™»å½•mysqlæ—¶ï¼Œç³»ç»Ÿåˆ†é…çš„"connection_id"ï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•°connection_id()æŸ¥çœ‹ 2ï¼‰ useråˆ—ï¼Œæ˜¾ç¤ºå½“å‰ç”¨æˆ·ã€‚å¦‚æœä¸æ˜¯rootï¼Œè¿™ä¸ªå‘½ä»¤å°±åªæ˜¾ç¤ºç”¨æˆ·æƒé™èŒƒå›´çš„sqlè¯­å¥ 3ï¼‰ hoståˆ—ï¼Œæ˜¾ç¤ºè¿™ä¸ªè¯­å¥æ˜¯ä»å“ªä¸ªipçš„å“ªä¸ªç«¯å£ä¸Šå‘çš„ï¼Œå¯ä»¥ç”¨æ¥è·Ÿè¸ªå‡ºç°é—®é¢˜è¯­å¥çš„ç”¨æˆ· 4ï¼‰ dbåˆ—ï¼Œæ˜¾ç¤ºè¿™ä¸ªè¿›ç¨‹ç›®å‰è¿æ¥çš„æ˜¯å“ªä¸ªæ•°æ®åº“ 5ï¼‰ commandåˆ—ï¼Œæ˜¾ç¤ºå½“å‰è¿æ¥çš„æ‰§è¡Œçš„å‘½ä»¤ï¼Œä¸€èˆ¬å–å€¼ä¸ºä¼‘çœ ï¼ˆsleepï¼‰ï¼ŒæŸ¥è¯¢ï¼ˆqueryï¼‰ï¼Œè¿æ¥ï¼ˆconnectï¼‰ç­‰ 6ï¼‰ timeåˆ—ï¼Œæ˜¾ç¤ºè¿™ä¸ªçŠ¶æ€æŒç»­çš„æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ 7ï¼‰ stateåˆ—ï¼Œæ˜¾ç¤ºä½¿ç”¨å½“å‰è¿æ¥çš„sqlè¯­å¥çš„çŠ¶æ€ï¼Œå¾ˆé‡è¦çš„åˆ—ã€‚stateæè¿°çš„æ˜¯è¯­å¥æ‰§è¡Œä¸­çš„æŸä¸€ä¸ªçŠ¶æ€ã€‚ä¸€ä¸ªsqlè¯­å¥ï¼Œä»¥æŸ¥è¯¢ä¸ºä¾‹ï¼Œå¯èƒ½éœ€è¦ç»è¿‡copying to tmp tableã€sorting resultã€sending dataç­‰çŠ¶æ€æ‰å¯ä»¥å®Œæˆ 8ï¼‰ infoåˆ—ï¼Œæ˜¾ç¤ºè¿™ä¸ªsqlè¯­å¥ï¼Œæ˜¯åˆ¤æ–­é—®é¢˜è¯­å¥çš„ä¸€ä¸ªé‡è¦ä¾æ® 3.3 explainåˆ†ææ‰§è¡Œè®¡åˆ’é€šè¿‡ä»¥ä¸Šæ­¥éª¤æŸ¥è¯¢åˆ°æ•ˆç‡ä½çš„ SQL è¯­å¥åï¼Œå¯ä»¥é€šè¿‡ EXPLAINæˆ–è€… DESCå‘½ä»¤è·å– MySQLå¦‚ä½•æ‰§è¡Œ SELECT è¯­å¥çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬åœ¨ SELECT è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­è¡¨å¦‚ä½•è¿æ¥å’Œè¿æ¥çš„é¡ºåºã€‚ æŸ¥è¯¢SQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ ï¼š explain select * from tb_item where id = 1; explain select * from tb_item where title = 'é˜¿å°”å¡ç‰¹ (OT-979) å†°å·ç™½ è”é€š3Gæ‰‹æœº3'; å­—æ®µ å«ä¹‰ id selectæŸ¥è¯¢çš„åºåˆ—å·ï¼Œæ˜¯ä¸€ç»„æ•°å­—ï¼Œè¡¨ç¤ºçš„æ˜¯æŸ¥è¯¢ä¸­æ‰§è¡Œselectå­å¥æˆ–è€…æ˜¯æ“ä½œè¡¨çš„é¡ºåºã€‚ select_type è¡¨ç¤º SELECT çš„ç±»å‹ï¼Œå¸¸è§çš„å–å€¼æœ‰ SIMPLEï¼ˆç®€å•è¡¨ï¼Œå³ä¸ä½¿ç”¨è¡¨è¿æ¥æˆ–è€…å­æŸ¥è¯¢ï¼‰ã€PRIMARYï¼ˆä¸»æŸ¥è¯¢ï¼Œå³å¤–å±‚çš„æŸ¥è¯¢ï¼‰ã€UNIONï¼ˆUNION ä¸­çš„ç¬¬äºŒä¸ªæˆ–è€…åé¢çš„æŸ¥è¯¢è¯­å¥ï¼‰ã€SUBQUERYï¼ˆå­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ª SELECTï¼‰ç­‰ table è¾“å‡ºç»“æœé›†çš„è¡¨ type è¡¨ç¤ºè¡¨çš„è¿æ¥ç±»å‹ï¼Œæ€§èƒ½ç”±å¥½åˆ°å·®çš„è¿æ¥ç±»å‹ä¸º( system â€”&gt; const â€”â€“&gt; eq_ref â€”â€”&gt; ref â€”â€”-&gt; ref_or_nullâ€”-&gt; index_merge â€”&gt; index_subquery â€”â€“&gt; range â€”â€“&gt; index â€”â€”&gt; all ) possible_keys è¡¨ç¤ºæŸ¥è¯¢æ—¶ï¼Œå¯èƒ½ä½¿ç”¨çš„ç´¢å¼• key è¡¨ç¤ºå®é™…ä½¿ç”¨çš„ç´¢å¼• key_len ç´¢å¼•å­—æ®µçš„é•¿åº¦ rows æ‰«æè¡Œçš„æ•°é‡ extra æ‰§è¡Œæƒ…å†µçš„è¯´æ˜å’Œæè¿° 3.3.1 ç¯å¢ƒå‡†å¤‡ CREATE TABLE `t_role` ( `id` varchar(32) NOT NULL, `role_name` varchar(255) DEFAULT NULL, `role_code` varchar(255) DEFAULT NULL, `description` varchar(255) DEFAULT NULL, PRIMARY KEY (`id`), UNIQUE KEY `unique_role_name` (`role_name`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; CREATE TABLE `t_user` ( `id` varchar(32) NOT NULL, `username` varchar(45) NOT NULL, `password` varchar(96) NOT NULL, `name` varchar(45) NOT NULL, PRIMARY KEY (`id`), UNIQUE KEY `unique_user_username` (`username`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; CREATE TABLE `user_role` ( `id` int(11) NOT NULL auto_increment , `user_id` varchar(32) DEFAULT NULL, `role_id` varchar(32) DEFAULT NULL, PRIMARY KEY (`id`), KEY `fk_ur_user_id` (`user_id`), KEY `fk_ur_role_id` (`role_id`), CONSTRAINT `fk_ur_role_id` FOREIGN KEY (`role_id`) REFERENCES `t_role` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_ur_user_id` FOREIGN KEY (`user_id`) REFERENCES `t_user` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION ) ENGINE=InnoDB DEFAULT CHARSET=utf8; insert into `t_user` (`id`, `username`, `password`, `name`) values('1','super','$2a$10$TJ4TmCdK.X4wv/tCqHW14.w70U3CC33CeVncD3SLmyMXMknstqKRe','è¶…çº§ç®¡ç†å‘˜'); insert into `t_user` (`id`, `username`, `password`, `name`) values('2','admin','$2a$10$TJ4TmCdK.X4wv/tCqHW14.w70U3CC33CeVncD3SLmyMXMknstqKRe','ç³»ç»Ÿç®¡ç†å‘˜'); insert into `t_user` (`id`, `username`, `password`, `name`) values('3','itcast','$2a$10$8qmaHgUFUAmPR5pOuWhYWOr291WJYjHelUlYn07k5ELF8ZCrW0Cui','test02'); insert into `t_user` (`id`, `username`, `password`, `name`) values('4','stu1','$2a$10$pLtt2KDAFpwTWLjNsmTEi.oU1yOZyIn9XkziK/y/spH5rftCpUMZa','å­¦ç”Ÿ1'); insert into `t_user` (`id`, `username`, `password`, `name`) values('5','stu2','$2a$10$nxPKkYSez7uz2YQYUnwhR.z57km3yqKn3Hr/p1FR6ZKgc18u.Tvqm','å­¦ç”Ÿ2'); insert into `t_user` (`id`, `username`, `password`, `name`) values('6','t1','$2a$10$TJ4TmCdK.X4wv/tCqHW14.w70U3CC33CeVncD3SLmyMXMknstqKRe','è€å¸ˆ1'); INSERT INTO `t_role` (`id`, `role_name`, `role_code`, `description`) VALUES('5','å­¦ç”Ÿ','student','å­¦ç”Ÿ'); INSERT INTO `t_role` (`id`, `role_name`, `role_code`, `description`) VALUES('7','è€å¸ˆ','teacher','è€å¸ˆ'); INSERT INTO `t_role` (`id`, `role_name`, `role_code`, `description`) VALUES('8','æ•™å­¦ç®¡ç†å‘˜','teachmanager','æ•™å­¦ç®¡ç†å‘˜'); INSERT INTO `t_role` (`id`, `role_name`, `role_code`, `description`) VALUES('9','ç®¡ç†å‘˜','admin','ç®¡ç†å‘˜'); INSERT INTO `t_role` (`id`, `role_name`, `role_code`, `description`) VALUES('10','è¶…çº§ç®¡ç†å‘˜','super','è¶…çº§ç®¡ç†å‘˜'); INSERT INTO user_role(id,user_id,role_id) VALUES(NULL, '1', '5'),(NULL, '1', '7'),(NULL, '2', '8'),(NULL, '3', '9'),(NULL, '4', '8'),(NULL, '5', '10') ; 3.3.2 explain ä¹‹ idid å­—æ®µæ˜¯ selectæŸ¥è¯¢çš„åºåˆ—å·ï¼Œæ˜¯ä¸€ç»„æ•°å­—ï¼Œè¡¨ç¤ºçš„æ˜¯æŸ¥è¯¢ä¸­æ‰§è¡Œselectå­å¥æˆ–è€…æ˜¯æ“ä½œè¡¨çš„é¡ºåºã€‚id æƒ…å†µæœ‰ä¸‰ç§ ï¼š 1ï¼‰ id ç›¸åŒè¡¨ç¤ºåŠ è½½è¡¨çš„é¡ºåºæ˜¯ä»ä¸Šåˆ°ä¸‹ã€‚ explain select * from t_role r, t_user u, user_role ur where r.id = ur.role_id and u.id = ur.user_id ; 2ï¼‰ id ä¸åŒidå€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œã€‚ EXPLAIN SELECT * FROM t_role WHERE id = (SELECT role_id FROM user_role WHERE user_id = (SELECT id FROM t_user WHERE username = 'stu1')) 3ï¼‰ id æœ‰ç›¸åŒï¼Œä¹Ÿæœ‰ä¸åŒï¼ŒåŒæ—¶å­˜åœ¨ã€‚idç›¸åŒçš„å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç»„ï¼Œä»ä¸Šå¾€ä¸‹é¡ºåºæ‰§è¡Œï¼›åœ¨æ‰€æœ‰çš„ç»„ä¸­ï¼Œidçš„å€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œã€‚ EXPLAIN SELECT * FROM t_role r , (SELECT * FROM user_role ur WHERE ur.`user_id` = '2') a WHERE r.id = a.role_id ; 3.3.3 explain ä¹‹ select_type è¡¨ç¤º SELECT çš„ç±»å‹ï¼Œå¸¸è§çš„å–å€¼ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š select_type å«ä¹‰ SIMPLE ç®€å•çš„selectæŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸­ä¸åŒ…å«å­æŸ¥è¯¢æˆ–è€…UNION PRIMARY æŸ¥è¯¢ä¸­è‹¥åŒ…å«ä»»ä½•å¤æ‚çš„å­æŸ¥è¯¢ï¼Œæœ€å¤–å±‚æŸ¥è¯¢æ ‡è®°ä¸ºè¯¥æ ‡è¯† SUBQUERY åœ¨SELECT æˆ– WHERE åˆ—è¡¨ä¸­åŒ…å«äº†å­æŸ¥è¯¢ DERIVED åœ¨FROM åˆ—è¡¨ä¸­åŒ…å«çš„å­æŸ¥è¯¢ï¼Œè¢«æ ‡è®°ä¸º DERIVEDï¼ˆè¡ç”Ÿï¼‰ MYSQLä¼šé€’å½’æ‰§è¡Œè¿™äº›å­æŸ¥è¯¢ï¼ŒæŠŠç»“æœæ”¾åœ¨ä¸´æ—¶è¡¨ä¸­ UNION è‹¥ç¬¬äºŒä¸ªSELECTå‡ºç°åœ¨UNIONä¹‹åï¼Œåˆ™æ ‡è®°ä¸ºUNION ï¼› è‹¥UNIONåŒ…å«åœ¨FROMå­å¥çš„å­æŸ¥è¯¢ä¸­ï¼Œå¤–å±‚SELECTå°†è¢«æ ‡è®°ä¸º ï¼š DERIVED UNION RESULT ä»UNIONè¡¨è·å–ç»“æœçš„SELECT 3.3.4 explain ä¹‹ tableå±•ç¤ºè¿™ä¸€è¡Œçš„æ•°æ®æ˜¯å…³äºå“ªä¸€å¼ è¡¨çš„ 3.3.5 explain ä¹‹ typetype æ˜¾ç¤ºçš„æ˜¯è®¿é—®ç±»å‹ï¼Œæ˜¯è¾ƒä¸ºé‡è¦çš„ä¸€ä¸ªæŒ‡æ ‡ï¼Œå¯å–å€¼ä¸ºï¼š type å«ä¹‰ NULL MySQLä¸è®¿é—®ä»»ä½•è¡¨ï¼Œç´¢å¼•ï¼Œç›´æ¥è¿”å›ç»“æœ system è¡¨åªæœ‰ä¸€è¡Œè®°å½•(ç­‰äºç³»ç»Ÿè¡¨)ï¼Œè¿™æ˜¯constç±»å‹çš„ç‰¹ä¾‹ï¼Œä¸€èˆ¬ä¸ä¼šå‡ºç° const è¡¨ç¤ºé€šè¿‡ç´¢å¼•ä¸€æ¬¡å°±æ‰¾åˆ°äº†ï¼Œconst ç”¨äºæ¯”è¾ƒprimary key æˆ–è€… unique ç´¢å¼•ã€‚å› ä¸ºåªåŒ¹é…ä¸€è¡Œæ•°æ®ï¼Œæ‰€ä»¥å¾ˆå¿«ã€‚å¦‚å°†ä¸»é”®ç½®äºwhereåˆ—è¡¨ä¸­ï¼ŒMySQL å°±èƒ½å°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªå¸¸äº®ã€‚constäºå°† â€œä¸»é”®â€ æˆ– â€œå”¯ä¸€â€ ç´¢å¼•çš„æ‰€æœ‰éƒ¨åˆ†ä¸å¸¸é‡å€¼è¿›è¡Œæ¯”è¾ƒ eq_ref ç±»ä¼¼refï¼ŒåŒºåˆ«åœ¨äºä½¿ç”¨çš„æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œä½¿ç”¨ä¸»é”®çš„å…³è”æŸ¥è¯¢ï¼Œå…³è”æŸ¥è¯¢å‡ºçš„è®°å½•åªæœ‰ä¸€æ¡ã€‚å¸¸è§äºä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æ‰«æ ref éå”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œè¿”å›åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„æ‰€æœ‰è¡Œã€‚æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ç´¢å¼•è®¿é—®ï¼Œè¿”å›æ‰€æœ‰åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„æ‰€æœ‰è¡Œï¼ˆå¤šä¸ªï¼‰ range åªæ£€ç´¢ç»™å®šè¿”å›çš„è¡Œï¼Œä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥é€‰æ‹©è¡Œã€‚ where ä¹‹åå‡ºç° between ï¼Œ &lt; , &gt; , in ç­‰æ“ä½œã€‚ index index ä¸ ALLçš„åŒºåˆ«ä¸º index ç±»å‹åªæ˜¯éå†äº†ç´¢å¼•æ ‘ï¼Œ é€šå¸¸æ¯”ALL å¿«ï¼Œ ALL æ˜¯éå†æ•°æ®æ–‡ä»¶ã€‚ all å°†éå†å…¨è¡¨ä»¥æ‰¾åˆ°åŒ¹é…çš„è¡Œ ç»“æœå€¼ä»æœ€å¥½åˆ°æœ€åä»¥æ­¤æ˜¯ï¼š NULL &gt; system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL ==ä¸€èˆ¬æ¥è¯´ï¼Œ æˆ‘ä»¬éœ€è¦ä¿è¯æŸ¥è¯¢è‡³å°‘è¾¾åˆ° range çº§åˆ«ï¼Œ æœ€å¥½è¾¾åˆ°ref ã€‚== 3.3.6 explain ä¹‹ keypossible_keys : æ˜¾ç¤ºå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨çš„ç´¢å¼•ï¼Œ ä¸€ä¸ªæˆ–å¤šä¸ªã€‚ key ï¼š å®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œ å¦‚æœä¸ºNULLï¼Œ åˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚ key_len : è¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œ è¯¥å€¼ä¸ºç´¢å¼•å­—æ®µæœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿åº¦ï¼Œåœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„å‰æä¸‹ï¼Œ é•¿åº¦è¶ŠçŸ­è¶Šå¥½ ã€‚ 3.3.7 explain ä¹‹ rowsæ‰«æè¡Œçš„æ•°é‡ã€‚ 3.3.8 explain ä¹‹ extraå…¶ä»–çš„é¢å¤–çš„æ‰§è¡Œè®¡åˆ’ä¿¡æ¯ï¼Œåœ¨è¯¥åˆ—å±•ç¤º ã€‚ extra å«ä¹‰ using filesort è¯´æ˜mysqlä¼šå¯¹æ•°æ®ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨çš„ç´¢å¼•æ’åºï¼Œè€Œä¸æ˜¯æŒ‰ç…§è¡¨å†…çš„ç´¢å¼•é¡ºåºè¿›è¡Œè¯»å–ï¼Œ ç§°ä¸º â€œæ–‡ä»¶æ’åºâ€, æ•ˆç‡ä½ã€‚ using temporary ä½¿ç”¨äº†ä¸´æ—¶è¡¨ä¿å­˜ä¸­é—´ç»“æœï¼ŒMySQLåœ¨å¯¹æŸ¥è¯¢ç»“æœæ’åºæ—¶ä½¿ç”¨ä¸´æ—¶è¡¨ã€‚å¸¸è§äº order by å’Œ group byï¼› æ•ˆç‡ä½ using index è¡¨ç¤ºç›¸åº”çš„selectæ“ä½œä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œ é¿å…è®¿é—®è¡¨çš„æ•°æ®è¡Œï¼Œ æ•ˆç‡ä¸é”™ã€‚ 3.4 show profileåˆ†æSQLMysqlä»5.0.37ç‰ˆæœ¬å¼€å§‹å¢åŠ äº†å¯¹ show profiles å’Œ show profile è¯­å¥çš„æ”¯æŒã€‚show profiles èƒ½å¤Ÿåœ¨åšSQLä¼˜åŒ–æ—¶å¸®åŠ©æˆ‘ä»¬äº†è§£æ—¶é—´éƒ½è€—è´¹åˆ°å“ªé‡Œå»äº†ã€‚ é€šè¿‡ have_profiling å‚æ•°ï¼Œèƒ½å¤Ÿçœ‹åˆ°å½“å‰MySQLæ˜¯å¦æ”¯æŒprofileï¼š é»˜è®¤profilingæ˜¯å…³é—­çš„ï¼Œå¯ä»¥é€šè¿‡setè¯­å¥åœ¨Sessionçº§åˆ«å¼€å¯profilingï¼š set profiling=1; //å¼€å¯profiling å¼€å…³; é€šè¿‡profileï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´æ¸…æ¥šåœ°äº†è§£SQLæ‰§è¡Œçš„è¿‡ç¨‹ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š show databases; use db01; show tables; select * from tb_item where id &lt; 5; select count(*) from tb_item; æ‰§è¡Œå®Œä¸Šè¿°å‘½ä»¤ä¹‹åï¼Œå†æ‰§è¡Œshow profiles æŒ‡ä»¤ï¼Œ æ¥æŸ¥çœ‹SQLè¯­å¥æ‰§è¡Œçš„è€—æ—¶ï¼š é€šè¿‡show profile for query query_id è¯­å¥å¯ä»¥æŸ¥çœ‹åˆ°è¯¥SQLæ‰§è¡Œè¿‡ç¨‹ä¸­æ¯ä¸ªçº¿ç¨‹çš„çŠ¶æ€å’Œæ¶ˆè€—çš„æ—¶é—´ï¼š TIP ï¼š Sending data çŠ¶æ€è¡¨ç¤ºMySQLçº¿ç¨‹å¼€å§‹è®¿é—®æ•°æ®è¡Œå¹¶æŠŠç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸ä»…ä»…æ˜¯è¿”å›ä¸ªå®¢æˆ·ç«¯ã€‚ç”±äºåœ¨Sending dataçŠ¶æ€ä¸‹ï¼ŒMySQLçº¿ç¨‹å¾€å¾€éœ€è¦åšå¤§é‡çš„ç£ç›˜è¯»å–æ“ä½œï¼Œæ‰€ä»¥ç»å¸¸æ˜¯æ•´å„æŸ¥è¯¢ä¸­è€—æ—¶æœ€é•¿çš„çŠ¶æ€ã€‚ åœ¨è·å–åˆ°æœ€æ¶ˆè€—æ—¶é—´çš„çº¿ç¨‹çŠ¶æ€åï¼ŒMySQLæ”¯æŒè¿›ä¸€æ­¥é€‰æ‹©allã€cpuã€block io ã€context switchã€page faultsç­‰æ˜ç»†ç±»å‹ç±»æŸ¥çœ‹MySQLåœ¨ä½¿ç”¨ä»€ä¹ˆèµ„æºä¸Šè€—è´¹äº†è¿‡é«˜çš„æ—¶é—´ã€‚ä¾‹å¦‚ï¼Œé€‰æ‹©æŸ¥çœ‹CPUçš„è€—è´¹æ—¶é—´ ï¼š å­—æ®µ å«ä¹‰ Status sql è¯­å¥æ‰§è¡Œçš„çŠ¶æ€ Duration sql æ‰§è¡Œè¿‡ç¨‹ä¸­æ¯ä¸€ä¸ªæ­¥éª¤çš„è€—æ—¶ CPU_user å½“å‰ç”¨æˆ·å æœ‰çš„cpu CPU_system ç³»ç»Ÿå æœ‰çš„cpu 3.5 traceåˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’MySQL5.6æä¾›äº†å¯¹SQLçš„è·Ÿè¸ªtrace, é€šè¿‡traceæ–‡ä»¶èƒ½å¤Ÿè¿›ä¸€æ­¥äº†è§£ä¸ºä»€ä¹ˆä¼˜åŒ–å™¨é€‰æ‹©Aè®¡åˆ’, è€Œä¸æ˜¯é€‰æ‹©Bè®¡åˆ’ã€‚ æ‰“å¼€trace ï¼Œ è®¾ç½®æ ¼å¼ä¸º JSONï¼Œå¹¶è®¾ç½®traceæœ€å¤§èƒ½å¤Ÿä½¿ç”¨çš„å†…å­˜å¤§å°ï¼Œé¿å…è§£æè¿‡ç¨‹ä¸­å› ä¸ºé»˜è®¤å†…å­˜è¿‡å°è€Œä¸èƒ½å¤Ÿå®Œæ•´å±•ç¤ºã€‚ SET optimizer_trace="enabled=on",end_markers_in_json=on; set optimizer_trace_max_mem_size=1000000; æ‰§è¡ŒSQLè¯­å¥ ï¼š select * from tb_item where id &lt; 4; æœ€åï¼Œ æ£€æŸ¥information_schema.optimizer_traceå°±å¯ä»¥çŸ¥é“MySQLæ˜¯å¦‚ä½•æ‰§è¡ŒSQLçš„ ï¼š select * from information_schema.optimizer_trace\G; *************************** 1. row *************************** QUERY: select * from tb_item where id &lt; 4 TRACE: { "steps": [ { "join_preparation": { "select#": 1, "steps": [ { "expanded_query": "/* select#1 */ select `tb_item`.`id` AS `id`,`tb_item`.`title` AS `title`,`tb_item`.`price` AS `price`,`tb_item`.`num` AS `num`,`tb_item`.`categoryid` AS `categoryid`,`tb_item`.`status` AS `status`,`tb_item`.`sellerid` AS `sellerid`,`tb_item`.`createtime` AS `createtime`,`tb_item`.`updatetime` AS `updatetime` from `tb_item` where (`tb_item`.`id` &lt; 4)" } ] /* steps */ } /* join_preparation */ }, { "join_optimization": { "select#": 1, "steps": [ { "condition_processing": { "condition": "WHERE", "original_condition": "(`tb_item`.`id` &lt; 4)", "steps": [ { "transformation": "equality_propagation", "resulting_condition": "(`tb_item`.`id` &lt; 4)" }, { "transformation": "constant_propagation", "resulting_condition": "(`tb_item`.`id` &lt; 4)" }, { "transformation": "trivial_condition_removal", "resulting_condition": "(`tb_item`.`id` &lt; 4)" } ] /* steps */ } /* condition_processing */ }, { "table_dependencies": [ { "table": "`tb_item`", "row_may_be_null": false, "map_bit": 0, "depends_on_map_bits": [ ] /* depends_on_map_bits */ } ] /* table_dependencies */ }, { "ref_optimizer_key_uses": [ ] /* ref_optimizer_key_uses */ }, { "rows_estimation": [ { "table": "`tb_item`", "range_analysis": { "table_scan": { "rows": 9816098, "cost": 2.04e6 } /* table_scan */, "potential_range_indices": [ { "index": "PRIMARY", "usable": true, "key_parts": [ "id" ] /* key_parts */ } ] /* potential_range_indices */, "setup_range_conditions": [ ] /* setup_range_conditions */, "group_index_range": { "chosen": false, "cause": "not_group_by_or_distinct" } /* group_index_range */, "analyzing_range_alternatives": { "range_scan_alternatives": [ { "index": "PRIMARY", "ranges": [ "id &lt; 4" ] /* ranges */, "index_dives_for_eq_ranges": true, "rowid_ordered": true, "using_mrr": false, "index_only": false, "rows": 3, "cost": 1.6154, "chosen": true } ] /* range_scan_alternatives */, "analyzing_roworder_intersect": { "usable": false, "cause": "too_few_roworder_scans" } /* analyzing_roworder_intersect */ } /* analyzing_range_alternatives */, "chosen_range_access_summary": { "range_access_plan": { "type": "range_scan", "index": "PRIMARY", "rows": 3, "ranges": [ "id &lt; 4" ] /* ranges */ } /* range_access_plan */, "rows_for_plan": 3, "cost_for_plan": 1.6154, "chosen": true } /* chosen_range_access_summary */ } /* range_analysis */ } ] /* rows_estimation */ }, { "considered_execution_plans": [ { "plan_prefix": [ ] /* plan_prefix */, "table": "`tb_item`", "best_access_path": { "considered_access_paths": [ { "access_type": "range", "rows": 3, "cost": 2.2154, "chosen": true } ] /* considered_access_paths */ } /* best_access_path */, "cost_for_plan": 2.2154, "rows_for_plan": 3, "chosen": true } ] /* considered_execution_plans */ }, { "attaching_conditions_to_tables": { "original_condition": "(`tb_item`.`id` &lt; 4)", "attached_conditions_computation": [ ] /* attached_conditions_computation */, "attached_conditions_summary": [ { "table": "`tb_item`", "attached": "(`tb_item`.`id` &lt; 4)" } ] /* attached_conditions_summary */ } /* attaching_conditions_to_tables */ }, { "refine_plan": [ { "table": "`tb_item`", "access_type": "range" } ] /* refine_plan */ } ] /* steps */ } /* join_optimization */ }, { "join_execution": { "select#": 1, "steps": [ ] /* steps */ } /* join_execution */ } ] /* steps */ } 4. ç´¢å¼•çš„ä½¿ç”¨ç´¢å¼•æ˜¯æ•°æ®åº“ä¼˜åŒ–æœ€å¸¸ç”¨ä¹Ÿæ˜¯æœ€é‡è¦çš„æ‰‹æ®µä¹‹ä¸€, é€šè¿‡ç´¢å¼•é€šå¸¸å¯ä»¥å¸®åŠ©ç”¨æˆ·è§£å†³å¤§å¤šæ•°çš„MySQLçš„æ€§èƒ½ä¼˜åŒ–é—®é¢˜ã€‚ 4.1 éªŒè¯ç´¢å¼•æå‡æŸ¥è¯¢æ•ˆç‡åœ¨æˆ‘ä»¬å‡†å¤‡çš„è¡¨ç»“æ„tb_item ä¸­ï¼Œ ä¸€å…±å­˜å‚¨äº† 300 ä¸‡è®°å½•ï¼› A. æ ¹æ®IDæŸ¥è¯¢ select * from tb_item where id = 1999\G; æŸ¥è¯¢é€Ÿåº¦å¾ˆå¿«ï¼Œ æ¥è¿‘0s ï¼Œ ä¸»è¦çš„åŸå› æ˜¯å› ä¸ºidä¸ºä¸»é”®ï¼Œ æœ‰ç´¢å¼•ï¼› 2). æ ¹æ® title è¿›è¡Œç²¾ç¡®æŸ¥è¯¢ select * from tb_item where title = 'iphoneX ç§»åŠ¨3G 32G941'\G; æŸ¥çœ‹SQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ ï¼š å¤„ç†æ–¹æ¡ˆ ï¼Œ é’ˆå¯¹titleå­—æ®µï¼Œ åˆ›å»ºç´¢å¼• ï¼š create index idx_item_title on tb_item(title); ç´¢å¼•åˆ›å»ºå®Œæˆä¹‹åï¼Œå†æ¬¡è¿›è¡ŒæŸ¥è¯¢ ï¼š é€šè¿‡explain ï¼Œ æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œæ‰§è¡ŒSQLæ—¶ä½¿ç”¨äº†åˆšæ‰åˆ›å»ºçš„ç´¢å¼• 4.2 ç´¢å¼•çš„ä½¿ç”¨4.2.1 å‡†å¤‡ç¯å¢ƒcreate table `tb_seller` ( `sellerid` varchar (100), `name` varchar (100), `nickname` varchar (50), `password` varchar (60), `status` varchar (1), `address` varchar (100), `createtime` datetime, primary key(`sellerid`) )engine=innodb default charset=utf8mb4; insert into `tb_seller` (`sellerid`, `name`, `nickname`, `password`, `status`, `address`, `createtime`) values('alibaba','é˜¿é‡Œå·´å·´','é˜¿é‡Œå°åº—','e10adc3949ba59abbe56e057f20f883e','1','åŒ—äº¬å¸‚','2088-01-01 12:00:00'); insert into `tb_seller` (`sellerid`, `name`, `nickname`, `password`, `status`, `address`, `createtime`) values('baidu','ç™¾åº¦ç§‘æŠ€æœ‰é™å…¬å¸','ç™¾åº¦å°åº—','e10adc3949ba59abbe56e057f20f883e','1','åŒ—äº¬å¸‚','2088-01-01 12:00:00'); insert into `tb_seller` (`sellerid`, `name`, `nickname`, `password`, `status`, `address`, `createtime`) values('huawei','åä¸ºç§‘æŠ€æœ‰é™å…¬å¸','åä¸ºå°åº—','e10adc3949ba59abbe56e057f20f883e','0','åŒ—äº¬å¸‚','2088-01-01 12:00:00'); insert into `tb_seller` (`sellerid`, `name`, `nickname`, `password`, `status`, `address`, `createtime`) values('itcast','ä¼ æ™ºæ’­å®¢æ•™è‚²ç§‘æŠ€æœ‰é™å…¬å¸','ä¼ æ™ºæ’­å®¢','e10adc3949ba59abbe56e057f20f883e','1','åŒ—äº¬å¸‚','2088-01-01 12:00:00'); insert into `tb_seller` (`sellerid`, `name`, `nickname`, `password`, `status`, `address`, `createtime`) values('itheima','é»‘é©¬ç¨‹åºå‘˜','é»‘é©¬ç¨‹åºå‘˜','e10adc3949ba59abbe56e057f20f883e','0','åŒ—äº¬å¸‚','2088-01-01 12:00:00'); insert into `tb_seller` (`sellerid`, `name`, `nickname`, `password`, `status`, `address`, `createtime`) values('luoji','ç½—æŠ€ç§‘æŠ€æœ‰é™å…¬å¸','ç½—æŠ€å°åº—','e10adc3949ba59abbe56e057f20f883e','1','åŒ—äº¬å¸‚','2088-01-01 12:00:00'); insert into `tb_seller` (`sellerid`, `name`, `nickname`, `password`, `status`, `address`, `createtime`) values('oppo','OPPOç§‘æŠ€æœ‰é™å…¬å¸','OPPOå®˜æ–¹æ——èˆ°åº—','e10adc3949ba59abbe56e057f20f883e','0','åŒ—äº¬å¸‚','2088-01-01 12:00:00'); insert into `tb_seller` (`sellerid`, `name`, `nickname`, `password`, `status`, `address`, `createtime`) values('ourpalm','æŒè¶£ç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸','æŒè¶£å°åº—','e10adc3949ba59abbe56e057f20f883e','1','åŒ—äº¬å¸‚','2088-01-01 12:00:00'); insert into `tb_seller` (`sellerid`, `name`, `nickname`, `password`, `status`, `address`, `createtime`) values('qiandu','åƒåº¦ç§‘æŠ€','åƒåº¦å°åº—','e10adc3949ba59abbe56e057f20f883e','2','åŒ—äº¬å¸‚','2088-01-01 12:00:00'); insert into `tb_seller` (`sellerid`, `name`, `nickname`, `password`, `status`, `address`, `createtime`) values('sina','æ–°æµªç§‘æŠ€æœ‰é™å…¬å¸','æ–°æµªå®˜æ–¹æ——èˆ°åº—','e10adc3949ba59abbe56e057f20f883e','1','åŒ—äº¬å¸‚','2088-01-01 12:00:00'); insert into `tb_seller` (`sellerid`, `name`, `nickname`, `password`, `status`, `address`, `createtime`) values('xiaomi','å°ç±³ç§‘æŠ€','å°ç±³å®˜æ–¹æ——èˆ°åº—','e10adc3949ba59abbe56e057f20f883e','1','è¥¿å®‰å¸‚','2088-01-01 12:00:00'); insert into `tb_seller` (`sellerid`, `name`, `nickname`, `password`, `status`, `address`, `createtime`) values('yijia','å®œå®¶å®¶å±…','å®œå®¶å®¶å±…æ——èˆ°åº—','e10adc3949ba59abbe56e057f20f883e','1','åŒ—äº¬å¸‚','2088-01-01 12:00:00'); create index idx_seller_name_sta_addr on tb_seller(name,status,address); 4.2.2 é¿å…ç´¢å¼•å¤±æ•ˆ1). å…¨å€¼åŒ¹é… ï¼Œå¯¹ç´¢å¼•ä¸­æ‰€æœ‰åˆ—éƒ½æŒ‡å®šå…·ä½“å€¼ã€‚ æ”¹æƒ…å†µä¸‹ï¼Œç´¢å¼•ç”Ÿæ•ˆï¼Œæ‰§è¡Œæ•ˆç‡é«˜ã€‚ explain select * from tb_seller where name='å°ç±³ç§‘æŠ€' and status='1' and address='åŒ—äº¬å¸‚'\G; 2). æœ€å·¦å‰ç¼€æ³•åˆ™ å¦‚æœç´¢å¼•äº†å¤šåˆ—ï¼Œè¦éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™ã€‚æŒ‡çš„æ˜¯æŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦å‰åˆ—å¼€å§‹ï¼Œå¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚ åŒ¹é…æœ€å·¦å‰ç¼€æ³•åˆ™ï¼Œèµ°ç´¢å¼•ï¼š è¿æ³•æœ€å·¦å‰ç¼€æ³•åˆ™ ï¼Œ ç´¢å¼•å¤±æ•ˆï¼š å¦‚æœç¬¦åˆæœ€å·¦æ³•åˆ™ï¼Œä½†æ˜¯å‡ºç°è·³è·ƒæŸä¸€åˆ—ï¼Œåªæœ‰æœ€å·¦åˆ—ç´¢å¼•ç”Ÿæ•ˆï¼š 3). èŒƒå›´æŸ¥è¯¢å³è¾¹çš„åˆ—ï¼Œä¸èƒ½ä½¿ç”¨ç´¢å¼• ã€‚ æ ¹æ®å‰é¢çš„ä¸¤ä¸ªå­—æ®µname ï¼Œ status æŸ¥è¯¢æ˜¯èµ°ç´¢å¼•çš„ï¼Œ ä½†æ˜¯æœ€åä¸€ä¸ªæ¡ä»¶address æ²¡æœ‰ç”¨åˆ°ç´¢å¼•ã€‚ 4). ä¸è¦åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè¿ç®—æ“ä½œï¼Œ ç´¢å¼•å°†å¤±æ•ˆã€‚ 5). å­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ï¼Œé€ æˆç´¢å¼•å¤±æ•ˆã€‚ ç”±äºï¼Œåœ¨æŸ¥è¯¢æ˜¯ï¼Œæ²¡æœ‰å¯¹å­—ç¬¦ä¸²åŠ å•å¼•å·ï¼ŒMySQLçš„æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼Œä¼šè‡ªåŠ¨çš„è¿›è¡Œç±»å‹è½¬æ¢ï¼Œé€ æˆç´¢å¼•å¤±æ•ˆã€‚ 6). å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œé¿å…select * å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆåªè®¿é—®ç´¢å¼•çš„æŸ¥è¯¢ï¼ˆç´¢å¼•åˆ—å®Œå…¨åŒ…å«æŸ¥è¯¢åˆ—ï¼‰ï¼‰ï¼Œå‡å°‘select * ã€‚ å¦‚æœæŸ¥è¯¢åˆ—ï¼Œè¶…å‡ºç´¢å¼•åˆ—ï¼Œä¹Ÿä¼šé™ä½æ€§èƒ½ã€‚ TIP : using index ï¼šä½¿ç”¨è¦†ç›–ç´¢å¼•çš„æ—¶å€™å°±ä¼šå‡ºç° using whereï¼šåœ¨æŸ¥æ‰¾ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œéœ€è¦å›è¡¨å»æŸ¥è¯¢æ‰€éœ€çš„æ•°æ® using index conditionï¼šæŸ¥æ‰¾ä½¿ç”¨äº†ç´¢å¼•ï¼Œä½†æ˜¯éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ® using index ; using whereï¼šæŸ¥æ‰¾ä½¿ç”¨äº†ç´¢å¼•ï¼Œä½†æ˜¯éœ€è¦çš„æ•°æ®éƒ½åœ¨ç´¢å¼•åˆ—ä¸­èƒ½æ‰¾åˆ°ï¼Œæ‰€ä»¥ä¸éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ® 7). ç”¨oråˆ†å‰²å¼€çš„æ¡ä»¶ï¼Œ å¦‚æœorå‰çš„æ¡ä»¶ä¸­çš„åˆ—æœ‰ç´¢å¼•ï¼Œè€Œåé¢çš„åˆ—ä¸­æ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆæ¶‰åŠçš„ç´¢å¼•éƒ½ä¸ä¼šè¢«ç”¨åˆ°ã€‚ ç¤ºä¾‹ï¼Œnameå­—æ®µæ˜¯ç´¢å¼•åˆ— ï¼Œ è€Œcreatetimeä¸æ˜¯ç´¢å¼•åˆ—ï¼Œä¸­é—´æ˜¯orè¿›è¡Œè¿æ¥æ˜¯ä¸èµ°ç´¢å¼•çš„ ï¼š explain select * from tb_seller where name='é»‘é©¬ç¨‹åºå‘˜' or createtime = '2088-01-01 12:00:00'\G; 8). ä»¥%å¼€å¤´çš„Likeæ¨¡ç³ŠæŸ¥è¯¢ï¼Œç´¢å¼•å¤±æ•ˆã€‚ å¦‚æœä»…ä»…æ˜¯å°¾éƒ¨æ¨¡ç³ŠåŒ¹é…ï¼Œç´¢å¼•ä¸ä¼šå¤±æ•ˆã€‚å¦‚æœæ˜¯å¤´éƒ¨æ¨¡ç³ŠåŒ¹é…ï¼Œç´¢å¼•å¤±æ•ˆã€‚ è§£å†³æ–¹æ¡ˆ ï¼š é€šè¿‡è¦†ç›–ç´¢å¼•æ¥è§£å†³ 9). å¦‚æœMySQLè¯„ä¼°ä½¿ç”¨ç´¢å¼•æ¯”å…¨è¡¨æ›´æ…¢ï¼Œåˆ™ä¸ä½¿ç”¨ç´¢å¼•ã€‚ 10). is NULL ï¼Œ is NOT NULL æœ‰æ—¶ç´¢å¼•å¤±æ•ˆã€‚ 11). in èµ°ç´¢å¼•ï¼Œ not in ç´¢å¼•å¤±æ•ˆã€‚ 12). å•åˆ—ç´¢å¼•å’Œå¤åˆç´¢å¼•ã€‚ å°½é‡ä½¿ç”¨å¤åˆç´¢å¼•ï¼Œè€Œå°‘ä½¿ç”¨å•åˆ—ç´¢å¼• ã€‚ åˆ›å»ºå¤åˆç´¢å¼• create index idx_name_sta_address on tb_seller(name, status, address); å°±ç›¸å½“äºåˆ›å»ºäº†ä¸‰ä¸ªç´¢å¼• ï¼š name name + status name + status + address åˆ›å»ºå•åˆ—ç´¢å¼• create index idx_seller_name on tb_seller(name); create index idx_seller_status on tb_seller(status); create index idx_seller_address on tb_seller(address); æ•°æ®åº“ä¼šé€‰æ‹©ä¸€ä¸ªæœ€ä¼˜çš„ç´¢å¼•ï¼ˆè¾¨è¯†åº¦æœ€é«˜ç´¢å¼•ï¼‰æ¥ä½¿ç”¨ï¼Œå¹¶ä¸ä¼šä½¿ç”¨å…¨éƒ¨ç´¢å¼• ã€‚ 4.3 æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µshow status like 'Handler_read%'; show global status like 'Handler_read%'; Handler_read_firstï¼šç´¢å¼•ä¸­ç¬¬ä¸€æ¡è¢«è¯»çš„æ¬¡æ•°ã€‚å¦‚æœè¾ƒé«˜ï¼Œè¡¨ç¤ºæœåŠ¡å™¨æ­£æ‰§è¡Œå¤§é‡å…¨ç´¢å¼•æ‰«æï¼ˆè¿™ä¸ªå€¼è¶Šä½è¶Šå¥½ï¼‰ã€‚ Handler_read_keyï¼šå¦‚æœç´¢å¼•æ­£åœ¨å·¥ä½œï¼Œè¿™ä¸ªå€¼ä»£è¡¨ä¸€ä¸ªè¡Œè¢«ç´¢å¼•å€¼è¯»çš„æ¬¡æ•°ï¼Œå¦‚æœå€¼è¶Šä½ï¼Œè¡¨ç¤ºç´¢å¼•å¾—åˆ°çš„æ€§èƒ½æ”¹å–„ä¸é«˜ï¼Œå› ä¸ºç´¢å¼•ä¸ç»å¸¸ä½¿ç”¨ï¼ˆè¿™ä¸ªå€¼è¶Šé«˜è¶Šå¥½ï¼‰ã€‚ Handler_read_next ï¼šæŒ‰ç…§é”®é¡ºåºè¯»ä¸‹ä¸€è¡Œçš„è¯·æ±‚æ•°ã€‚å¦‚æœä½ ç”¨èŒƒå›´çº¦æŸæˆ–å¦‚æœæ‰§è¡Œç´¢å¼•æ‰«ææ¥æŸ¥è¯¢ç´¢å¼•åˆ—ï¼Œè¯¥å€¼å¢åŠ ã€‚ Handler_read_prevï¼šæŒ‰ç…§é”®é¡ºåºè¯»å‰ä¸€è¡Œçš„è¯·æ±‚æ•°ã€‚è¯¥è¯»æ–¹æ³•ä¸»è¦ç”¨äºä¼˜åŒ–ORDER BY ... DESCã€‚ Handler_read_rnd ï¼šæ ¹æ®å›ºå®šä½ç½®è¯»ä¸€è¡Œçš„è¯·æ±‚æ•°ã€‚å¦‚æœä½ æ­£æ‰§è¡Œå¤§é‡æŸ¥è¯¢å¹¶éœ€è¦å¯¹ç»“æœè¿›è¡Œæ’åºè¯¥å€¼è¾ƒé«˜ã€‚ä½ å¯èƒ½ä½¿ç”¨äº†å¤§é‡éœ€è¦MySQLæ‰«ææ•´ä¸ªè¡¨çš„æŸ¥è¯¢æˆ–ä½ çš„è¿æ¥æ²¡æœ‰æ­£ç¡®ä½¿ç”¨é”®ã€‚è¿™ä¸ªå€¼è¾ƒé«˜ï¼Œæ„å‘³ç€è¿è¡Œæ•ˆç‡ä½ï¼Œåº”è¯¥å»ºç«‹ç´¢å¼•æ¥è¡¥æ•‘ã€‚ Handler_read_rnd_nextï¼šåœ¨æ•°æ®æ–‡ä»¶ä¸­è¯»ä¸‹ä¸€è¡Œçš„è¯·æ±‚æ•°ã€‚å¦‚æœä½ æ­£è¿›è¡Œå¤§é‡çš„è¡¨æ‰«æï¼Œè¯¥å€¼è¾ƒé«˜ã€‚é€šå¸¸è¯´æ˜ä½ çš„è¡¨ç´¢å¼•ä¸æ­£ç¡®æˆ–å†™å…¥çš„æŸ¥è¯¢æ²¡æœ‰åˆ©ç”¨ç´¢å¼•ã€‚ 5. SQLä¼˜åŒ–5.1 å¤§æ‰¹é‡æ’å…¥æ•°æ®ç¯å¢ƒå‡†å¤‡ ï¼š CREATE TABLE `tb_user_2` ( `id` int(11) NOT NULL AUTO_INCREMENT, `username` varchar(45) NOT NULL, `password` varchar(96) NOT NULL, `name` varchar(45) NOT NULL, `birthday` datetime DEFAULT NULL, `sex` char(1) DEFAULT NULL, `email` varchar(45) DEFAULT NULL, `phone` varchar(45) DEFAULT NULL, `qq` varchar(32) DEFAULT NULL, `status` varchar(32) NOT NULL COMMENT 'ç”¨æˆ·çŠ¶æ€', `create_time` datetime NOT NULL, `update_time` datetime DEFAULT NULL, PRIMARY KEY (`id`), UNIQUE KEY `unique_user_username` (`username`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 ; å½“ä½¿ç”¨load å‘½ä»¤å¯¼å…¥æ•°æ®çš„æ—¶å€™ï¼Œé€‚å½“çš„è®¾ç½®å¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ã€‚ å¯¹äº InnoDB ç±»å‹çš„è¡¨ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼å¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ï¼š 1ï¼‰ ä¸»é”®é¡ºåºæ’å…¥ å› ä¸ºInnoDBç±»å‹çš„è¡¨æ˜¯æŒ‰ç…§ä¸»é”®çš„é¡ºåºä¿å­˜çš„ï¼Œæ‰€ä»¥å°†å¯¼å…¥çš„æ•°æ®æŒ‰ç…§ä¸»é”®çš„é¡ºåºæ’åˆ—ï¼Œå¯ä»¥æœ‰æ•ˆçš„æé«˜å¯¼å…¥æ•°æ®çš„æ•ˆç‡ã€‚å¦‚æœInnoDBè¡¨æ²¡æœ‰ä¸»é”®ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šè‡ªåŠ¨é»˜è®¤åˆ›å»ºä¸€ä¸ªå†…éƒ¨åˆ—ä½œä¸ºä¸»é”®ï¼Œæ‰€ä»¥å¦‚æœå¯ä»¥ç»™è¡¨åˆ›å»ºä¸€ä¸ªä¸»é”®ï¼Œå°†å¯ä»¥åˆ©ç”¨è¿™ç‚¹ï¼Œæ¥æé«˜å¯¼å…¥æ•°æ®çš„æ•ˆç‡ã€‚ è„šæœ¬æ–‡ä»¶ä»‹ç» : sql1.log ----&gt; ä¸»é”®æœ‰åº sql2.log ----&gt; ä¸»é”®æ— åº æ’å…¥IDé¡ºåºæ’åˆ—æ•°æ®ï¼š æ’å…¥IDæ— åºæ’åˆ—æ•°æ®ï¼š 2ï¼‰ å…³é—­å”¯ä¸€æ€§æ ¡éªŒ åœ¨å¯¼å…¥æ•°æ®å‰æ‰§è¡Œ SET UNIQUE_CHECKS=0ï¼Œå…³é—­å”¯ä¸€æ€§æ ¡éªŒï¼Œåœ¨å¯¼å…¥ç»“æŸåæ‰§è¡ŒSET UNIQUE_CHECKS=1ï¼Œæ¢å¤å”¯ä¸€æ€§æ ¡éªŒï¼Œå¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ã€‚ 3ï¼‰ æ‰‹åŠ¨æäº¤äº‹åŠ¡ å¦‚æœåº”ç”¨ä½¿ç”¨è‡ªåŠ¨æäº¤çš„æ–¹å¼ï¼Œå»ºè®®åœ¨å¯¼å…¥å‰æ‰§è¡Œ SET AUTOCOMMIT=0ï¼Œå…³é—­è‡ªåŠ¨æäº¤ï¼Œå¯¼å…¥ç»“æŸåå†æ‰§è¡Œ SET AUTOCOMMIT=1ï¼Œæ‰“å¼€è‡ªåŠ¨æäº¤ï¼Œä¹Ÿå¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ã€‚ 5.2 ä¼˜åŒ–insertè¯­å¥å½“è¿›è¡Œæ•°æ®çš„insertæ“ä½œçš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨ä»¥ä¸‹å‡ ç§ä¼˜åŒ–æ–¹æ¡ˆã€‚ å¦‚æœéœ€è¦åŒæ—¶å¯¹ä¸€å¼ è¡¨æ’å…¥å¾ˆå¤šè¡Œæ•°æ®æ—¶ï¼Œåº”è¯¥å°½é‡ä½¿ç”¨å¤šä¸ªå€¼è¡¨çš„insertè¯­å¥ï¼Œè¿™ç§æ–¹å¼å°†å¤§å¤§çš„ç¼©å‡å®¢æˆ·ç«¯ä¸æ•°æ®åº“ä¹‹é—´çš„è¿æ¥ã€å…³é—­ç­‰æ¶ˆè€—ã€‚ä½¿å¾—æ•ˆç‡æ¯”åˆ†å¼€æ‰§è¡Œçš„å•ä¸ªinsertè¯­å¥å¿«ã€‚ ç¤ºä¾‹ï¼Œ åŸå§‹æ–¹å¼ä¸ºï¼š insert into tb_test values(1,'Tom'); insert into tb_test values(2,'Cat'); insert into tb_test values(3,'Jerry'); ä¼˜åŒ–åçš„æ–¹æ¡ˆä¸º ï¼š insert into tb_test values(1,'Tom'),(2,'Cat')ï¼Œ(3,'Jerry'); åœ¨äº‹åŠ¡ä¸­è¿›è¡Œæ•°æ®æ’å…¥ã€‚ start transaction; insert into tb_test values(1,'Tom'); insert into tb_test values(2,'Cat'); insert into tb_test values(3,'Jerry'); commit; æ•°æ®æœ‰åºæ’å…¥ insert into tb_test values(4,'Tim'); insert into tb_test values(1,'Tom'); insert into tb_test values(3,'Jerry'); insert into tb_test values(5,'Rose'); insert into tb_test values(2,'Cat'); ä¼˜åŒ–å insert into tb_test values(1,'Tom'); insert into tb_test values(2,'Cat'); insert into tb_test values(3,'Jerry'); insert into tb_test values(4,'Tim'); insert into tb_test values(5,'Rose'); 5.3 ä¼˜åŒ–order byè¯­å¥5.3.1 ç¯å¢ƒå‡†å¤‡CREATE TABLE `emp` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(100) NOT NULL, `age` int(3) NOT NULL, `salary` int(11) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; insert into `emp` (`id`, `name`, `age`, `salary`) values('1','Tom','25','2300'); insert into `emp` (`id`, `name`, `age`, `salary`) values('2','Jerry','30','3500'); insert into `emp` (`id`, `name`, `age`, `salary`) values('3','Luci','25','2800'); insert into `emp` (`id`, `name`, `age`, `salary`) values('4','Jay','36','3500'); insert into `emp` (`id`, `name`, `age`, `salary`) values('5','Tom2','21','2200'); insert into `emp` (`id`, `name`, `age`, `salary`) values('6','Jerry2','31','3300'); insert into `emp` (`id`, `name`, `age`, `salary`) values('7','Luci2','26','2700'); insert into `emp` (`id`, `name`, `age`, `salary`) values('8','Jay2','33','3500'); insert into `emp` (`id`, `name`, `age`, `salary`) values('9','Tom3','23','2400'); insert into `emp` (`id`, `name`, `age`, `salary`) values('10','Jerry3','32','3100'); insert into `emp` (`id`, `name`, `age`, `salary`) values('11','Luci3','26','2900'); insert into `emp` (`id`, `name`, `age`, `salary`) values('12','Jay3','37','4500'); create index idx_emp_age_salary on emp(age,salary); 5.3.2 ä¸¤ç§æ’åºæ–¹å¼1). ç¬¬ä¸€ç§æ˜¯é€šè¿‡å¯¹è¿”å›æ•°æ®è¿›è¡Œæ’åºï¼Œä¹Ÿå°±æ˜¯é€šå¸¸è¯´çš„ filesort æ’åºï¼Œæ‰€æœ‰ä¸æ˜¯é€šè¿‡ç´¢å¼•ç›´æ¥è¿”å›æ’åºç»“æœçš„æ’åºéƒ½å« FileSort æ’åºã€‚ 2). ç¬¬äºŒç§é€šè¿‡æœ‰åºç´¢å¼•é¡ºåºæ‰«æç›´æ¥è¿”å›æœ‰åºæ•°æ®ï¼Œè¿™ç§æƒ…å†µå³ä¸º using indexï¼Œä¸éœ€è¦é¢å¤–æ’åºï¼Œæ“ä½œæ•ˆç‡é«˜ã€‚ å¤šå­—æ®µæ’åº äº†è§£äº†MySQLçš„æ’åºæ–¹å¼ï¼Œä¼˜åŒ–ç›®æ ‡å°±æ¸…æ™°äº†ï¼šå°½é‡å‡å°‘é¢å¤–çš„æ’åºï¼Œé€šè¿‡ç´¢å¼•ç›´æ¥è¿”å›æœ‰åºæ•°æ®ã€‚where æ¡ä»¶å’ŒOrder by ä½¿ç”¨ç›¸åŒçš„ç´¢å¼•ï¼Œå¹¶ä¸”Order By çš„é¡ºåºå’Œç´¢å¼•é¡ºåºç›¸åŒï¼Œ å¹¶ä¸”Order by çš„å­—æ®µéƒ½æ˜¯å‡åºï¼Œæˆ–è€…éƒ½æ˜¯é™åºã€‚å¦åˆ™è‚¯å®šéœ€è¦é¢å¤–çš„æ“ä½œï¼Œè¿™æ ·å°±ä¼šå‡ºç°FileSortã€‚ 5.3.3 Filesort çš„ä¼˜åŒ–é€šè¿‡åˆ›å»ºåˆé€‚çš„ç´¢å¼•ï¼Œèƒ½å¤Ÿå‡å°‘ Filesort çš„å‡ºç°ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¡ä»¶é™åˆ¶ä¸èƒ½è®©Filesortæ¶ˆå¤±ï¼Œé‚£å°±éœ€è¦åŠ å¿« Filesortçš„æ’åºæ“ä½œã€‚å¯¹äºFilesort ï¼Œ MySQL æœ‰ä¸¤ç§æ’åºç®—æ³•ï¼š 1ï¼‰ ä¸¤æ¬¡æ‰«æç®—æ³• ï¼šMySQL4.1 ä¹‹å‰ï¼Œä½¿ç”¨è¯¥æ–¹å¼æ’åºã€‚é¦–å…ˆæ ¹æ®æ¡ä»¶å–å‡ºæ’åºå­—æ®µå’Œè¡ŒæŒ‡é’ˆä¿¡æ¯ï¼Œç„¶ååœ¨æ’åºåŒº sort buffer ä¸­æ’åºï¼Œå¦‚æœsort bufferä¸å¤Ÿï¼Œåˆ™åœ¨ä¸´æ—¶è¡¨ temporary table ä¸­å­˜å‚¨æ’åºç»“æœã€‚å®Œæˆæ’åºä¹‹åï¼Œå†æ ¹æ®è¡ŒæŒ‡é’ˆå›è¡¨è¯»å–è®°å½•ï¼Œè¯¥æ“ä½œå¯èƒ½ä¼šå¯¼è‡´å¤§é‡éšæœºI/Oæ“ä½œã€‚ 2ï¼‰ä¸€æ¬¡æ‰«æç®—æ³•ï¼šä¸€æ¬¡æ€§å–å‡ºæ»¡è¶³æ¡ä»¶çš„æ‰€æœ‰å­—æ®µï¼Œç„¶ååœ¨æ’åºåŒº sort buffer ä¸­æ’åºåç›´æ¥è¾“å‡ºç»“æœé›†ã€‚æ’åºæ—¶å†…å­˜å¼€é”€è¾ƒå¤§ï¼Œä½†æ˜¯æ’åºæ•ˆç‡æ¯”ä¸¤æ¬¡æ‰«æç®—æ³•è¦é«˜ã€‚ MySQL é€šè¿‡æ¯”è¾ƒç³»ç»Ÿå˜é‡ max_length_for_sort_data çš„å¤§å°å’ŒQueryè¯­å¥å–å‡ºçš„å­—æ®µæ€»å¤§å°ï¼Œ æ¥åˆ¤å®šæ˜¯å¦é‚£ç§æ’åºç®—æ³•ï¼Œå¦‚æœmax_length_for_sort_data æ›´å¤§ï¼Œé‚£ä¹ˆä½¿ç”¨ç¬¬äºŒç§ä¼˜åŒ–ä¹‹åçš„ç®—æ³•ï¼›å¦åˆ™ä½¿ç”¨ç¬¬ä¸€ç§ã€‚ å¯ä»¥é€‚å½“æé«˜ sort_buffer_size å’Œ max_length_for_sort_data ç³»ç»Ÿå˜é‡ï¼Œæ¥å¢å¤§æ’åºåŒºçš„å¤§å°ï¼Œæé«˜æ’åºçš„æ•ˆç‡ã€‚ 5.4 ä¼˜åŒ–group by è¯­å¥ç”±äºGROUP BY å®é™…ä¸Šä¹ŸåŒæ ·ä¼šè¿›è¡Œæ’åºæ“ä½œï¼Œè€Œä¸”ä¸ORDER BY ç›¸æ¯”ï¼ŒGROUP BY ä¸»è¦åªæ˜¯å¤šäº†æ’åºä¹‹åçš„åˆ†ç»„æ“ä½œã€‚å½“ç„¶ï¼Œå¦‚æœåœ¨åˆ†ç»„çš„æ—¶å€™è¿˜ä½¿ç”¨äº†å…¶ä»–çš„ä¸€äº›èšåˆå‡½æ•°ï¼Œé‚£ä¹ˆè¿˜éœ€è¦ä¸€äº›èšåˆå‡½æ•°çš„è®¡ç®—ã€‚æ‰€ä»¥ï¼Œåœ¨GROUP BY çš„å®ç°è¿‡ç¨‹ä¸­ï¼Œä¸ ORDER BY ä¸€æ ·ä¹Ÿå¯ä»¥åˆ©ç”¨åˆ°ç´¢å¼•ã€‚ å¦‚æœæŸ¥è¯¢åŒ…å« group by ä½†æ˜¯ç”¨æˆ·æƒ³è¦é¿å…æ’åºç»“æœçš„æ¶ˆè€—ï¼Œ åˆ™å¯ä»¥æ‰§è¡Œorder by null ç¦æ­¢æ’åºã€‚å¦‚ä¸‹ ï¼š drop index idx_emp_age_salary on emp; explain select age,count(*) from emp group by age; ä¼˜åŒ–å explain select age,count(*) from emp group by age order by null; ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œç¬¬ä¸€ä¸ªSQLè¯­å¥éœ€è¦è¿›è¡Œâ€filesortâ€ï¼Œè€Œç¬¬äºŒä¸ªSQLç”±äºorder by null ä¸éœ€è¦è¿›è¡Œ â€œfilesortâ€ï¼Œ è€Œä¸Šæ–‡æè¿‡Filesortå¾€å¾€éå¸¸è€—è´¹æ—¶é—´ã€‚ åˆ›å»ºç´¢å¼• ï¼š create index idx_emp_age_salary on emp(age,salary)ï¼› 5.5 ä¼˜åŒ–åµŒå¥—æŸ¥è¯¢Mysql4.1ç‰ˆæœ¬ä¹‹åï¼Œå¼€å§‹æ”¯æŒSQLçš„å­æŸ¥è¯¢ã€‚è¿™ä¸ªæŠ€æœ¯å¯ä»¥ä½¿ç”¨SELECTè¯­å¥æ¥åˆ›å»ºä¸€ä¸ªå•åˆ—çš„æŸ¥è¯¢ç»“æœï¼Œç„¶åæŠŠè¿™ä¸ªç»“æœä½œä¸ºè¿‡æ»¤æ¡ä»¶ç”¨åœ¨å¦ä¸€ä¸ªæŸ¥è¯¢ä¸­ã€‚ä½¿ç”¨å­æŸ¥è¯¢å¯ä»¥ä¸€æ¬¡æ€§çš„å®Œæˆå¾ˆå¤šé€»è¾‘ä¸Šéœ€è¦å¤šä¸ªæ­¥éª¤æ‰èƒ½å®Œæˆçš„SQLæ“ä½œï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é¿å…äº‹åŠ¡æˆ–è€…è¡¨é”æ­»ï¼Œå¹¶ä¸”å†™èµ·æ¥ä¹Ÿå¾ˆå®¹æ˜“ã€‚ä½†æ˜¯ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œå­æŸ¥è¯¢æ˜¯å¯ä»¥è¢«æ›´é«˜æ•ˆçš„è¿æ¥ï¼ˆJOINï¼‰æ›¿ä»£ã€‚ ç¤ºä¾‹ ï¼ŒæŸ¥æ‰¾æœ‰è§’è‰²çš„æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯ : explain select * from t_user where id in (select user_id from user_role ); æ‰§è¡Œè®¡åˆ’ä¸º : ä¼˜åŒ–å : explain select * from t_user u , user_role ur where u.id = ur.user_id; è¿æ¥(Join)æŸ¥è¯¢ä¹‹æ‰€ä»¥æ›´æœ‰æ•ˆç‡ä¸€äº› ï¼Œæ˜¯å› ä¸ºMySQLä¸éœ€è¦åœ¨å†…å­˜ä¸­åˆ›å»ºä¸´æ—¶è¡¨æ¥å®Œæˆè¿™ä¸ªé€»è¾‘ä¸Šéœ€è¦ä¸¤ä¸ªæ­¥éª¤çš„æŸ¥è¯¢å·¥ä½œã€‚ 5.6 ä¼˜åŒ–ORæ¡ä»¶å¯¹äºåŒ…å«ORçš„æŸ¥è¯¢å­å¥ï¼Œå¦‚æœè¦åˆ©ç”¨ç´¢å¼•ï¼Œåˆ™ORä¹‹é—´çš„æ¯ä¸ªæ¡ä»¶åˆ—éƒ½å¿…é¡»ç”¨åˆ°ç´¢å¼• ï¼Œ è€Œä¸”ä¸èƒ½ä½¿ç”¨åˆ°å¤åˆç´¢å¼•ï¼› å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œåˆ™åº”è¯¥è€ƒè™‘å¢åŠ ç´¢å¼•ã€‚ è·å– emp è¡¨ä¸­çš„æ‰€æœ‰çš„ç´¢å¼• ï¼š ç¤ºä¾‹ ï¼š explain select * from emp where id = 1 or age = 30; å»ºè®®ä½¿ç”¨ union æ›¿æ¢ or ï¼š æˆ‘ä»¬æ¥æ¯”è¾ƒä¸‹é‡è¦æŒ‡æ ‡ï¼Œå‘ç°ä¸»è¦å·®åˆ«æ˜¯ type å’Œ ref è¿™ä¸¤é¡¹ type æ˜¾ç¤ºçš„æ˜¯è®¿é—®ç±»å‹ï¼Œæ˜¯è¾ƒä¸ºé‡è¦çš„ä¸€ä¸ªæŒ‡æ ‡ï¼Œç»“æœå€¼ä»å¥½åˆ°åä¾æ¬¡æ˜¯ï¼š system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL UNION è¯­å¥çš„ type å€¼ä¸º refï¼ŒOR è¯­å¥çš„ type å€¼ä¸º rangeï¼Œå¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„å·®è· UNION è¯­å¥çš„ ref å€¼ä¸º constï¼ŒOR è¯­å¥çš„ type å€¼ä¸º nullï¼Œconst è¡¨ç¤ºæ˜¯å¸¸é‡å€¼å¼•ç”¨ï¼Œéå¸¸å¿« è¿™ä¸¤é¡¹çš„å·®è·å°±è¯´æ˜äº† UNION è¦ä¼˜äº OR ã€‚ 5.7 ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢ä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œé€šè¿‡åˆ›å»ºè¦†ç›–ç´¢å¼•èƒ½å¤Ÿæ¯”è¾ƒå¥½åœ°æé«˜æ€§èƒ½ã€‚ä¸€ä¸ªå¸¸è§åˆéå¸¸å¤´ç–¼çš„é—®é¢˜å°±æ˜¯ limit 2000000,10 ï¼Œæ­¤æ—¶éœ€è¦MySQLæ’åºå‰2000010 è®°å½•ï¼Œä»…ä»…è¿”å›2000000 - 2000010 çš„è®°å½•ï¼Œå…¶ä»–è®°å½•ä¸¢å¼ƒï¼ŒæŸ¥è¯¢æ’åºçš„ä»£ä»·éå¸¸å¤§ ã€‚ 5.7.1 ä¼˜åŒ–æ€è·¯ä¸€åœ¨ç´¢å¼•ä¸Šå®Œæˆæ’åºåˆ†é¡µæ“ä½œï¼Œæœ€åæ ¹æ®ä¸»é”®å…³è”å›åŸè¡¨æŸ¥è¯¢æ‰€éœ€è¦çš„å…¶ä»–åˆ—å†…å®¹ã€‚ 5.7.2 ä¼˜åŒ–æ€è·¯äºŒè¯¥æ–¹æ¡ˆé€‚ç”¨äºä¸»é”®è‡ªå¢çš„è¡¨ï¼Œå¯ä»¥æŠŠLimit æŸ¥è¯¢è½¬æ¢æˆæŸä¸ªä½ç½®çš„æŸ¥è¯¢ ã€‚ 5.8 ä½¿ç”¨SQLæç¤ºSQLæç¤ºï¼Œæ˜¯ä¼˜åŒ–æ•°æ®åº“çš„ä¸€ä¸ªé‡è¦æ‰‹æ®µï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨SQLè¯­å¥ä¸­åŠ å…¥ä¸€äº›äººä¸ºçš„æç¤ºæ¥è¾¾åˆ°ä¼˜åŒ–æ“ä½œçš„ç›®çš„ã€‚ 5.8.1 USE INDEXåœ¨æŸ¥è¯¢è¯­å¥ä¸­è¡¨åçš„åé¢ï¼Œæ·»åŠ  use index æ¥æä¾›å¸Œæœ›MySQLå»å‚è€ƒçš„ç´¢å¼•åˆ—è¡¨ï¼Œå°±å¯ä»¥è®©MySQLä¸å†è€ƒè™‘å…¶ä»–å¯ç”¨çš„ç´¢å¼•ã€‚ create index idx_seller_name on tb_seller(name); 5.8.2 IGNORE INDEXå¦‚æœç”¨æˆ·åªæ˜¯å•çº¯çš„æƒ³è®©MySQLå¿½ç•¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªç´¢å¼•ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ ignore index ä½œä¸º hint ã€‚ explain select * from tb_seller ignore index(idx_seller_name) where name = 'å°ç±³ç§‘æŠ€'; 5.8.3 FORCE INDEXä¸ºå¼ºåˆ¶MySQLä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„ç´¢å¼•ï¼Œå¯åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨ force index ä½œä¸ºhint ã€‚ create index idx_seller_address on tb_seller(address); document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQLæ•°æ®åº“ä¼˜åŒ–ä¹‹ç»„åˆæ‹³(äºŒ)</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLæ•°æ®åº“ä¼˜åŒ–ä¹‹ç»„åˆæ‹³(ä¸€)]]></title>
    <url>%2F2021%2F01%2F17%2Fmysql-advanced-1%2F</url>
    <content type="text"><![CDATA[éåŸåˆ›å›¾æ–‡,å›¾æ–‡æ¥æºäºé»‘é©¬å®˜ç½‘,æ­¤å¤„ä»…ä½œä¸ºå¤‡ä»½å­¦ä¹  MySQLæ•°æ®åº“ä¼˜åŒ–æ€»æ¦‚ ğŸš©ç»„åˆæ‹³ï¼ˆä¸€ï¼‰ ç»„åˆæ‹³ï¼ˆäºŒï¼‰ ç»„åˆæ‹³ï¼ˆä¸‰ï¼‰ ç»„åˆæ‹³ï¼ˆå››ï¼‰ ç´¢å¼• ä½“ç³»ç»“æ„ åº”ç”¨ä¼˜åŒ– MySQL å¸¸ç”¨å·¥å…· è§†å›¾ å­˜å‚¨å¼•æ“ æŸ¥è¯¢ç¼“å­˜ä¼˜åŒ– MySQL æ—¥å¿— å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•° ä¼˜åŒ–SQLæ­¥éª¤ å†…å­˜ç®¡ç†åŠä¼˜åŒ– MySQL ä¸»ä»å¤åˆ¶ è§¦å‘å™¨ ç´¢å¼•ä½¿ç”¨ MySQLé”é—®é¢˜ SQLä¼˜åŒ– å¸¸ç”¨SQLæŠ€å·§ 1. ç´¢å¼•1.1 ç´¢å¼•æ¦‚è¿°MySQLå®˜æ–¹å¯¹ç´¢å¼•çš„å®šä¹‰ä¸ºï¼šç´¢å¼•ï¼ˆindexï¼‰æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ï¼ˆæœ‰åºï¼‰ã€‚åœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤è€…æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œ è¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ï¼Œè¿™ç§æ•°æ®ç»“æ„å°±æ˜¯ç´¢å¼•ã€‚å¦‚ä¸‹é¢ç¤ºæ„å›¾æ‰€ç¤º : å·¦è¾¹æ˜¯æ•°æ®è¡¨ï¼Œä¸€å…±æœ‰ä¸¤åˆ—ä¸ƒæ¡è®°å½•ï¼Œæœ€å·¦è¾¹çš„æ˜¯æ•°æ®è®°å½•çš„ç‰©ç†åœ°å€ï¼ˆæ³¨æ„é€»è¾‘ä¸Šç›¸é‚»çš„è®°å½•åœ¨ç£ç›˜ä¸Šä¹Ÿå¹¶ä¸æ˜¯ä¸€å®šç‰©ç†ç›¸é‚»çš„ï¼‰ã€‚ä¸ºäº†åŠ å¿«Col2çš„æŸ¥æ‰¾ï¼Œå¯ä»¥ç»´æŠ¤ä¸€ä¸ªå³è¾¹æ‰€ç¤ºçš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹åˆ†åˆ«åŒ…å«ç´¢å¼•é”®å€¼å’Œä¸€ä¸ªæŒ‡å‘å¯¹åº”æ•°æ®è®°å½•ç‰©ç†åœ°å€çš„æŒ‡é’ˆï¼Œè¿™æ ·å°±å¯ä»¥è¿ç”¨äºŒå‰æŸ¥æ‰¾å¿«é€Ÿè·å–åˆ°ç›¸åº”æ•°æ®ã€‚ä¸€èˆ¬æ¥è¯´ç´¢å¼•æœ¬èº«ä¹Ÿå¾ˆå¤§ï¼Œä¸å¯èƒ½å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤ç´¢å¼•å¾€å¾€ä»¥ç´¢å¼•æ–‡ä»¶çš„å½¢å¼å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚ç´¢å¼•æ˜¯æ•°æ®åº“ä¸­ç”¨æ¥æé«˜æ€§èƒ½çš„æœ€å¸¸ç”¨çš„å·¥å…·ã€‚ 1.2 ç´¢å¼•ä¼˜åŠ¿åŠ£åŠ¿ä¼˜åŠ¿1ï¼‰ ç±»ä¼¼äºä¹¦ç±çš„ç›®å½•ç´¢å¼•ï¼Œæé«˜æ•°æ®æ£€ç´¢çš„æ•ˆç‡ï¼Œé™ä½æ•°æ®åº“çš„IOæˆæœ¬ã€‚2ï¼‰ é€šè¿‡ç´¢å¼•åˆ—å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œé™ä½æ•°æ®æ’åºçš„æˆæœ¬ï¼Œé™ä½CPUçš„æ¶ˆè€—ã€‚ åŠ£åŠ¿1ï¼‰ å®é™…ä¸Šç´¢å¼•ä¹Ÿæ˜¯ä¸€å¼ è¡¨ï¼Œè¯¥è¡¨ä¸­ä¿å­˜äº†ä¸»é”®ä¸ç´¢å¼•å­—æ®µï¼Œå¹¶æŒ‡å‘å®ä½“ç±»çš„è®°å½•ï¼Œæ‰€ä»¥ç´¢å¼•åˆ—ä¹Ÿæ˜¯è¦å ç”¨ç©ºé—´çš„ã€‚2ï¼‰ è™½ç„¶ç´¢å¼•å¤§å¤§æé«˜äº†æŸ¥è¯¢æ•ˆç‡ï¼ŒåŒæ—¶å´ä¹Ÿé™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦ï¼Œå¦‚å¯¹è¡¨è¿›è¡ŒINSERTã€UPDATEã€DELETEã€‚å› ä¸ºæ›´æ–°è¡¨æ—¶ï¼ŒMySQL ä¸ä»…è¦ä¿å­˜æ•°æ®ï¼Œè¿˜è¦ä¿å­˜ä¸€ä¸‹ç´¢å¼•æ–‡ä»¶æ¯æ¬¡æ›´æ–°æ·»åŠ äº†ç´¢å¼•åˆ—çš„å­—æ®µï¼Œéƒ½ä¼šè°ƒæ•´å› ä¸ºæ›´æ–°æ‰€å¸¦æ¥çš„é”®å€¼å˜åŒ–åçš„ç´¢å¼•ä¿¡æ¯ã€‚ 1.3 ç´¢å¼•ç»“æ„ç´¢å¼•æ˜¯åœ¨MySQLçš„å­˜å‚¨å¼•æ“å±‚ä¸­å®ç°çš„ï¼Œè€Œä¸æ˜¯åœ¨æœåŠ¡å™¨å±‚å®ç°çš„ã€‚æ‰€ä»¥æ¯ç§å­˜å‚¨å¼•æ“çš„ç´¢å¼•éƒ½ä¸ä¸€å®šå®Œå…¨ç›¸åŒï¼Œä¹Ÿä¸æ˜¯æ‰€æœ‰çš„å­˜å‚¨å¼•æ“éƒ½æ”¯æŒæ‰€æœ‰çš„ç´¢å¼•ç±»å‹çš„ã€‚MySQLç›®å‰æä¾›äº†ä»¥ä¸‹4ç§ç´¢å¼•ï¼š BTREE ç´¢å¼• ï¼š æœ€å¸¸è§çš„ç´¢å¼•ç±»å‹ï¼Œå¤§éƒ¨åˆ†ç´¢å¼•éƒ½æ”¯æŒ B æ ‘ç´¢å¼•ã€‚ HASH ç´¢å¼•ï¼šåªæœ‰Memoryå¼•æ“æ”¯æŒ ï¼Œ ä½¿ç”¨åœºæ™¯ç®€å• ã€‚ R-tree ç´¢å¼•ï¼ˆç©ºé—´ç´¢å¼•ï¼‰ï¼šç©ºé—´ç´¢å¼•æ˜¯MyISAMå¼•æ“çš„ä¸€ä¸ªç‰¹æ®Šç´¢å¼•ç±»å‹ï¼Œä¸»è¦ç”¨äºåœ°ç†ç©ºé—´æ•°æ®ç±»å‹ï¼Œé€šå¸¸ä½¿ç”¨è¾ƒå°‘ï¼Œä¸åšç‰¹åˆ«ä»‹ç»ã€‚ Full-text ï¼ˆå…¨æ–‡ç´¢å¼•ï¼‰ ï¼šå…¨æ–‡ç´¢å¼•ä¹Ÿæ˜¯MyISAMçš„ä¸€ä¸ªç‰¹æ®Šç´¢å¼•ç±»å‹ï¼Œä¸»è¦ç”¨äºå…¨æ–‡ç´¢å¼•ï¼ŒInnoDBä»Mysql5.6ç‰ˆæœ¬å¼€å§‹æ”¯æŒå…¨æ–‡ç´¢å¼•ã€‚ MyISAMã€InnoDBã€Memoryä¸‰ç§å­˜å‚¨å¼•æ“å¯¹å„ç§ç´¢å¼•ç±»å‹çš„æ”¯æŒ ç´¢å¼• InnoDBå¼•æ“ MyISAMå¼•æ“ Memoryå¼•æ“ BTREEç´¢å¼• æ”¯æŒ æ”¯æŒ æ”¯æŒ HASH ç´¢å¼• ä¸æ”¯æŒ ä¸æ”¯æŒ æ”¯æŒ R-tree ç´¢å¼• ä¸æ”¯æŒ æ”¯æŒ ä¸æ”¯æŒ Full-text 5.6ç‰ˆæœ¬ä¹‹åæ”¯æŒ æ”¯æŒ ä¸æ”¯æŒ æˆ‘ä»¬å¹³å¸¸æ‰€è¯´çš„ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«æŒ‡æ˜ï¼Œéƒ½æ˜¯æŒ‡B+æ ‘ï¼ˆå¤šè·¯æœç´¢æ ‘ï¼Œå¹¶ä¸ä¸€å®šæ˜¯äºŒå‰çš„ï¼‰ç»“æ„ç»„ç»‡çš„ç´¢å¼•ã€‚å…¶ä¸­èšé›†ç´¢å¼•ã€å¤åˆç´¢å¼•ã€å‰ç¼€ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•é»˜è®¤éƒ½æ˜¯ä½¿ç”¨ B+tree ç´¢å¼•ï¼Œç»Ÿç§°ä¸º ç´¢å¼•ã€‚ 1.3.1 BTREE ç»“æ„BTreeåˆå«å¤šè·¯å¹³è¡¡æœç´¢æ ‘ï¼Œä¸€é¢—må‰çš„BTreeç‰¹æ€§å¦‚ä¸‹ï¼š æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåŒ…å«mä¸ªå­©å­ã€‚ é™¤æ ¹èŠ‚ç‚¹ä¸å¶å­èŠ‚ç‚¹å¤–ï¼Œæ¯ä¸ªèŠ‚ç‚¹è‡³å°‘æœ‰[ceil(m/2)]ä¸ªå­©å­ã€‚ è‹¥æ ¹èŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œåˆ™è‡³å°‘æœ‰ä¸¤ä¸ªå­©å­ã€‚ æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚ã€‚ æ¯ä¸ªéå¶å­èŠ‚ç‚¹ç”±nä¸ªkeyä¸n+1ä¸ªæŒ‡é’ˆç»„æˆï¼Œå…¶ä¸­[ceil(m/2)-1] &lt;= n &lt;= m-1 ä»¥5å‰BTreeä¸ºä¾‹ï¼Œkeyçš„æ•°é‡ï¼šå…¬å¼æ¨å¯¼[ceil(m/2)-1] &lt;= n &lt;= m-1ã€‚æ‰€ä»¥ 2 &lt;= n &lt;=4 ã€‚å½“n&gt;4æ—¶ï¼Œä¸­é—´èŠ‚ç‚¹åˆ†è£‚åˆ°çˆ¶èŠ‚ç‚¹ï¼Œä¸¤è¾¹èŠ‚ç‚¹åˆ†è£‚ã€‚æ’å…¥ C N G A H E K Q M F W L T Z D P R X Y S æ•°æ®ä¸ºä¾‹ã€‚ æ¼”å˜è¿‡ç¨‹å¦‚ä¸‹ï¼š 1). æ’å…¥å‰4ä¸ªå­—æ¯ C N G A 2). æ’å…¥Hï¼Œn&gt;4ï¼Œä¸­é—´å…ƒç´ Gå­—æ¯å‘ä¸Šåˆ†è£‚åˆ°æ–°çš„èŠ‚ç‚¹ 3). æ’å…¥Eï¼ŒKï¼ŒQä¸éœ€è¦åˆ†è£‚ 4). æ’å…¥Mï¼Œä¸­é—´å…ƒç´ Må­—æ¯å‘ä¸Šåˆ†è£‚åˆ°çˆ¶èŠ‚ç‚¹G 5). æ’å…¥Fï¼ŒWï¼ŒLï¼ŒTä¸éœ€è¦åˆ†è£‚ 6). æ’å…¥Zï¼Œä¸­é—´å…ƒç´ Tå‘ä¸Šåˆ†è£‚åˆ°çˆ¶èŠ‚ç‚¹ä¸­ 7). æ’å…¥Dï¼Œä¸­é—´å…ƒç´ Då‘ä¸Šåˆ†è£‚åˆ°çˆ¶èŠ‚ç‚¹ä¸­ã€‚ç„¶åæ’å…¥Pï¼ŒRï¼ŒXï¼ŒYä¸éœ€è¦åˆ†è£‚ 8). æœ€åæ’å…¥Sï¼ŒNPQRèŠ‚ç‚¹n&gt;5ï¼Œä¸­é—´èŠ‚ç‚¹Qå‘ä¸Šåˆ†è£‚ï¼Œä½†åˆ†è£‚åçˆ¶èŠ‚ç‚¹DGMTçš„n&gt;5ï¼Œä¸­é—´èŠ‚ç‚¹Må‘ä¸Šåˆ†è£‚ åˆ°æ­¤ï¼Œè¯¥BTREEæ ‘å°±å·²ç»æ„å»ºå®Œæˆäº†ï¼Œ BTREEæ ‘ å’Œ äºŒå‰æ ‘ ç›¸æ¯”ï¼Œ æŸ¥è¯¢æ•°æ®çš„æ•ˆç‡æ›´é«˜ï¼Œ å› ä¸ºå¯¹äºç›¸åŒçš„æ•°æ®é‡æ¥è¯´ï¼ŒBTREEçš„å±‚çº§ç»“æ„æ¯”äºŒå‰æ ‘å°ï¼Œå› æ­¤æœç´¢é€Ÿåº¦å¿«ã€‚ 1.3.3 B+TREE ç»“æ„B+Treeä¸ºBTreeçš„å˜ç§ï¼ŒB+Treeä¸BTreeçš„åŒºåˆ«ä¸ºï¼š 1). nå‰B+Treeæœ€å¤šå«æœ‰nä¸ªkeyï¼Œè€ŒBTreeæœ€å¤šå«æœ‰n-1ä¸ªkeyã€‚2). B+Treeçš„å¶å­èŠ‚ç‚¹ä¿å­˜æ‰€æœ‰çš„keyä¿¡æ¯ï¼Œä¾keyå¤§å°é¡ºåºæ’åˆ—ã€‚3). æ‰€æœ‰çš„éå¶å­èŠ‚ç‚¹éƒ½å¯ä»¥çœ‹ä½œæ˜¯keyçš„ç´¢å¼•éƒ¨åˆ†ã€‚ ç”±äºB+Treeåªæœ‰å¶å­èŠ‚ç‚¹ä¿å­˜keyä¿¡æ¯ï¼ŒæŸ¥è¯¢ä»»ä½•keyéƒ½è¦ä»rootèµ°åˆ°å¶å­ã€‚æ‰€ä»¥B+Treeçš„æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®šã€‚ 1.3.3 MySQLä¸­çš„B+TreeMySqlç´¢å¼•æ•°æ®ç»“æ„å¯¹ç»å…¸çš„B+Treeè¿›è¡Œäº†ä¼˜åŒ–ã€‚åœ¨åŸB+Treeçš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹çš„é“¾è¡¨æŒ‡é’ˆï¼Œå°±å½¢æˆäº†å¸¦æœ‰é¡ºåºæŒ‡é’ˆçš„B+Treeï¼Œæé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ã€‚ MySQLä¸­çš„ B+Tree ç´¢å¼•ç»“æ„ç¤ºæ„å›¾: 1.4 ç´¢å¼•åˆ†ç±»1ï¼‰ å•å€¼ç´¢å¼• ï¼šå³ä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—ï¼Œä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå•åˆ—ç´¢å¼•2ï¼‰ å”¯ä¸€ç´¢å¼• ï¼šç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä½†å…è®¸æœ‰ç©ºå€¼3ï¼‰ å¤åˆç´¢å¼• ï¼šå³ä¸€ä¸ªç´¢å¼•åŒ…å«å¤šä¸ªåˆ— 1.5 ç´¢å¼•è¯­æ³•ç´¢å¼•åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œå¯ä»¥åŒæ—¶åˆ›å»ºï¼Œ ä¹Ÿå¯ä»¥éšæ—¶å¢åŠ æ–°çš„ç´¢å¼•ã€‚ å‡†å¤‡ç¯å¢ƒ: create database demo_01 default charset=utf8mb4; use demo_01; CREATE TABLE `city` ( `city_id` int(11) NOT NULL AUTO_INCREMENT, `city_name` varchar(50) NOT NULL, `country_id` int(11) NOT NULL, PRIMARY KEY (`city_id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; CREATE TABLE `country` ( `country_id` int(11) NOT NULL AUTO_INCREMENT, `country_name` varchar(100) NOT NULL, PRIMARY KEY (`country_id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; insert into `city` (`city_id`, `city_name`, `country_id`) values(1,'è¥¿å®‰',1); insert into `city` (`city_id`, `city_name`, `country_id`) values(2,'NewYork',2); insert into `city` (`city_id`, `city_name`, `country_id`) values(3,'åŒ—äº¬',1); insert into `city` (`city_id`, `city_name`, `country_id`) values(4,'ä¸Šæµ·',1); insert into `country` (`country_id`, `country_name`) values(1,'China'); insert into `country` (`country_id`, `country_name`) values(2,'America'); insert into `country` (`country_id`, `country_name`) values(3,'Japan'); insert into `country` (`country_id`, `country_name`) values(4,'UK'); 1.5.1 åˆ›å»ºç´¢å¼•è¯­æ³• ï¼š CREATE [UNIQUE|FULLTEXT|SPATIAL] INDEX index_name [USING index_type] ON tbl_name(index_col_name,...) index_col_name : column_name[(length)][ASC | DESC] ç¤ºä¾‹ ï¼š ä¸ºcityè¡¨ä¸­çš„city_nameå­—æ®µåˆ›å»ºç´¢å¼• ï¼› create index idx_city_name on city(city_name); 1.5.2 æŸ¥çœ‹ç´¢å¼•è¯­æ³•ï¼š show index from table_name; ç¤ºä¾‹ï¼šæŸ¥çœ‹cityè¡¨ä¸­çš„ç´¢å¼•ä¿¡æ¯ï¼› 1.5.3 åˆ é™¤ç´¢å¼•è¯­æ³• ï¼š DROP INDEX index_name ON tbl_name; ç¤ºä¾‹ ï¼š æƒ³è¦åˆ é™¤cityè¡¨ä¸Šçš„ç´¢å¼•idx_city_nameï¼Œå¯ä»¥æ“ä½œå¦‚ä¸‹ï¼š drop index idx_city_name on city; 1.5.4 ALTERå‘½ä»¤-- æ·»åŠ ä¸€ä¸ªä¸»é”®,ç´¢å¼•å€¼å¿…é¡»å”¯ä¸€,ä¸”ä¸èƒ½ä¸ºNULL alter table tb_name add primary key(column_list); -- æ·»åŠ å”¯ä¸€ç´¢å¼•,ç´¢å¼•çš„å€¼å¿…é¡»å”¯ä¸€(é™¤äº†NULLå¤–,NULLå¯èƒ½ä¼šå‡ºç°å¤šæ¬¡) alter table tb_name add unique index_name(column_list); -- æ·»åŠ æ™®é€šç´¢å¼•,ç´¢å¼•å€¼å¯ä»¥å‡ºç°å¤šæ¬¡ alter table tb_name add index index_name(column_list); -- æŒ‡å®šäº†ç´¢å¼•ä¸ºFULLTEXT,ç”¨äºå…¨æ–‡ç´¢å¼• alter table tb_name add fulltext index_name(column_list); 1.6 ç´¢å¼•è®¾è®¡åŸåˆ™â€‹ ç´¢å¼•çš„è®¾è®¡å¯ä»¥éµå¾ªä¸€äº›å·²æœ‰çš„åŸåˆ™ï¼Œåˆ›å»ºç´¢å¼•çš„æ—¶å€™è¯·å°½é‡è€ƒè™‘ç¬¦åˆè¿™äº›åŸåˆ™ï¼Œä¾¿äºæå‡ç´¢å¼•çš„ä½¿ç”¨æ•ˆç‡ï¼Œæ›´é«˜æ•ˆçš„ä½¿ç”¨ç´¢å¼•ã€‚ å¯¹æŸ¥è¯¢é¢‘æ¬¡è¾ƒé«˜ï¼Œä¸”æ•°æ®é‡æ¯”è¾ƒå¤§çš„è¡¨å»ºç«‹ç´¢å¼•ã€‚ ç´¢å¼•å­—æ®µçš„é€‰æ‹©ï¼Œæœ€ä½³å€™é€‰åˆ—åº”å½“ä»whereå­å¥çš„æ¡ä»¶ä¸­æå–ï¼Œå¦‚æœwhereå­å¥ä¸­çš„ç»„åˆæ¯”è¾ƒå¤šï¼Œé‚£ä¹ˆåº”å½“æŒ‘é€‰æœ€å¸¸ç”¨ã€è¿‡æ»¤æ•ˆæœæœ€å¥½çš„åˆ—çš„ç»„åˆã€‚ ä½¿ç”¨å”¯ä¸€ç´¢å¼•ï¼ŒåŒºåˆ†åº¦è¶Šé«˜ï¼Œä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡è¶Šé«˜ã€‚ ç´¢å¼•å¯ä»¥æœ‰æ•ˆçš„æå‡æŸ¥è¯¢æ•°æ®çš„æ•ˆç‡ï¼Œä½†ç´¢å¼•æ•°é‡ä¸æ˜¯å¤šå¤šç›Šå–„ï¼Œç´¢å¼•è¶Šå¤šï¼Œç»´æŠ¤ç´¢å¼•çš„ä»£ä»·è‡ªç„¶ä¹Ÿå°±æ°´æ¶¨èˆ¹é«˜ã€‚å¯¹äºæ’å…¥ã€æ›´æ–°ã€åˆ é™¤ç­‰DMLæ“ä½œæ¯”è¾ƒé¢‘ç¹çš„è¡¨æ¥è¯´ï¼Œç´¢å¼•è¿‡å¤šï¼Œä¼šå¼•å…¥ç›¸å½“é«˜çš„ç»´æŠ¤ä»£ä»·ï¼Œé™ä½DMLæ“ä½œçš„æ•ˆç‡ï¼Œå¢åŠ ç›¸åº”æ“ä½œçš„æ—¶é—´æ¶ˆè€—ã€‚å¦å¤–ç´¢å¼•è¿‡å¤šçš„è¯ï¼ŒMySQLä¹Ÿä¼šçŠ¯é€‰æ‹©å›°éš¾ç—…ï¼Œè™½ç„¶æœ€ç»ˆä»ç„¶ä¼šæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„ç´¢å¼•ï¼Œä½†æ— ç–‘æé«˜äº†é€‰æ‹©çš„ä»£ä»·ã€‚ ä½¿ç”¨çŸ­ç´¢å¼•ï¼Œç´¢å¼•åˆ›å»ºä¹‹åä¹Ÿæ˜¯ä½¿ç”¨ç¡¬ç›˜æ¥å­˜å‚¨çš„ï¼Œå› æ­¤æå‡ç´¢å¼•è®¿é—®çš„I/Oæ•ˆç‡ï¼Œä¹Ÿå¯ä»¥æå‡æ€»ä½“çš„è®¿é—®æ•ˆç‡ã€‚å‡å¦‚æ„æˆç´¢å¼•çš„å­—æ®µæ€»é•¿åº¦æ¯”è¾ƒçŸ­ï¼Œé‚£ä¹ˆåœ¨ç»™å®šå¤§å°çš„å­˜å‚¨å—å†…å¯ä»¥å­˜å‚¨æ›´å¤šçš„ç´¢å¼•å€¼ï¼Œç›¸åº”çš„å¯ä»¥æœ‰æ•ˆçš„æå‡MySQLè®¿é—®ç´¢å¼•çš„I/Oæ•ˆç‡ã€‚ åˆ©ç”¨æœ€å·¦å‰ç¼€ï¼ŒNä¸ªåˆ—ç»„åˆè€Œæˆçš„ç»„åˆç´¢å¼•ï¼Œé‚£ä¹ˆç›¸å½“äºæ˜¯åˆ›å»ºäº†Nä¸ªç´¢å¼•ï¼Œå¦‚æœæŸ¥è¯¢æ—¶whereå­å¥ä¸­ä½¿ç”¨äº†ç»„æˆè¯¥ç´¢å¼•çš„å‰å‡ ä¸ªå­—æ®µï¼Œé‚£ä¹ˆè¿™æ¡æŸ¥è¯¢SQLå¯ä»¥åˆ©ç”¨ç»„åˆç´¢å¼•æ¥æå‡æŸ¥è¯¢æ•ˆç‡ã€‚ åˆ›å»ºå¤åˆç´¢å¼•: CREATE INDEX idx_name_email_status ON tb_seller(NAME,email,STATUS); å°±ç›¸å½“äº å¯¹name åˆ›å»ºç´¢å¼• ; å¯¹name , email åˆ›å»ºäº†ç´¢å¼• ; å¯¹name , email, status åˆ›å»ºäº†ç´¢å¼• ; 2. è§†å›¾2.1 è§†å›¾æ¦‚è¿°â€‹ è§†å›¾ï¼ˆViewï¼‰æ˜¯ä¸€ç§è™šæ‹Ÿå­˜åœ¨çš„è¡¨ã€‚è§†å›¾å¹¶ä¸åœ¨æ•°æ®åº“ä¸­å®é™…å­˜åœ¨ï¼Œè¡Œå’Œåˆ—æ•°æ®æ¥è‡ªå®šä¹‰è§†å›¾çš„æŸ¥è¯¢ä¸­ä½¿ç”¨çš„è¡¨ï¼Œå¹¶ä¸”æ˜¯åœ¨ä½¿ç”¨è§†å›¾æ—¶åŠ¨æ€ç”Ÿæˆçš„ã€‚é€šä¿—çš„è®²ï¼Œè§†å›¾å°±æ˜¯ä¸€æ¡SELECTè¯­å¥æ‰§è¡Œåè¿”å›çš„ç»“æœé›†ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨åˆ›å»ºè§†å›¾çš„æ—¶å€™ï¼Œä¸»è¦çš„å·¥ä½œå°±è½åœ¨åˆ›å»ºè¿™æ¡SQLæŸ¥è¯¢è¯­å¥ä¸Šã€‚è§†å›¾ç›¸å¯¹äºæ™®é€šçš„è¡¨çš„ä¼˜åŠ¿ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ é¡¹ã€‚ ç®€å•ï¼šä½¿ç”¨è§†å›¾çš„ç”¨æˆ·å®Œå…¨ä¸éœ€è¦å…³å¿ƒåé¢å¯¹åº”çš„è¡¨çš„ç»“æ„ã€å…³è”æ¡ä»¶å’Œç­›é€‰æ¡ä»¶ï¼Œå¯¹ç”¨æˆ·æ¥è¯´å·²ç»æ˜¯è¿‡æ»¤å¥½çš„å¤åˆæ¡ä»¶çš„ç»“æœé›†ã€‚ å®‰å…¨ï¼šä½¿ç”¨è§†å›¾çš„ç”¨æˆ·åªèƒ½è®¿é—®ä»–ä»¬è¢«å…è®¸æŸ¥è¯¢çš„ç»“æœé›†ï¼Œå¯¹è¡¨çš„æƒé™ç®¡ç†å¹¶ä¸èƒ½é™åˆ¶åˆ°æŸä¸ªè¡ŒæŸä¸ªåˆ—ï¼Œä½†æ˜¯é€šè¿‡è§†å›¾å°±å¯ä»¥ç®€å•çš„å®ç°ã€‚ æ•°æ®ç‹¬ç«‹ï¼šä¸€æ—¦è§†å›¾çš„ç»“æ„ç¡®å®šäº†ï¼Œå¯ä»¥å±è”½è¡¨ç»“æ„å˜åŒ–å¯¹ç”¨æˆ·çš„å½±å“ï¼Œæºè¡¨å¢åŠ åˆ—å¯¹è§†å›¾æ²¡æœ‰å½±å“ï¼›æºè¡¨ä¿®æ”¹åˆ—åï¼Œåˆ™å¯ä»¥é€šè¿‡ä¿®æ”¹è§†å›¾æ¥è§£å†³ï¼Œä¸ä¼šé€ æˆå¯¹è®¿é—®è€…çš„å½±å“ã€‚ 2.2 åˆ›å»ºæˆ–è€…ä¿®æ”¹è§†å›¾åˆ›å»ºè§†å›¾çš„è¯­æ³•ä¸ºï¼š CREATE [OR REPLACE] [ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}] VIEW view_name [(column_list)] AS select_statement [WITH [CASCADED | LOCAL] CHECK OPTION] ä¿®æ”¹è§†å›¾çš„è¯­æ³•ä¸ºï¼š ALTER [ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}] VIEW view_name [(column_list)] AS select_statement [WITH [CASCADED | LOCAL] CHECK OPTION] é€‰é¡¹ : WITH [CASCADED | LOCAL] CHECK OPTION å†³å®šäº†æ˜¯å¦å…è®¸æ›´æ–°æ•°æ®ä½¿è®°å½•ä¸å†æ»¡è¶³è§†å›¾çš„æ¡ä»¶ã€‚ LOCAL ï¼š åªè¦æ»¡è¶³æœ¬è§†å›¾çš„æ¡ä»¶å°±å¯ä»¥æ›´æ–°ã€‚ CASCADED ï¼š å¿…é¡»æ»¡è¶³æ‰€æœ‰é’ˆå¯¹è¯¥è§†å›¾çš„æ‰€æœ‰è§†å›¾çš„æ¡ä»¶æ‰å¯ä»¥æ›´æ–°ã€‚ é»˜è®¤å€¼. ç¤ºä¾‹ , åˆ›å»ºcity_country_viewè§†å›¾ , æ‰§è¡Œå¦‚ä¸‹SQL : create or replace view city_country_view as select t.*,c.country_name from country c , city t where c.country_id = t.country_id; æŸ¥è¯¢è§†å›¾ : 2.3 æŸ¥çœ‹è§†å›¾â€‹ ä» MySQL 5.1 ç‰ˆæœ¬å¼€å§‹ï¼Œä½¿ç”¨ SHOW TABLES å‘½ä»¤çš„æ—¶å€™ä¸ä»…æ˜¾ç¤ºè¡¨çš„åå­—ï¼ŒåŒæ—¶ä¹Ÿä¼šæ˜¾ç¤ºè§†å›¾çš„åå­—ï¼Œè€Œä¸å­˜åœ¨å•ç‹¬æ˜¾ç¤ºè§†å›¾çš„ SHOW VIEWS å‘½ä»¤ã€‚ åŒæ ·ï¼Œåœ¨ä½¿ç”¨ SHOW TABLE STATUS å‘½ä»¤çš„æ—¶å€™ï¼Œä¸ä½†å¯ä»¥æ˜¾ç¤ºè¡¨çš„ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æ˜¾ç¤ºè§†å›¾çš„ä¿¡æ¯ã€‚ å¦‚æœéœ€è¦æŸ¥è¯¢æŸä¸ªè§†å›¾çš„å®šä¹‰ï¼Œå¯ä»¥ä½¿ç”¨ SHOW CREATE VIEW å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ ï¼š 2.4 åˆ é™¤è§†å›¾è¯­æ³• : DROP VIEW [IF EXISTS] view_name [, view_name] ...[RESTRICT | CASCADE] ç¤ºä¾‹ , åˆ é™¤è§†å›¾city_country_view : DROP VIEW city_country_view ; 3. å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°3.1 å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°æ¦‚è¿°â€‹ å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°æ˜¯ äº‹å…ˆç»è¿‡ç¼–è¯‘å¹¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ä¸€æ®µ SQL è¯­å¥çš„é›†åˆï¼Œè°ƒç”¨å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°å¯ä»¥ç®€åŒ–åº”ç”¨å¼€å‘äººå‘˜çš„å¾ˆå¤šå·¥ä½œï¼Œå‡å°‘æ•°æ®åœ¨æ•°æ®åº“å’Œåº”ç”¨æœåŠ¡å™¨ä¹‹é—´çš„ä¼ è¾“ï¼Œå¯¹äºæé«˜æ•°æ®å¤„ç†çš„æ•ˆç‡æ˜¯æœ‰å¥½å¤„çš„ã€‚ å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„åŒºåˆ«åœ¨äºå‡½æ•°å¿…é¡»æœ‰è¿”å›å€¼ï¼Œè€Œå­˜å‚¨è¿‡ç¨‹æ²¡æœ‰ã€‚â€‹ å‡½æ•° ï¼š æ˜¯ä¸€ä¸ªæœ‰è¿”å›å€¼çš„è¿‡ç¨‹ ï¼›â€‹ è¿‡ç¨‹ ï¼š æ˜¯ä¸€ä¸ªæ²¡æœ‰è¿”å›å€¼çš„å‡½æ•° ï¼› 3.2 åˆ›å»ºå­˜å‚¨è¿‡ç¨‹CREATE PROCEDURE procedure_name ([proc_parameter[,...]]) begin -- SQLè¯­å¥ end ; ç¤ºä¾‹ ï¼š delimiter $ create procedure pro_test1() begin select 'Hello Mysql' ; end$ delimiter ; çŸ¥è¯†å°è´´å£« DELIMITER â€‹ è¯¥å…³é”®å­—ç”¨æ¥å£°æ˜SQLè¯­å¥çš„åˆ†éš”ç¬¦ , å‘Šè¯‰ MySQL è§£é‡Šå™¨ï¼Œè¯¥æ®µå‘½ä»¤æ˜¯å¦å·²ç»ç»“æŸäº†ï¼Œmysqlæ˜¯å¦å¯ä»¥æ‰§è¡Œäº†ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œdelimiteræ˜¯åˆ†å·;ã€‚åœ¨å‘½ä»¤è¡Œå®¢æˆ·ç«¯ä¸­ï¼Œå¦‚æœæœ‰ä¸€è¡Œå‘½ä»¤ä»¥åˆ†å·ç»“æŸï¼Œé‚£ä¹ˆå›è½¦åï¼Œmysqlå°†ä¼šæ‰§è¡Œè¯¥å‘½ä»¤ã€‚ 3.3 è°ƒç”¨å­˜å‚¨è¿‡ç¨‹call procedure_name() ; 3.4 æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹-- æŸ¥è¯¢db_nameæ•°æ®åº“ä¸­çš„æ‰€æœ‰çš„å­˜å‚¨è¿‡ç¨‹ select name from mysql.proc where db='db_name'; -- æŸ¥è¯¢å­˜å‚¨è¿‡ç¨‹çš„çŠ¶æ€ä¿¡æ¯ show procedure status; -- æŸ¥è¯¢æŸä¸ªå­˜å‚¨è¿‡ç¨‹çš„å®šä¹‰ show create procedure test.pro_test1 \G; 3.5 åˆ é™¤å­˜å‚¨è¿‡ç¨‹DROP PROCEDURE [IF EXISTS] sp_name; 3.6 è¯­æ³•å­˜å‚¨è¿‡ç¨‹æ˜¯å¯ä»¥ç¼–ç¨‹çš„ï¼Œæ„å‘³ç€å¯ä»¥ä½¿ç”¨å˜é‡ï¼Œè¡¨è¾¾å¼ï¼Œæ§åˆ¶ç»“æ„ ï¼Œ æ¥å®Œæˆæ¯”è¾ƒå¤æ‚çš„åŠŸèƒ½ã€‚ 3.6.1 å˜é‡ DECLARE é€šè¿‡ DECLARE å¯ä»¥å®šä¹‰ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œè¯¥å˜é‡çš„ä½œç”¨èŒƒå›´åªèƒ½åœ¨ BEGINâ€¦END å—ä¸­ã€‚ DECLARE var_name[,...] type [DEFAULT value] ç¤ºä¾‹ : delimiter $ create procedure pro_test2() begin declare num int default 5; select num+ 10; end$ delimiter ; SET ç›´æ¥èµ‹å€¼ä½¿ç”¨ SETï¼Œå¯ä»¥èµ‹å¸¸é‡æˆ–è€…èµ‹è¡¨è¾¾å¼ï¼Œå…·ä½“è¯­æ³•å¦‚ä¸‹ï¼š SET var_name = expr [, var_name = expr] ... ç¤ºä¾‹ : DELIMITER $ CREATE PROCEDURE pro_test3() BEGIN DECLARE NAME VARCHAR(20); SET NAME = 'MYSQL'; SELECT NAME ; END$ DELIMITER ; ä¹Ÿå¯ä»¥é€šè¿‡select â€¦ into æ–¹å¼è¿›è¡Œèµ‹å€¼æ“ä½œ : DELIMITER $ CREATE PROCEDURE pro_test5() BEGIN declare countnum int; select count(*) into countnum from city; select countnum; END$ DELIMITER ; 3.6.2 ifæ¡ä»¶åˆ¤æ–­è¯­æ³•ç»“æ„ : if search_condition then statement_list [elseif search_condition then statement_list] ... [else statement_list] end if; ç¤ºä¾‹ : æ ¹æ®å®šä¹‰çš„èº«é«˜å˜é‡ï¼Œåˆ¤å®šå½“å‰èº«é«˜çš„æ‰€å±çš„èº«æç±»å‹ 180 åŠä»¥ä¸Š â€”â€”â€”-&gt; èº«æé«˜æŒ‘ 170 - 180 â€”â€”â€”&gt; æ ‡å‡†èº«æ 170 ä»¥ä¸‹ â€”â€”â€”-&gt; ä¸€èˆ¬èº«æ delimiter $ create procedure pro_test6() begin declare height int default 175; declare description varchar(50); if height >= 180 then set description = 'èº«æé«˜æŒ‘'; elseif height >= 170 and height &lt; 180 then set description = 'æ ‡å‡†èº«æ'; else set description = 'ä¸€èˆ¬èº«æ'; end if; select description ; end$ delimiter ; è°ƒç”¨ç»“æœä¸º : 3.6.3 ä¼ é€’å‚æ•°è¯­æ³•æ ¼å¼ : create procedure procedure_name([in/out/inout] å‚æ•°å å‚æ•°ç±»å‹) ... IN : è¯¥å‚æ•°å¯ä»¥ä½œä¸ºè¾“å…¥,ä¹Ÿå°±æ˜¯éœ€è¦è°ƒç”¨æ–¹ä¼ å…¥å€¼ , é»˜è®¤ OUT: è¯¥å‚æ•°ä½œä¸ºè¾“å‡º,ä¹Ÿå°±æ˜¯è¯¥å‚æ•°å¯ä»¥ä½œä¸ºè¿”å›å€¼ INOUT: æ—¢å¯ä»¥ä½œä¸ºè¾“å…¥å‚æ•°,ä¹Ÿå¯ä»¥ä½œä¸ºè¾“å‡ºå‚æ•° 1) IN - è¾“å…¥ ç¤ºä¾‹ :æ ¹æ®å®šä¹‰çš„èº«é«˜å˜é‡ï¼Œåˆ¤å®šå½“å‰èº«é«˜çš„æ‰€å±çš„èº«æç±»å‹ delimiter $ create procedure pro_test5(in height int) begin declare description varchar(50) default ''; if height >= 180 then set description='èº«æé«˜æŒ‘'; elseif height >= 170 and height &lt; 180 then set description='æ ‡å‡†èº«æ'; else set description='ä¸€èˆ¬èº«æ'; end if; select concat('èº«é«˜ ', height , 'å¯¹åº”çš„èº«æç±»å‹ä¸º:',description); end$ delimiter ; 2) OUT-è¾“å‡º ç¤ºä¾‹: æ ¹æ®ä¼ å…¥çš„èº«é«˜å˜é‡ï¼Œè·å–å½“å‰èº«é«˜çš„æ‰€å±çš„èº«æç±»å‹ create procedure pro_test5(in height int , out description varchar(100)) begin if height >= 180 then set description='èº«æé«˜æŒ‘'; elseif height >= 170 and height &lt; 180 then set description='æ ‡å‡†èº«æ'; else set description='ä¸€èˆ¬èº«æ'; end if; end$ è°ƒç”¨: call pro_test5(168, @description)$ select @description$ å°çŸ¥è¯† @description è¿™ç§å˜é‡è¦åœ¨å˜é‡åç§°å‰é¢åŠ ä¸Šâ€œ@â€ç¬¦å·ï¼Œå«åšç”¨æˆ·ä¼šè¯å˜é‡ï¼Œä»£è¡¨æ•´ä¸ªä¼šè¯è¿‡ç¨‹ä»–éƒ½æ˜¯æœ‰ä½œç”¨çš„ï¼Œè¿™ä¸ªç±»ä¼¼äºå…¨å±€å˜é‡ä¸€æ ·ã€‚ @@global.sort_buffer_size è¿™ç§åœ¨å˜é‡å‰åŠ ä¸Š â€œ@@â€ ç¬¦å·, å«åš ç³»ç»Ÿå˜é‡ 3.6.4 caseç»“æ„è¯­æ³•ç»“æ„ : æ–¹å¼ä¸€ : CASE case_value WHEN when_value THEN statement_list [WHEN when_value THEN statement_list] ... [ELSE statement_list] END CASE; æ–¹å¼äºŒ : CASE WHEN search_condition THEN statement_list [WHEN search_condition THEN statement_list] ... [ELSE statement_list] END CASE; ç¤ºä¾‹ :ç»™å®šä¸€ä¸ªæœˆä»½, ç„¶åè®¡ç®—å‡ºæ‰€åœ¨çš„å­£åº¦ delimiter $ create procedure pro_test9(month int) begin declare result varchar(20); case when month >= 1 and month &lt;=3 then set result = 'ç¬¬ä¸€å­£åº¦'; when month >= 4 and month &lt;=6 then set result = 'ç¬¬äºŒå­£åº¦'; when month >= 7 and month &lt;=9 then set result = 'ç¬¬ä¸‰å­£åº¦'; when month >= 10 and month &lt;=12 then set result = 'ç¬¬å››å­£åº¦'; end case; select concat('æ‚¨è¾“å…¥çš„æœˆä»½ä¸º :', month , ' , è¯¥æœˆä»½ä¸º : ' , result) as content ; end$ delimiter ; 3.6.5 whileå¾ªç¯è¯­æ³•ç»“æ„: while search_condition do statement_list end while; éœ€æ±‚: ç¤ºä¾‹ :è®¡ç®—ä»1åŠ åˆ°nçš„å€¼ delimiter $ create procedure pro_test8(n int) begin declare total int default 0; declare num int default 1; while num&lt;=n do set total = total + num; set num = num + 1; end while; select total; end$ delimiter ; 3.6.6 repeatç»“æ„æœ‰æ¡ä»¶çš„å¾ªç¯æ§åˆ¶è¯­å¥, å½“æ»¡è¶³æ¡ä»¶çš„æ—¶å€™é€€å‡ºå¾ªç¯ ã€‚while æ˜¯æ»¡è¶³æ¡ä»¶æ‰æ‰§è¡Œï¼Œrepeat æ˜¯æ»¡è¶³æ¡ä»¶å°±é€€å‡ºå¾ªç¯ã€‚ è¯­æ³•ç»“æ„ : REPEAT statement_list UNTIL search_condition END REPEAT; ç¤ºä¾‹ :è®¡ç®—ä»1åŠ åˆ°nçš„å€¼ delimiter $ create procedure pro_test10(n int) begin declare total int default 0; repeat set total = total + n; set n = n - 1; until n=0 end repeat; select total ; end$ delimiter ; 3.6.7 loopè¯­å¥LOOP å®ç°ç®€å•çš„å¾ªç¯ï¼Œé€€å‡ºå¾ªç¯çš„æ¡ä»¶éœ€è¦ä½¿ç”¨å…¶ä»–çš„è¯­å¥å®šä¹‰ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨ LEAVE è¯­å¥å®ç°ï¼Œå…·ä½“è¯­æ³•å¦‚ä¸‹ï¼š [begin_label:] LOOP statement_list END LOOP [end_label] å¦‚æœä¸åœ¨ statement_list ä¸­å¢åŠ é€€å‡ºå¾ªç¯çš„è¯­å¥ï¼Œé‚£ä¹ˆ LOOP è¯­å¥å¯ä»¥ç”¨æ¥å®ç°ç®€å•çš„æ­»å¾ªç¯ã€‚ 3.6.8 leaveè¯­å¥ç”¨æ¥ä»æ ‡æ³¨çš„æµç¨‹æ„é€ ä¸­é€€å‡ºï¼Œé€šå¸¸å’Œ BEGIN â€¦ END æˆ–è€…å¾ªç¯ä¸€èµ·ä½¿ç”¨ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ LOOP å’Œ LEAVE çš„ç®€å•ä¾‹å­ , é€€å‡ºå¾ªç¯ï¼š delimiter $ CREATE PROCEDURE pro_test11(n int) BEGIN declare total int default 0; ins: LOOP IF n &lt;= 0 then leave ins; END IF; set total = total + n; set n = n - 1; END LOOP ins; select total; END$ delimiter ; 3.6.9 æ¸¸æ ‡/å…‰æ ‡æ¸¸æ ‡æ˜¯ç”¨æ¥å­˜å‚¨æŸ¥è¯¢ç»“æœé›†çš„æ•°æ®ç±»å‹ , åœ¨å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°ä¸­å¯ä»¥ä½¿ç”¨å…‰æ ‡å¯¹ç»“æœé›†è¿›è¡Œå¾ªç¯çš„å¤„ç†ã€‚å…‰æ ‡çš„ä½¿ç”¨åŒ…æ‹¬å…‰æ ‡çš„å£°æ˜ã€OPENã€FETCH å’Œ CLOSEï¼Œå…¶è¯­æ³•åˆ†åˆ«å¦‚ä¸‹ã€‚ å£°æ˜å…‰æ ‡ï¼š DECLARE cursor_name CURSOR FOR select_statement ; OPEN å…‰æ ‡ï¼š OPEN cursor_name ; FETCH å…‰æ ‡ï¼š FETCH cursor_name INTO var_name [, var_name] ... CLOSE å…‰æ ‡ï¼š CLOSE cursor_name ; ç¤ºä¾‹ : åˆå§‹åŒ–è„šæœ¬: create table emp( id int(11) not null auto_increment , name varchar(50) not null comment 'å§“å', age int(11) comment 'å¹´é¾„', salary int(11) comment 'è–ªæ°´', primary key(`id`) )engine=innodb default charset=utf8 ; insert into emp(id,name,age,salary) values(null,'é‡‘æ¯›ç‹®ç‹',55,3800),(null,'ç™½çœ‰é¹°ç‹',60,4000),(null,'é’ç¿¼è ç‹',38,2800),(null,'ç´«è¡«é¾™ç‹',42,1800); -- æŸ¥è¯¢empè¡¨ä¸­æ•°æ®, å¹¶é€è¡Œè·å–è¿›è¡Œå±•ç¤º create procedure pro_test11() begin declare e_id int(11); declare e_name varchar(50); declare e_age int(11); declare e_salary int(11); declare emp_result cursor for select * from emp; open emp_result; fetch emp_result into e_id,e_name,e_age,e_salary; select concat('id=',e_id , ', name=',e_name, ', age=', e_age, ', è–ªèµ„ä¸º: ',e_salary); fetch emp_result into e_id,e_name,e_age,e_salary; select concat('id=',e_id , ', name=',e_name, ', age=', e_age, ', è–ªèµ„ä¸º: ',e_salary); fetch emp_result into e_id,e_name,e_age,e_salary; select concat('id=',e_id , ', name=',e_name, ', age=', e_age, ', è–ªèµ„ä¸º: ',e_salary); fetch emp_result into e_id,e_name,e_age,e_salary; select concat('id=',e_id , ', name=',e_name, ', age=', e_age, ', è–ªèµ„ä¸º: ',e_salary); fetch emp_result into e_id,e_name,e_age,e_salary; select concat('id=',e_id , ', name=',e_name, ', age=', e_age, ', è–ªèµ„ä¸º: ',e_salary); close emp_result; end$ é€šè¿‡å¾ªç¯ç»“æ„ , è·å–æ¸¸æ ‡ä¸­çš„æ•°æ® : DELIMITER $ create procedure pro_test12() begin DECLARE id int(11); DECLARE name varchar(50); DECLARE age int(11); DECLARE salary int(11); DECLARE has_data int default 1; DECLARE emp_result CURSOR FOR select * from emp; DECLARE EXIT HANDLER FOR NOT FOUND set has_data = 0; open emp_result; repeat fetch emp_result into id , name , age , salary; select concat('idä¸º',id, ', name ä¸º' ,name , ', ageä¸º ' ,age , ', è–ªæ°´ä¸º: ', salary); until has_data = 0 end repeat; close emp_result; end$ DELIMITER ; 3.7 å­˜å‚¨å‡½æ•°è¯­æ³•ç»“æ„: CREATE FUNCTION function_name([param type ... ]) RETURNS type BEGIN ... END; ç¤ºä¾‹ : å®šä¹‰ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹, è¯·æ±‚æ»¡è¶³æ¡ä»¶çš„æ€»è®°å½•æ•° ; delimiter $ create function count_city(countryId int) returns int begin declare cnum int ; select count(*) into cnum from city where country_id = countryId; return cnum; end$ delimiter ; è°ƒç”¨: select count_city(1); select count_city(2); 4. è§¦å‘å™¨4.1 ä»‹ç»è§¦å‘å™¨æ˜¯ä¸è¡¨æœ‰å…³çš„æ•°æ®åº“å¯¹è±¡ï¼ŒæŒ‡åœ¨ insert/update/delete ä¹‹å‰æˆ–ä¹‹åï¼Œè§¦å‘å¹¶æ‰§è¡Œè§¦å‘å™¨ä¸­å®šä¹‰çš„SQLè¯­å¥é›†åˆã€‚è§¦å‘å™¨çš„è¿™ç§ç‰¹æ€§å¯ä»¥ååŠ©åº”ç”¨åœ¨æ•°æ®åº“ç«¯ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ , æ—¥å¿—è®°å½• , æ•°æ®æ ¡éªŒç­‰æ“ä½œ ã€‚ ä½¿ç”¨åˆ«å OLD å’Œ NEW æ¥å¼•ç”¨è§¦å‘å™¨ä¸­å‘ç”Ÿå˜åŒ–çš„è®°å½•å†…å®¹ï¼Œè¿™ä¸å…¶ä»–çš„æ•°æ®åº“æ˜¯ç›¸ä¼¼çš„ã€‚ç°åœ¨è§¦å‘å™¨è¿˜åªæ”¯æŒè¡Œçº§è§¦å‘ï¼Œä¸æ”¯æŒè¯­å¥çº§è§¦å‘ã€‚ è§¦å‘å™¨ç±»å‹ NEW å’Œ OLDçš„ä½¿ç”¨ INSERT å‹è§¦å‘å™¨ NEW è¡¨ç¤ºå°†è¦æˆ–è€…å·²ç»æ–°å¢çš„æ•°æ® UPDATE å‹è§¦å‘å™¨ OLD è¡¨ç¤ºä¿®æ”¹ä¹‹å‰çš„æ•°æ® , NEW è¡¨ç¤ºå°†è¦æˆ–å·²ç»ä¿®æ”¹åçš„æ•°æ® DELETE å‹è§¦å‘å™¨ OLD è¡¨ç¤ºå°†è¦æˆ–è€…å·²ç»åˆ é™¤çš„æ•°æ® 4.2 åˆ›å»ºè§¦å‘å™¨è¯­æ³•ç»“æ„ : create trigger trigger_name before/after insert/update/delete on tbl_name [ for each row ] -- è¡Œçº§è§¦å‘å™¨ begin trigger_stmt ; end; ç¤ºä¾‹ é€šè¿‡è§¦å‘å™¨è®°å½• emp è¡¨çš„æ•°æ®å˜æ›´æ—¥å¿— , åŒ…å«å¢åŠ , ä¿®æ”¹ , åˆ é™¤ ; 1) é¦–å…ˆåˆ›å»ºä¸€å¼ æ—¥å¿—è¡¨ : create table emp_logs( id int(11) not null auto_increment, operation varchar(20) not null comment 'æ“ä½œç±»å‹, insert/update/delete', operate_time datetime not null comment 'æ“ä½œæ—¶é—´', operate_id int(11) not null comment 'æ“ä½œè¡¨çš„ID', operate_params varchar(500) comment 'æ“ä½œå‚æ•°', primary key(`id`) )engine=innodb default charset=utf8; 2) åˆ›å»º insert å‹è§¦å‘å™¨ï¼Œå®Œæˆæ’å…¥æ•°æ®æ—¶çš„æ—¥å¿—è®°å½• : DELIMITER $ create trigger emp_logs_insert_trigger after insert on emp for each row begin insert into emp_logs (id,operation,operate_time,operate_id,operate_params) values(null,'insert',now(),new.id,concat('æ’å…¥å(id:',new.id,', name:',new.name,', age:',new.age,', salary:',new.salary,')')); end $ DELIMITER ; 3) åˆ›å»º update å‹è§¦å‘å™¨ï¼Œå®Œæˆæ›´æ–°æ•°æ®æ—¶çš„æ—¥å¿—è®°å½• : DELIMITER $ create trigger emp_logs_update_trigger after update on emp for each row begin insert into emp_logs (id,operation,operate_time,operate_id,operate_params) values(null,'update',now(),new.id,concat('ä¿®æ”¹å‰(id:',old.id,', name:',old.name,', age:',old.age,', salary:',old.salary,') , ä¿®æ”¹å(id',new.id, 'name:',new.name,', age:',new.age,', salary:',new.salary,')')); end $ DELIMITER ; 4) åˆ›å»ºdelete è¡Œçš„è§¦å‘å™¨ , å®Œæˆåˆ é™¤æ•°æ®æ—¶çš„æ—¥å¿—è®°å½• : DELIMITER $ create trigger emp_logs_delete_trigger after delete on emp for each row begin insert into emp_logs (id,operation,operate_time,operate_id,operate_params) values(null,'delete',now(),old.id,concat('åˆ é™¤å‰(id:',old.id,', name:',old.name,', age:',old.age,', salary:',old.salary,')')); end $ DELIMITER ; 5)æµ‹è¯•ï¼š insert into emp(id,name,age,salary) values(null, 'å…‰æ˜å·¦ä½¿',30,3500); insert into emp(id,name,age,salary) values(null, 'å…‰æ˜å³ä½¿',33,3200); update emp set age = 39 where id = 3; delete from emp where id = 5; 4.3 åˆ é™¤è§¦å‘å™¨è¯­æ³•ç»“æ„ : drop trigger [schema_name.]trigger_name å¦‚æœæ²¡æœ‰æŒ‡å®š schema_nameï¼Œé»˜è®¤ä¸ºå½“å‰æ•°æ®åº“ ã€‚ 4.4 æŸ¥çœ‹è§¦å‘å™¨å¯ä»¥é€šè¿‡æ‰§è¡Œ SHOW TRIGGERS å‘½ä»¤æŸ¥çœ‹è§¦å‘å™¨çš„çŠ¶æ€ã€è¯­æ³•ç­‰ä¿¡æ¯ã€‚ è¯­æ³•ç»“æ„ ï¼š show triggers; document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQLæ•°æ®åº“ä¼˜åŒ–ä¹‹ç»„åˆæ‹³(ä¸€)</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å­¦ä¹ æŒ‡å—]]></title>
    <url>%2F2021%2F01%2F12%2Fstudy-guide%2F</url>
    <content type="text"><![CDATA[å­¦ä¹ æœ¬èº«æ¯”å­¦ä¹ å†…å®¹æ›´é‡è¦ ä»»åŠ¡å¼å­¦ä¹ ï¼š1.å®¶åº­2.å·¥ä½œ3.æˆé•¿ ä¸€ã€å¯»æ‰¾å­¦ä¹ èµ„æº1.1 æœç´¢ç½‘ç«™ã€å…¬ä¼—å· 1.2 ä¸“ä¸šå¹³å°å·¥å…·1.3 è·Ÿäººå­¦â€‹ä¸‰çº§å¯¼å¸ˆåˆ¶ï¼šå…¥é—¨ã€è¿›åœˆã€æ‹œä½› å…¥é—¨ï¼šç¬¬ä¸€çº§å¯¼å¸ˆ-ä»»æ„å¹²è¿™è¡Œçš„äººï¼ˆè¯¢é—®ç‰›äººï¼ˆå…³æ³¨ä»–ä»¬ï¼Œæ•£å°„ä»–ä»¬çš„å…³æ³¨ï¼‰ã€ä¹¦ï¼‰â€‹è¿›åœˆï¼šæœºä¼šâ€‹æ‹œä½›ï¼šæ¥è§¦ï¼šå¥½é—®é¢˜ å¥½é—®é¢˜ï¼š 1.è¯·é—®åœ¨åƒæ‚¨è¿™æ ·çš„ä¸“å®¶å¿ƒç›®ä¸­ï¼Œæ‚¨è¿™ä¸ªé¢†åŸŸå…¬è®¤çš„å¤§ç¥æ˜¯è°ï¼Ÿ 2.æˆ‘ç‰¹åˆ«é—æ†¾ï¼Œæˆ‘ä¸€ç›´æ²¡æœ‰æœºä¼šç³»ç»Ÿåœ°å»å­¦ï¼Œæ‚¨è¿™ä¸ªé¢†åŸŸçš„çŸ¥è¯†ã€‚æˆ‘å››åå¤šå²äº†ï¼Œæƒ³ä»ç°åœ¨å¼€å§‹å­¦èµ·ï¼Œé‚£åœ¨å…¥é—¨é˜¶æ®µï¼Œæ‚¨æ¨èæˆ‘è¯»å“ªæœ¬ä¹¦ï¼Ÿ 3.è€å¸ˆï¼Œæˆ‘æƒ³åœ¨å¤§å­¦æ¯•ä¸šä¹‹åä»äº‹æŠ•èµ„å·¥ä½œã€‚æ‚¨æ˜¯åšæŠ•èµ„çš„ï¼Œæ‚¨è§‰å¾—ä»äº‹è¿™ä¸€è¡Œä¸šåŸºæœ¬èƒ½åŠ›çš„è¦æ±‚æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘åº”è¯¥ä»å“ªå¼€å§‹ä½œå‡†å¤‡ï¼Ÿ 4.è€å¸ˆï¼Œä»äº‹è¿™ä¸ªè¡Œä¸šï¼Œæ‚¨è§‰å¾—æœ€å…³é”®çš„ç¯èŠ‚æœ‰å“ªäº›ï¼Ÿæ‚¨éƒ½é‡åˆ°è¿‡å“ªå‡ ä¸ªé‡è¦æŒ‘æˆ˜ï¼Ÿæ‚¨æ˜¯æ€ä¹ˆè¿‡æ¥çš„ï¼Ÿ 5.åœ¨æ‚¨è¿™ä¸ªé¢†åŸŸï¼Œæ‚¨è§‰å¾—ä¸€èˆ¬äººå’Œé«˜æ‰‹ä¹‹é—´æœ€å¤§çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ 6.å¦‚æœæ‚¨è¦å¸¦ä¸€ä¸ªå¾’å¼Ÿï¼Œæ‚¨ä¼šé‡ç‚¹æ•™ä»–å…³æ³¨å“ªå‡ ä¸ªé­”é¬¼ç»†èŠ‚ï¼Ÿä¸ºä»€ä¹ˆæ˜¯è¿™å‡ ä¸ªç»†èŠ‚ç‰¹åˆ«é‡è¦ï¼Ÿ 7.è€å¸ˆï¼Œæœ€è¿‘å¥½é•¿æ—¶é—´æ²¡è§äº†ï¼Œæœ€è¿‘åŠå¹´æ‚¨è§‰å¾—æœ‰ä»€ä¹ˆé—®é¢˜ã€ä»€ä¹ˆæ–°é—»æˆ–è€…å“ªæœ¬ä¹¦ï¼Œæ˜¯å¯¹æ‚¨è§¦åŠ¨ç‰¹åˆ«å¤§çš„å—ï¼Ÿ è¿™ä¸ªé—®é¢˜ï¼Œæ˜¯æˆ‘è‡ªå·±å¾ˆå–œæ¬¢é—®çš„ä¸€ä¸ªé—®é¢˜ã€‚é¦–å…ˆï¼Œè¿™ä¸ªé—®é¢˜å¾ˆè½»ï¼Œå¯¹æ–¹å®¹æ˜“å›ç­”ã€‚ä½†æ˜¯åœ¨ä»–çš„å›ç­”å½“ä¸­ï¼Œæˆ‘ä»¬åˆèƒ½æ”¶é›†åˆ°å¾ˆå¤šæƒ³æ³•ï¼Œæ”¶è·å¾ˆå¤§ã€‚åœ¨é—²è°ˆçš„æ—¶å€™ï¼Œæœ€é€‚åˆé—®è¿™æ ·çš„é—®é¢˜ã€‚ 8.æœ€è¿‘ä½ ä»¬è¡Œä¸šå‘ç”Ÿäº†ä¸€ä»¶XXXå¤§äº‹ï¼Œæ‚¨èƒ½å¸®æˆ‘åˆ†æåˆ†æï¼Œè¿™èƒŒååˆ°åº•æ˜¯æ€ä¹ˆå›äº‹å—ï¼Ÿ 9.è€å¸ˆï¼Œæˆ‘ç°åœ¨æ­¤æ—¶æ­¤åˆ»å·²ç»åœ¨åšä¸€ä»¶ä»€ä¹ˆäº‹ã€‚è¿™ä¸ªäº‹ï¼Œæˆ‘æœ‰ä¸ªéš¾ç‚¹ä¸€ç›´æ²¡æƒ³æ˜ç™½ï¼Œèƒ½ä¸èƒ½è¯·æ‚¨ç»™æˆ‘æŒ‡ç‚¹ä¸€ä¸‹ï¼Ÿ 10.å‡å¦‚ï¼Œæ­¤åˆ»æ˜¯ä½ ç”Ÿå‘½çš„æœ€åååˆ†é’Ÿã€‚ä½ æœ‰ä¸ªæœºä¼šï¼Œå¯ä»¥ç»™è¿™ä¸ªä¸–ç•Œç•™ä¸‹ä¸€æ®µè¯ï¼Œè¯´è¯´ä½ è‡ªå·±è¿™ä¸ªä¸“ä¸šã€‚è¯·é—®ä½ ä¼šè¯´ä»€ä¹ˆï¼Ÿ äºŒã€å®šç›®æ ‡2.1 æœ‰åœºæ™¯ï¼š2.2 æœ‰è·ç¦»ï¼šç›®æ ‡å’Œç°çŠ¶æœ‰å·®è·ï¼Œè·³ä¸€è·³æ‰èƒ½å¤Ÿå¾—ç€ï¼Œ2.3 æœ‰æŠ“æ‰‹ï¼šè·ç¦»å¾—åˆé€‚,å…·ä½“å¯å…¥æ‰‹çš„åœ°æ–¹2.3.1 å¼€å§‹ç»“æŸæ—¶é—´â€‹2.3.2 å…·ä½“çš„æ‰§è¡ŒåŠ¨ä½œâ€‹2.3.3 æ‰§è¡ŒåŠ¨ä½œçš„æ•°é‡â€‹2.3.4 åŠ¨ä½œçš„å®Œæˆåº¦ 2.4 æœ‰é˜¶æ¢¯ï¼šæ‹’ç»å¹³å‡ç”¨åŠ›ä»æ˜“åˆ°éš¾æ’åºï¼Œå…ˆé€‰æœ€æ˜“çš„å¤„ç†ï¼ˆå°æ­¥å­åŸç†,å…ˆæ‘˜å¥½æ‘˜çš„æœå­ï¼‰ ä¸‰ã€æé«˜æ•ˆç‡3.1 äº”é˜¶å­¦ä¹ æ³•3.1.1 æµ‹è¯•æ³•ï¼ˆè®¾è®¡å­¦ä¹ ä»»åŠ¡ï¼‰3.1.2 æŒ‡è¯»æ³•3.1.3 å¤šç¯å¢ƒè¾“å…¥æ³•ï¼ˆçœ‹å¬ï¼‰3.1.4 è®°å¿†å®«æ®¿ï¼ˆæŠ—é—å¿˜ï¼‰3.1.5 åˆ·ä¹¦ï¼ˆä¸è¯»ç»†,è¯»å¹¿,è§†é‡ï¼‰ åºè¨€ï¼Œå¼€å¤´ï¼Œå€’æ•°ç¬¬äºŒç«  å±…é«˜ä¸´ä¸‹å…³æ³¨ï¼ˆæŒ‘æˆ˜ï¼Œä»»åŠ¡æ¸…å•ï¼‰ å››ã€è¾“å‡ºå€’é€¼è¾“å…¥4.1 è®°ç¬”è®°ï¼ˆä¸¤è½®ç¬”è®°æ³•ï¼‰â€‹ 1è½®ï¼ˆæ‰‹å†™ï¼‰ï¼šå®é™…è¾“å…¥çš„ï¼ˆå…³é”®è¯è®°å½•ï¼‰ | å½“æ—¶çš„æƒ³æ³•æ„Ÿå—ï¼ˆè®¯é£è¯­è®°ï¼‰â€‹ 2è½® é‡æ–°ç”¨è‡ªå·±çš„é€»è¾‘å†™å‡ºæ¥ 4.2 è®²å‡ºæ¥ 10å²-å…·è±¡èƒ½æ‡‚ï¼ŒæŠ½è±¡ä¸æ‡‚ 4.3 è¿ç§»ï¼šè§¦ç±»æ—é€šâ€‹ 4.3.1 èƒ½ç”¨çš„åœºæ™¯â€‹ 4.3.2 ä¸èƒ½ç”¨çš„åœºæ™¯ 4.4 å¤¯å®ï¼Œæ‹‰å‡ºæ“ä½œæ¸…å• ï¼šæ¸…å•ä½“ï¼ˆè¿­ä»£æ¸…å•1.0-&gt;2.0-&gt;3.0-&gt; â€¦ï¼‰äº”ã€æ­£åé¦ˆï¼ˆè‡ªé©±åŠ›ï¼‰-æƒ³æ–¹è®¾æ³•5.1 è®°ç¬”è®°ï¼Œå°æœ¬è®°5.2 å…¬å¼€å¹³å°ï¼Œå®šæœŸå‘è¡¨è‡ªå·±çš„æˆæœ5.3 ç¯å¢ƒåœºï¼ˆç»“ç•Œï¼‰5.4 æƒŠå¥‡æ—¥è®°ï¼ˆæ¯æ—¥ä¸€å¥è¯ï¼‰ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>æ‰‹å†Œ</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaè®¾è®¡æ¨¡å¼]]></title>
    <url>%2F2021%2F01%2F05%2Fdesign-pattern%2F</url>
    <content type="text"><![CDATA[æ¦‚è¿°ï¼š æœ¬è´¨ï¼šé¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™çš„å®é™…è¿ç”¨ï¼Œæ˜¯å¯¹ç±»çš„å°è£…ã€ç»§æ‰¿å’Œå¤šæ€æ€§ä»¥åŠç±»çš„å…³è”å…³ç³»å’Œç»„åˆå…³ç³»çš„å……åˆ†ç†è§£ã€‚ åˆ†ç±»: 1. åˆ›å»ºå‹æ¨¡å¼ï¼šå…±5ç§ï¼Œç”¨äºæè¿°â€œæ€æ ·åˆ›å»ºå¯¹è±¡â€ï¼Œä¸»è¦ç‰¹ç‚¹æ˜¯â€œå°†å¯¹è±¡çš„åˆ›å»ºä¸ä½¿ç”¨åˆ†ç¦»â€(è§£è€¦)ã€‚å®¢æˆ·ç¨‹åºä»…ä»…éœ€è¦å»ä½¿ç”¨å¯¹è±¡ï¼Œè€Œä¸å†å…³å¿ƒåˆ›å»ºå¯¹è±¡è¿‡ç¨‹ä¸­çš„é€»è¾‘ã€‚ 2. ç»“æ„å‹æ¨¡å¼ï¼šå…±7ç§ï¼Œç”¨äºæè¿°å¦‚ä½•å°†ç±»æˆ–å¯¹è±¡æŒ‰æŸç§å¸ƒå±€ç»„æˆæ›´å¤§çš„ç»“æ„ã€‚ 3. è¡Œä¸ºå‹æ¨¡å¼ï¼šå…±11ç§ï¼Œç”¨äºæè¿°ç±»æˆ–å¯¹è±¡ä¹‹é—´æ€æ ·ç›¸äº’åä½œå…±åŒå®Œæˆå•ä¸ªå¯¹è±¡æ— æ³•å•ç‹¬å®Œæˆçš„ä»»åŠ¡ï¼Œä»¥åŠæ€æ ·åˆ†é…èŒè´£ã€‚ ä¸€ã€6å¤§è®¾è®¡åŸåˆ™1. å•ä¸€èŒè´£åŸåˆ™ (SRP)è‹±æ–‡ï¼šSingle Responsibility Principle å®šä¹‰ï¼šæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªåŸå› å¼•èµ·ç±»çš„å˜æ›´ ä¼˜ç‚¹ï¼š â€‹ 1.ç±»çš„å¤æ‚æ€§é™ä½ â€‹ 2.å¯è¯»æ€§æé«˜ â€‹ 3.å¯ç»´æŠ¤æ€§æé«˜ â€‹ 4.å˜æ›´å¼•èµ·çš„é£é™©é™ä½ éš¾ç‚¹ï¼šèŒè´£ç•Œé™çš„åˆ’åˆ† é€‚ç”¨èŒƒå›´ï¼šæ¥å£(ä¸€å®š)ã€ç±»(å°½é‡)ã€æ–¹æ³•(å°½å¯èƒ½) 2. é‡Œå¼æ›¿æ¢åŸåˆ™ (LSP)è‹±æ–‡ï¼šLiskov Substitution Principle å®šä¹‰ï¼š â€‹ å®šä¹‰1ï¼šå¦‚æœå¯¹æ¯ä¸€ä¸ªç±»å‹ä¸ºSçš„å¯¹è±¡o1,éƒ½æœ‰ç±»å‹ä¸ºTçš„å¯¹è±¡o2ï¼Œä½¿å¾—ä»¥Tå®šä¹‰çš„æ‰€æœ‰ç¨‹åºPåœ¨æ‰€æœ‰çš„å¯¹è±¡o1éƒ½ä»£æ¢æˆo2æ—¶,ç¨‹åºPçš„è¡Œä¸ºæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆç±»å‹Sæ˜¯ç±»å‹Tçš„å­ç±»å‹ã€‚ â€‹ å®šä¹‰2ï¼šæ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹å¿…é¡»èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡ã€‚ â€‹ é€šä¿—è§£é‡Šï¼šçˆ¶ç±»å‡ºç°çš„åœ°æ–¹,å­ç±»èƒ½å®Œç¾æ›¿æ¢çˆ¶ç±»,ä¸”ä¸ä¼šäº§ç”Ÿä»»ä½•é”™è¯¯å’Œå¼‚å¸¸;åä¹‹,å­ç±»å‡ºç°çš„åœ°æ–¹,çˆ¶ç±»æœªå¿…èƒ½é€‚åº”ã€‚ å®šä¹‰æ‹†è§£ï¼š â€‹ 4å±‚å«ä¹‰ï¼š â€‹ 1.å­ç±»å¿…é¡»å®Œå…¨å®ç°çˆ¶ç±»çš„æ–¹æ³• â€‹ 2.å­ç±»å¯ä»¥æœ‰è‡ªå·±çš„ä¸ªæ€§ â€‹ 3.[å¥‘çº¦è®¾è®¡]è¦†ç›–æˆ–å®ç°çˆ¶ç±»çš„æ–¹æ³•æ—¶è¾“å…¥å‚æ•°ï¼Œè¦ä¹ˆä¸€æ ·ï¼ˆè¦†å†™ï¼‰ï¼Œè¦ä¹ˆå¯ä»¥è¢«æ”¾å¤§ï¼ˆé‡è½½ï¼‰ â€‹ 4.è¦†å†™æˆ–å®ç°çˆ¶ç±»çš„æ–¹æ³•æ—¶è¾“å‡ºç»“æœï¼ˆè¿”å›ç±»å‹ï¼‰å¯ä»¥è¢«ç¼©å° ä¼˜ç‚¹ï¼šå¢å¼ºç¨‹åºçš„å¥å£®æ€§ åº”ç”¨ï¼šç‰ˆæœ¬å‡çº§(å¾…å®è·µ) æœ€ä½³å®è·µï¼šåœ¨é¡¹ç›®ä¸­,é‡‡ç”¨LSPæ—¶ï¼Œå°½é‡é¿å…å­ç±»çš„â€œä¸ªæ€§â€ï¼Œä¸€æ—¦å­ç±»æœ‰â€œä¸ªæ€§â€ï¼Œè¿™ä¸ªå­ç±»å’Œçˆ¶ç±»ä¹‹é—´çš„å…³ç³»å°±å¾ˆéš¾è°ƒå’Œäº†ï¼ŒæŠŠå­ç±»å½“åšçˆ¶ç±»ä½¿ç”¨ï¼Œå­ç±»çš„â€œä¸ªæ€§â€è¢«æŠ¹æ€â€“å§”å±ˆäº†ç‚¹ï¼›æŠŠå­ç±»å•ç‹¬ä½œä¸ºä¸€ä¸ªä¸šåŠ¡æ¥ä½¿ç”¨ï¼Œåˆ™ä¼šè®©ä»£ç é—´çš„è€¦åˆå…³ç³»å˜çš„æ‰‘æœ”è¿·ç¦»â€“ç¼ºä¹æ›¿æ¢çš„æ ‡å‡†ã€‚ 3. ä¾èµ–å¯¼è‡´åŸåˆ™ (DIP)è‹±æ–‡ï¼šDependence Inversion Principle å®šä¹‰ï¼šHigh level modules should not depend upon low level modules. Both should depend upon abstractions. Abstractions should not depend upon details. Details should depend upon abstractions. å®šä¹‰æ‹†è§£ï¼š â€‹ 1.é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–åº•å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ â€‹ 2.æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ ä¼˜ç‚¹ï¼šå‡å°‘ç±»é—´çš„è€¦åˆæ€§ï¼Œæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œé™ä½å¹¶è¡Œå¼€å‘å¼•èµ·çš„é£é™©ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ ä¾èµ–ä¸‰ç§å†™æ³•ï¼š â€‹ 1.æ„é€ å‡½æ•°ä¼ é€’ä¾èµ–å¯¹è±¡ â€‹ 2.Setteræ–¹æ³•ä¼ é€’ä¾èµ–å¯¹è±¡ â€‹ 3.æ¥å£å£°æ˜ä¾èµ–å¯¹è±¡ æœ¬è´¨ï¼š â€‹ éµå¾ªè§„åˆ™ï¼š â€‹ 1.åŸºæœ¬è¦æ±‚ï¼šé€šè¿‡æŠ½è±¡(æ¥å£æˆ–æŠ½è±¡ç±»),ä½¿å„ç±»æˆ–æ¨¡å—çš„å®ç°å½¼æ­¤ç‹¬ç«‹,ä¸ç›¸ç›¸äº’å½±å“,å®ç°æ¨¡å—é—´çš„æ¾è€¦åˆã€‚ â€‹ 2.å˜é‡çš„è¡¨é¢ç±»å‹å°½é‡æ˜¯æ¥å£æˆ–è€…æ˜¯æŠ½è±¡ç±»ï¼šä¸€ä¸ªå˜é‡å¯ä»¥æœ‰ä¸¤ç§ç±»å‹ï¼šè¡¨é¢ç±»å‹å’Œå®é™…ç±»å‹ï¼Œè¡¨é¢ç±»å‹æ˜¯åœ¨å®šä¹‰çš„æ—¶å€™èµ‹äºˆçš„ç±»å‹ï¼Œå®é™…ç±»å‹æ˜¯å¯¹è±¡çš„ç±»å‹ã€‚ â€‹ 3.ä»»ä½•ç±»éƒ½ä¸åº”è¯¥ä»å…·ä½“ç±»æ´¾ç”Ÿ â€‹ 4.å°½é‡ä¸è¦è¦†å†™åŸºç±»çš„æ–¹æ³• â€‹ 5.ç»“åˆé‡Œæ°æ›¿æ¢åŸåˆ™ä½¿ç”¨ â€‹ æ ¸å¿ƒï¼šâ€œé¢å‘æ¥å£ç¼–ç¨‹â€ 4. æ¥å£éš”ç¦»åŸåˆ™ (ISP)è‹±æ–‡: Interface Segregation Principle å®šä¹‰ï¼š â€‹ å®šä¹‰1ï¼šå®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ â€‹ å®šä¹‰2ï¼šç±»é—´çš„ä¾èµ–å…³ç³»åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Š â€‹ é€šä¿—è§£é‡Šï¼šå»ºç«‹å•ä¸€æ¥å£ï¼Œä¸è¦è‡ƒè‚¿è‚¥å¤§çš„æ¥å£ã€‚æ¥å£å°½é‡ç»†åŒ–ï¼Œæ¥å£ä¸­çš„æ–¹æ³•å°½é‡å°‘ã€‚ åŒºåˆ†ï¼šå•ä¸€èŒè´£åŸåˆ™(SRP) å’Œ æ¥å£éš”ç¦»åŸåˆ™(ISP)çš„åŒºåˆ«ï¼ŒSRPå¼ºè°ƒå•ä¸€èŒè´£ï¼Œè¦æ±‚ç±»å’ŒèŒè´£å•ä¸€ï¼Œæ³¨é‡èŒè´£ï¼Œè¿™æ˜¯é€»è¾‘ä¸šåŠ¡ä¸Šåˆ’åˆ†ï¼Œè€ŒISPè¦æ±‚æ¥å£çš„æ–¹æ³•å°½é‡å°‘ã€‚ è§„èŒƒæ‹†è§£ï¼š â€‹ 1.æ¥å£å°½é‡å°ï¼šâ€œå°â€æœ‰é™åº¦ï¼Œå¿…é¡» æ»¡è¶³å•ä¸€èŒè´£ (SRP) â€‹ 2.æ¥å£è¦é«˜å†…èšï¼šé«˜å†…èšå°±æ˜¯æé«˜æ¥å£ã€ç±»ã€æ¨¡å—çš„å¤„ç†èƒ½åŠ›ï¼Œå‡å°‘å¯¹å¤–çš„äº¤äº’ã€‚æ¥å£ä¸­å°½é‡å°‘å…¬å¸ƒpublicæ–¹æ³•ï¼Œæ¥å£çš„å¯¹å¤–çš„æ‰¿è¯ºè¶Šå°‘å¯¹ç³»ç»Ÿçš„å¼€å‘è¶Šæœ‰åˆ©ï¼Œå˜æ›´çš„é£é™©å°±è¶Šå°‘ï¼ŒåŒæ—¶ä¹Ÿæœ‰åˆ©äºé™ä½æˆæœ¬ã€‚ â€‹ 3.å®šåˆ¶æœåŠ¡ï¼šå•ç‹¬ä¸ºä¸€ä¸ªä¸ªä½“ä½“ç”¨ä¼˜è‰¯çš„æœåŠ¡ã€‚åªæä¾›è®¿é—®è€…éœ€è¦çš„æ–¹æ³•ã€‚ â€‹ 4.æ¥å£è®¾è®¡æ˜¯ç”±é™åº¦çš„:æ¥å£è®¾è®¡ç²’åº¦è¶Šå°è¶Šçµæ´»ï¼Œçµæ´»å¸¦æ¥äº†æ¥å£å¤æ‚åŒ–ï¼Œå¼€å‘éš¾åº¦å¢åŠ ï¼Œå¯ç»´æŠ¤æ€§é™ä½ã€‚æŠŠæ¡å¥½â€œåº¦â€ã€‚ 5. è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆLKP/LoDï¼‰è‹±æ–‡ï¼šLaw of Demeter ä¹Ÿç§° Least Knowledge Principle å…³é”®è¯ï¼šé«˜å†…èšã€ä½è€¦åˆ å®šä¹‰ï¼šä¸€ä¸ªå¯¹è±¡åº”è¯¥å¯¹å…¶ä»–å¯¹è±¡æœ‰æœ€å°‘çš„äº†è§£ã€‚ â€‹ é€šä¿—è§£é‡Šï¼šä¸€ä¸ªç±»åº”è¯¥å¯¹è‡ªå·±éœ€è¦è€¦åˆæˆ–è€…è°ƒç”¨çš„ç±»çŸ¥é“å¾—è¶Šå°‘(å³è§£è€¦ã€å¼±è€¦) å®šä¹‰æ‹†è§£ï¼š â€‹ 4å±‚å«ä¹‰ï¼š â€‹ 1.åªä¸ç›´æ¥çš„æœ‹å‹é€šä¿¡ ï¼Œæœ‹å‹ç±»ï¼šå‡ºç°åœ¨æˆå‘˜å˜é‡ã€æ–¹æ³•çš„è¾“å…¥è¾“å‡ºå‚æ•°ä¸­çš„ç±»ç§°ä¸ºæˆå‘˜æœ‹å‹ç±»ï¼Œè€Œå‡ºç°åœ¨æ–¹æ³•ä½“å†…éƒ¨çš„ç±»ä¸å±äºæœ‹å‹ç±» â€‹ 2.æœ‹å‹é—´æ˜¯æœ‰è·ç¦»çš„ï¼šå°½é‡ä¸è¦å¯¹å¤–å…¬å¸ƒå¤ªå¤šçš„publicæ–¹æ³•å’Œéé™æ€çš„publicå˜é‡ï¼Œå°½é‡å†…æ•›ï¼Œå¤šä½¿ç”¨privateã€package-privateã€protectç­‰è®¿é—®æƒé™ â€‹ 3.æ˜¯è‡ªå·±çš„å°±æ˜¯è‡ªå·±çš„ï¼šå¦‚æœä¸€ä¸ªæ–¹æ³•æ”¾åœ¨æœ¬ç±»ä¸­ï¼Œå³ä¸å¢åŠ ç±»é—´å…³ç³»ï¼Œä¹Ÿå¯¹æœ¬ç±»ä¸äº§ç”Ÿè´Ÿé¢å½±å“ï¼Œé‚£å°±æ”¾ç½®åœ¨æœ¬ç±»ä¸­ã€‚ â€‹ 4.è°¨æ…ä½¿ç”¨Serializable æœ€ä½³å®è·µï¼šä¸€ä¸ªç±»è·³è½¬ä¸¤æ¬¡ä»¥ä¸Šæ‰èƒ½è®¿é—®åˆ°å¦ä¸€ä¸ªç±»ï¼Œå°±éœ€è¦æƒ³åŠæ³•è¿›è¡Œé‡æ„ 6. å¼€é—­åŸåˆ™ï¼ˆOCPï¼‰è‹±æ–‡ï¼šOpen Closed Principle å®šä¹‰ï¼šä¸€ä¸ªè½¯ä»¶å®ä½“å¦‚ç±»ã€æ¨¡å—å’Œå‡½æ•°åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ äºŒã€23ç§è®¾è®¡æ¨¡å¼ï¼ˆ5ï¼‰1. åˆ›å»ºå‹æ¨¡å¼1.1. ç®€å•å·¥å‚æ¨¡å¼ï¼ˆSFPï¼‰è‹±æ–‡ï¼šSimple Factory Pattern å®šä¹‰ï¼šç”±ä¸€ä¸ªå·¥å‚å¯¹è±¡å†³å®šåˆ›å»ºå‡ºå“ªä¸€ç§ç±»å‹å®ä¾‹ã€‚å®¢æˆ·ç«¯åªéœ€ä¼ å…¥å·¥å‚ç±»çš„å‚æ•°ï¼Œæ— éœ€å…³å¿ƒåˆ›å»ºè¿‡ç¨‹ã€‚ ä¼˜ç‚¹ï¼šå…·ä½“äº§å“ä»å®¢æˆ·ç«¯ä»£ç ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œè§£è€¦ã€‚ ç¼ºç‚¹ï¼šå·¥å‚ç±»èŒè´£è¿‡é‡ï¼Œå¢åŠ æ–°çš„ç±»å‹æ—¶ï¼Œå¾—ä¿®æ”¹å·¥å‚ç±»çš„ä»£ç ï¼Œè¿èƒŒOCPã€‚ æœ€ä½³å®è·µï¼šä¸¥æ ¼æ„ä¹‰æ¥è¯´ï¼ŒSFPä¸å±äºè®¾è®¡æ¨¡å¼çš„ä¸€ç§ ä¸¾ä¾‹ï¼šç®€å•å·¥å‚æ¨¡å¼-ç³–æœç”Ÿäº§ åˆ›å»ºç³–æœæŠ½è±¡ç±» public abstract class Candy { public abstract void eat(); } åˆ›å»ºæŠ½è±¡ç³–æœå®ç°ç±»-å·§å…‹åŠ›ç­‰ public class Chocolate extends Candy{ @Override public void eat() { System.out.println("eat chocolate ing..."); } } åˆ›å»ºç³–æœå·¥å‚ç±» public class CandyFactory { public Candy product(String candyName){ if("chocolate".equalsIgnoreCase(candyName)){ return new Chocolate(); }else{ return null; } } } æµ‹è¯• public class SfpTest { public static void main(String[] args) { CandyFactory candyFactory = new CandyFactory(); Candy chocolate = candyFactory.product("chocolate"); chocolate.eat(); } } è¾“å‡º eat chocolate ing... 1.2. å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFMPï¼‰è‹±æ–‡ï¼šFactory Method Pattern å®šä¹‰ï¼šå®šä¹‰åˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å®ç°è¿™ä¸ªæ¥å£çš„ç±»æ¥å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»ï¼Œå·¥å‚æ–¹æ³•è®©ç±»çš„å®ä¾‹åŒ–æ¨è¿Ÿåˆ°å­ç±»è¿›è¡Œã€‚ ä¼˜ç‚¹ï¼š å…·ä½“äº§å“ä»å®¢æˆ·ç«¯ä»£ç ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œå®ç°äº†è§£è€¦ã€‚ åŠ å…¥æ–°çš„ç±»å‹æ—¶ï¼Œåªéœ€æ·»åŠ æ–°çš„å·¥å‚æ–¹æ³•ï¼ˆæ— éœ€ä¿®æ”¹æ—§çš„å·¥å‚æ–¹æ³•ä»£ç ï¼‰ï¼Œç¬¦åˆOCPã€‚ ç¼ºç‚¹ï¼šç±»çš„ä¸ªæ•°å®¹æ˜“è¿‡å¤šï¼Œå¢åŠ å¤æ‚åº¦ã€‚ æœ€ä½³å®è·µï¼š ä¸¾ä¾‹ï¼š åˆ›å»ºç³–æœæŠ½è±¡ç±» public abstract class Candy { public abstract void eat(); } åˆ›å»ºæŠ½è±¡å·¥å‚ç±» public abstract class CandyFactory { public abstract Candy product(); } åˆ›å»ºæŠ½è±¡ç³–æœå®ç°ç±»-ç‰ç±³è½¯ç³–ç­‰ public class CornFudge extends Candy{ @Override public void eat() { System.out.println("eat corn fudge ing..."); } } åˆ›å»ºæŠ½è±¡å·¥å‚å®ç°ç±»-ç‰ç±³è½¯ç³–å·¥å‚ç­‰ public class CornFudgeFactory extends CandyFactory { @Override public Candy product() { return new CornFudge(); } } æµ‹è¯• public class FmpTest { public static void main(String[] args) { CornFudgeFactory cornFudgeFactory = new CornFudgeFactory(); Candy cornFudge = cornFudgeFactory.product(); cornFudge.eat(); } } 6.è¾“å‡º eat corn fudge ing... 1.3. æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAFPï¼‰è‹±æ–‡ï¼šAbstract Factory Pattern å®šä¹‰ï¼šæä¾›äº†ä¸€ç³»åˆ—ç›¸å…³æˆ–è€…ç›¸äº’ä¾èµ–çš„å¯¹è±¡çš„æ¥å£ ä¼˜ç‚¹ï¼š å…·ä½“äº§å“ä»å®¢æˆ·ç«¯ä»£ç ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œå®ç°è§£è€¦ã€‚ å°†ä¸€ä¸ªç³»åˆ—çš„äº§å“æ—ç»Ÿä¸€åˆ°ä¸€èµ·åˆ›å»º ç¼ºç‚¹ï¼šæ‹“å±•æ–°çš„åŠŸèƒ½å›°éš¾ï¼Œéœ€è¦ä¿®æ”¹æŠ½è±¡å·¥å‚çš„æ¥å£ æœ€ä½³å®è·µï¼š ä¸¾ä¾‹ï¼š åˆ›å»ºæŠ½è±¡ç³–æœç±» public abstract class Candy { public abstract void eat(); public abstract void buy(); } åˆ›å»ºæŠ½è±¡ä»·æ ¼ç±» public abstract class Price { public abstract void pay(); } åˆ›å»ºæŠ½è±¡å·¥å‚æ¥å£ public interface CandyFactory { Candy getCandy(); Price getPrice(); } å®ç°æŠ½è±¡å·¥å‚æ¥å£-æ£’æ£’ç³–å·¥å‚ public class LollipopFactory implements CandyFactory{ @Override public Candy getCandy() { return new Lollipop(); } @Override public Price getPrice() { return new LollipopPrice(); } } åˆ›å»ºäº§å“æ— public class Lollipop extends Candy { @Override public void eat() { System.out.println("eat lollipop ing..."); } @Override public void buy() { System.out.println("buy lollipop"); } } public class LollipopPrice extends Price{ @Override public void pay() { System.out.println("lollipop sell $2"); } } æµ‹è¯• public class afpTest { public static void main(String[] args) { LollipopFactory lollipopFactory = new LollipopFactory(); lollipopFactory.getPrice().pay(); lollipopFactory.getCandy().buy(); lollipopFactory.getCandy().eat(); } } è¾“å‡º lollipop sell $2 buy lollipop eat lollipop ing... 1.4. å»ºé€ è€…æ¨¡å¼ï¼ˆBPï¼‰è‹±æ–‡ï¼šBuilder Pattern å®šä¹‰ï¼šä¹Ÿç§°ä¸ºç”Ÿæˆå™¨æ¨¡å¼ï¼Œå°†å¤æ‚å¯¹è±¡çš„å»ºé€ è¿‡ç¨‹æŠ½è±¡å‡ºæ¥ï¼ˆæŠ½è±¡ç±»åˆ«ï¼‰ï¼Œä½¿è¿™ä¸ªæŠ½è±¡è¿‡ç¨‹çš„ä¸åŒå®ç°æ–¹æ³•å¯ä»¥æ„é€ å‡ºä¸åŒè¡¨ç°ï¼ˆå±æ€§ï¼‰çš„å¯¹è±¡ã€‚ç®€å•æ¥è¯´å°±æ˜¯ï¼Œç›¸åŒçš„è¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„äº§å“ã€‚ ä¼˜ç‚¹ï¼š å°è£…æ€§å¥½ï¼Œåˆ›å»ºå’Œä½¿ç”¨åˆ†ç¦» æ‹“å±•æ€§å¥½ï¼Œå»ºé€ ç±»ä¹‹é—´ç‹¬ç«‹ï¼Œä¸€å®šç¨‹åº¦ä¸Šè§£è€¦ã€‚ ç¼ºç‚¹ï¼š äº§ç”Ÿå¤šä½™çš„Builderå¯¹è±¡ï¼› äº§å“å†…éƒ¨å‘ç”Ÿå˜åŒ–ï¼Œå»ºé€ è€…éœ€è¦æ›´æ”¹ï¼Œæˆæœ¬è¾ƒå¤§ã€‚ æœ€ä½³å®è·µï¼š ä¸€ä¸ªå¯¹è±¡æœ‰éå¸¸å¤æ‚çš„å†…éƒ¨ç»“æ„ï¼ˆå¾ˆå¤šå±æ€§ï¼‰ æƒ³å°†å¤æ‚å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨åˆ†ç¦»ã€‚ ä¸¾ä¾‹ï¼š åˆ›å»ºå•†é“ºç±»Store(åŒ…å«å¤šå±æ€§) public class Store { private String name; private String location; private String type; @Override public String toString() { return "Store{" + "name='" + name + '\'' + ", location='" + location + '\'' + ", type='" + type + '\'' + '}'; } public String getName() { return name; } public void setName(String name) { this.name = name; } public String getLocation() { return location; } public void setLocation(String location) { this.location = location; } public String getType() { return type; } public void setType(String type) { this.type = type; } } åˆ›å»ºå•†é“ºæŠ½è±¡ç”Ÿæˆå™¨ StoreBuilderï¼ˆåŒ…å«å’ŒStoreç›¸åŒçš„å±æ€§åŠå¯¹åº”çš„æŠ½è±¡æ„é€ æ–¹æ³•ï¼‰ public abstract class StoreBuilder { private String name; private String location; private String type; public abstract void name(String name); public abstract void location(String location); public abstract void type(String type); public abstract Store build(); } åˆ›å»ºå•†é“ºæŠ½è±¡ç”Ÿæˆå™¨çš„å®ç°ï¼Œç³–æœé“ºæ„é€ å™¨CandyStoreBuilder public class CandyStoreBuilder extends StoreBuilder { private Store store = new Store(); @Override public void name(String name) { this.store.setName(name); } @Override public void location(String location) { this.store.setLocation(location); } @Override public void type(String type) { this.store.setType(type); } @Override public Store build() { return store; } } åˆ›å»ºç»é”€å•†ç±»Dealer,ç”¨äºé€šè¿‡StoreBuilderæ„å»ºå…·ä½“çš„å•†é“º public class Dealer { private StoreBuilder storeBuilder; public void setStoreBuilder(StoreBuilder storeBuilder) { this.storeBuilder = storeBuilder; } public Store build(String name, String location, String type) { this.storeBuilder.name(name); this.storeBuilder.location(location); this.storeBuilder.type(type); return storeBuilder.build(); } } æµ‹è¯• public class BpTest { public static void main(String[] args) { Dealer dealer = new Dealer(); dealer.setStoreBuilder(new CandyStoreBuilder()); Store store = dealer.build("ç”œèœœèœœç³–æœåº—", "ä¸Šæµ·å¸‚é™†å®¶å˜´77å·", "ç³–æœç»é”€"); System.out.println(store); } } è¾“å‡º Store{name='ç”œèœœèœœç³–æœåº—', location='ä¸Šæµ·å¸‚é™†å®¶å˜´77å·', type='ç³–æœç»é”€'} 1.5. å•ä¾‹æ¨¡å¼ (SP)è‹±æ–‡ï¼šSingleton Pattern å®šä¹‰ï¼šä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ ä¼˜ç‚¹ï¼š å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå‡å°‘äº†å†…å­˜å¼€é”€ï¼› é¿å…å¯¹èµ„æºçš„å¤šé‡å ç”¨ï¼› ç¼ºç‚¹ï¼šæ²¡æœ‰æ¥å£ï¼Œæ‹“å±•å›°éš¾ã€‚ æœ€ä½³å®è·µï¼š æ¨¡å¼ æè¿° æ–¹å¼ ä¼˜ç‚¹ ç¼ºç‚¹ æ˜¯å¦æ¨è é¥¿æ±‰æ¨¡å¼ ä¸ç®¡éœ€ä¸éœ€è¦ç”¨åˆ°å®ä¾‹éƒ½è¦å»åˆ›å»ºå®ä¾‹ - çº¿ç¨‹å®‰å…¨ ä¸ç®¡ç”¨åˆ°ä¸å¦,ç±»åŠ è½½åˆ°å†…å­˜åï¼Œå°±å®ä¾‹åŒ–ä¸€ä¸ªå•ä¾‹ æœ‰ç¼ºç‚¹,ç®€å•å®ç”¨,æ¨èä½¿ç”¨ æ‡’æ±‰æ¨¡å¼ éœ€è¦ç”¨åˆ°åˆ›å»ºå®ä¾‹äº†ç¨‹åºå†å»åˆ›å»ºå®ä¾‹ æ–¹å¼ä¸€ï¼šé”,åŒé‡åˆ¤ç©ºæ–¹å¼ 1.çº¿ç¨‹å®‰å…¨ 2.ç”¨çš„æ—¶å€™,å†å®ä¾‹åŒ– é™ä½ç¨‹åºæ•ˆç‡(åˆ¤ç©º+é”) ä¸æ¨è æ–¹å¼äºŒï¼šé™æ€å†…éƒ¨ç±»æ–¹å¼ 1.çº¿ç¨‹å®‰å…¨(JVMä¿è¯å•ä¾‹) 2.åŠ è½½å¤–éƒ¨ç±»ä¸ä¼šåŠ è½½å†…éƒ¨ç±»,å®ç°äº†æ‡’åŠ è½½ - å®Œç¾å†™æ³•,æ¨è æšä¸¾æ¨¡å¼ - - 1. è§£å†³çº¿ç¨‹åŒæ­¥2. é˜²æ­¢ååºåˆ—åŒ–åŸå› ï¼šç”±äºæšä¸¾æ²¡æœ‰æ„é€ æ–¹æ³•ï¼Œä¸ä¼šè¢«åå°„åå°„åŸç†ï¼šç±»çš„classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜,åå°„ï¼ˆååºåˆ—åŒ–çš„æ–¹å¼ï¼‰newä¸€ä¸ªå®ä¾‹ï¼ˆå‰æè¦æœ‰æ„é€ æ–¹æ³•ï¼‰ - å®Œç¾ä¸­çš„å®Œç¾,æ¨è ä¸¾ä¾‹ï¼š é¥¿æ±‰æ¨¡å¼ã€æ‡’æ±‰æ¨¡å¼ã€å•ä¾‹æ¨¡å¼ 1.1. é¥¿æ±‰æ¨¡å¼ æ–¹å¼ä¸€ï¼šé—´æ¥å£°æ˜-é™æ€ä»£ç å—new public class SingletonHunger01 { //æ–¹å¼ä¸€ ï¼šé—´æ¥å£°æ˜-é™æ€ä»£ç å—new private static final SingletonHunger01 INSTANCE; static{ INSTANCE = new SingletonHunger01(); } //æ„é€ æ–¹æ³•è®¾ä¸ºç§æœ‰,ä½¿å¾—å…¶ä»–ç±»ä¸èƒ½new private SingletonHunger01(){}; public static SingletonHunger01 getInstance(){ return INSTANCE; } } â€‹ æ–¹å¼äºŒï¼šç›´æ¥å£°æ˜-ç›´æ¥new public class SingletonHunger02 { //æ–¹å¼äºŒï¼šç›´æ¥å£°æ˜-ç›´æ¥new private static final SingletonHunger02 INSTANCE = new SingletonHunger02(); //æ„é€ æ–¹æ³•è®¾ä¸ºç§æœ‰,ä½¿å¾—å…¶ä»–ç±»ä¸èƒ½new private SingletonHunger02(){}; public static SingletonHunger02 getInstance(){ return INSTANCE; } } â€‹ 1.2. æ‡’æ±‰æ¨¡å¼ â€‹ æ–¹å¼ä¸€ï¼šé”,åŒé‡åˆ¤ç©ºæ–¹å¼ public class SingletonLazy01 { public static SingletonLazy01 INSTANCE = null; //æ„é€ æ–¹æ³•è®¾ä¸ºç§æœ‰,ä½¿å¾—å…¶ä»–ç±»ä¸èƒ½new private SingletonLazy01(){}; public static SingletonLazy01 getInstance(){ if(INSTANCE == null){ //é™ä½æ¯æ¬¡è¿›æ¥éƒ½éœ€è¦åˆ¤æ–­é” synchronized (SingletonLazy01.class){ if(INSTANCE == null){ INSTANCE = new SingletonLazy01(); } } } return INSTANCE; } } â€‹ æ–¹å¼äºŒï¼šé™æ€å†…éƒ¨ç±»æ–¹å¼ public class SingletonLazy02 { private SingletonLazy02(){}; //é™æ€å†…éƒ¨ç±» private static class StaticInner{ private final static SingletonLazy02 INSTANCE = new SingletonLazy02(); } public static SingletonLazy02 getInstance(){ return StaticInner.INSTANCE; } } â€‹ 1.3. æšä¸¾å•ä¾‹ public enum SingletonEnum { //å•ä¾‹æšä¸¾ INSTANCE; } æµ‹è¯• public class SpTest { public static void main(String[] args) { System.out.println("HASHCODE-hashç ,åŒä¸€ä¸ªç±»ä¸­çš„hashç ä¸ä¼šç›¸åŒ,ä¸åŒç±»çš„hashcodeä¸èƒ½ä¿è¯ç›¸åŒ"); System.out.println("é¥¿æ±‰æ¨¡å¼-é—´æ¥å£°æ˜æ–¹å¼-"+SingletonHunger01.getInstance().hashCode()); System.out.println("é¥¿æ±‰æ¨¡å¼-ç›´æ¥å£°æ˜æ–¹å¼-"+SingletonHunger02.getInstance().hashCode()); System.out.println("æ‡’æ±‰æ¨¡å¼-é”,åŒé‡åˆ¤ç©ºæ–¹å¼-"+SingletonLazy01.getInstance().hashCode()); System.out.println("æ‡’æ±‰æ¨¡å¼-é™æ€å†…éƒ¨ç±»æ–¹å¼-"+SingletonLazy02.getInstance().hashCode()); System.out.println("å•ä¾‹æ¨¡å¼-"+SingletonEnum.INSTANCE.hashCode()); } } è¾“å‡º HASHCODE-hashç ,åŒä¸€ä¸ªç±»ä¸­çš„hashç ä¸ä¼šç›¸åŒ,ä¸åŒç±»çš„hashcodeä¸èƒ½ä¿è¯ç›¸åŒ é¥¿æ±‰æ¨¡å¼-é—´æ¥å£°æ˜æ–¹å¼-1856056345 é¥¿æ±‰æ¨¡å¼-ç›´æ¥å£°æ˜æ–¹å¼-221036634 æ‡’æ±‰æ¨¡å¼-é”,åŒé‡åˆ¤ç©ºæ–¹å¼-1418370913 æ‡’æ±‰æ¨¡å¼-é™æ€å†…éƒ¨ç±»æ–¹å¼-707610042 å•ä¾‹æ¨¡å¼-551734240 1.6. åŸå‹æ¨¡å¼ï¼ˆPPï¼‰è‹±æ–‡ï¼šPrototype Pattern å®šä¹‰ï¼šç”¨åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œå¹¶é€šè¿‡æ‹·è´è¿™äº›åŸå‹åˆ›å»ºæ–°çš„å¯¹è±¡ ä¼˜ç‚¹ï¼š åŸå‹æ¨¡å¼æ˜¯åœ¨å†…å­˜ä¸­äºŒè¿›åˆ¶æµçš„æ‹·è´ï¼Œè¦æ¯”newä¸€ä¸ªå¯¹è±¡çš„æ€§èƒ½è¦å¥½ï¼Œç‰¹åˆ«æ˜¯éœ€è¦äº§ç”Ÿå¤§é‡å¯¹è±¡æ—¶ã€‚ ç®€åŒ–åˆ›å»ºå¯¹è±¡è¿‡ç¨‹ã€‚ ç¼ºç‚¹ï¼š å¯¹è±¡å¿…é¡»é‡å†™Objectå…‹éš†æ–¹æ³•ï¼› ç›´æ¥åœ¨å†…å­˜ä¸­æ‹·è´ï¼Œæ„é€ å‡½æ•°æ˜¯ä¸ä¼šæ‰§è¡Œ å¤æ‚å¯¹è±¡çš„å…‹éš†æ–¹æ³•å†™èµ·æ¥è¾ƒéº»çƒ¦ï¼ˆæµ…å…‹éš†ã€æ·±å…‹éš†ï¼‰ å…‹éš†ä¼šç ´åå®ç°äº†Cloneableæ¥å£çš„å•ä¾‹å¯¹è±¡ æœ€ä½³å®è·µï¼š å¦‚æœç±»çš„åˆå§‹åŒ–éœ€è¦è€—è´¹è¾ƒå¤šçš„èµ„æºï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡åŸå‹æ‹·è´é¿å…è¿™äº›æ¶ˆè€—ã€‚ é€šè¿‡newäº§ç”Ÿä¸€ä¸ªå¯¹è±¡éœ€è¦éå¸¸ç¹ççš„æ•°æ®å‡†å¤‡æˆ–è®¿é—®æƒé™ï¼Œåˆ™å¯ä»¥ä½¿ç”¨åŸå‹æ¨¡å¼ã€‚ ä¸€ä¸ªå¯¹è±¡éœ€è¦æä¾›ç»™å…¶ä»–å¯¹è±¡è®¿é—®ï¼Œè€Œä¸”å„ä¸ªè°ƒç”¨è€…å¯èƒ½éƒ½éœ€è¦ä¿®æ”¹å…¶å€¼æ—¶ï¼Œå¯ä»¥æ‹·è´å¤šä¸ªå¯¹è±¡ä¾›è°ƒç”¨è€…ä½¿ç”¨ï¼Œå³ä¿æŠ¤æ€§æ‹·è´ã€‚ æ‹“å±•ï¼š å…‹éš†åˆ†ç±» å®ç° æµ…å…‹éš† åªå¤åˆ¶åŸºæœ¬ç±»å‹çš„æ•°æ®ï¼Œå¼•ç”¨ç±»å‹çš„æ•°æ®åªå¤åˆ¶äº†å¼•ç”¨çš„åœ°å€ï¼Œå¼•ç”¨çš„å¯¹è±¡å¹¶æ²¡æœ‰å¤åˆ¶ï¼Œåœ¨æ–°çš„å¯¹è±¡ä¸­ä¿®æ”¹å¼•ç”¨ç±»å‹çš„æ•°æ®ä¼šå½±å“åŸå¯¹è±¡ä¸­çš„å¼•ç”¨ã€‚ æ·±å…‹éš† æ–¹å¼ä¸€ï¼šåµŒå¥—é‡å†™cloneæ–¹æ³•ï¼šå®ç°Cloneableæ¥å£ï¼ˆå¼•ç”¨æ•°æ®ç±»å‹ä¹Ÿè¦å®ç°Cloneableæ¥å£ï¼‰ï¼Œé‡å†™cloneæ–¹æ³•ï¼Œcloneçš„åµŒå¥—ï¼Œå¤åˆ¶åçš„å¯¹è±¡ä¸åŸå¯¹è±¡ä¹‹é—´å®Œå…¨ä¸ä¼šå½±å“ã€‚æ–¹å¼äºŒï¼šåºåˆ—åŒ–å¯¹è±¡ï¼šå®ç°åºåˆ—åŒ–Serializableæ¥å£ï¼ˆä¸å®ç°Cloneableæ¥å£ï¼‰ï¼Œï¼ˆå¼•ç”¨æ•°æ®ç±»å‹ä¹Ÿè¦å®ç°Serializableï¼‰ï¼Œå¯¹è±¡åºåˆ—åŒ–åå†™å…¥æµä¸­ï¼Œæ­¤æ—¶ä¸å­˜åœ¨å¼•ç”¨æ•°æ®ç±»å‹çš„æ¦‚å¿µï¼Œä»æµä¸­è¯»å–ï¼Œç”Ÿæˆæ–°çš„å¯¹è±¡ï¼Œæ–°å¯¹è±¡å’ŒåŸå¯¹è±¡ä¹‹é—´ä¹Ÿæ˜¯å®Œå…¨äº’ä¸å½±å“çš„ã€‚ ä¸¾ä¾‹ï¼š 1.1. æµ…å…‹éš†ï¼ˆç®€å•å±æ€§ï¼‰ï¼šåˆ›å»ºå¯¹è±¡ï¼Œå®ç°Cloneableï¼Œé‡å†™cloneæ–¹æ³• public class CandyShallow implements Cloneable { private String name; private String color; public String getName() { return name; } public void setName(String name) { this.name = name; } public String getColor() { return color; } public void setColor(String color) { this.color = color; } //æµ…å…‹éš† @Override protected Object clone() throws CloneNotSupportedException { return super.clone(); } @Override public String toString() { return "CandyShallow{" + "name='" + name + '\'' + ", color='" + color + '\'' + '}'; } } 1.2. æµ‹è¯• public class PpTest { public static void main(String[] args) throws CloneNotSupportedException { CandyShallow candyShallow = new CandyShallow(); ArrayList&lt;CandyShallow> list = new ArrayList&lt;>(); for (int i = 0; i &lt; 3; i++) { CandyShallow clone = (CandyShallow)candyShallow.clone(); clone.setName("ALPENLIEBE"+i); clone.setColor("color"+i); list.add(clone); } System.out.println(list); } } 1.3. è¾“å‡º [Candy{name='ALPENLIEBE0', color='color0'}, Candy{name='ALPENLIEBE1', color='color1'}, Candy{name='ALPENLIEBE2', color='color2'}] 2.1. æ–¹å¼ä¸€ï¼šå®ç°Cloneable,åµŒå¥—é‡å†™cloneæ–¹æ³• public class CandyDeep implements Cloneable { private String name; private String color; private Stuffing stuffing; //--------------------------------------é‡ç‚¹â†“ /** * æ–¹å¼ä¸€ï¼šé‡å†™cloneæ–¹æ³•ï¼Œå®ç°æ·±æ‹·è´ * æ³¨ï¼šè¯¥æ–¹å¼çš„ç¼ºé™·æ˜¯éœ€è¦å•ç‹¬å¤„ç†æ‰€æœ‰è¦å…‹éš†çš„ç±»ä¸­çš„å¼•ç”¨æ•°æ®ç±»å‹(Stuffing) */ @Override protected Object clone(){ CandyDeep candyDeep = null; try { candyDeep = (CandyDeep) super.clone(); candyDeep.stuffing = (Stuffing)this.stuffing.clone(); } catch (CloneNotSupportedException e) { e.printStackTrace(); } return candyDeep; } //--------------------------------------é‡ç‚¹â†‘ @Override public String toString() { return "CandyDeep{" + "name='" + name + '\'' + ", color='" + color + '\'' + ", stuffing=" + stuffing + '}'; } public CandyDeep(String name, String color, Stuffing stuffing) { this.name = name; this.color = color; this.stuffing = stuffing; } public String getName() { return name; } public void setName(String name) { this.name = name; } public String getColor() { return color; } public void setColor(String color) { this.color = color; } public Stuffing getStuffing() { return stuffing; } public void setStuffing(Stuffing stuffing) { this.stuffing = stuffing; } } public class Stuffing implements Cloneable{ private String body; private String form; private String color; //--------------------------------------é‡ç‚¹â†“ //æ— å¼•ç”¨æ•°æ®ç±»å‹,æµ…å…‹éš†å³å¯ @Override protected Object clone() throws CloneNotSupportedException { return super.clone(); } //--------------------------------------é‡ç‚¹â†‘ @Override public String toString() { return "Stuffing{" + "body='" + body + '\'' + ", form='" + form + '\'' + ", color='" + color + '\'' + '}'; } public Stuffing(String body, String form, String color) { this.body = body; this.form = form; this.color = color; } public String getBody() { return body; } public void setBody(String body) { this.body = body; } public String getForm() { return form; } public void setForm(String form) { this.form = form; } public String getColor() { return color; } public void setColor(String color) { this.color = color; } } 2.2. æ–¹å¼äºŒï¼ˆæ¨èï¼‰ï¼šåºåˆ—åŒ–å¯¹è±¡ public class CandyDeep2 implements Serializable { private static final long serialVersionUID = 1L; private String name; private String color; private Stuffing2 stuffing2; //--------------------------------------é‡ç‚¹â†“ public CandyDeep2 deepClone() { ByteArrayOutputStream bos = null; ObjectOutputStream oos = null; ByteArrayInputStream bis = null; ObjectInputStream ois = null; try { //åˆ›å»ºåºåˆ—åŒ–æµ bos = new ByteArrayOutputStream(); oos = new ObjectOutputStream(bos); //å°†å½“å‰å¯¹è±¡ä»¥å¯¹è±¡æµçš„æ–¹å¼è¾“å‡º oos.writeObject(this); //åˆ›å»ºååºåˆ—åŒ–æµ bis = new ByteArrayInputStream(bos.toByteArray()); ois = new ObjectInputStream(bis); //å°†æµå¯¹è±¡ååºåˆ—åŒ–,ä»è€Œå®ç°ç±»çš„æ·±æ‹·è´ return (CandyDeep2) ois.readObject(); } catch (IOException | ClassNotFoundException e) { e.printStackTrace(); return null; } finally { try { //èµ„æºé‡Šæ”¾ bos.close(); bis.close(); oos.close(); ois.close(); } catch (IOException e) { e.printStackTrace(); } } } //--------------------------------------é‡ç‚¹â†‘ @Override public String toString() { return "CandyDeep2{" + "name='" + name + '\'' + ", color='" + color + '\'' + ", stuffing2=" + stuffing2 + '}'; } public CandyDeep2(String name, String color, Stuffing2 stuffing2) { this.name = name; this.color = color; this.stuffing2 = stuffing2; } public String getName() { return name; } public void setName(String name) { this.name = name; } public String getColor() { return color; } public void setColor(String color) { this.color = color; } public Stuffing2 getStuffing2() { return stuffing2; } public void setStuffing2(Stuffing2 stuffing2) { this.stuffing2 = stuffing2; } } public class Stuffing2 implements Serializable { private static final long serialVersionUID = 1L; private String body; private String form; private String color; @Override public String toString() { return "Stuffing2{" + "body='" + body + '\'' + ", form='" + form + '\'' + ", color='" + color + '\'' + '}'; } public Stuffing2(String body, String form, String color) { this.body = body; this.form = form; this.color = color; } public String getBody() { return body; } public void setBody(String body) { this.body = body; } public String getForm() { return form; } public void setForm(String form) { this.form = form; } public String getColor() { return color; } public void setColor(String color) { this.color = color; } } 2.3. æµ‹è¯• public static void main(String[] args) { System.out.println("æ·±å…‹éš†,æ–¹å¼ä¸€:"); CandyDeep candyDeep = new CandyDeep("é»‘è‰²","é…’å¿ƒå·§å…‹åŠ›",new Stuffing("é…’é¥®æ–™","æ¶²ä½“","æ— è‰²")); System.out.println(candyDeep); //candyDeep å’Œ cloneCandy éåŒä¸€ä¸ªå¯¹è±¡ CandyDeep cloneCandy = (CandyDeep) candyDeep.clone(); System.out.println(cloneCandy); System.out.println("+++++++++++++++++++åä¸½çš„åˆ†ç•Œçº¿++++++++++++++++++++++"); System.out.println("æ·±å…‹éš†,æ–¹å¼äºŒ:"); CandyDeep2 candyDeep2 = new CandyDeep2("ç™½è‰²","æœä»å·§å…‹åŠ›",new Stuffing2("æœä»","å›ºä½“","æ£•è‰²")); System.out.println(candyDeep2); //candyDeep2 å’Œ cloneCandy2 éåŒä¸€ä¸ªå¯¹è±¡ CandyDeep2 cloneCandy2 = candyDeep2.deepClone(); System.out.println(cloneCandy2); } 2.4. è¾“å‡º æ·±å…‹éš†,æ–¹å¼ä¸€: CandyDeep{name='é»‘è‰²', color='é…’å¿ƒå·§å…‹åŠ›', stuffing=Stuffing{body='é…’é¥®æ–™', form='æ¶²ä½“', color='æ— è‰²'}} CandyDeep{name='é»‘è‰²', color='é…’å¿ƒå·§å…‹åŠ›', stuffing=Stuffing{body='é…’é¥®æ–™', form='æ¶²ä½“', color='æ— è‰²'}} +++++++++++++++++++åä¸½çš„åˆ†ç•Œçº¿++++++++++++++++++++++ æ·±å…‹éš†,æ–¹å¼äºŒ: CandyDeep2{name='ç™½è‰²', color='æœä»å·§å…‹åŠ›', stuffing2=Stuffing2{body='æœä»', form='å›ºä½“', color='æ£•è‰²'}} CandyDeep2{name='ç™½è‰²', color='æœä»å·§å…‹åŠ›', stuffing2=Stuffing2{body='æœä»', form='å›ºä½“', color='æ£•è‰²'}} 2.ç»“æ„å‹æ¨¡å¼ï¼ˆ7ï¼‰2.1. å¤–è§‚æ¨¡å¼ï¼ˆFPï¼‰è‹±æ–‡ï¼šFacade Pattern å®šä¹‰ï¼šå¤–è§‚æ¨¡å¼åˆå«é—¨é¢æ¨¡å¼ï¼Œæä¾›äº†ç»Ÿä¸€çš„æ¥å£ï¼Œç”¨æ¥è®¿é—®å­ç³»ç»Ÿä¸­çš„ä¸€ç¾¤æ¥å£ã€‚ ä¼˜ç‚¹ï¼š ç®€åŒ–äº†è°ƒç”¨è¿‡ç¨‹ï¼Œæ— éœ€äº†è§£æ·±å…¥å­ç³»ç»Ÿ å‡ä½è€¦åˆåº¦ï¼› æ›´å¥½çš„å±‚æ¬¡åˆ’åˆ†ï¼› ç¬¦åˆLKPã€‚ ç¼ºç‚¹ï¼š å¢åŠ å­ç³»ç»Ÿï¼Œæ‹“å±•å­ç³»ç»Ÿè¡Œä¸ºå®¹æ˜“å¼•å…¥é£é™©ï¼› ä¸ç¬¦åˆOCPã€‚ æœ€ä½³å®è·µï¼š å­ç³»ç»Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œå¢åŠ å¤–è§‚æ¨¡å¼æä¾›ç®€å•æ¥å£è°ƒç”¨ï¼› æ„å»ºå¤šå±‚ç³»ç»Ÿç»“æ„ï¼Œåˆ©ç”¨å¤–è§‚å¯¹è±¡ä½œä¸ºæ¯å±‚çš„å…¥å£ï¼Œç®€åŒ–å±‚é—´è°ƒç”¨ã€‚ ä¸¾ä¾‹ï¼š å®¢æˆ·è´­ä¹°ç°åšè›‹ç³•ï¼Œå®¢æˆ·ç›´æ¥å’Œå‰å°æ‰“äº¤é“ï¼Œå‰å°å’Œåå°(åˆ¶ä½œè›‹ç³•,è£…é¥°,æ‰“åŒ…)ä¼ è¾¾ä¿¡æ¯ï¼Œåå°å¯¹äºå®¢æˆ·è¢«é€æ˜åŒ– åˆ›å»ºè›‹ç³•ä¿¡æ¯å®ä½“ public class CakeInfo { private String cakeName; private Double amount; private Integer num; @Override public String toString() { return "CakeInfo{" + "cakeName='" + cakeName + '\'' + ", amount=" + amount + ", num=" + num + '}'; } public Double getAmount() { return amount; } public void setAmount(Double amount) { this.amount = amount; } public Integer getNum() { return num; } public void setNum(Integer num) { this.num = num; } public String getCakeName() { return cakeName; } public void setCakeName(String cakeName) { this.cakeName = cakeName; } } åˆ›å»ºåå°-åˆ¶ä½œæœåŠ¡ public class MakeService { public boolean makeCake(String cakeName){ System.out.println("ç³•ç‚¹å¸ˆåˆ¶ä½œ"+cakeName); return true; } } åˆ›å»ºåå°-è£…é¥°æœåŠ¡ public class DecorateService { public boolean decorateCake(String cakeName){ System.out.println("è£…é¥°å¸ˆè£…é¥°"+cakeName); return true; } } åˆ›å»ºåå°-æ‰“åŒ…æœåŠ¡ public class PackageService { public boolean packageCake(String cakeName){ System.out.println("æ‰“åŒ…å¸ˆæ‰“åŒ…"+cakeName+",å¹¶è½¬äº¤å‰å°"); return true; } } åˆ›å»ºå‰å°æœåŠ¡èšåˆåå°æœåŠ¡ public class FrontDeskService { private MakeService maker = new MakeService(); private DecorateService decorator = new DecorateService(); private PackageService packer = new PackageService(); public void sellCake(CakeInfo cakeInfo){ System.out.println("å‰å°ä»å®¢æˆ·æ¥å—è›‹ç³•ä¿¡æ¯:"+cakeInfo); String cakeName = cakeInfo.getCakeName(); if(maker.makeCake(cakeName)){ if(decorator.decorateCake(cakeName)){ if(packer.packageCake(cakeName)){ System.out.println("å‰å°æ”¶åˆ°è›‹ç³•->è½¬äº¤å®¢æˆ·->æ”¶é“¶->é”€å”®æˆåŠŸ"); } } } } } æµ‹è¯• public class FpTest { public static void main(String[] args) { CakeInfo cakeInfo = new CakeInfo(); cakeInfo.setAmount(100.00); cakeInfo.setNum(1); cakeInfo.setCakeName("å·§å…‹åŠ›è›‹ç³•"); FrontDeskService frontDeskService = new FrontDeskService(); frontDeskService.sellCake(cakeInfo); } } è¾“å‡º å‰å°ä»å®¢æˆ·æ¥å—è›‹ç³•ä¿¡æ¯:CakeInfo{cakeName='å·§å…‹åŠ›è›‹ç³•', amount=100.0, num=1} ç³•ç‚¹å¸ˆåˆ¶ä½œå·§å…‹åŠ›è›‹ç³• è£…é¥°å¸ˆè£…é¥°å·§å…‹åŠ›è›‹ç³• æ‰“åŒ…å¸ˆæ‰“åŒ…å·§å…‹åŠ›è›‹ç³•,å¹¶è½¬äº¤å‰å° å‰å°æ”¶åˆ°è›‹ç³•->è½¬äº¤å®¢æˆ·->æ”¶é“¶->é”€å”®æˆåŠŸ 2.2. è£…é¥°è€…æ¨¡å¼ï¼ˆDPï¼‰è‹±æ–‡ï¼šDecorator Pattern å®šä¹‰ï¼šåœ¨ä¸æ”¹å˜åŸæœ‰å¯¹è±¡çš„åŸºç¡€ä¹‹ä¸Šï¼Œå°†åŠŸèƒ½é™„åŠ åˆ°å¯¹è±¡ä¸Šï¼Œæä¾›äº†æ¯”ç»§æ‰¿æ›´æœ‰å¼¹æ€§çš„æ›¿ä»£æ–¹æ¡ˆ ä¼˜ç‚¹ï¼š ç»§æ‰¿çš„æœ‰åŠ›è¡¥å……ï¼Œä¸æ”¹å˜åŸæœ‰å¯¹è±¡çš„æƒ…å†µä¸‹ç»™å¯¹è±¡æ‹“å±•åŠŸèƒ½ é€šè¿‡ä½¿ç”¨ä¸åŒçš„è£…é¥°ç±»ã€ä¸åŒçš„ç»„åˆæ–¹å¼ï¼Œå®ç°ä¸åŒçš„æ•ˆæœ ç¬¦åˆOCP ç¼ºç‚¹ï¼šå¢åŠ ç¨‹åºå¤æ‚æ€§ æœ€ä½³å®è·µï¼š æ‹“å±•ä¸€ä¸ªç±»çš„åŠŸèƒ½ åŠ¨æ€ç»™å¯¹è±¡æ·»åŠ åŠŸèƒ½ï¼Œå¹¶ä¸”åŠ¨æ€æ’¤é”€ ä¸¾ä¾‹ï¼š å®¢æˆ·ä¹°è›‹ç³•ï¼Œè¦æ±‚å¯¹è›‹ç³•åŠ ä¸åŒææ–™(æœåˆ‡ï¼Œå¥¶æ²¹ï¼Œå·§å…‹åŠ›ï¼Œè£…é¥°ç”»ç­‰)ï¼Œä»·æ ¼ä¹Ÿéšä¹‹å˜åŠ¨ 1.åˆ›å»ºè›‹ç³•å¥—é¤æŠ½è±¡ç±» public abstract class CakePackage { public abstract String remark(); public abstract int price(); } 2.åˆ›å»ºè£…é¥°å™¨ç±»ç»§æ‰¿è›‹ç³•å¥—é¤æŠ½è±¡ç±» public class CakeDecorator extends CakePackage{ private CakePackage cakePackage; public CakeDecorator(CakePackage cakePackage) { this.cakePackage = cakePackage; } @Override public String remark() { return cakePackage.remark(); } @Override public int price() { return cakePackage.price(); } } 3.åˆ›å»ºæ ‡å‡†è›‹ç³•å¥—é¤ç±» public class StandardCakePackage extends CakePackage{ @Override public String remark() { return "è›‹ç³•èƒš\n"; } @Override public int price() { return 5; } } 4.åˆ›å»ºåŠ å¥¶æ²¹ã€æ°´æœã€ç³–æœç­‰å¢å€¼å¥—é¤ç±» public class CreamCakePackage extends CakeDecorator { public CreamCakePackage(CakePackage cakePackage) { super(cakePackage); } @Override public String remark() { return super.remark()+"åŠ å¥¶æ²¹\n"; } @Override public int price() { return super.price()+5; } } public class FruitCakePackage extends CakeDecorator { public FruitCakePackage(CakePackage cakePackage) { super(cakePackage); } @Override public String remark() { return super.remark() + "åŠ æ°´æœ\n"; } @Override public int price() { return super.price()+10; } } public class CandyCakePackage extends CakeDecorator { public CandyCakePackage(CakePackage cakePackage) { super(cakePackage); } @Override public String remark() { return super.remark()+"åŠ ç³–æœ\n"; } @Override public int price() { return super.price()+15; } } 5.æµ‹è¯• public class DpTest { public static void main(String[] args) { CakePackage cake = new StandardCakePackage(); cake = new CreamCakePackage(cake); cake = new FruitCakePackage(cake); cake = new CandyCakePackage(cake); System.out.println(cake.remark()+"ä»·æ ¼ï¼š"+cake.price()+"å…ƒ"); } } 6.è¾“å‡º è›‹ç³•èƒš åŠ å¥¶æ²¹ åŠ æ°´æœ åŠ ç³–æœ ä»·æ ¼ï¼š35å…ƒ 2.3. é€‚é…å™¨æ¨¡å¼ï¼ˆAPï¼‰è‹±æ–‡ï¼šAdapter Pattern å®šä¹‰ï¼šå°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢ä¸ºæœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œä½¿åŸæœ¬ä¸å…¼å®¹çš„ç±»å¯ä»¥ä¸€èµ·å·¥ä½œ ä¼˜ç‚¹ï¼š æé«˜ç±»çš„é€æ˜æ€§å’Œå¤ç”¨ï¼Œç°æœ‰çš„ç±»å¤ç”¨ä½†ä¸éœ€æ”¹å˜ ç›®æ ‡ç±»å’Œé€‚é…å™¨ç±»è§£è€¦ï¼Œæé«˜ç¨‹åºæ‹“å±•æ€§ ç¬¦åˆOCP ç¼ºç‚¹ï¼š é€‚é…å™¨ç¼–å†™è¿‡ç¨‹éœ€è¦å…¨é¢è€ƒè™‘ï¼Œå¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚æ€§ é™ä½ä»£ç å¯è¯»æ€§ æœ€ä½³å®è·µï¼šå·²å­˜åœ¨çš„ç±»ï¼Œå®ƒçš„æ–¹æ³•å’Œéœ€æ±‚ä¸åŒ¹é…æ—¶ï¼ˆæ–¹æ³•ç»“æœç›¸åŒæˆ–è€…ç›¸ä¼¼ï¼‰ ä¸¾ä¾‹ï¼š åŸæœ‰çš„è›‹ç³•äº§å“çº¿ï¼Œæ–°å¢ä¸€ä¸ªç‰©æ–™äº§å“çº¿(æ°´æœã€å¥¶æ²¹ç­‰)ï¼Œåœ¨ä¸ä¿®æ”¹åŸäº§å“çº¿çš„åŒæ—¶,ä¸¤ä¸ªäº§å“çº¿å…±åŒå·¥ä½œ åˆ›å»ºè›‹ç³•äº§å“çº¿ç±» public class Cake { public void makeCakes(){ System.out.println("ç”Ÿäº§è›‹ç³•"); } } åˆ›å»ºç‰©æ–™äº§å“çº¿æ¥å£ public interface Materiel { void make(); } è›‹ç³•äº§å“ç±»åŠ å…¥åˆ°ç‰©æ–™äº§å“çº¿ï¼Œåˆ›å»ºä¸€ä¸ªé€‚é…å™¨ //ä¸€èˆ¬é€‚é…å™¨ public class CreamCakeAdaptor extends Cake implements Materiel{ @Override public void make() { System.out.println("ç”Ÿäº§å¥¶æ²¹é¢„å¤‡"); super.makeCakes(); System.out.println("æ··åˆæˆå¥¶æ²¹è›‹ç³•"); } } //å¯¹è±¡é€‚é…å™¨ public class FruitCakeAdaptor implements Materiel{ Cake cake = new Cake(); @Override public void make() { System.out.println("ç”Ÿäº§æœåˆ‡é¢„å¤‡"); cake.makeCakes(); System.out.println("æ··åˆæˆæ°´æœè›‹ç³•"); } } æµ‹è¯• public class ApTest { public static void main(String[] args) { CreamCakeAdaptor creamCakeAdaptor = new CreamCakeAdaptor(); creamCakeAdaptor.make(); System.out.println("++++++++++++++åä¸½çš„åˆ†å‰²çº¿+++++++++++++++"); FruitCakeAdaptor fruitCakeAdaptor = new FruitCakeAdaptor(); fruitCakeAdaptor.make(); } } è¾“å‡º ç”Ÿäº§å¥¶æ²¹é¢„å¤‡ ç”Ÿäº§è›‹ç³• æ··åˆæˆå¥¶æ²¹è›‹ç³• ++++++++++++++åä¸½çš„åˆ†å‰²çº¿+++++++++++++++ ç”Ÿäº§æœåˆ‡é¢„å¤‡ ç”Ÿäº§è›‹ç³• æ··åˆæˆæ°´æœè›‹ç³• 2.4. äº«å…ƒæ¨¡å¼ï¼ˆFPï¼‰è‹±æ–‡ï¼šFlyweight Pattern å®šä¹‰ï¼šæä¾›äº†å‡å°‘å¯¹è±¡æ•°é‡ä»è€Œæ”¹å–„åº”ç”¨æ‰€éœ€çš„å¯¹è±¡ç»“æ„çš„æ–¹å¼ï¼Œè¿ç”¨å…±äº«æŠ€æœ¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡ã€‚ ä¼˜ç‚¹ï¼šå‡å°‘å¯¹è±¡çš„åˆ›å»ºï¼Œé™ä½å†…å­˜å ç”¨ï¼› ç¼ºç‚¹ï¼š å…³æ³¨å†…éƒ¨çŠ¶æ€æˆ–å¤–éƒ¨çŠ¶æ€ï¼Œå…³æ³¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼›ï¼ˆå†…éƒ¨çŠ¶æ€ï¼šäº«å…ƒå¯¹è±¡çš„å±æ€§çŠ¶æ€ï¼Œä¸ä¼šå› ä¸ºå¤–éƒ¨çš„æ”¹å˜è€Œæ”¹å˜ï¼› å¤–éƒ¨çŠ¶æ€ï¼šæ–¹æ³•å‚æ•°ï¼‰ ç¨‹åºçš„é€»è¾‘å¤æ‚åŒ–ã€‚ æœ€ä½³å®è·µï¼š å‡å°‘å¯¹è±¡çš„åˆ›å»ºï¼Œé™ä½å†…å­˜å ç”¨ï¼› ç»Ÿæ‹¥æœ‰å¤§é‡ç›¸ä¼¼å¯¹è±¡ï¼Œéœ€è¦ç¼“å†²æ± çš„åœºæ™¯ã€‚ ä¸¾ä¾‹ï¼šåˆ¶ä½œå¤§é‡ç›¸åŒç±»å‹çš„è›‹ç³•ï¼ˆä»£ç å…³é”®æ˜¯é€šè¿‡HashMapå­˜å‚¨å¯¹è±¡ï¼‰ åˆ›å»ºè›‹ç³•æ¥å£ public interface Cake { void make() throws InterruptedException; } å…·ä½“ç±»(å¦‚ï¼šæ°´æœç±»å‹è›‹ç³•)å®ç°è›‹ç³•æ¥å£ public class FruitCake implements Cake { private String name; private LocalDateTime productTime; public FruitCake(String name){ this.name = name; } public void setProductTime(LocalDateTime productTime) { this.productTime = productTime; } @Override public void make() { try { Thread.sleep(100); System.out.println(name+"ç”Ÿäº§æ—¶é—´ï¼š"+this.productTime); } catch (InterruptedException e) { e.printStackTrace(); } } } åˆ›å»ºæ°´æœè›‹ç³•çš„å·¥å‚ public class FruitCakeFactory { //å…³é”®ç‚¹ private static final HashMap&lt;String,FruitCake> CAKE_HASH_MAP = new HashMap&lt;>(); public static FruitCake product(String name){ FruitCake fruitCake = CAKE_HASH_MAP.get(name); if(fruitCake == null){ System.out.println("æ²¡æœ‰"+name+"åˆ¶ä½œæ–¹æ³•,å­¦ä¹ åˆ¶ä½œæ–¹æ³•"); fruitCake = new FruitCake(name); CAKE_HASH_MAP.put(name,fruitCake); } return fruitCake; } } æµ‹è¯• public class FpTest { private static final String[] CAKE_TYPE = {"è“è“è›‹ç³•","ç«é¾™æœè›‹ç³•","è‰è“è›‹ç³•","é¦™è•‰è›‹ç³•"}; public static void main(String[] args) { IntStream.range(0,10).forEach((i)->{ String name = CAKE_TYPE[(int)(Math.random() * CAKE_TYPE.length)]; FruitCake cake = FruitCakeFactory.product(name); cake.setProductTime(LocalDateTime.now()); cake.make(); }); } } è¾“å‡º 10æ¬¡å¾ªç¯ä¸­ï¼Œåªç”Ÿäº§äº†4ä¸ªå¯¹è±¡ï¼Œå¾ˆå¥½çš„æè¿°äº†ç³»ç»Ÿæœ‰å¤§é‡ç›¸ä¼¼å¯¹è±¡ï¼Œéœ€è¦ç¼“å†²æ± çš„åœºæ™¯ã€‚ JDKä¸­çš„å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œæ•°æ®åº“è¿æ¥æ± ç­‰éƒ½æ˜¯ç”¨çš„äº«å…ƒæ¨¡å¼ã€‚ æ²¡æœ‰è“è“è›‹ç³•åˆ¶ä½œæ–¹æ³•,å­¦ä¹ åˆ¶ä½œæ–¹æ³• è“è“è›‹ç³•ç”Ÿäº§æ—¶é—´ï¼š2020-12-13T10:49:17.647076600 è“è“è›‹ç³•ç”Ÿäº§æ—¶é—´ï¼š2020-12-13T10:49:17.779721700 æ²¡æœ‰è‰è“è›‹ç³•åˆ¶ä½œæ–¹æ³•,å­¦ä¹ åˆ¶ä½œæ–¹æ³• è‰è“è›‹ç³•ç”Ÿäº§æ—¶é—´ï¼š2020-12-13T10:49:17.881450300 è‰è“è›‹ç³•ç”Ÿäº§æ—¶é—´ï¼š2020-12-13T10:49:17.982180600 æ²¡æœ‰é¦™è•‰è›‹ç³•åˆ¶ä½œæ–¹æ³•,å­¦ä¹ åˆ¶ä½œæ–¹æ³• é¦™è•‰è›‹ç³•ç”Ÿäº§æ—¶é—´ï¼š2020-12-13T10:49:18.085903500 è“è“è›‹ç³•ç”Ÿäº§æ—¶é—´ï¼š2020-12-13T10:49:18.204594900 è“è“è›‹ç³•ç”Ÿäº§æ—¶é—´ï¼š2020-12-13T10:49:18.305322300 é¦™è•‰è›‹ç³•ç”Ÿäº§æ—¶é—´ï¼š2020-12-13T10:49:18.430981100 è‰è“è›‹ç³•ç”Ÿäº§æ—¶é—´ï¼š2020-12-13T10:49:18.541684900 è“è“è›‹ç³•ç”Ÿäº§æ—¶é—´ï¼š2020-12-13T10:49:18.645407200 2.5. ç»„åˆæ¨¡å¼ï¼ˆCPï¼‰è‹±æ–‡ï¼šComposite Pattern å®šä¹‰ï¼šåˆå«éƒ¨åˆ†æ•´ä½“æ¨¡å¼ï¼Œæ˜¯ç”¨äºæŠŠä¸€ç»„ç›¸ä¼¼çš„å¯¹è±¡å½“ä½œä¸€ä¸ªå•ä¸€çš„å¯¹è±¡ã€‚ç»„åˆæ¨¡å¼ä¾æ®æ ‘å½¢ç»“æ„æ¥ç»„åˆå¯¹è±¡ï¼Œç”¨æ¥è¡¨ç¤ºéƒ¨åˆ†ä»¥åŠæ•´ä½“å±‚æ¬¡ã€‚ ä¼˜ç‚¹ï¼š å±‚æ¬¡æ¸…æ™° å®¢æˆ·ç«¯ä¸å¿…å…³ç³»å±‚æ¬¡å·®å¼‚ï¼Œæ–¹ä¾¿æ§åˆ¶ ç¬¦åˆOCP ç¼ºç‚¹ï¼šæ ‘å½¢å¤„ç†è¾ƒä¸ºå¤æ‚ æœ€ä½³å®è·µï¼š å®¢æˆ·ç«¯å¯ä»¥å¿½ç•¥ç»„åˆå¯¹è±¡ä¸å•ä¸ªå¯¹è±¡çš„å·®å¼‚ å¤„ç†æ ‘å½¢ç»“æ„æ•°æ® ä¸¾ä¾‹ï¼šèœå•æŒ‰é’®ç»„æˆçš„æ ‘å½¢ åˆ›å»ºèœå•æŒ‰é’®ç»„åˆæŠ½è±¡ç±» public abstract class MenuButton { public void add(MenuButton menuButton) { throw new UnsupportedOperationException("ä¸æ”¯æŒåˆ›å»ºæ“ä½œ"); } public String getName() { throw new UnsupportedOperationException("ä¸æ”¯æŒåç§°è·å–"); } public String getType() { throw new UnsupportedOperationException("ä¸æ”¯æŒç±»å‹è·å–"); } public String getIcon() { throw new UnsupportedOperationException("ä¸æ”¯æŒå›¾æ ‡"); } public void print() { throw new UnsupportedOperationException("ä¸æ”¯æŒæ‰“å°æ“ä½œ"); } } åˆ›å»ºæŒ‰é’®ç±» public class Button extends MenuButton{ private String name; public Button(String name) { this.name = name; } @Override public String getName() { return name; } @Override public String getType(){ return "æŒ‰é’®"; } @Override public void print() { System.out.println(getName() + "[" + getType() + "]"); } } åˆ›å»ºèœå•ç±» public class Menu extends MenuButton { private List&lt;MenuButton> items = new ArrayList&lt;>(); private String name; private String icon; private Integer level; public Menu(String name, String icon, Integer level) { this.name = name; this.icon = icon; this.level = level; } @Override public void add(MenuButton menuButton){ items.add(menuButton); } @Override public String getName() { return this.name; } @Override public String getType() { return "èœå•"; } @Override public String getIcon() { return this.icon; } @Override public void print() { System.out.println(getIcon() + getName() + "[" + getType() + "]"); for (MenuButton item : items) { if (this.level != null) { for (int i = 0; i &lt; this.level; i++) { System.out.print(" "); } } item.print(); } } } æµ‹è¯• public class CpTest { public static void main(String[] args) { Menu userMenu = new Menu("ç”¨æˆ·ç®¡ç†", "ğŸ§‘", 2); Button createUser = new Button("æ–°å¢ç”¨æˆ·"); Button updateUser = new Button("ä¿®æ”¹ç”¨æˆ·"); Button deleteUser = new Button("åˆ é™¤ç”¨æˆ·"); userMenu.add(createUser); userMenu.add(updateUser); userMenu.add(deleteUser); Menu logMenu = new Menu("æ“ä½œæ—¥å¿—", "ğŸ“ƒ", 2); Button export = new Button("å¯¼å‡ºExcel"); logMenu.add(export); Menu systemMenu = new Menu("ç³»ç»Ÿç®¡ç†", "ğŸ”¨", 1); systemMenu.add(userMenu); systemMenu.add(logMenu); systemMenu.print(); } } è¾“å‡º ğŸ”¨ç³»ç»Ÿç®¡ç†[èœå•] ğŸ§‘ç”¨æˆ·ç®¡ç†[èœå•] æ–°å¢ç”¨æˆ·[æŒ‰é’®] ä¿®æ”¹ç”¨æˆ·[æŒ‰é’®] åˆ é™¤ç”¨æˆ·[æŒ‰é’®] ğŸ“ƒæ“ä½œæ—¥å¿—[èœå•] å¯¼å‡ºExcel[æŒ‰é’®] 2.6. æ¡¥æ¥æ¨¡å¼ï¼ˆBPï¼‰è‹±æ–‡ï¼šBridge Pattern å®šä¹‰ï¼šå°†æŠ½è±¡éƒ¨åˆ†å’Œå…·ä½“å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚é€šè¿‡ç»„åˆçš„æ–¹å¼å»ºç«‹ä¸¤ä¸ªç±»ä¹‹é—´çš„å…³ç³»ï¼Œè€Œä¸æ˜¯é€šè¿‡ç»§æ‰¿ã€‚ ä¼˜ç‚¹ï¼š åˆ†ç¦»æŠ½è±¡éƒ¨åˆ†å’Œå…·ä½“å®ç°éƒ¨åˆ† æé«˜äº†ç³»ç»Ÿå¯æ‹“å±•æ€§ ç¬¦åˆOCPå’Œåˆæˆå¤ç”¨åŸåˆ™ ç¼ºç‚¹ï¼šå¢åŠ äº†ç³»ç»Ÿçš„ç†è§£å’Œè®¾è®¡éš¾åº¦ æœ€ä½³å®è·µï¼š æŠ½è±¡å’Œå®ä½“å®ç°ä¹‹é—´å¢åŠ æ›´å¤šçš„çµæ´»æ€§ ä¸€ä¸ªç±»å­˜åœ¨å¤šä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œå¹¶ä¸”éœ€è¦ç‹¬ç«‹æ‹“å±• ä¸å¸Œæœ›ä½¿ç”¨ç»§æ‰¿ ä¸¾ä¾‹ï¼š 1.åˆ›å»ºè›‹ç³•çš„æ¥å£ç±» public interface Cake { Cake makeCake(); void getCake(); } 2.åˆ›å»ºè›‹ç³•æ¥å£çš„å®ç°ç±» æ°´æœè›‹ç³• public class FruitCake implements Cake { @Override public Cake makeCake() { System.out.println("åˆ¶ä½œæ°´æœè›‹ç³•"); return new FruitCake(); } @Override public void getCake() { System.out.println("è·å¾—æ°´æœè›‹ç³•"); } } å¥¶æ²¹è›‹ç³• public class CreamCake implements Cake { @Override public Cake makeCake() { System.out.println("åˆ¶ä½œå¥¶æ²¹è›‹ç³•"); return new CreamCake(); } @Override public void getCake() { System.out.println("è·å¾—å¥¶æ²¹è›‹ç³•"); } } 3.åˆ›å»ºåº—é“ºæŠ½è±¡ç±»,é€šè¿‡å±æ€§çš„æ–¹å¼å’Œè›‹ç³•æ¥å£ç›¸å…³è”ï¼Œç›®çš„æ˜¯å¯ä»¥åœ¨ä¸åŒçš„åº—é“ºå®ç°ç±»ä¸­çµæ´»åœ°åˆ¶ä½œå„ç§è›‹ç³• åº—é“ºæŠ½è±¡ç±» public abstract class Store { protected Cake cake; public Store(Cake cake){ this.cake = cake; } abstract Cake makeCake(); } åº—é“ºå®ç°ç±» public class ZhangSanStore extends Store{ public ZhangSanStore(Cake cake) { super(cake); } @Override Cake makeCake() { System.out.println("å¼ ä¸‰çš„è›‹ç³•åº—"); return cake.makeCake(); } } public class LiSiStore extends Store { public LiSiStore(Cake cake) { super(cake); } @Override Cake makeCake() { System.out.println("æå››çš„è›‹ç³•åº—"); return cake.makeCake(); } } 4.æµ‹è¯• public class BpTest { public static void main(String[] args) { ZhangSanStore zhangSanStore = new ZhangSanStore(new FruitCake()); Cake cake = zhangSanStore.makeCake(); cake.getCake(); System.out.println("++++++++++++++++åä¸½çš„åˆ†å‰²çº¿+++++++++++++++++"); LiSiStore liSiStore = new LiSiStore(new CreamCake()); Cake cake1 = liSiStore.makeCake(); cake1.getCake(); } } 5.è¾“å‡º å¼ ä¸‰çš„è›‹ç³•åº— åˆ¶ä½œæ°´æœè›‹ç³• è·å¾—æ°´æœè›‹ç³• ++++++++++++++++åä¸½çš„åˆ†å‰²çº¿+++++++++++++++++ æå››çš„è›‹ç³•åº— åˆ¶ä½œå¥¶æ²¹è›‹ç³• è·å¾—å¥¶æ²¹è›‹ç³• 2.7. ä»£ç†æ¨¡å¼ï¼ˆPPï¼‰è‹±æ–‡ï¼šProxy Pattern å®šä¹‰ï¼šä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ï¼Œä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ï¼Œä»£ç†å¯¹è±¡åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´èµ·åˆ°äº†ä¸­ä»‹çš„ä½œç”¨ ä¼˜ç‚¹ï¼š å°†ä»£ç†å¯¹è±¡å’ŒçœŸå®è¢«è°ƒç”¨çš„ç›®æ ‡å¯¹è±¡åˆ†ç¦» é™ä½è€¦åˆï¼Œæ‹“å±•æ€§å¥½ ä¿æŠ¤ç›®æ ‡å¯¹è±¡ï¼Œå¢å¼ºç›®æ ‡å¯¹è±¡ ç¼ºç‚¹ï¼š é€ æˆç±»çš„æ•°ç›®å¢åŠ ï¼Œå¢åŠ å¤æ‚åº¦ å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡å¢åŠ ä»£ç†å¯¹è±¡ï¼Œä¼šé€ æˆå¤„ç†é€Ÿåº¦å˜æ…¢ æœ€ä½³å®è·µï¼š ä¿æŠ¤ç›®æ ‡å¯¹è±¡ å¢å¼ºç›®æ ‡å¯¹è±¡ ä»£ç†åˆ†ç±» åŠŸèƒ½ ç¼ºç‚¹ é™æ€ä»£ç† é€šè¿‡åœ¨ä»£ç ä¸­æ˜¾å¼åœ°å®šä¹‰äº†ä¸€ä¸ªä»£ç†ç±»ï¼Œåœ¨ä»£ç†ç±»ä¸­é€šè¿‡åŒåçš„æ–¹æ³•å¯¹ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•è¿›è¡ŒåŒ…è£…ï¼Œå®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨ä»£ç†ç±»çš„æ–¹æ³•æ¥è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ã€‚ æ¯éœ€è¦ä»£ç†ä¸€ä¸ªç±»ï¼Œå°±éœ€è¦æ‰‹å†™å¯¹åº”çš„ä»£ç†ç±» åŠ¨æ€ä»£ç† JDKçš„åŠ¨æ€ä»£ç†åªèƒ½ä»£ç†æ¥å£ï¼Œé€šè¿‡æ¥å£çš„æ–¹æ³•ååœ¨åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»ä¸­è°ƒç”¨ä¸šåŠ¡å®ç°ç±»çš„åŒåæ–¹æ³•ã€‚ CGLibä»£ç† é€šè¿‡ç»§æ‰¿æ¥å®ç°ï¼Œç”Ÿæˆçš„ä»£ç†ç±»å°±æ˜¯ç›®æ ‡å¯¹è±¡ç±»çš„å­ç±»ï¼Œé€šè¿‡é‡å†™ä¸šåŠ¡æ–¹æ³•æ¥å®ç°ä»£ç† Springå¯¹ä»£ç†æ¨¡å¼çš„æ‹“å±• 1. å½“Beanæœ‰å®ç°æ¥å£æ—¶ï¼Œä½¿ç”¨JDKåŠ¨æ€ä»£ç†ï¼› 2. å½“Beanæ²¡æœ‰å®ç°æ¥å£æ—¶ï¼Œä½¿ç”¨CGLibä»£ç†ã€‚ ä¸¾ä¾‹ï¼š 1.é™æ€ä»£ç† ï¼ˆ1ï¼‰åˆ›å»ºç³–æœç±»æ¥å£ public interface ICandyService { void makeCandy(); } ï¼ˆ2ï¼‰åˆ›å»ºç³–æœç±»å®ç°ç±» public class CandyServiceServiceImpl implements ICandyService { @Override public void makeCandy() { System.out.println("åˆ¶ä½œç³–æœ"); } } ï¼ˆ3ï¼‰åˆ›å»ºä»£ç†å¯¹è±¡ public class ProxyService { private ICandyService iCandyService; public void makeCandy(){ beforeMethod(); iCandyService = new CandyServiceServiceImpl(); iCandyService.makeCandy(); afterMethod(); } private void afterMethod() { System.out.println("åŒ…è£…"); } private void beforeMethod() { System.out.println("å‡†å¤‡ææ–™"); } } ï¼ˆ4ï¼‰æµ‹è¯• public class PpTest { public static void main(String[] args) { System.out.println("[ä»£ç†æ¨¡å¼-é™æ€ä»£ç†]"); ProxyService proxyService = new ProxyService(); proxyService.makeCandy(); } } ï¼ˆ5ï¼‰è¾“å‡º [ä»£ç†æ¨¡å¼-é™æ€ä»£ç†] å‡†å¤‡ææ–™ åˆ¶ä½œç³–æœ åŒ…è£… 2.åŠ¨æ€ä»£ç† ï¼ˆ1ï¼‰åˆ›å»ºé¥¼å¹²ç±»æ¥å£ public interface IBiscuitService { void makeBiscuit(String ingredients); } ï¼ˆ2ï¼‰åˆ›å»ºé¥¼å¹²ç±»å®ç°ç±» public class BiscuitServiceImpl implements IBiscuitService { @Override public void makeBiscuit(String ingredients) { System.out.println("åˆ¶ä½œ"+ingredients+"é¥¼å¹²"); } } ï¼ˆ3ï¼‰åˆ›å»ºåŠ¨æ€ä»£ç† public class DynamicProxy implements InvocationHandler { // ä»£ç†çš„ç›®æ ‡å¯¹è±¡ private Object object; public DynamicProxy(Object object) { this.object = object; } public Object proxy(){ Class&lt;?> clazz = object.getClass(); return Proxy.newProxyInstance(clazz.getClassLoader(), clazz.getInterfaces(), this); } /** * @param proxy åŠ¨æ€ç”Ÿæˆçš„ä»£ç†å¯¹è±¡ * @param method ä»£ç†æ–¹æ³• * @param args ä»£ç†æ–¹æ³•çš„æ–¹æ³•å‚æ•° * @return ç»“æœ * @throws Throwable å¼‚å¸¸ */ @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { beforeMethod(object); // åå°„æ‰§è¡Œä»£ç†å¯¹è±¡çš„ç›®æ ‡æ–¹æ³• Object result = method.invoke(object, args); afterMethod(object); return result; } private void beforeMethod(Object object) { if (object instanceof IBiscuitService) { System.out.println("å‡†å¤‡é¥¼å¹²é…æ–™"); } else if (object instanceof ICandyService) { System.out.println("å‡†å¤‡ç³–æœé…æ–™"); } else { throw new RuntimeException("æš‚ä¸æ”¯æŒä»£ç†" + object.getClass() + "ç±»å‹"); } } private void afterMethod(Object object) { if (object instanceof IBiscuitService) { System.out.println("åŒ…è£…é¥¼å¹²"); } else if (object instanceof ICandyService) { System.out.println("åŒ…è£…ç³–æœ"); } else { throw new RuntimeException("æš‚ä¸æ”¯æŒä»£ç†" + object.getClass() + "ç±»å‹"); } } } ï¼ˆ4ï¼‰æµ‹è¯• public class Pp2Test { public static void main(String[] args) { System.out.println("[ä»£ç†æ¨¡å¼-åŠ¨æ€ä»£ç†]"); ICandyService candyService = (ICandyService) new DynamicProxy(new CandyServiceServiceImpl()).proxy(); candyService.makeCandy(); System.out.println("++++++++++++++++åä¸½çš„åˆ†å‰²çº¿+++++++++++++++++"); IBiscuitService biscuitService = (IBiscuitService) new DynamicProxy(new BiscuitServiceImpl()).proxy(); biscuitService.makeBiscuit("è‰è“"); System.out.println("++++++++++++++++åä¸½çš„åˆ†å‰²çº¿+++++++++++++++++"); biscuitService.makeBiscuit("å¥¶æ²¹"); } } ï¼ˆ5ï¼‰è¾“å‡º [ä»£ç†æ¨¡å¼-åŠ¨æ€ä»£ç†] å‡†å¤‡ç³–æœé…æ–™ åˆ¶ä½œç³–æœ åŒ…è£…ç³–æœ ++++++++++++++++åä¸½çš„åˆ†å‰²çº¿+++++++++++++++++ å‡†å¤‡é¥¼å¹²é…æ–™ åˆ¶ä½œè‰è“é¥¼å¹² åŒ…è£…é¥¼å¹² ++++++++++++++++åä¸½çš„åˆ†å‰²çº¿+++++++++++++++++ å‡†å¤‡é¥¼å¹²é…æ–™ åˆ¶ä½œå¥¶æ²¹é¥¼å¹² åŒ…è£…é¥¼å¹² 3.CGLibä»£ç† â€‹ é€šè¿‡ç»§æ‰¿æ¥å®ç°ï¼Œç”Ÿæˆçš„ä»£ç†ç±»å°±æ˜¯ç›®æ ‡å¯¹è±¡ç±»çš„å­ç±»ï¼Œé€šè¿‡é‡å†™ä¸šåŠ¡æ–¹æ³•æ¥å®ç°ä»£ç†ã€‚ 4.Springå¯¹ä»£ç†æ¨¡å¼çš„æ‰©å±• â€‹ å¯ä»¥é€šè¿‡ä»¥ä¸‹é…ç½®å¼ºåˆ¶ä½¿ç”¨CGLibä»£ç†; spring: aop: proxy-target-class: true 3.è¡Œä¸ºå‹æ¨¡å¼ï¼ˆ11ï¼‰3.1. æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTPï¼‰è‹±æ–‡ï¼šTemplate Pattern å®šä¹‰ï¼šæ¨¡æ¿æ–¹æ³•æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªæµç¨‹çš„éª¨æ¶ï¼Œç”±å¤šä¸ªæ–¹æ³•ç»„æˆã€‚å¹¶å…è®¸å­ç±»ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤æä¾›å®ç°ã€‚ç®€è€Œè¨€ä¹‹å°±æ˜¯å…¬å…±çš„ä¸å˜çš„éƒ¨åˆ†ç”±çˆ¶ç±»ç»Ÿä¸€å®ç°ï¼Œå˜åŒ–çš„éƒ¨åˆ†ç”±å­ç±»æ¥ä¸ªæ€§åŒ–å®ç°ã€‚ ä¼˜ç‚¹ï¼š æé«˜å¤ç”¨æ€§ æé«˜æ‹“å±•æ€§ OCP ç¼ºç‚¹ï¼š ç±»çš„æ•°ç›®å¢åŠ  å¢åŠ äº†ç³»ç»Ÿå®ç°çš„å¤æ‚åº¦ çˆ¶ç±»æ·»åŠ æ–°çš„æŠ½è±¡æ–¹æ³•ï¼Œæ‰€æœ‰å­ç±»éƒ½è¦æ”¹ä¸€é æœ€ä½³å®è·µï¼š ä¸¾ä¾‹ï¼šå¤–å–1.åˆ›å»ºå›ºå®šæµç¨‹æŠ½è±¡ç±» public abstract class Takeaway { final void order() { System.out.println("(æµç¨‹å›ºå®š)ä¸‹å•"); } final void packageSend() { System.out.println("(æµç¨‹å›ºå®š)æ‰“åŒ…æ´¾é€"); } protected abstract void make(); protected boolean needTableware() { return true; } final void flow() { this.order(); this.make(); if (needTableware()) { System.out.println("èµ é€ä¸€æ¬¡æ€§é¤å…·"); } this.packageSend(); } } 2.åˆ›å»ºå­ç±»å®ç°ç±» public class CakeTakeaway extends Takeaway{ @Override protected void make() { System.out.println("åˆ¶ä½œè›‹ç³•"); } @Override protected boolean needTableware(){ return super.needTableware(); } } public class BiscuitTakeaway extends Takeaway{ @Override protected void make() { System.out.println("åˆ¶ä½œé¥¼å¹²"); } @Override protected boolean needTableware() { return false; } } 3.æµ‹è¯• public class TpTest { public static void main(String[] args) { CakeTakeaway cakeTakeaway = new CakeTakeaway(); cakeTakeaway.flow(); System.out.println("++++++++++++++åä¸½çš„åˆ†å‰²çº¿+++++++++++++++"); BiscuitTakeaway biscuitTakeaway = new BiscuitTakeaway(); biscuitTakeaway.flow(); } } 4.å®ç° (æµç¨‹å›ºå®š)ä¸‹å• åˆ¶ä½œè›‹ç³• èµ é€ä¸€æ¬¡æ€§é¤å…· (æµç¨‹å›ºå®š)æ‰“åŒ…æ´¾é€ ++++++++++++++åä¸½çš„åˆ†å‰²çº¿+++++++++++++++ (æµç¨‹å›ºå®š)ä¸‹å• åˆ¶ä½œé¥¼å¹² (æµç¨‹å›ºå®š)æ‰“åŒ…æ´¾é€ 3.2. è¿­ä»£å™¨æ¨¡å¼ï¼ˆIPï¼‰è‹±æ–‡ï¼šIterator Pattern å®šä¹‰ï¼šè¿­ä»£å™¨æ¨¡å¼ï¼Œåˆç§°æ¸¸æ ‡æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼æä¾›ä¸€ç§æ–¹æ³•è®¿é—®ä¸€ä¸ªå®¹å™¨å¯¹è±¡ä¸­å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸éœ€è¦æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚ã€‚ ä¼˜ç‚¹ï¼š 1.å®ƒæ”¯æŒä»¥ä¸åŒçš„æ–¹å¼éå†ä¸€ä¸ªèšåˆå¯¹è±¡ï¼Œåœ¨åŒä¸€ä¸ªèšåˆå¯¹è±¡ä¸Šå¯ä»¥å®šä¹‰å¤šç§éå†æ–¹å¼ã€‚æ›¿æ¢è¿­ä»£å™¨å°±å¯ä»¥åˆ‡æ¢éå†æ–¹æ³•ã€‚ 2.è¿­ä»£å™¨ç®€åŒ–äº†èšåˆç±»ã€‚èšåˆå¯¹è±¡å¯ä»¥ä¸ç”¨è‡ªå·±å†æä¾›éå†æ–¹æ³•ã€‚ 3.åœ¨è¿­ä»£å™¨æ¨¡å¼ä¸­ç”±äºå¼•å…¥äº†æŠ½è±¡å±‚ï¼Œå¢åŠ æ–°çš„èšåˆç±»å’Œè¿­ä»£å™¨ç±»éƒ½å¾ˆæ–¹ä¾¿ï¼Œæ— é¡»ä¿®æ”¹åŸæœ‰ä»£ç ï¼Œæ»¡è¶³â€œå¼€é—­åŸåˆ™â€çš„è¦æ±‚ã€‚ ç¼ºç‚¹ï¼š 1.ç”±äºè¿­ä»£å™¨æ¨¡å¼å°†å­˜å‚¨æ•°æ®å’Œéå†æ•°æ®çš„èŒè´£åˆ†ç¦»ï¼Œå¢åŠ æ–°çš„èšåˆç±»éœ€è¦å¯¹åº”å¢åŠ æ–°çš„è¿­ä»£å™¨æ¥ï¼Œç±»çš„ä¸ªæ•°æˆå¯¹å¢åŠ ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚ 2.æŠ½è±¡è¿­ä»£å™¨è®¾è®¡éš¾åº¦ç›¸å¯¹è¾ƒå¤§ï¼Œéœ€è¦å……åˆ†è€ƒè™‘åˆ°ç³»ç»Ÿå°†æ¥çš„æ‰©å±•ï¼Œï¼Œä¾‹å¦‚JDKå†…ç½®è¿­ä»£å™¨Iteratorå°±æ— æ³•å®ç°é€†å‘éå†ï¼Œå¦‚æœéœ€è¦å®ç°é€†å‘éå†ï¼Œåªèƒ½é€šè¿‡å…¶å­ç±»ListIteratorç­‰æ¥å®ç°ï¼Œè€ŒListIteratorè¿­ä»£å™¨æ— æ³•ç”¨äºæ“ä½œSetç±»å‹çš„èšåˆå¯¹è±¡ã€‚ æœ€ä½³å®è·µï¼š 1.è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡çš„å†…å®¹è€Œæ— é¡»æš´éœ²å®ƒçš„å†…éƒ¨è¡¨ç¤ºã€‚å°†èšåˆå¯¹è±¡çš„è®¿é—®ä¸å†…éƒ¨æ•°æ®çš„å­˜å‚¨åˆ†ç¦»ï¼Œä½¿å¾—è®¿é—®èšåˆå¯¹è±¡æ—¶æ— é¡»äº†è§£å…¶å†…éƒ¨å®ç°ç»†èŠ‚ã€‚ 2.éœ€è¦ä¸ºä¸€ä¸ªèšåˆå¯¹è±¡æä¾›å¤šç§éå†æ–¹å¼ã€‚ 3.ä¸ºéå†ä¸åŒèšåˆç»“æ„æä¾›ç»Ÿä¸€çš„æ¥å£ï¼Œè¯¥æ¥å£çš„å®ç°ç±»ä¸­ä¸ºä¸åŒçš„èšåˆç»“æ„æä¾›ä¸åŒçš„éå†æ–¹å¼ï¼Œè€Œå®¢æˆ·ç«¯å¯ä»¥ä¸€è‡´æ€§çš„æ“ä½œè¯¥æ¥å£ã€‚ ä¸¾ä¾‹ï¼š 1.åˆ›å»ºæŠ½è±¡å®¹å™¨ public interface Aggregate { void add(Object obj); void remove(Object obj); Iterator iterator(); } 2.åˆ›å»ºå®¹å™¨å®ç°ç±» public class ConcreteAggregate implements Aggregate{ private List list = new ArrayList(); @Override public void add(Object obj) { list.add(obj); } @Override public void remove(Object obj) { list.remove(obj); } @Override public Iterator iterator() { return new ConcreteIterator(list); } } 3.åˆ›å»ºæŠ½è±¡è¿­ä»£å™¨ public interface Iterator { Object next(); boolean hasNext(); } 4.åˆ›å»ºå…·ä½“è¿­ä»£å™¨å®ç°ç±» public class ConcreteIterator implements Iterator { private List list = new ArrayList(); private int cursor = 0; public ConcreteIterator(List list) { this.list = list; } @Override public Object next() { Object obj = null; if (this.hasNext()) { obj = this.list.get(cursor++); } return obj; } @Override public boolean hasNext() { if (cursor == list.size()) { return false; } return true; } } 5.æµ‹è¯• public class IpTest { public static void main(String[] args) { Aggregate ag = new ConcreteAggregate(); ag.add("a"); ag.add("b"); ag.add("c"); Iterator it = ag.iterator(); while(it.hasNext()){ String str = (String)it.next(); System.out.println(str); } } } 6.è¾“å‡º a b c 3.3. ç­–ç•¥æ¨¡å¼ï¼ˆSPï¼‰è‹±æ–‡ï¼šStrategy Pattern å®šä¹‰ï¼šç­–ç•¥æ¨¡å¼å®šä¹‰äº†ç®—æ³•å®¶æ—ï¼Œåˆ†åˆ«å°è£…èµ·æ¥ï¼Œè®©å®ƒä»¬ä¹‹é—´å¯ä»¥äº’ç›¸æ›¿æ¢ã€‚æ­¤æ¨¡å¼è®©ç®—æ³•çš„å˜åŒ–ä¸ä¼šå½±å“åˆ°ä½¿ç”¨ç®—æ³•çš„ç”¨æˆ·ã€‚ç­–ç•¥æ¨¡å¼å¸¸ç”¨äºæ¶ˆé™¤å¤§é‡çš„if elseä»£ç ã€‚ ä¼˜ç‚¹ï¼š ç¼ºç‚¹ï¼š æœ€ä½³å®è·µï¼š ç³»ç»Ÿæœ‰å¾ˆå¤šç±»ï¼Œå®ƒä»¬çš„åŒºåˆ«ä»…ä»…åœ¨äºè¡Œä¸ºä¸åŒ ä¸€ä¸ªç³»ç»Ÿéœ€è¦åŠ¨æ€åœ°åœ¨å‡ ç§ç®—æ³•ä¸­é€‰æ‹©ä¸€ç§ ä¸¾ä¾‹ï¼šä¿ƒé”€æ´»åŠ¨ 1.åˆ›å»ºæ´»åŠ¨æ¥å£ public interface Activity { void discount(); } 2.åˆ›å»ºå¤šæ¥å£å®ç°ç±» public class StrategyOne implements Activity{ @Override public void discount() { System.out.println("æ»¡å‡è¿”ç°"); } } public class StrategyTwo implements Activity { @Override public void discount() { System.out.println("æ»¡å‡æ‰“æŠ˜"); } } 3.æµ‹è¯• public class SpTest { public static void main(String[] args) { String plan = "A"; if("A".equalsIgnoreCase(plan)){ StrategyOne strategyOne = new StrategyOne(); strategyOne.discount(); }else if("B".equalsIgnoreCase(plan)){ StrategyTwo strategyTwo = new StrategyTwo(); strategyTwo.discount(); }else{ throw new RuntimeException("æš‚ä¸æ”¯æŒæ´»åŠ¨ç­–ç•¥"); } } } 4.è¾“å‡º æ»¡å‡è¿”ç° 3.4. è§£é‡Šå™¨æ¨¡å¼ï¼ˆIPï¼‰â€“ TODOè‹±æ–‡ï¼šInterpreter Pattern å®šä¹‰ï¼š ä¼˜ç‚¹ï¼š ç¼ºç‚¹ï¼š æœ€ä½³å®è·µï¼š ä¸¾ä¾‹ï¼šæœ€éš¾æ¨¡å¼ï¼Œä¸å¸¸ç”¨ï¼Œåè¡¥å…… 3.5. è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆOPï¼‰è‹±æ–‡ï¼šObserver Pattern å®šä¹‰ï¼šè§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†å¯¹è±¡ä¹‹é—´çš„ä¸€å¯¹å¤šä¾èµ–ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…åŒæ—¶ç›‘å¬æŸä¸ªä¸»é¢˜å¯¹è±¡ï¼Œå½“ä¸»ä½“å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒçš„æ‰€æœ‰è§‚å¯Ÿè€…éƒ½ä¼šæ”¶åˆ°å“åº”çš„é€šçŸ¥ã€‚ ä¼˜ç‚¹ï¼š è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…ä¹‹é—´å»ºç«‹ä¸€ä¸ªæŠ½è±¡çš„è€¦åˆï¼› è§‚å¯Ÿè€…æ¨¡å¼æ”¯æŒå¹¿æ’­é€šä¿¡ã€‚ ç¼ºç‚¹ï¼š è§‚å¯Ÿè€…ä¹‹é—´æœ‰è¿‡å¤šçš„ç»†èŠ‚ä¾èµ–ï¼Œæé«˜æ—¶é—´æ¶ˆè€—åŠç¨‹åºå¤æ‚åº¦ åº”é¿å…å¾ªç¯è°ƒç”¨ æœ€ä½³å®è·µï¼š ä¸¾ä¾‹ï¼šå…¬ä¼—å·æ¨é€æ–‡ç«  1.åˆ›å»ºè¢«è§‚å¯Ÿè€…(å…¬ä¼—å·) public class OfficialAccount extends Observable { private String accountName; public OfficialAccount(String accountName) { this.accountName = accountName; } public String getAccountName() { return accountName; } public void push(Article article) { System.out.println("ã€"+this.accountName+"ã€‘" +"å‘èµ·æ¨é€>>>"+article.getAuthor()+"çš„ã€Š"+article.getName()+"ã€‹"); // è®¾ç½®æ ‡è¯†ä½ changed = trueï¼Œè¡¨ç¤ºè¢«è§‚å¯Ÿè€…å‘ç”Ÿäº†æ”¹å˜ setChanged(); // é€šçŸ¥è§‚å¯Ÿè€…ï¼Œå¯ä»¥ç»™è§‚å¯Ÿè€…ä¼ é€’æ•°æ® notifyObservers(article); } } 2.åˆ›å»ºè§‚å¯Ÿè€…ï¼ˆè®¢é˜…è€…ï¼‰ public class Followers implements Observer { private String name; public Followers(String name) { this.name = name; } @Override public void update(Observable o, Object arg) { OfficialAccount officialAccount = (OfficialAccount) o; Article article = (Article) arg; System.out.println(name+":::æ”¶åˆ°ã€"+officialAccount.getAccountName()+"ã€‘çš„æ¨é€:"+article.getAuthor()+"çš„ã€Š"+article.getName()+"ã€‹"); } } 3.åˆ›å»ºæ¨é€å¯¹è±¡ï¼ˆæ–‡ç« ï¼‰ public class Article { private String name; private String author; public Article(String name, String author) { this.name = name; this.author = author; } public String getName() { return name; } public void setName(String name) { this.name = name; } public String getAuthor() { return author; } public void setAuthor(String author) { this.author = author; } } 4.æµ‹è¯• public class OpTest { public static void main(String[] args) { OfficialAccount officialAccount = new OfficialAccount("JAVAå¤§æœ¬è¥"); //æ·»åŠ è®¢é˜…è€… Followers follower1 = new Followers("è·¯äººç”²"); officialAccount.addObserver(follower1); Followers follower2 = new Followers("è·¯äººä¹™"); officialAccount.addObserver(follower2); //æ¨é€ Article article = new Article("å¤§è¯è®¾è®¡æ¨¡å¼","èœé¸Ÿ"); officialAccount.push(article); } } 5.è¾“å‡º ã€JAVAå¤§æœ¬è¥ã€‘å‘èµ·æ¨é€>>>èœé¸Ÿçš„ã€Šå¤§è¯è®¾è®¡æ¨¡å¼ã€‹ è·¯äººä¹™:::æ”¶åˆ°ã€JAVAå¤§æœ¬è¥ã€‘çš„æ¨é€:èœé¸Ÿçš„ã€Šå¤§è¯è®¾è®¡æ¨¡å¼ã€‹ è·¯äººç”²:::æ”¶åˆ°ã€JAVAå¤§æœ¬è¥ã€‘çš„æ¨é€:èœé¸Ÿçš„ã€Šå¤§è¯è®¾è®¡æ¨¡å¼ã€‹ 3.6. å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMPï¼‰è‹±æ–‡ï¼šMemento Pattern å®šä¹‰ï¼šåœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ã€‚è¿™æ ·ä»¥åå°±å¯ä»¥å°†è¯¥å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€ã€‚ ä¼˜ç‚¹ï¼š 1.å®ƒæä¾›äº†ä¸€ç§çŠ¶æ€æ¢å¤çš„å®ç°æœºåˆ¶ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°å›åˆ°ä¸€ä¸ªç‰¹å®šçš„å†å²æ­¥éª¤ï¼Œå½“æ–°çš„çŠ¶æ€æ— æ•ˆæˆ–è€…å­˜åœ¨é—®é¢˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æš‚æ—¶å­˜å‚¨èµ·æ¥çš„å¤‡å¿˜å½•å°†çŠ¶æ€å¤åŸã€‚ 2.å¤‡å¿˜å½•å®ç°äº†å¯¹ä¿¡æ¯çš„å°è£…ï¼Œä¸€ä¸ªå¤‡å¿˜å½•å¯¹è±¡æ˜¯ä¸€ç§åŸå‘å™¨å¯¹è±¡çŠ¶æ€çš„è¡¨ç¤ºï¼Œä¸ä¼šè¢«å…¶ä»–ä»£ç æ‰€æ”¹åŠ¨ã€‚å¤‡å¿˜å½•ä¿å­˜äº†åŸå‘å™¨çš„çŠ¶æ€ï¼Œé‡‡ç”¨åˆ—è¡¨ã€å †æ ˆç­‰é›†åˆæ¥å­˜å‚¨å¤‡å¿˜å½•å¯¹è±¡å¯ä»¥å®ç°å¤šæ¬¡æ’¤é”€æ“ä½œã€‚ ç¼ºç‚¹ï¼šèµ„æºæ¶ˆè€—è¿‡å¤§ï¼Œå¦‚æœéœ€è¦ä¿å­˜çš„åŸå‘å™¨ç±»çš„æˆå‘˜å˜é‡å¤ªå¤šï¼Œå°±ä¸å¯é¿å…éœ€è¦å ç”¨å¤§é‡çš„å­˜å‚¨ç©ºé—´ï¼Œæ¯ä¿å­˜ä¸€æ¬¡å¯¹è±¡çš„çŠ¶æ€éƒ½éœ€è¦æ¶ˆè€—ä¸€å®šçš„ç³»ç»Ÿèµ„æºã€‚ æœ€ä½³å®è·µï¼š ä¿å­˜ä¸€ä¸ªå¯¹è±¡åœ¨æŸä¸€ä¸ªæ—¶åˆ»çš„å…¨éƒ¨çŠ¶æ€æˆ–éƒ¨åˆ†çŠ¶æ€ï¼Œè¿™æ ·ä»¥åéœ€è¦æ—¶å®ƒèƒ½å¤Ÿæ¢å¤åˆ°å…ˆå‰çš„çŠ¶æ€ï¼Œå®ç°æ’¤é”€æ“ä½œã€‚ é˜²æ­¢å¤–ç•Œå¯¹è±¡ç ´åä¸€ä¸ªå¯¹è±¡å†å²çŠ¶æ€çš„å°è£…æ€§ï¼Œé¿å…å°†å¯¹è±¡å†å²çŠ¶æ€çš„å®ç°ç»†èŠ‚æš´éœ²ç»™å¤–ç•Œå¯¹è±¡ã€‚ åç§° ä½œç”¨ åŸå‘å™¨ç±»ï¼ˆOriginatorï¼‰ åˆ›å»ºä¸€ä¸ªå¤‡å¿˜å½•å¯¹è±¡ï¼Œä½¿ç”¨å¤‡å¿˜å½•å­˜å‚¨å®ƒçš„å†…éƒ¨çŠ¶æ€ è´Ÿè´£äººç±»ï¼ˆCareTakerï¼‰ è´Ÿè´£ä¿å­˜å¥½å¤‡å¿˜å½•å¯¹è±¡ï¼Œä¸èƒ½æ£€æŸ¥æˆ–æ“ä½œå¤‡å¿˜å½•çš„å†…å®¹ å¤‡å¿˜å½•ç±»ï¼ˆMementoï¼‰ å°†åŸå‘å™¨çš„å†…éƒ¨çŠ¶æ€å­˜å‚¨èµ·æ¥ï¼ŒåŸå‘å™¨æ ¹æ®éœ€è¦å†³å®šå¤‡å¿˜å½•å­˜å‚¨åŸå‘å™¨çš„å“ªäº›å†…éƒ¨çŠ¶æ€ ä¸¾ä¾‹ï¼šå†’é™©å²›é—¯å…³ 1.åˆ›å»ºæ¸¸æˆç±» public class AdventureIslandGame { /**å…³å¡*/ private Integer point; /**å»ºæ¡£*/ public GameMemento createMemento(Integer point){ return new GameMemento(point); } /**å¼€å§‹æ¸¸æˆ*/ public void play(){ point = 1; } /**æ¢å¤å¤‡ä»½*/ public void restore(GameMemento gameMemento){ this.point = gameMemento.getPoint(); } public Integer getPoint() { return point; } public void setPoint(Integer point) { this.point = point; } } 2.åˆ›å»ºå¤‡ä»½ public class GameMemento { /**å…³å¡*/ private Integer point; /** * å¤‡ä»½å…³å¡ */ public GameMemento(int point){ this.point = point; } public Integer getPoint() { return point; } public void setPoint(Integer point) { this.point = point; } } 3.åˆ›å»ºå¤‡ä»½ç®¡ç†ç±» public class Caretaker { private GameMemento gameMemento; /**æ¢å¤å¤‡ä»½*/ public GameMemento retrieveMemento(){ return this.gameMemento; } /**ä¿å­˜å¤‡ä»½*/ public void saveMemento(GameMemento gameMemento){ this.gameMemento = gameMemento; } } 4.æµ‹è¯• public class MpTest { public static void main(String[] args) { System.out.println("[å†’é™©å²›é—¯å…³æ¸¸æˆ]"); AdventureIslandGame game = new AdventureIslandGame(); System.out.println("æ¸¸æˆå¼€å§‹"); game.play(); System.out.println("è¿›å…¥ç¬¬"+game.getPoint()+"å…³"); System.out.println("å‡»æ€ç¬¬"+game.getPoint()+"å…³boss,è¿›å…¥ä¸‹ä¸€å…³"); System.out.println("åˆ›å»ºæ–°æ¡£..."); GameMemento gameMemento = game.createMemento(game.getPoint()); Caretaker caretaker = new Caretaker(); caretaker.saveMemento(gameMemento); System.out.println("~~~~~~ç¬¬"+game.getPoint()+"å…³,å­˜æ¡£å®Œæˆ~~~~~~"); game.setPoint(game.getPoint()+1); System.out.println("è¿›å…¥ç¬¬"+game.getPoint()+"å…³"); System.out.println("å‡»æ€ç¬¬"+game.getPoint()+"å…³boss,è¿›å…¥ä¸‹ä¸€å…³"); gameMemento.setPoint(game.getPoint()); caretaker.saveMemento(gameMemento); System.out.println("~~~~~~ç¬¬"+game.getPoint()+"å…³,å­˜æ¡£å®Œæˆ~~~~~~"); game.setPoint(game.getPoint()+1); System.out.println("è¿›å…¥ç¬¬"+game.getPoint()+"å…³"); System.out.println("è¢«ç¬¬"+game.getPoint()+"å…³bossæ€æ­»,æ¸¸æˆç»“æŸ"); System.out.println("å›é€€å…³å¡..."); game.restore(caretaker.retrieveMemento()); System.out.println("~~~~~~å›é€€å®Œæˆ,å½“å‰å…³å¡ç¬¬"+game.getPoint()+"å…³~~~~~~"); game.setPoint(game.getPoint()+1); System.out.println("è·å–å½“å‰å…³å¡ï¼šè¿›å…¥ç¬¬"+game.getPoint()+"å…³"); } } 5.è¾“å‡º [å†’é™©å²›é—¯å…³æ¸¸æˆ] æ¸¸æˆå¼€å§‹ è¿›å…¥ç¬¬1å…³ å‡»æ€ç¬¬1å…³boss,è¿›å…¥ä¸‹ä¸€å…³ åˆ›å»ºæ–°æ¡£... è¿›å…¥ç¬¬2å…³ å‡»æ€ç¬¬2å…³boss,è¿›å…¥ä¸‹ä¸€å…³ â€‹~~~~~~ç¬¬2å…³,å­˜æ¡£å®Œæˆ~~~~~~ è¿›å…¥ç¬¬3å…³ è¢«ç¬¬3å…³bossæ€æ­»,æ¸¸æˆç»“æŸ å›é€€å…³å¡... â€‹~~~~~~å›é€€å®Œæˆ,å½“å‰å…³å¡ç¬¬2å…³~~~~~~ è·å–å½“å‰å…³å¡ï¼šè¿›å…¥ç¬¬3å…³ 3.7. å‘½ä»¤æ¨¡å¼ï¼ˆCPï¼‰è‹±æ–‡ï¼šCommand Pattern å®šä¹‰ï¼š å°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œä½¿æˆ‘ä»¬å¯ç”¨ä¸åŒçš„è¯·æ±‚å¯¹ç”¨æˆ·è¿›è¡Œå‚æ•°åŒ–ï¼›å¯¹è¯·æ±‚æ’é˜Ÿæˆ–è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œä»¥åŠæ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚ åç§° ä½œç”¨ æŠ½è±¡å‘½ä»¤è€…ï¼ˆCommandï¼‰ å®šä¹‰å‘½ä»¤çš„æ¥å£ï¼Œå£°æ˜æ‰§è¡Œçš„æ–¹æ³•ã€‚ å…·ä½“å‘½ä»¤ç±»ï¼ˆConcreteCommandï¼‰ å‘½ä»¤æ¥å£å®ç°å¯¹è±¡ï¼Œæ˜¯â€œè™šâ€çš„å®ç°ï¼›é€šå¸¸ä¼šæŒæœ‰æ¥æ”¶è€…ï¼Œå¹¶è°ƒç”¨æ¥æ”¶è€…çš„åŠŸèƒ½æ¥å®Œæˆå‘½ä»¤è¦æ‰§è¡Œçš„æ“ä½œã€‚ æ¥æ”¶è€…ï¼ˆReceiverï¼‰ çœŸæ­£æ‰§è¡Œå‘½ä»¤çš„å¯¹è±¡ã€‚ä»»ä½•ç±»éƒ½å¯èƒ½æˆä¸ºä¸€ä¸ªæ¥æ”¶è€…ï¼Œåªè¦å®ƒèƒ½å¤Ÿæ ¹æ®å‘½ä»¤è¦æ±‚å®ç°çš„ç›¸åº”åŠŸèƒ½ã€‚ è°ƒç”¨è€…ï¼ˆInvokerï¼‰ è¦æ±‚å‘½ä»¤è¦æ±‚å‘½ä»¤å¯¹è±¡æ‰§è¡Œè¯·æ±‚ï¼Œé€šå¸¸ä¼šæŒæœ‰å‘½ä»¤å¯¹è±¡ï¼Œå¯ä»¥æŒæœ‰å¾ˆå¤šçš„å‘½ä»¤å¯¹è±¡ã€‚è¿™æ˜¯ç”¨æˆ·ç«¯çœŸæ­£å‡ºå‘å‘½ä»¤å¹¶è¦æ±‚å‘½ä»¤æ‰§è¡Œç›¸åº”æ“ä½œçš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç›¸å½“äºä½¿ç”¨å‘½ä»¤å¯¹è±¡çš„å…¥å£ã€‚ å…·ä½“å‘½ä»¤å¯¹è±¡ï¼ˆclientï¼‰ åˆ›å»ºå…·ä½“çš„å‘½ä»¤å¯¹è±¡ï¼Œå¹¶ä¸”è®¾ç½®å‘½ä»¤å¯¹è±¡çš„æ¥æ”¶è€…ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºè£…é…è€…ã€‚ ä¼˜ç‚¹ï¼š é™ä½ç³»ç»Ÿçš„è€¦åˆåº¦ã€‚ç”±äºè¯·æ±‚è€…ä¸æ¥æ”¶è€…ä¹‹é—´ä¸å­˜åœ¨ç›´æ¥å¼•ç”¨ï¼Œå› æ­¤è¯·æ±‚è€…ä¸æ¥æ”¶è€…ä¹‹é—´å®ç°å®Œå…¨è§£è€¦ï¼Œç›¸åŒçš„è¯·æ±‚è€…å¯ä»¥å¯¹åº”ä¸åŒçš„æ¥æ”¶è€…ï¼ŒåŒæ ·ï¼Œç›¸åŒçš„æ¥æ”¶è€…ä¹Ÿå¯ä»¥ä¾›ä¸åŒçš„è¯·æ±‚è€…ä½¿ç”¨ï¼Œä¸¤è€…ä¹‹é—´å…·æœ‰è‰¯å¥½çš„ç‹¬ç«‹æ€§ã€‚ æ–°çš„å‘½ä»¤å¯ä»¥å¾ˆå®¹æ˜“åœ°åŠ å…¥åˆ°ç³»ç»Ÿä¸­ã€‚ç”±äºå¢åŠ æ–°çš„å…·ä½“å‘½ä»¤ç±»ä¸ä¼šå½±å“åˆ°å…¶ä»–ç±»ï¼Œå› æ­¤å¢åŠ æ–°çš„å…·ä½“å‘½ä»¤ç±»å¾ˆå®¹æ˜“ï¼Œæ— é¡»ä¿®æ”¹åŸæœ‰ç³»ç»Ÿæºä»£ç ï¼Œç”šè‡³å®¢æˆ·ç±»ä»£ç ï¼Œæ»¡è¶³â€œå¼€é—­åŸåˆ™â€çš„è¦æ±‚ã€‚ ç¼ºç‚¹ï¼šä½¿ç”¨å‘½ä»¤æ¨¡å¼å¯èƒ½ä¼šå¯¼è‡´æŸäº›ç³»ç»Ÿæœ‰è¿‡å¤šçš„å…·ä½“å‘½ä»¤ç±»ã€‚å› ä¸ºé’ˆå¯¹æ¯ä¸€ä¸ªå¯¹è¯·æ±‚æ¥æ”¶è€…çš„è°ƒç”¨æ“ä½œéƒ½éœ€è¦è®¾è®¡ä¸€ä¸ªå…·ä½“å‘½ä»¤ç±»ï¼Œå› æ­¤åœ¨æŸäº›ç³»ç»Ÿä¸­å¯èƒ½éœ€è¦æä¾›å¤§é‡çš„å…·ä½“å‘½ä»¤ç±»ï¼Œè¿™å°†å½±å“å‘½ä»¤æ¨¡å¼çš„ä½¿ç”¨ã€‚ æœ€ä½³å®è·µï¼š 1.ç³»ç»Ÿéœ€è¦å°†è¯·æ±‚è°ƒç”¨è€…å’Œè¯·æ±‚æ¥æ”¶è€…è§£è€¦ï¼Œä½¿å¾—è°ƒç”¨è€…å’Œæ¥æ”¶è€…ä¸ç›´æ¥äº¤äº’ã€‚ 2.ç³»ç»Ÿéœ€è¦åœ¨ä¸åŒçš„æ—¶é—´æŒ‡å®šè¯·æ±‚ã€å°†è¯·æ±‚æ’é˜Ÿå’Œæ‰§è¡Œè¯·æ±‚ã€‚ ä¸¾ä¾‹ï¼šSiriè¯­éŸ³åŠ©æ‰‹ 1.åˆ›å»ºå‘½ä»¤æ¥å£ public interface Command { //æ‰§è¡Œå‘½ä»¤ void execute(); } 2.åˆ›å»ºå…·ä½“å®ç°å‘½ä»¤å®ç°ç±» public class OpenCommand implements Command { private Application app; public OpenCommand(Application app){ this.app = app; } @Override public void execute() { app.on(); } } public class CloseCommand implements Command { private Application app; public CloseCommand(Application app){ this.app = app; } @Override public void execute() { app.off(); } } 3.åˆ›å»ºåº”ç”¨æŠ½è±¡ç±» public abstract class Application { public abstract void on(); public abstract void off(); } 4.åˆ›å»ºåº”ç”¨å®ç°ç±» public class WeChat extends Application { @Override public void on() { System.out.println("å¾®ä¿¡æ‰“å¼€äº†"); } @Override public void off() { System.out.println("å¾®ä¿¡å…³é—­äº†"); } } public class Alipay extends Application { @Override public void on() { System.out.println("æ”¯ä»˜å®æ‰“å¼€äº†"); } @Override public void off() { System.out.println("æ”¯ä»˜å®å…³é—­äº†"); } } 5.å®ç°å‘½ä»¤å‘èµ·è€… public class Siri { private Command command; /** * è®¾ç½®è¦æ‰§è¡Œçš„å‘½ä»¤ * @param command å‘½ä»¤ */ public void setCommand(Command command){ this.command = command; } /** * æ‰§è¡Œå‘½ä»¤ */ public void executeCommand(){ command.execute(); } } 6.æµ‹è¯• public class CpTest { public static void main(String[] args) { Siri siri = new Siri(); System.out.println("å˜¿ siriï¼Œ æ‰“å¼€å¾®ä¿¡"); Application weChat = new WeChat(); Command command = new OpenCommand(weChat); //siriä¼ é€’å‘½ä»¤ siri.setCommand(command); siri.executeCommand(); System.out.println("å˜¿ siriï¼Œæ‰“å¼€æ”¯ä»˜å®"); Application alipay = new Alipay(); command = new OpenCommand(alipay); //siriä¼ é€’å‘½ä»¤ siri.setCommand(command); siri.executeCommand(); } } 7.è¾“å‡º å˜¿ siriï¼Œ æ‰“å¼€å¾®ä¿¡ å¾®ä¿¡æ‰“å¼€äº† å˜¿ siriï¼Œæ‰“å¼€æ”¯ä»˜å® æ”¯ä»˜å®æ‰“å¼€äº† 3.8. ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMPï¼‰è‹±æ–‡ï¼šMediator Pattern å®šä¹‰ï¼šä¸­ä»‹è€…æ¨¡å¼æ˜¯æŒ‡ç”¨ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—çš„å¯¹è±¡äº¤äº’ã€‚ä¸­ä»‹è€…ä½¿ä¸ªå¯¹è±¡ä¸éœ€è¦æ˜¾ç¤ºçš„ç›¸äº’å¼•ç”¨ï¼Œä»è€Œä½¿å…¶è€¦åˆæ¾æ•£ï¼Œè€Œä¸”å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚ ä¼˜ç‚¹ï¼š 1.ç®€åŒ–äº†å¯¹è±¡ä¹‹é—´çš„äº¤äº’ï¼Œå®ƒç”¨ä¸­ä»‹è€…å’ŒåŒäº‹çš„ä¸€å¯¹å¤šäº¤äº’ä»£æ›¿äº†åŸæ¥åŒäº‹ä¹‹é—´çš„å¤šå¯¹å¤šäº¤äº’ï¼Œä¸€å¯¹å¤šå…³ç³»æ›´å®¹æ˜“ç†è§£ã€ç»´æŠ¤æ‰©å±•ï¼Œå°†åŸæœ¬éš¾ä»¥ç†è§£çš„ç½‘çŠ¶ç»“æ„è½¬æ¢æˆç›¸å¯¹ç®€å•çš„æ˜Ÿå‹ç»“æ„ã€‚ 2.å¯å°†å„åŒäº‹å¯¹è±¡è§£è€¦ã€‚ä¸­ä»‹è€…æœ‰åˆ©äºå„åŒäº‹ä¹‹é—´çš„æ¾è€¦åˆï¼Œæˆ‘ä»¬å¯ä»¥ç‹¬ç«‹çš„æ”¹å˜å’Œå¤ç”¨æ¯ä¸€ä¸ªåŒäº‹å’Œä¸­ä»‹è€…ï¼Œå¢åŠ æ–°çš„ä¸­ä»‹è€…å’Œæ–°çš„åŒäº‹ç±»éƒ½æ¯”è¾ƒæ–¹ä¾¿ï¼Œæ›´å¥½çš„ç¬¦åˆâ€œå¼€é—­åŸåˆ™â€ã€‚ 3.å¯ä»¥å‡å°‘å­ç±»ç”Ÿæˆï¼Œä¸­ä»‹è€…å°†åŸæœ¬åˆ†å¸ƒäºå¤šä¸ªå¯¹è±¡é—´çš„è¡Œä¸ºé›†ä¸­åœ¨ä¸€èµ·ï¼Œæ”¹å˜è¿™äº›è¡Œä¸ºåªéœ€ç”Ÿæˆæ–°çš„ä¸­ä»‹è€…å­ç±»å³å¯ï¼Œè¿™ä½¿å¾—å„ä¸ªåŒäº‹ç±»å¯è¢«é‡ç”¨ï¼Œæ— é¡»å¯¹åŒäº‹ç±»è¿›è¡Œæ‰©å±•ã€‚ ç¼ºç‚¹ï¼šåœ¨å…·ä½“ä¸­ä»‹è€…ç±»ä¸­åŒ…å«äº†å¤§é‡åŒäº‹ä¹‹é—´çš„äº¤äº’ç»†èŠ‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…·ä½“ä¸­ä»‹è€…ç±»éå¸¸å¤æ‚ï¼Œä½¿å¾—ç³»ç»Ÿéš¾ä»¥ç»´æŠ¤ã€‚ æœ€ä½³å®è·µï¼š 1.ç³»ç»Ÿä¸­å¯¹è±¡ä¹‹é—´å­˜åœ¨å¤æ‚çš„å¼•ç”¨å…³ç³»ï¼Œç³»ç»Ÿç»“æ„æ··ä¹±ä¸”éš¾ä»¥ç†è§£ã€‚ 2.ä¸€ä¸ªå¯¹è±¡ç”±äºå¼•ç”¨äº†å…¶ä»–å¾ˆå¤šå¯¹è±¡å¹¶ä¸”ç›´æ¥å’Œè¿™äº›å¯¹è±¡é€šä¿¡ï¼Œå¯¼è‡´éš¾ä»¥å¤ç”¨è¯¥å¯¹è±¡ã€‚ 3.æƒ³é€šè¿‡ä¸€ä¸ªä¸­é—´ç±»æ¥å°è£…å¤šä¸ªç±»ä¸­çš„è¡Œä¸ºï¼Œè€Œåˆä¸æƒ³ç”Ÿæˆå¤ªå¤šçš„å­ç±»ã€‚å¯ä»¥é€šè¿‡å¼•å…¥ä¸­ä»‹è€…ç±»æ¥å®ç°ï¼Œåœ¨ä¸­ä»‹è€…ä¸­å®šä¹‰å¯¹è±¡äº¤äº’çš„å…¬å…±è¡Œä¸ºï¼Œå¦‚æœéœ€è¦æ”¹å˜è¡Œä¸ºåˆ™å¯ä»¥å¢åŠ æ–°çš„å…·ä½“ä¸­ä»‹è€…ç±»ã€‚ ä¸¾ä¾‹ï¼šåŒäº‹ç±»ç›¸äº’å½±å“ 1.åˆ›å»ºåŒäº‹ç±»æŠ½è±¡ç±» public abstract class Colleague { protected int number; public int getNumber() { return number; } public void setNumber(int number){ this.number = number; } public abstract void setNumber(int number, Mediator mediator); } 2.åˆ›å»ºåŒäº‹ç±»å®ç°ç±» public class ColleagueA extends Colleague{ @Override public void setNumber(int number, Mediator mediator) { this.number = number; mediator.A2B(); } } public class ColleagueB extends Colleague{ @Override public void setNumber(int number, Mediator mediator) { this.number = number; mediator.B2A(); } } 3.åˆ›å»ºä¸­ä»‹è€…æŠ½è±¡ç±» public abstract class Mediator { protected Colleague ca; protected Colleague cb; public Mediator(Colleague a, Colleague b) { this.ca = a; this.cb = b; } public abstract void A2B(); public abstract void B2A(); } 4.åˆ›å»ºä¸­ä»‹è€…å®ç°ç±» public class MediatorImpl extends Mediator { public MediatorImpl(Colleague a, Colleague b) { super(a, b); } @Override public void A2B() { int number = ca.getNumber(); cb.setNumber(number*100); } @Override public void B2A() { int number = cb.getNumber(); ca.setNumber(number/100); } } 5.æµ‹è¯• public class MpTest { public static void main(String[] args) { ColleagueA colleagueA = new ColleagueA(); ColleagueB colleagueB = new ColleagueB(); Mediator mediator = new MediatorImpl(colleagueA,colleagueB); System.out.println("++++++++++++é€šè¿‡è®¾ç½®Aå½±å“B++++++++++++"); colleagueA.setNumber(1000,mediator); System.out.println("Açš„å€¼ä¸ºï¼š"+colleagueA.getNumber()); System.out.println("Bçš„å€¼ä¸ºAçš„10å€ï¼š"+colleagueB.getNumber()); System.out.println("++++++++++++é€šè¿‡è®¾ç½®Bå½±å“A++++++++++++"); colleagueB.setNumber(2000,mediator); System.out.println("Bçš„å€¼ä¸ºï¼š"+colleagueB.getNumber()); System.out.println("Açš„å€¼ä¸ºBçš„0.1å€ï¼š"+colleagueA.getNumber()); } } 6.è¾“å‡º ++++++++++++é€šè¿‡è®¾ç½®Aå½±å“B++++++++++++ Açš„å€¼ä¸ºï¼š1000 Bçš„å€¼ä¸ºAçš„10å€ï¼š100000 ++++++++++++é€šè¿‡è®¾ç½®Bå½±å“A++++++++++++ Bçš„å€¼ä¸ºï¼š2000 Açš„å€¼ä¸ºBçš„0.1å€ï¼š20 3.9. èŒè´£é“¾æ¨¡å¼ï¼ˆCRPï¼‰è‹±æ–‡ï¼šChain of Responsibility Pattern å®šä¹‰ï¼šè´£ä»»é“¾æ¨¡å¼æ˜¯ä¸ºäº†é¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œä½¿å¤šä¸ªæ¥æ”¶å¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ã€‚å°†è¿™äº›å¯¹è±¡ç»ƒæˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯¥è¯·æ±‚ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚ èŒè´£é“¾åˆ†ç±» å®šä¹‰ çº¯çš„èŒè´£é“¾æ¨¡å¼ çº¯çš„èŒè´£é“¾æ¨¡å¼è¦æ±‚ä¸€ä¸ªå…·ä½“çš„å¤„ç†è€…å¯¹è±¡åªèƒ½åœ¨ä¸¤ä¸ªè¡Œä¸ºä¸­é€‰æ‹©ä¸€ä¸ªï¼šä¸€ä¸ªæ˜¯æ‰¿æ‹…è´£ä»»ï¼›äºŒæ˜¯æŠŠè´£ä»»æ¨ç»™ä¸‹å®¶ã€‚ä¸å…è®¸å‡ºç°æŸä¸€ä¸ªå…·ä½“å¤„ç†è€…å¯¹è±¡åœ¨æ‰¿æ‹…äº†ä¸€éƒ¨åˆ†è´£ä»»ååˆæŠŠè´£ä»»å‘ä¸‹ä¼ çš„æƒ…å†µã€‚åœ¨ä¸€ä¸ªçº¯çš„èŒè´£é“¾ä¸­ï¼Œä¸€ä¸ªè¯·æ±‚å¿…é¡»è¢«æŸä¸€ä¸ªå¤„ç†è€…å¯¹è±¡æ‰€æ¥å—ã€‚ ä¸çº¯çš„èŒè´£é“¾æ¨¡å¼ ä¸çº¯çš„èŒè´£é“¾æ¨¡å¼ä¸­å…è®¸æŸä¸ªè¯·æ±‚è¢«ä¸€ä¸ªå…·ä½“å¤„ç†è€…éƒ¨åˆ†å¤„ç†åå†å‘ä¸‹ä¼ é€’ï¼Œæˆ–è€…ä¸€ä¸ªå…·ä½“å¤„ç†è€…å¤„ç†å®ŒæŸè¯·æ±‚åå…¶åç»§å¤„ç†è€…å¯ä»¥ç»§ç»­å¤„ç†è¯¥è¯·æ±‚ï¼Œè€Œä¸”ä¸€ä¸ªè¯·æ±‚å¯ä»¥æœ€ç»ˆä¸è¢«ä»»ä½•å¤„ç†è€…å¯¹è±¡æ‰€æ¥æ”¶ã€‚ ä¼˜ç‚¹ï¼š 1.è¯·æ±‚ä¸éœ€è¦æŒ‡å‡ºè¢«å“ªä¸ªå¯¹è±¡å¤„ç†äº†ï¼Œè¿™æ ·çš„æ•ˆæœæ˜¯è¯·æ±‚è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è§£è€¦ï¼Œè€Œä¸”é“¾ä¸­çš„å¯¹è±¡ä¹Ÿä¸éœ€è¦æ¸…æ¥šå…¶ä»–é“¾çš„ç»“æ„ï¼Œä¹Ÿé™ä½äº†è€¦åˆã€‚ 2.è¯·æ±‚å¤„ç†å¯¹è±¡ä»…éœ€è¦ç»´æŠ¤ä¸€ä¸ªæŒ‡å‘å…¶åç»§è€…çš„çš„å¼•ç”¨ï¼Œè€Œä¸éœ€è¦ç»´æŠ¤æ‰€æœ‰çš„å¤„ç†å¯¹è±¡ï¼Œç®€åŒ–äº†å¯¹è±¡ä¹‹é—´çš„ç›¸äº’è¿æ¥ã€‚ 3.åœ¨ç»™å¯¹è±¡åˆ†æ´¾èŒè´£æ—¶ï¼ŒèŒè´£é“¾å¯ä»¥ç»™æˆ‘ä»¬æ›´å¤šçš„çµæ´»æ€§ï¼Œå¯ä»¥é€šè¿‡åœ¨è¿è¡Œæ—¶å¯¹è¯¥é“¾è¿›è¡ŒåŠ¨æ€çš„å¢åŠ æˆ–ä¿®æ”¹æ¥å¢åŠ æˆ–æ”¹å˜å¤„ç†ä¸€ä¸ªè¯·æ±‚çš„èŒè´£ã€‚ 4.æ–°å¢ä¸€ä¸ªè¯·æ±‚å¤„ç†å¯¹è±¡ï¼Œä¸éœ€è¦æ”¹åŠ¨ç°æœ‰ä»£ç ï¼Œåªéœ€è¦é‡æ–°è®¾ç½®è¿æ¥å³å¯ï¼Œç¬¦åˆâ€œå¼€é—­åŸåˆ™â€ã€‚ ç¼ºç‚¹ï¼š 1.å¦‚æœä¸€ä¸ªè¯·æ±‚æ²¡æœ‰æ˜ç¡®çš„æ¥æ”¶è€…ï¼Œé‚£ä¹ˆå°±ä¸èƒ½ä¿è¯å®ƒä¸€å®šä¼šè¢«å¤„ç†ï¼Œè¯¥è¯·æ±‚å¯èƒ½ä¸€ç›´åˆ°é“¾çš„æœ«ç«¯éƒ½å¾—ä¸åˆ°å¤„ç†ï¼›ä¸€ä¸ªè¯·æ±‚ä¹Ÿå¯èƒ½å› èŒè´£é“¾æ²¡æœ‰è¢«æ­£ç¡®é…ç½®è€Œå¾—ä¸åˆ°å¤„ç†ã€‚ 2.å¯¹äºæ¯”è¾ƒé•¿çš„èŒè´£é“¾ï¼Œè¯·æ±‚çš„å¤„ç†å¯èƒ½æ¶‰åŠåˆ°å¤šä¸ªå¤„ç†å¯¹è±¡ï¼Œä¸ä»…å¢åŠ äº†ä»£ç çš„å¤æ‚æ€§å¹¶ä¸”ç³»ç»Ÿæ€§èƒ½ä¹Ÿå°†å—åˆ°ä¸€å®šå½±å“ï¼Œè€Œä¸”åœ¨è¿›è¡Œä»£ç è°ƒè¯•æ—¶ä¸å¤ªæ–¹ä¾¿ã€‚ 3.è‹¥å»ºé“¾ä¸å½“ï¼Œå¯èƒ½ä¼šé€ æˆå¾ªç¯è°ƒç”¨ï¼Œå°†å¯¼è‡´ç³»ç»Ÿé™·å…¥æ­»å¾ªç¯ã€‚ æœ€ä½³å®è·µï¼š 1.æœ‰å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†åŒä¸€ä¸ªè¯·æ±‚ï¼Œå…·ä½“å“ªä¸ªå¯¹è±¡å¤„ç†è¯¥è¯·æ±‚å¾…è¿è¡Œæ—¶åˆ»å†ç¡®å®šï¼Œå®¢æˆ·ç«¯åªéœ€å°†è¯·æ±‚æäº¤åˆ°é“¾ä¸Šï¼Œè€Œæ— é¡»å…³å¿ƒè¯·æ±‚çš„å¤„ç†å¯¹è±¡æ˜¯è°ä»¥åŠå®ƒæ˜¯å¦‚ä½•å¤„ç†çš„ã€‚ 2.åœ¨ä¸æ˜ç¡®æŒ‡å®šæ¥æ”¶è€…çš„æƒ…å†µä¸‹ï¼Œå‘å¤šä¸ªå¯¹è±¡ä¸­çš„ä¸€ä¸ªæäº¤ä¸€ä¸ªè¯·æ±‚ã€‚ 3.å¯åŠ¨æ€æŒ‡å®šä¸€ç»„å¯¹è±¡å¤„ç†è¯·æ±‚ï¼Œå®¢æˆ·ç«¯å¯ä»¥åŠ¨æ€åˆ›å»ºèŒè´£é“¾æ¥å¤„ç†è¯·æ±‚ï¼Œè¿˜å¯ä»¥æ”¹å˜é“¾ä¸­å¤„ç†è€…ä¹‹é—´çš„å…ˆåæ¬¡åºã€‚å…¶å®åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ä¹Ÿä¼šæœ‰é€‚ç”¨åˆ°è´£ä»»é“¾æ¨¡å¼çš„åœºæ™¯ï¼Œtry/catchã€servlet(å„ä¸ªserveltäº’ç›¸è°ƒç”¨)ã€ä»¥åŠfilterç­‰ ä¸¾ä¾‹ï¼šè¯·å‡å®¡æ‰¹ 1.åˆ›å»ºè¯·å‡å¯¹è±¡ public class Leave { //å§“å private String name; //éƒ¨é—¨ private String department; //å¤©æ•° private Double day; //åŸå›  private String cause; public String getName() { return name; } public void setName(String name) { this.name = name; } public String getDepartment() { return department; } public void setDepartment(String department) { this.department = department; } public Double getDay() { return day; } public void setDay(Double day) { this.day = day; } public String getCause() { return cause; } public void setCause(String cause) { this.cause = cause; } @Override public String toString() { return "Leave{" + "name='" + name + '\'' + ", department='" + department + '\'' + ", day=" + day + ", cause='" + cause + '\'' + '}'; } } 2.åˆ›å»ºå®¡æ‰¹è€…æŠ½è±¡ç±» public abstract class Approver { //å®¡æ ¸äººå public String name; //ä¸‹ä¸€ä¸ªå®¡æ ¸äºº public Approver nextApprove; public Approver(String name) { this.name = name; } //è®¾ç½®ä¸‹ä¸€ä¸ªå®¡æ ¸äºº public void setNextApprove(Approver nextApprove) { this.nextApprove = nextApprove; } //å®¡æ ¸ public abstract void approval(Leave leave); } 3.åˆ›å»ºå®¡æ‰¹è€…å®ç°ç±» public class Manager extends Approver { public Manager(String name) { super(name); } @Override public void approval(Leave leave) { if(leave.getDay() &lt; 5){ System.out.println(name+"æƒé™èŒƒå›´å†…,æ‰¹å‡†äº†"); System.out.println("ç»“æŸå®¡æ‰¹"); }else{ if(Objects.nonNull(nextApprove)){ System.out.println(name+"æƒé™èŒƒå›´å¤–,ç§»äº¤ä¸Šä¸€çº§é¢†å¯¼"); this.nextApprove.approval(leave); }else{ System.out.println("é¢†å¯¼ä¸åœ¨,å®¡æ‰¹è´¨æŠ¼"); } } } } public class Boss extends Approver { public Boss(String name) { super(name); } @Override public void approval(Leave leave) { if (leave.getDay() > 5 &amp;&amp; leave.getDay() &lt; 10) { System.out.println(name+"ï¼šæœªè¶…é¢„æœŸ,æ‰¹å‡†"); System.out.println("ç»“æŸå®¡æ‰¹"); } else { System.out.println(name+"æ—¶é—´å¤ªé•¿äº†,å½±å“å…¬å¸æŒ£é’±,é©³å›"); System.out.println("ç»“æŸå®¡æ‰¹"); } } } 4.æµ‹è¯• public class CrpTest { public static void main(String[] args) { Leave leave = new Leave(); leave.setName("å°ç‹"); leave.setDepartment("ç ”å‘éƒ¨"); leave.setDay(8.0D); leave.setCause("ç»“å©š"); Manager manager = new Manager("æç»ç†"); Boss boss = new Boss("é’±æ€»"); manager.setNextApprove(boss); System.out.println("è¯·å‡å‘èµ·è€…ï¼š"+leave.toString()); manager.approval(leave); } } 5.è¾“å‡º è¯·å‡å‘èµ·è€…ï¼šLeave{name='å°ç‹', department='ç ”å‘éƒ¨', day=8.0, cause='ç»“å©š'} æç»ç†æƒé™èŒƒå›´å¤–,ç§»äº¤ä¸Šä¸€çº§é¢†å¯¼ é’±æ€»ï¼šæœªè¶…é¢„æœŸ,æ‰¹å‡† ç»“æŸå®¡æ‰¹ 3.10. è®¿é—®è€…æ¨¡å¼ï¼ˆVPï¼‰è‹±æ–‡ï¼šVisitor Pattern å®šä¹‰ï¼šè¡¨ç¤ºä¸€ä¸ªä½œç”¨äºæŸå¯¹è±¡ç»“æ„ä¸­çš„å„å…ƒç´ çš„æ“ä½œã€‚å®ƒä½¿ä½ å¯ä»¥åœ¨ä¸æ”¹å˜å„å…ƒç´ ç±»çš„å‰æä¸‹å®šä¹‰ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°æ“ä½œã€‚ ä¼˜ç‚¹ï¼š 1.ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ 2.ä¼˜ç§€çš„æ‰©å±•æ€§ 3.çµæ´»æ€§ ç¼ºç‚¹ï¼š 1.å…·ä½“å…ƒç´ å¯¹è®¿é—®è€…å…¬å¸ƒç»†èŠ‚ï¼Œè¿åäº†è¿ªç±³ç‰¹åŸåˆ™ 2.å…·ä½“å…ƒç´ å˜æ›´æ¯”è¾ƒå›°éš¾ 3.è¿åäº†ä¾èµ–å€’ç½®åŸåˆ™ï¼Œä¾èµ–äº†å…·ä½“ç±»ï¼Œæ²¡æœ‰ä¾èµ–æŠ½è±¡ã€‚ æœ€ä½³å®è·µï¼š 1.å¯¹è±¡ç»“æ„ä¸­å¯¹è±¡å¯¹åº”çš„ç±»å¾ˆå°‘æ”¹å˜ï¼Œä½†ç»å¸¸éœ€è¦åœ¨æ­¤å¯¹è±¡ç»“æ„ä¸Šå®šä¹‰æ–°çš„æ“ä½œã€‚ 2.éœ€è¦å¯¹ä¸€ä¸ªå¯¹è±¡ç»“æ„ä¸­çš„å¯¹è±¡è¿›è¡Œå¾ˆå¤šä¸åŒçš„å¹¶ä¸”ä¸ç›¸å…³çš„æ“ä½œï¼Œè€Œéœ€è¦é¿å…è®©è¿™äº›æ“ä½œâ€æ±¡æŸ“â€è¿™äº›å¯¹è±¡çš„ç±»ï¼Œä¹Ÿä¸å¸Œæœ›åœ¨å¢åŠ æ–°æ“ä½œæ—¶ä¿®æ”¹è¿™äº›ç±»ã€‚ æ³¨æ„äº‹é¡¹ï¼šè®¿é—®è€…å¯ä»¥å¯¹åŠŸèƒ½è¿›è¡Œç»Ÿä¸€ï¼Œå¯ä»¥åšæŠ¥è¡¨ã€UIã€æ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨ã€‚ ä¸¾ä¾‹ï¼š åœºæ™¯ï¼š CEOå’ŒCTOå¼€å§‹è¯„å®šå‘˜å·¥ä¸€å¹´çš„å·¥ä½œç»©æ•ˆï¼Œå‘˜å·¥åˆ†ä¸ºå·¥ç¨‹å¸ˆå’Œç»ç†ï¼ŒCTOå…³æ³¨å·¥ç¨‹å¸ˆçš„ä»£ç é‡ã€ç»ç†çš„æ–°äº§å“æ•°é‡ï¼›CEOå…³æ³¨çš„æ˜¯å·¥ç¨‹å¸ˆçš„KPIå’Œç»ç†çš„KPIä»¥åŠæ–°äº§å“æ•°é‡ã€‚ç”±äºCEOå’ŒCTOå¯¹äºä¸åŒå‘˜å·¥çš„å…³æ³¨ç‚¹æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™å°±éœ€è¦å¯¹ä¸åŒå‘˜å·¥ç±»å‹è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚è®¿é—®è€…æ¨¡å¼æ­¤æ—¶å¯ä»¥æ´¾ä¸Šç”¨åœºäº†ã€‚ 1.åˆ›å»ºæŠ½è±¡å‘˜å·¥ç±» public abstract class Staff { //å‘˜å·¥å§“å public String name; //å‘˜å·¥KPI public Integer kpi; public Staff(String name) { this.name = name; this.kpi = new Random().nextInt(10); } //æ¥å—visitorè®¿é—® public abstract void accept(Visitor visitor); } 2.åˆ›å»ºå‘˜å·¥å®ç°ç±» public class Engineer extends Staff { public Engineer(String name) { super(name); } @Override public void accept(Visitor visitor) { visitor.visit(this); } public int getCodeLines(){ return new Random().nextInt(100000); } } public class Manager extends Staff { public Manager(String name) { super(name); } @Override public void accept(Visitor visitor) { visitor.visit(this); } public int getProductNum(){ return new Random().nextInt(10); } } 3.åˆ›å»ºè§‚æ¥å£ public interface Visitor { // è®¿é—®å·¥ç¨‹å¸ˆç±»å‹ void visit(Engineer engineer); // è®¿é—®ç»ç†ç±»å‹ void visit(Manager manager); } 4.åˆ›å»ºè§‚å¯Ÿè€…æ¥å£å®ç°ç±» public class CEO implements Visitor { private String name; public CEO(String name) { this.name = name; } @Override public void visit(Engineer engineer) { System.out.println(name+"æŸ¥çœ‹:"+engineer.name+"çš„KPIï¼š"+engineer.kpi); } @Override public void visit(Manager manager) { System.out.println(name+"æŸ¥çœ‹:"+manager.name+"çš„KPIï¼š"+manager.kpi); } } public class CTO implements Visitor { private String name; public CTO(String name) { this.name = name; } @Override public void visit(Engineer engineer) { System.out.println(name+"æŸ¥çœ‹:"+engineer.name+"çš„ä»£ç æ•°ï¼š"+engineer.getCodeLines()); } @Override public void visit(Manager manager) { System.out.println(name+"æŸ¥çœ‹:"+manager.name+"çš„äº§å“æ•°ï¼š"+manager.getProductNum()); } } 5.åˆ›å»ºæŠ¥è¡¨ç±» public class ExcelReport { private List&lt;Staff> staffs = new ArrayList&lt;>(); public ExcelReport(){ staffs.add(new Manager("æç»ç†")); staffs.add(new Manager("å¼ ç»ç†")); staffs.add(new Engineer("å°ç‹")); staffs.add(new Engineer("å°æ")); } public void showReport(Visitor visitor){ for (Staff staff : staffs) { staff.accept(visitor); } } } 6.æµ‹è¯• public class VpTest { public static void main(String[] args) { ExcelReport excelReport = new ExcelReport(); excelReport.showReport(new CEO("å´è‘£")); excelReport.showReport(new CTO("ç¨‹æ€»")); } } 7.è¾“å‡º å´è‘£æŸ¥çœ‹:æç»ç†çš„KPIï¼š3 å´è‘£æŸ¥çœ‹:å¼ ç»ç†çš„KPIï¼š7 å´è‘£æŸ¥çœ‹:å°ç‹çš„KPIï¼š5 å´è‘£æŸ¥çœ‹:å°æçš„KPIï¼š8 ç¨‹æ€»æŸ¥çœ‹:æç»ç†çš„äº§å“æ•°ï¼š1 ç¨‹æ€»æŸ¥çœ‹:å¼ ç»ç†çš„äº§å“æ•°ï¼š3 ç¨‹æ€»æŸ¥çœ‹:å°ç‹çš„ä»£ç æ•°ï¼š55701 ç¨‹æ€»æŸ¥çœ‹:å°æçš„ä»£ç æ•°ï¼š31420 3.11. çŠ¶æ€æ¨¡å¼ï¼ˆSPï¼‰è‹±æ–‡ï¼šState Pattern å®šä¹‰ï¼šå…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶çŠ¶æ€æ”¹å˜æ—¶ï¼Œæ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¯¹è±¡çœ‹èµ·æ¥ä¼¼ä¹ä¿®æ”¹äº†å®ƒçš„ç±»ã€‚ ä¼˜ç‚¹ï¼š 1.å°è£…äº†çŠ¶æ€çš„è½¬æ¢è§„åˆ™ï¼Œåœ¨çŠ¶æ€æ¨¡å¼ä¸­å¯ä»¥å°†çŠ¶æ€è½¬æ¢çš„å·¥ä½œå°è£…åœ¨ç¯å¢ƒç±»æˆ–å…·ä½“çš„çŠ¶æ€ç±»ä¸­ï¼Œå¯ä»¥å¯¹çŠ¶æ€è½¬æ¢ç è¿›è¡Œé›†ä¸­ç®¡ç†ï¼Œè€Œä¸æ˜¯åˆ†æ•£åœ¨ä¸€ä¸ªä¸ªçš„ä¸šåŠ¡ä¸­ã€‚ 2.å°†æ‰€æœ‰ä¸æŸä¸ªçŠ¶æ€æœ‰å…³çš„è¡Œä¸ºæ”¾åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œåªéœ€è¦æ³¨å…¥ä¸€ä¸ªä¸åŒçš„çŠ¶æ€å¯¹è±¡å³å¯ä½¿ç¯å¢ƒå¯¹è±¡æ‹¥æœ‰ä¸åŒçš„è¡Œä¸ºã€‚ 3.å…è®¸çŠ¶æ€è½¬æ¢é€»è¾‘ä¸çŠ¶æ€å¯¹è±¡åˆä¸ºä¸€ä½“ï¼Œè€Œä¸æ˜¯æä¾›ä¸€ä¸ªå·¨å¤§çš„æ¡ä»¶è¯­å¥å—ï¼ŒçŠ¶æ€æ¨¡å¼å¯ä»¥è®©æˆ‘ä»¬é¿å…ä½¿ç”¨åºå¤§çš„æ¡ä»¶è¯­å¥æ¥å°†ä¸šåŠ¡æ–¹æ³•å’ŒçŠ¶æ€è½¬æ¢ä»£ç äº¤ç»‡åœ¨ä¸€èµ·ã€‚ ç¼ºç‚¹ï¼š 1.çŠ¶æ€æ¨¡å¼çš„ä½¿ç”¨å¿…ç„¶ä¼šå¢åŠ ç³»ç»Ÿä¸­ç±»å’Œå¯¹è±¡çš„ä¸ªæ•°ï¼Œå¯¼è‡´ç³»ç»Ÿè¿è¡Œå¼€é”€å¢å¤§ã€‚ 2.çŠ¶æ€æ¨¡å¼çš„ç»“æ„ä¸å®ç°éƒ½è¾ƒä¸ºå¤æ‚ï¼Œå¦‚æœä½¿ç”¨ä¸å½“å°†å¯¼è‡´ç¨‹åºç»“æ„å’Œä»£ç çš„æ··ä¹±ï¼Œå¢åŠ ç³»ç»Ÿè®¾è®¡çš„éš¾åº¦ã€‚ æœ€ä½³å®è·µï¼š 1.å¯¹è±¡çš„è¡Œä¸ºä¾èµ–äºå®ƒçš„çŠ¶æ€ï¼ˆå¦‚æŸäº›å±æ€§å€¼ï¼‰ï¼ŒçŠ¶æ€çš„æ”¹å˜å°†å¯¼è‡´è¡Œä¸ºçš„å˜åŒ–ã€‚ 2.åœ¨ä»£ç ä¸­åŒ…å«å¤§é‡ä¸å¯¹è±¡çŠ¶æ€æœ‰å…³çš„æ¡ä»¶è¯­å¥ï¼Œè¿™äº›æ¡ä»¶è¯­å¥çš„å‡ºç°ï¼Œä¼šå¯¼è‡´ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œçµæ´»æ€§å˜å·®ï¼Œä¸èƒ½æ–¹ä¾¿åœ°å¢åŠ å’Œåˆ é™¤çŠ¶æ€ï¼Œå¹¶ä¸”å¯¼è‡´å®¢æˆ·ç±»ä¸ç±»åº“ä¹‹é—´çš„è€¦åˆå¢å¼ºã€‚ ä¸¾ä¾‹ï¼šè¯·å‡å®¡æ ¸ 1.åˆ›å»ºè¯·å‡å¯¹è±¡ public class LeaveApply { //ç”³è¯·å•åˆå§‹çŠ¶æ€æ˜¯å¾…æäº¤çŠ¶æ€ private ApplyState applyState = new Audit(); //è®¾ç½®çŠ¶æ€ public void setState(ApplyState state){ applyState = state; } //çŠ¶æ€å˜åŒ–å,æ›´æ–°å¯¹è±¡è‡ªèº«çš„è¡Œä¸º public void getResult(){ applyState.changeHandle(); } } 2.åˆ›å»ºå®¡æ ¸çŠ¶æ€æ¥å£ public interface ApplyState { //çŠ¶æ€å˜åŒ–å¤„ç†æ“ä½œ void changeHandle(); } 3.åˆ›å»ºå„å®¡æ ¸çŠ¶æ€å…·ä½“å®ç°ç±» public class Audit implements ApplyState { @Override public void changeHandle() { System.out.println("[å®¡æ ¸ä¸­]"); } } public class AuditPass implements ApplyState { @Override public void changeHandle() { System.out.println("[å®¡æ ¸é€šè¿‡]"); } } public class AuditReject implements ApplyState{ @Override public void changeHandle() { System.out.println("[å®¡æ ¸æœªé€šè¿‡]"); } } 4.æµ‹è¯• public class SpTest { public static void main(String[] args) { LeaveApply leaveApply = new LeaveApply(); leaveApply.getResult(); leaveApply.setState(new AuditPass()); leaveApply.getResult(); leaveApply.setState(new AuditReject()); leaveApply.getResult(); } } 5.è¾“å‡º [å®¡æ ¸ä¸­] [å®¡æ ¸é€šè¿‡] [å®¡æ ¸æœªé€šè¿‡] document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>ç¼–ç¨‹</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç³»ç»Ÿä¼˜åŒ–å°è®°ï¼šCPUé•¿æ—¶é—´æ»¡è´Ÿè·è¿è¡Œ]]></title>
    <url>%2F2020%2F11%2F28%2Fsystem-optimize%2F</url>
    <content type="text"><![CDATA[CPUé•¿æ—¶é—´æ»¡è´Ÿè·è¿è¡Œ,ä¸€æ¬¡å…¥é—¨çº§é™CPUç³»ç»Ÿä¼˜åŒ–å®æˆ˜ ç°è±¡ç”¨æˆ·é‡å¢å¤§,çº¿ä¸Šä¸€ä¸ªJavaå•åº”ç”¨æœåŠ¡é•¿æ—¶é—´å ç”¨æœåŠ¡å™¨CPUè¾¾åˆ°400%ï¼Œä½¿å¾—æ¥å£å“åº”é€Ÿåº¦éå¸¸æ…¢ï¼Œçº¿ç¨‹æ‹¥å µï¼Œå‡ºç°å„ç§å“åº”è¶…æ—¶é—®é¢˜ï¼Œå³ä¾¿æœ‰æ—¶å€™æ²¡æœ‰ç”¨æˆ·æ“ä½œï¼Œä¹Ÿä¼šé•¿æ—¶é—´å ç”¨å¤§é‡CPUå’Œå†…å­˜ã€‚ è§£å†³æ€è·¯æ‰¾å‡ºå“ªäº›ç¨‹åºå¤„ç†æ»¡ï¼Œè¿›è¡Œæ’æŸ¥ä¼˜åŒ–ï¼ˆä¸šåŠ¡æµç¨‹è°ƒæ•´ã€é”å…³é—­ã€SQLä¼˜åŒ–ã€ä¸€äº›è€—æ€§èƒ½çš„ç¨‹åºä¸ä½¿ç”¨å†…å­˜æ–¹æ¡ˆï¼‰ è§£å†³æ–¹æ¡ˆlinuxå‘½ä»¤æ’æŸ¥ + Arthasç›‘æ§ + Druid sql ç›‘æ§ è§£å†³æ–¹æ¡ˆï¼šä¸€ã€Linuxå‘½ä»¤æ’æŸ¥ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š1.æ˜¾ç¤ºè¿›ç¨‹åˆ—è¡¨ï¼Œå®šä½è¿›ç¨‹å·åœ¨topå‘½ä»¤ä¸‹ï¼ŒæŒ‰shift+HæŸ¥çœ‹cpuå ç”¨æœ€é«˜è¿›ç¨‹(PID:21659) 2.æ˜¾ç¤ºçº¿ç¨‹åˆ—è¡¨ï¼Œå®šä½çº¿ç¨‹å·ï¼Œæ‰¾åˆ°å“ªäº›çº¿ç¨‹å ç”¨é«˜è€—æ—¶é•¿å‘½ä»¤ï¼šps -mp pid -o THREAD,tid,time | sort -rn | more exï¼šps -mp 21659 -o THREAD,tid,time ï¼ˆshift+Hï¼‰ psï¼šæˆªå›¾ä¸­pidå†™æˆ24275åŸå› æ˜¯ç”±äºä¸­é€”é‡å¯è¿‡ä¸€æ¬¡ç¨‹åºï¼ŒåŸPIDï¼š21659 å˜æ›´æˆ PIDï¼š24275ï¼Œå®åˆ™éƒ½æ˜¯åŒä¸€ä¸ªJavaç¨‹åº å…¶ä¸­TIDï¼š24737ã€24742ã€24745ï¼Œè€—æ—¶è¾ƒé•¿å ç”¨CPUç‡è¾ƒé«˜ 3.å°†çº¿ç¨‹å·è½¬ä¸ºç³»ç»Ÿå¯è¯†åˆ«çš„16è¿›åˆ¶å‘½ä»¤ï¼šprintf "%x\n" tid 4.æ‰“å°çº¿ç¨‹çš„å †æ ˆä¿¡æ¯ï¼Œåˆ†æåŸå› å‘½ä»¤ï¼š jstack PID | grep [16è¿›åˆ¶TID] -A 30 exï¼šæŸ¥çœ‹çº¿ç¨‹24737çš„å †æ ˆä¿¡æ¯ï¼Œ jstack 24275 | grep 60a1 -A 30 5.å¦‚æœå«Œä»¥ä¸Šæ“ä½œéº»çƒ¦ï¼Œä¹Ÿå¯ç›´æ¥ä½¿ç”¨ jstack PIDï¼Œæ‰“å°å‡ºæ‰€æœ‰å †æ ˆï¼Œè¿›è¡ŒæŸ¥çœ‹ã€‚äºŒã€è¾…åŠ©ç¥å™¨Arthasç¨‹åºç›‘æ§æœ¬æ¬¡ä¸åœ¨è¯´æ˜ï¼Œåå‡ºä¸“é¢˜è®²è§£ï¼Œé™„ä¸Šå®˜æ–¹æ–‡æ¡£ï¼š Arthasä¼ é€é—¨ ä¸‰ã€è¾…åŠ©Druid SQLç›‘æ§æœ¬æ¬¡ä¹Ÿä¸åœ¨è¯´æ˜ï¼Œåå‡ºä¸“é¢˜è®²è§£ï¼Œé™„ä¸€å¼ å›¾ æœ€ç»ˆé—®é¢˜å®šä½åœ¨å †å†…å­˜å æ»¡ï¼Œæ–°åˆ›å»ºå¯¹è±¡æ—¶æ— æ³•åˆ†é…è¶³å¤Ÿçš„å†…å­˜ï¼Œå¼•èµ·é¢‘ç¹GC 1.ç¨‹åºé¢‘ç¹è¯·æ±‚RPCæ¥å£å¾—åˆ°çš„å“åº”æ…¢ï¼Œè€—æ—¶è¿‡å¤§ï¼› è§£å†³æ–¹æ¡ˆï¼šç”±äºè·å–çš„æ•°æ®å®æ—¶æ€§è¦æ±‚ä¸é«˜ï¼Œæ”¹ä¸ºç¼“å­˜å¤„ç†ï¼Œé¿å…å®æ—¶è¯·æ±‚ã€‚ 2.å®¢æˆ·ç«¯é¢‘ç¹è¯·æ±‚æŸä¸ªæ¥å£ï¼Œä¸”æ¥å£ä¸­çš„sqlæ•ˆç‡éå¸¸ä½,å¯¼è‡´äº†sqlè¿æ¥é•¿æ—¶é—´è¢«å ç”¨ã€‚ è§£å†³æ–¹æ¡ˆï¼šç”±äºè¯¥æ¥å£å†å²é—ç•™ï¼Œä¸”å’Œå¯¹åº”çš„è°ƒç”¨å®¢æˆ·ç«¯åŒäº‹ç¡®è®¤è¯¥æ¥å£ç°ä»Šå·²ç”¨å¤„ä¸å¤§ï¼Œå› æ­¤æ³¨é‡Šæ‰äº†è¯¥æ¥å£ã€‚ 3.é¢‘ç¹æ”¶åˆ°å›è°ƒï¼Œéšå¼€å¯äº†å¤šçº¿ç¨‹å¤„ç†ä½†ç”±äºæœ‰çº¿ç¨‹é”ï¼Œä½¿å¾—å…¶ä»–çº¿ç¨‹è¢«blockï¼Œå®åˆ™ä¾ç„¶æ˜¯ä¸ªå•çº¿ç¨‹å¤„ç†ï¼Œæ¶ˆè´¹é€Ÿåº¦èµ¶ä¸ä¸Šç”Ÿäº§é€Ÿåº¦ï¼Œçº¿ç¨‹ç§¯å‹ã€‚ è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿å®‰å…¨çš„æƒ…å†µä¸‹ï¼Œå…³é—­äº†çº¿ç¨‹é”ã€‚ 4.ä»£ç é€»è¾‘ä¸åˆç†; è§£å†³æ–¹æ¡ˆï¼šé‡æ–°è°ƒæ•´ä»£ç é€»è¾‘ 5.å¯¹æ•°æ®åº“æ“ä½œè¿‡äºé¢‘ç¹; è§£å†³æ–¹æ¡ˆï¼šè°ƒæ•´é€»è¾‘ï¼Œä¼˜åŒ–sqlï¼ˆè°ƒæ•´sqlï¼ŒåŠ ç´¢å¼•ï¼Œé¿å…å…¨è¡¨æ‰«æï¼‰ï¼Œå°½é‡å°‘æ“ä½œæ•°æ®åº“ï¼Œå¤šä½¿ç”¨ç¼“å­˜å¯¹æ•°æ®è¿›è¡Œæ“ä½œ æ€»ç»“ç»è¿‡æ­¤æ¬¡æ’æŸ¥ï¼Œè™½æœ€ç»ˆé—®é¢˜å¾—ä»¥ç¼“è§£ï¼Œä½†æ·±çŸ¥ç³»ç»Ÿå†…ä¾ç„¶å­˜åœ¨å¾ˆå¤šå…¶ä»–æ€§èƒ½é—®é¢˜ï¼Œæš´éœ²å‡ºå¯¹JVMçŸ¥è¯†çš„æ¬ ç¼ºï¼Œä»¥åŠJavaä»£ç ã€SQLåŠŸåº•éœ€è¦æŒç»­åŠ å¼ºã€‚ä¿è¯ç¨‹åºç³»ç»Ÿçš„ç¨³å®šï¼Œå¥å£®ï¼Œé«˜æ•ˆã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>ç¼–ç¨‹</category>
      </categories>
      <tags>
        <tag>è¿ç»´</tag>
        <tag>åç«¯</tag>
        <tag>ç³»ç»Ÿä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Docker Installs]]></title>
    <url>%2F2020%2F10%2F23%2Fdocker-installs%2F</url>
    <content type="text"><![CDATA[docker å®‰è£…è½¯ä»¶å·¥å…· å‡†å¤‡å·¥ä½œdockerå‡†å¤‡å·¥ä½œä¼ é€é—¨ å‘½ä»¤å¿«æ· æŸ¥çœ‹é•œåƒ# docker images | grep ? å¯åŠ¨å®¹å™¨# docker run -id --name=matrix_mysql -p 13306:3306 -e MYSQL_ROOT_PASSWORD=abc123 mysql è¿›å…¥å®¹å™¨# docker exec -it å®¹å™¨å/å®¹å™¨Id /bin/bash å®‰è£…Nexus3æŸ¥è¯¢é•œåƒ# docker search nexus æ‹‰å–é•œåƒ# docker pull sonatype/nexus3 é…ç½®æœ¬åœ°ä¿å­˜æ•°æ®çš„è·¯å¾„ è·¯å¾„å¯è‡ªå®šä¹‰,æˆ‘æ”¾åœ¨/docker/nexus/nexus-dataä¸‹ã€‚ æ³¨æ„ï¼šåœ¨ç”Ÿæˆç›®å½•çš„æ—¶å€™ï¼Œå› ä¸ºnexusçš„è¯»å†™é»˜è®¤æ˜¯200,docker runçš„æ—¶å€™ä¼šæŠ¥æ‰¾ä¸åˆ°è·¯å¾„çš„é”™è¯¯ å¯èƒ½é‡åˆ°çš„é—®é¢˜:æ‰¾ä¸åˆ°è·¯å¾„é”™è¯¯ ä¿®æ”¹ç›®å½•æƒé™# chmod 777 docker # chmod 777 nexus # chmod 777 nexus-data è¿è¡Œé•œåƒ# docker run -d -p 8081:8081 -p 8082:8082 -p 8083:8083 --name matrix_nexus3 -v /usr/etc/docker/nexus/nexus-data:/nexus-data sonatype/nexus3 8082 å®¢æˆ·ç«¯é¡µé¢çš„å¯¹å¤–ç«¯å£; 8082 å‡†å¤‡å»ºç«‹docker hosted ç§æœ‰åº“ä½¿ç”¨ã€‚hostedå¯ä»¥ä¸Šä¼ ä¸‹è½½æˆ‘å»ºç«‹çš„images; 8083 å‡†å¤‡å»ºç«‹docker proxy ä»£ç†åº“ä½¿ç”¨ã€‚ proxyå¯ä»¥é•œåƒè¿œç¨‹å…¬å…±ä»“åº“ï¼Œæ¯”å¦‚ï¼šdockeå®˜æ–¹ä»“åº“ã€aliyunç­‰ç­‰; daemon.json åœ¨/etc/docker/daemon.jsonè¿™ä¸ªæ–‡ä»¶å¤¹ä¸­é…ç½®; daemon.jsonæ–‡ä»¶ä¸­çš„é…ç½®è¯´æ˜ï¼š { "registry-mirrors": ["https://1v50e4uy.mirror.aliyuncs.com"], ----æ–‡ä»¶åŠ é€Ÿåœ°å€ï¼Œä¸‹è½½å›½å¤–çš„é•œåƒï¼Œé€šè¿‡å®ƒè¿›è¡ŒåŠ é€Ÿ "insecure-registries":["192.168.111.112:8083"] ---é…ç½®æœ¬åœ°çš„é•œåƒåº“åœ°å€,æ¯æ¬¡æ‹–å–é•œåƒ,å¦‚æœ8083ä¸Šæ²¡æœ‰ï¼Œå…ˆä»è¿œç¨‹åº“ä¸‹è½½ï¼Œä¸‹è½½åˆ°8083ï¼Œå†ä¸‹è½½åˆ°æœ¬åœ°åº“ï¼Œä¸‹æ¬¡å†ä¸‹è½½çš„æ—¶å€™ï¼Œå°±ä»8083ä¸Šä¸‹è½½äº†ã€‚ } ç™»å½• Nexus31.ç™»å½•é“¾æ¥ï¼šhttp://192.168.111.112:8081/ 2.é»˜è®¤ç”¨æˆ·å:admin é»˜è®¤å¯†ç ä¸å†æ˜¯admin123,æ‰€ä»¥éœ€è¦å»å®¹å™¨å†…æŸ¥çœ‹ 3.æŸ¥çœ‹é»˜è®¤å¯†ç ï¼šè¿›å…¥å®¹å™¨å†…æŸ¥çœ‹ # docker exec -it matrix_nexus3 /bin/bash # cd nexus-data/ # vi admin.password ---å¤åˆ¶å‡ºå¯†ç ,å»ç½‘é¡µç™»å½• 4.ç™»å½•å®Œæˆå,é»˜è®¤æç¤ºä¿®æ”¹æ–°å¯†ç ,æ–°å¯†ç æ”¹å®Œå,admin.passwordå°†ä¼šæ¶ˆå¤±,æ‰€ä»¥è¦ä¿ç®¡å¥½å¯†ç  document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>docker</tag>
        <tag>è¿ç»´</tag>
        <tag>åç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hexoæ“ä½œæ‰‹å†Œ]]></title>
    <url>%2F2020%2F10%2F23%2Fhexo-manual%2F</url>
    <content type="text"><![CDATA[A fast, simple &amp; powerful blog framework å®˜æ–¹ç½‘ç«™ï¼šhttps://hexo.io/zh-cn/docs/configuration å¸¸ç”¨å‘½ä»¤æ¸…é™¤ç¼“å­˜æ–‡ä»¶ (db.json) å’Œå·²ç”Ÿæˆçš„é™æ€æ–‡ä»¶ (public) $ hexo clean ç”Ÿæˆé™æ€æ–‡ä»¶ $ hexo generate -d, --deploy æ–‡ä»¶ç”Ÿæˆåç«‹å³éƒ¨ç½²ç½‘ç«™ -w, --watch ç›‘è§†æ–‡ä»¶å˜åŠ¨ éƒ¨ç½² hexo d å¯åŠ¨æœåŠ¡å™¨ã€‚é»˜è®¤æƒ…å†µä¸‹,è®¿é—®ç½‘å€ä¸º: http://localhost:4000/ $ hexo server -p, --port é‡è®¾ç«¯å£ -s, --static åªä½¿ç”¨é™æ€æ–‡ä»¶ -l, --log å¯åŠ¨æ—¥è®°è®°å½•ï¼Œä½¿ç”¨è¦†ç›–è®°å½•æ ¼å¼ å‘è¡¨è‰ç¨¿ $ hexo publish [layout] &lt;filename&gt; æ˜¾ç¤ºè‰ç¨¿ $ hexo --draft è‡ªå®šä¹‰ CWDï¼ˆCurrent working directoryï¼‰ $ hexo --cwd /path/to/cwd åˆ›å»ºæ–‡æ¡£ hexo new [layout] &lt;title&gt; ex: hexo new inner demo01 hexo new outer demo01 hexo new feeling demo01 draft--&gt;public hexo publish [layout] &lt;title&gt; ex: hexo new draft demo01 hexo publish inner &lt;title&gt; é¡µçœ‰è¯´æ˜title: Hexoæ“ä½œæ‰‹å†Œ //æ ‡é¢˜ author: 571 //ä½œè€… series: INNER //æ‰€å±ç³»åˆ— categories: INNER //æ‰€å±ç±»åˆ« comments: true //æ˜¯å¦å¼€å¯è¯„è®ºï¼š true å¼€å¯ img: /cover/abc.jpg //å°é¢å›¾ top: false //æ˜¯å¦ç½®é¡¶ true æ˜¯ cover: false //æ˜¯å¦è½®æ’­ true æ˜¯ tags: //æ ‡ç­¾ - inner - æ‰‹å†Œ date: 2020-05-14 21:58:38 //åˆ›å»ºæ—¶é—´ updated: 2020-05-14 21:58:38 //ä¿®æ”¹æ—¶é—´ åˆ›å»ºæ–‡ç« æ–‡ä»¶åˆ›å»ºæ–‡ä»¶å‘½åæ ¼å¼ï¼šå°å†™ã€ä¸­æ éš”å¼€å•è¯ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>æ‰‹å†Œ</category>
      </categories>
      <tags>
        <tag>æ‰‹å†Œ</tag>
        <tag>åšå®¢</tag>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Docker,è½»é‡çº§çš„è™šæ‹ŸåŒ–æŠ€æœ¯]]></title>
    <url>%2F2020%2F10%2F23%2Fdocker%2F</url>
    <content type="text"><![CDATA[Docker ä¸€ä¸ªåˆ©ç”¨äº†lxcçš„æŠ€æœ¯çš„ä¸€ä¸ªè™šæ‹ŸåŒ–å¼•æ“ã€‚ Dockerç®€ä»‹ä»€ä¹ˆæ˜¯è™šæ‹ŸåŒ–â€‹ åœ¨è®¡ç®—æœºä¸­ï¼Œè™šæ‹ŸåŒ–ï¼ˆè‹±è¯­ï¼šVirtualizationï¼‰æ˜¯ä¸€ç§èµ„æºç®¡ç†æŠ€æœ¯ï¼Œæ˜¯å°†è®¡ç®—æœºçš„å„ç§å®ä½“èµ„æºï¼Œå¦‚æœåŠ¡å™¨ã€ç½‘ç»œã€å†…å­˜åŠå­˜å‚¨ç­‰ï¼Œäºˆä»¥æŠ½è±¡ã€è½¬æ¢åå‘ˆç°å‡ºæ¥ï¼Œæ‰“ç ´å®ä½“ç»“æ„é—´çš„ä¸å¯åˆ‡å‰²çš„éšœç¢ï¼Œä½¿ç”¨æˆ·å¯ä»¥æ¯”åŸæœ¬çš„ç»„æ€æ›´å¥½çš„æ–¹å¼æ¥åº”ç”¨è¿™äº›èµ„æºã€‚è¿™äº›èµ„æºçš„æ–°è™šæ‹Ÿéƒ¨ä»½æ˜¯ä¸å—ç°æœ‰èµ„æºçš„æ¶è®¾æ–¹å¼ï¼Œåœ°åŸŸæˆ–ç‰©ç†ç»„æ€æ‰€é™åˆ¶ã€‚ä¸€èˆ¬æ‰€æŒ‡çš„è™šæ‹ŸåŒ–èµ„æºåŒ…æ‹¬è®¡ç®—èƒ½åŠ›å’Œèµ„æ–™å­˜å‚¨ã€‚ â€‹ åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè™šæ‹ŸåŒ–æŠ€æœ¯ä¸»è¦ç”¨æ¥è§£å†³é«˜æ€§èƒ½çš„ç‰©ç†ç¡¬ä»¶äº§èƒ½è¿‡å‰©å’Œè€çš„æ—§çš„ç¡¬ä»¶äº§èƒ½è¿‡ä½çš„é‡ç»„é‡ç”¨ï¼Œé€æ˜åŒ–åº•å±‚ç‰©ç†ç¡¬ä»¶ï¼Œä»è€Œæœ€å¤§åŒ–çš„åˆ©ç”¨ç‰©ç†ç¡¬ä»¶ å¯¹èµ„æºå……åˆ†åˆ©ç”¨ â€‹ è™šæ‹ŸåŒ–æŠ€æœ¯ç§ç±»å¾ˆå¤šï¼Œä¾‹å¦‚ï¼šè½¯ä»¶è™šæ‹ŸåŒ–ã€ç¡¬ä»¶è™šæ‹ŸåŒ–ã€å†…å­˜è™šæ‹ŸåŒ–ã€ç½‘ç»œè™šæ‹ŸåŒ–(vip)ã€æ¡Œé¢è™šæ‹ŸåŒ–ã€æœåŠ¡è™šæ‹ŸåŒ–ã€è™šæ‹Ÿæœºç­‰ç­‰ã€‚ ä»€ä¹ˆæ˜¯Dockerâ€‹ Docker æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œè¯ç”Ÿäº 2013 å¹´åˆï¼Œæœ€åˆæ˜¯ dotCloud å…¬å¸å†…éƒ¨çš„ä¸€ä¸ªä¸šä½™é¡¹ç›®ã€‚å®ƒåŸºäº Google å…¬å¸æ¨å‡ºçš„ Go è¯­è¨€å®ç°ã€‚ é¡¹ç›®åæ¥åŠ å…¥äº† Linux åŸºé‡‘ä¼šï¼Œéµä»äº† Apache 2.0 åè®®ï¼Œé¡¹ç›®ä»£ç åœ¨ GitHub ä¸Šè¿›è¡Œç»´æŠ¤ã€‚ â€‹ â€‹ Docker è‡ªå¼€æºåå—åˆ°å¹¿æ³›çš„å…³æ³¨å’Œè®¨è®ºï¼Œä»¥è‡³äº dotCloud å…¬å¸åæ¥éƒ½æ”¹åä¸º Docker Incã€‚Redhat å·²ç»åœ¨å…¶ RHEL6.5 ä¸­é›†ä¸­æ”¯æŒ Dockerï¼›Google ä¹Ÿåœ¨å…¶ PaaS äº§å“ä¸­å¹¿æ³›åº”ç”¨ã€‚ â€‹ Docker é¡¹ç›®çš„ç›®æ ‡æ˜¯å®ç°è½»é‡çº§çš„æ“ä½œç³»ç»Ÿè™šæ‹ŸåŒ–è§£å†³æ–¹æ¡ˆã€‚ Docker çš„åŸºç¡€æ˜¯ Linux å®¹å™¨ï¼ˆLXCï¼‰ç­‰æŠ€æœ¯ã€‚ â€‹ åœ¨ LXC çš„åŸºç¡€ä¸Š Docker è¿›è¡Œäº†è¿›ä¸€æ­¥çš„å°è£…ï¼Œè®©ç”¨æˆ·ä¸éœ€è¦å»å…³å¿ƒå®¹å™¨çš„ç®¡ç†ï¼Œä½¿å¾—æ“ä½œæ›´ä¸ºç®€ä¾¿ã€‚ç”¨æˆ·æ“ä½œ Docker çš„å®¹å™¨å°±åƒæ“ä½œä¸€ä¸ªå¿«é€Ÿè½»é‡çº§çš„è™šæ‹Ÿæœºä¸€æ ·ç®€å•ã€‚ ä¸ºä»€ä¹ˆé€‰æ‹©Docker? ï¼ˆ1ï¼‰ä¸Šæ‰‹å¿«ã€‚ â€‹ ç”¨æˆ·åªéœ€è¦å‡ åˆ†é’Ÿï¼Œå°±å¯ä»¥æŠŠè‡ªå·±çš„ç¨‹åºâ€œDockeråŒ–â€ã€‚Dockerä¾èµ–äºâ€œå†™æ—¶å¤åˆ¶â€ï¼ˆcopy-on-writeï¼‰æ¨¡å‹ï¼Œä½¿ä¿®æ”¹åº”ç”¨ç¨‹åºä¹Ÿéå¸¸è¿…é€Ÿï¼Œå¯ä»¥è¯´è¾¾åˆ°â€œéšå¿ƒæ‰€è‡´ï¼Œä»£ç å³æ”¹â€çš„å¢ƒç•Œã€‚ éšåï¼Œå°±å¯ä»¥åˆ›å»ºå®¹å™¨æ¥è¿è¡Œåº”ç”¨ç¨‹åºäº†ã€‚å¤§å¤šæ•°Dockerå®¹å™¨åªéœ€è¦ä¸åˆ°1ç§’ä¸­å³å¯å¯åŠ¨ã€‚ç”±äºå»é™¤äº†ç®¡ç†ç¨‹åºçš„å¼€é”€ï¼ŒDockerå®¹å™¨æ‹¥æœ‰å¾ˆé«˜çš„æ€§èƒ½ï¼ŒåŒæ—¶åŒä¸€å°å®¿ä¸»æœºä¸­ä¹Ÿå¯ä»¥è¿è¡Œæ›´å¤šçš„å®¹å™¨ï¼Œä½¿ç”¨æˆ·å°½å¯èƒ½çš„å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚ ï¼ˆ2ï¼‰èŒè´£çš„é€»è¾‘åˆ†ç±» â€‹ ä½¿ç”¨Dockerï¼Œå¼€å‘äººå‘˜åªéœ€è¦å…³å¿ƒå®¹å™¨ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œè€Œè¿ç»´äººå‘˜åªéœ€è¦å…³å¿ƒå¦‚ä½•ç®¡ç†å®¹å™¨ã€‚Dockerè®¾è®¡çš„ç›®çš„å°±æ˜¯è¦åŠ å¼ºå¼€å‘äººå‘˜å†™ä»£ç çš„å¼€å‘ç¯å¢ƒä¸åº”ç”¨ç¨‹åºè¦éƒ¨ç½²çš„ç”Ÿäº§ç¯å¢ƒä¸€è‡´æ€§ã€‚ä»è€Œé™ä½é‚£ç§â€œå¼€å‘æ—¶ä¸€åˆ‡æ­£å¸¸ï¼Œè‚¯å®šæ˜¯è¿ç»´çš„é—®é¢˜ï¼ˆæµ‹è¯•ç¯å¢ƒéƒ½æ˜¯æ­£å¸¸çš„ï¼Œä¸Šçº¿åå‡ºäº†é—®é¢˜å°±å½’ç»“ä¸ºè‚¯å®šæ˜¯è¿ç»´çš„é—®é¢˜ï¼‰â€ ï¼ˆ3ï¼‰å¿«é€Ÿé«˜æ•ˆçš„å¼€å‘ç”Ÿå‘½å‘¨æœŸ â€‹ Dockerçš„ç›®æ ‡ä¹‹ä¸€å°±æ˜¯ç¼©çŸ­ä»£ç ä»å¼€å‘ã€æµ‹è¯•åˆ°éƒ¨ç½²ã€ä¸Šçº¿è¿è¡Œçš„å‘¨æœŸï¼Œè®©ä½ çš„åº”ç”¨ç¨‹åºå…·å¤‡å¯ç§»æ¤æ€§ï¼Œæ˜“äºæ„å»ºï¼Œå¹¶æ˜“äºåä½œã€‚ï¼ˆé€šä¿—ä¸€ç‚¹è¯´ï¼ŒDockerå°±åƒä¸€ä¸ªç›’å­ï¼Œé‡Œé¢å¯ä»¥è£…å¾ˆå¤šç‰©ä»¶ï¼Œå¦‚æœéœ€è¦è¿™äº›ç‰©ä»¶çš„å¯ä»¥ç›´æ¥å°†è¯¥å¤§ç›’å­æ‹¿èµ°ï¼Œè€Œä¸éœ€è¦ä»è¯¥ç›’å­ä¸­ä¸€ä»¶ä»¶çš„å–ã€‚ï¼‰ ï¼ˆ4ï¼‰é¼“åŠ±ä½¿ç”¨é¢å‘æœåŠ¡çš„æ¶æ„ â€‹ Dockerè¿˜é¼“åŠ±é¢å‘æœåŠ¡çš„ä½“ç³»ç»“æ„å’Œå¾®æœåŠ¡æ¶æ„ã€‚Dockeræ¨èå•ä¸ªå®¹å™¨åªè¿è¡Œä¸€ä¸ªåº”ç”¨ç¨‹åºæˆ–è¿›ç¨‹ï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªåˆ†å¸ƒå¼çš„åº”ç”¨ç¨‹åºæ¨¡å‹ï¼Œåœ¨è¿™ç§æ¨¡å‹ä¸‹ï¼Œåº”ç”¨ç¨‹åºæˆ–è€…æœåŠ¡éƒ½å¯ä»¥è¡¨ç¤ºä¸ºä¸€ç³»åˆ—å†…éƒ¨äº’è”çš„å®¹å™¨ï¼Œä»è€Œä½¿åˆ†å¸ƒå¼éƒ¨ç½²åº”ç”¨ç¨‹åºï¼Œæ‰©å±•æˆ–è°ƒè¯•åº”ç”¨ç¨‹åºéƒ½å˜å¾—éå¸¸ç®€å•ï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†ç¨‹åºçš„å†…çœæ€§ã€‚ï¼ˆå½“ç„¶ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªå®¹å™¨ä¸­è¿è¡Œå¤šä¸ªåº”ç”¨ç¨‹åºï¼‰ 1.3 å®¹å™¨ä¸è™šæ‹Ÿæœºæ¯”è¾ƒâ€‹ ä¸‹é¢çš„å›¾ç‰‡æ¯”è¾ƒäº† Docker å’Œä¼ ç»Ÿè™šæ‹ŸåŒ–æ–¹å¼çš„ä¸åŒä¹‹å¤„ï¼Œå¯è§å®¹å™¨æ˜¯åœ¨æ“ä½œç³»ç»Ÿå±‚é¢ä¸Šå®ç°è™šæ‹ŸåŒ–ï¼Œç›´æ¥å¤ç”¨æœ¬åœ°ä¸»æœºçš„æ“ä½œç³»ç»Ÿï¼Œè€Œä¼ ç»Ÿæ–¹å¼åˆ™æ˜¯åœ¨ç¡¬ä»¶å±‚é¢å®ç°ã€‚ ä¸ä¼ ç»Ÿçš„è™šæ‹Ÿæœºç›¸æ¯”ï¼ŒDockerä¼˜åŠ¿ä½“ç°ä¸ºå¯åŠ¨é€Ÿåº¦å¿«ã€å ç”¨ä½“ç§¯å°ã€‚ Docker ç»„ä»¶DockeræœåŠ¡å™¨ä¸å®¢æˆ·ç«¯â€‹ Dockeræ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯-æœåŠ¡å™¨ï¼ˆC/Sï¼‰æ¶æ„ç¨‹åºã€‚Dockerå®¢æˆ·ç«¯åªéœ€è¦å‘DockeræœåŠ¡å™¨æˆ–è€…å®ˆæŠ¤è¿›ç¨‹å‘å‡ºè¯·æ±‚ï¼ŒæœåŠ¡å™¨æˆ–è€…å®ˆæŠ¤è¿›ç¨‹å°†å®Œæˆæ‰€æœ‰å·¥ä½œå¹¶è¿”å›ç»“æœã€‚Dockeræä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·Dockerä»¥åŠä¸€æ•´å¥—RESTful APIã€‚ä½ å¯ä»¥åœ¨åŒä¸€å°å®¿ä¸»æœºä¸Šè¿è¡ŒDockerå®ˆæŠ¤è¿›ç¨‹å’Œå®¢æˆ·ç«¯ï¼Œä¹Ÿå¯ä»¥ä»æœ¬åœ°çš„Dockerå®¢æˆ·ç«¯è¿æ¥åˆ°è¿è¡Œåœ¨å¦ä¸€å°å®¿ä¸»æœºä¸Šçš„è¿œç¨‹Dockerå®ˆæŠ¤è¿›ç¨‹ã€‚ Dockeré•œåƒä¸å®¹å™¨â€‹ é•œåƒæ˜¯æ„å»ºDockerçš„åŸºçŸ³ã€‚ç”¨æˆ·åŸºäºé•œåƒæ¥è¿è¡Œè‡ªå·±çš„å®¹å™¨ã€‚é•œåƒä¹Ÿæ˜¯Dockerç”Ÿå‘½å‘¨æœŸä¸­çš„â€œæ„å»ºâ€éƒ¨åˆ†ã€‚é•œåƒæ˜¯åŸºäºè”åˆæ–‡ä»¶ç³»ç»Ÿçš„ä¸€ç§å±‚å¼ç»“æ„ï¼Œç”±ä¸€ç³»åˆ—æŒ‡ä»¤ä¸€æ­¥ä¸€æ­¥æ„å»ºå‡ºæ¥ã€‚ä¾‹å¦‚ï¼š æ·»åŠ ä¸€ä¸ªæ–‡ä»¶ï¼› æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼› æ‰“å¼€ä¸€ä¸ªçª—å£ã€‚ ä¹Ÿå¯ä»¥å°†é•œåƒå½“ä½œå®¹å™¨çš„â€œæºä»£ç â€ã€‚é•œåƒä½“ç§¯å¾ˆå°ï¼Œéå¸¸â€œä¾¿æºâ€ï¼Œæ˜“äºåˆ†äº«ã€å­˜å‚¨å’Œæ›´æ–°ã€‚ â€‹ Dockerå¯ä»¥å¸®åŠ©ä½ æ„å»ºå’Œéƒ¨ç½²å®¹å™¨ï¼Œä½ åªéœ€è¦æŠŠè‡ªå·±çš„åº”ç”¨ç¨‹åºæˆ–è€…æœåŠ¡æ‰“åŒ…æ”¾è¿›å®¹å™¨å³å¯ã€‚å®¹å™¨æ˜¯åŸºäºé•œåƒå¯åŠ¨èµ·æ¥çš„ï¼Œå®¹å™¨ä¸­å¯ä»¥è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ã€‚æˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼Œé•œåƒæ˜¯Dockerç”Ÿå‘½å‘¨æœŸä¸­çš„æ„å»ºæˆ–è€…æ‰“åŒ…é˜¶æ®µï¼Œè€Œå®¹å™¨åˆ™æ˜¯å¯åŠ¨æˆ–è€…æ‰§è¡Œé˜¶æ®µã€‚ å®¹å™¨åŸºäºé•œåƒå¯åŠ¨ï¼Œä¸€æ—¦å®¹å™¨å¯åŠ¨å®Œæˆåï¼Œæˆ‘ä»¬å°±å¯ä»¥ç™»å½•åˆ°å®¹å™¨ä¸­å®‰è£…è‡ªå·±éœ€è¦çš„è½¯ä»¶æˆ–è€…æœåŠ¡ã€‚ æ‰€ä»¥Dockerå®¹å™¨å°±æ˜¯ï¼š â€‹ ä¸€ä¸ªé•œåƒæ ¼å¼ï¼› â€‹ ä¸€äº›åˆ—æ ‡å‡†æ“ä½œï¼› â€‹ ä¸€ä¸ªæ‰§è¡Œç¯å¢ƒã€‚ â€‹ Dockerå€Ÿé‰´äº†æ ‡å‡†é›†è£…ç®±çš„æ¦‚å¿µã€‚æ ‡å‡†é›†è£…ç®±å°†è´§ç‰©è¿å¾€ä¸–ç•Œå„åœ°ï¼ŒDockerå°†è¿™ä¸ªæ¨¡å‹è¿ç”¨åˆ°è‡ªå·±çš„è®¾è®¡ä¸­ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼šé›†è£…ç®±è¿è¾“è´§ç‰©ï¼Œè€ŒDockerè¿è¾“è½¯ä»¶ã€‚ å’Œé›†è£…ç®±ä¸€æ ·ï¼ŒDockeråœ¨æ‰§è¡Œä¸Šè¿°æ“ä½œæ—¶ï¼Œå¹¶ä¸å…³å¿ƒå®¹å™¨ä¸­åˆ°åº•è£…äº†ä»€ä¹ˆï¼Œå®ƒä¸ç®¡æ˜¯webæœåŠ¡å™¨ï¼Œè¿˜æ˜¯æ•°æ®åº“ï¼Œæˆ–è€…æ˜¯åº”ç”¨ç¨‹åºæœåŠ¡å™¨ä»€ä¹ˆçš„ã€‚æ‰€æœ‰çš„å®¹å™¨éƒ½æŒ‰ç…§ç›¸åŒçš„æ–¹å¼å°†å†…å®¹â€œè£…è½½â€è¿›å»ã€‚ Dockerä¹Ÿä¸å…³å¿ƒä½ è¦æŠŠå®¹å™¨è¿åˆ°ä½•æ–¹ï¼šæˆ‘ä»¬å¯ä»¥åœ¨è‡ªå·±çš„ç¬”è®°æœ¬ä¸­æ„å»ºå®¹å™¨ï¼Œä¸Šä¼ åˆ°Registryï¼Œç„¶åä¸‹è½½åˆ°ä¸€ä¸ªç‰©ç†çš„æˆ–è€…è™šæ‹Ÿçš„æœåŠ¡å™¨æ¥æµ‹è¯•ï¼Œåœ¨æŠŠå®¹å™¨éƒ¨ç½²åˆ°å…·ä½“çš„ä¸»æœºä¸­ã€‚åƒæ ‡å‡†é›†è£…ç®±ä¸€æ ·ï¼ŒDockerå®¹å™¨æ–¹ä¾¿æ›¿æ¢ï¼Œå¯ä»¥å åŠ ï¼Œæ˜“äºåˆ†å‘ï¼Œå¹¶ä¸”å°½é‡é€šç”¨ã€‚ Registryï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰â€‹ Dockerç”¨Registryæ¥ä¿å­˜ç”¨æˆ·æ„å»ºçš„é•œåƒã€‚Registryåˆ†ä¸ºå…¬å…±å’Œç§æœ‰ä¸¤ç§ã€‚Dockerå…¬å¸è¿è¥å…¬å…±çš„Registryå«åšDocker Hubã€‚ç”¨æˆ·å¯ä»¥åœ¨Docker Hubæ³¨å†Œè´¦å·ï¼Œåˆ†äº«å¹¶ä¿å­˜è‡ªå·±çš„é•œåƒï¼ˆè¯´æ˜ï¼šåœ¨Docker Hubä¸‹è½½é•œåƒå·¨æ…¢ï¼Œå¯ä»¥è‡ªå·±æ„å»ºç§æœ‰çš„Registryï¼‰ã€‚ â€‹ https://hub.docker.com/ Dockerå®‰è£…ä¸å¯åŠ¨å®‰è£…Dockerâ€‹ Dockerå®˜æ–¹å»ºè®®åœ¨Ubuntuä¸­å®‰è£…ï¼Œå› ä¸ºDockeræ˜¯åŸºäºUbuntuå‘å¸ƒçš„ï¼Œè€Œä¸”ä¸€èˆ¬Dockerå‡ºç°çš„é—®é¢˜Ubuntuæ˜¯æœ€å…ˆæ›´æ–°æˆ–è€…æ‰“è¡¥ä¸çš„ã€‚åœ¨å¾ˆå¤šç‰ˆæœ¬çš„CentOSä¸­æ˜¯ä¸æ”¯æŒæ›´æ–°æœ€æ–°çš„ä¸€äº›è¡¥ä¸åŒ…çš„ã€‚ â€‹ ç”±äºæˆ‘ä»¬å­¦ä¹ çš„ç¯å¢ƒéƒ½ä½¿ç”¨çš„æ˜¯CentOSï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬å°†Dockerå®‰è£…åˆ°CentOSä¸Šã€‚æ³¨æ„ï¼šè¿™é‡Œå»ºè®®å®‰è£…åœ¨CentOS7.xä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œåœ¨CentOS6.xçš„ç‰ˆæœ¬ä¸­ï¼Œå®‰è£…å‰éœ€è¦å®‰è£…å…¶ä»–å¾ˆå¤šçš„ç¯å¢ƒè€Œä¸”Dockerå¾ˆå¤šè¡¥ä¸ä¸æ”¯æŒæ›´æ–°ã€‚ â€‹ è¯·ç›´æ¥æŒ‚è½½è¯¾ç¨‹é…å¥—çš„Centos7.xé•œåƒ ï¼ˆ1ï¼‰yum åŒ…æ›´æ–°åˆ°æœ€æ–° sudo yum update ï¼ˆ2ï¼‰å®‰è£…éœ€è¦çš„è½¯ä»¶åŒ…ï¼Œ yum-util æä¾›yum-config-manageråŠŸèƒ½ï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯devicemapperé©±åŠ¨ä¾èµ–çš„ sudo yum install -y yum-utils device-mapper-persistent-data lvm2 ï¼ˆ3ï¼‰è®¾ç½®yumæºä¸ºé˜¿é‡Œäº‘ sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo ï¼ˆ4ï¼‰å®‰è£…docker sudo yum install docker-ce ï¼ˆ5ï¼‰å®‰è£…åæŸ¥çœ‹dockerç‰ˆæœ¬ docker -v è®¾ç½®ustcçš„é•œåƒustcæ˜¯è€ç‰Œçš„linuxé•œåƒæœåŠ¡æä¾›è€…äº†ï¼Œè¿˜åœ¨é¥è¿œçš„ubuntu 5.04ç‰ˆæœ¬çš„æ—¶å€™å°±åœ¨ç”¨ã€‚ustcçš„dockeré•œåƒåŠ é€Ÿå™¨é€Ÿåº¦å¾ˆå¿«ã€‚ustc docker mirrorçš„ä¼˜åŠ¿ä¹‹ä¸€å°±æ˜¯ä¸éœ€è¦æ³¨å†Œï¼Œæ˜¯çœŸæ­£çš„å…¬å…±æœåŠ¡ã€‚ https://lug.ustc.edu.cn/wiki/mirrors/help/docker ç¼–è¾‘è¯¥æ–‡ä»¶ï¼š vi /etc/docker/daemon.json åœ¨è¯¥æ–‡ä»¶ä¸­è¾“å…¥å¦‚ä¸‹å†…å®¹ï¼š { "registry-mirrors": ["https://docker.mirrors.ustc.edu.cn"] } Dockerçš„å¯åŠ¨ä¸åœæ­¢systemctlå‘½ä»¤æ˜¯ç³»ç»ŸæœåŠ¡ç®¡ç†å™¨æŒ‡ä»¤ å¯åŠ¨dockerï¼š systemctl start docker åœæ­¢dockerï¼š systemctl stop docker é‡å¯dockerï¼š systemctl restart docker æŸ¥çœ‹dockerçŠ¶æ€ï¼š systemctl status docker å¼€æœºå¯åŠ¨ï¼š systemctl enable docker æŸ¥çœ‹dockeræ¦‚è¦ä¿¡æ¯ docker info æŸ¥çœ‹dockerå¸®åŠ©æ–‡æ¡£ docker --help å¸¸ç”¨å‘½ä»¤é•œåƒç›¸å…³å‘½ä»¤æŸ¥çœ‹é•œåƒdocker images REPOSITORYï¼šé•œåƒåç§° TAGï¼šé•œåƒæ ‡ç­¾ IMAGE IDï¼šé•œåƒID CREATEDï¼šé•œåƒçš„åˆ›å»ºæ—¥æœŸï¼ˆä¸æ˜¯è·å–è¯¥é•œåƒçš„æ—¥æœŸï¼‰ SIZEï¼šé•œåƒå¤§å° è¿™äº›é•œåƒéƒ½æ˜¯å­˜å‚¨åœ¨Dockerå®¿ä¸»æœºçš„/var/lib/dockerç›®å½•ä¸‹ æœç´¢é•œåƒå¦‚æœä½ éœ€è¦ä»ç½‘ç»œä¸­æŸ¥æ‰¾éœ€è¦çš„é•œåƒï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æœç´¢ docker search é•œåƒåç§° NAMEï¼šä»“åº“åç§° DESCRIPTIONï¼šé•œåƒæè¿° STARSï¼šç”¨æˆ·è¯„ä»·ï¼Œååº”ä¸€ä¸ªé•œåƒçš„å—æ¬¢è¿ç¨‹åº¦ OFFICIALï¼šæ˜¯å¦å®˜æ–¹ AUTOMATEDï¼šè‡ªåŠ¨æ„å»ºï¼Œè¡¨ç¤ºè¯¥é•œåƒç”±Docker Hubè‡ªåŠ¨æ„å»ºæµç¨‹åˆ›å»ºçš„ æ‹‰å–é•œåƒæ‹‰å–é•œåƒå°±æ˜¯ä»ä¸­å¤®ä»“åº“ä¸­ä¸‹è½½é•œåƒåˆ°æœ¬åœ° docker pull é•œåƒåç§° ä¾‹å¦‚ï¼Œæˆ‘è¦ä¸‹è½½centos7é•œåƒ docker pull centos:7 åˆ é™¤é•œåƒæŒ‰é•œåƒIDåˆ é™¤é•œåƒ docker rmi é•œåƒID åˆ é™¤æ‰€æœ‰é•œåƒ docker rmi `docker images -q` å®¹å™¨ç›¸å…³å‘½ä»¤æŸ¥çœ‹å®¹å™¨æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ docker ps æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ docker ps â€“a æŸ¥çœ‹æœ€åä¸€æ¬¡è¿è¡Œçš„å®¹å™¨ docker ps â€“l æŸ¥çœ‹åœæ­¢çš„å®¹å™¨ docker ps -f status=exited åˆ›å»ºä¸å¯åŠ¨å®¹å™¨åˆ›å»ºå®¹å™¨å¸¸ç”¨çš„å‚æ•°è¯´æ˜ï¼š åˆ›å»ºå®¹å™¨å‘½ä»¤ï¼šdocker run -iï¼šè¡¨ç¤ºè¿è¡Œå®¹å™¨ -tï¼šè¡¨ç¤ºå®¹å™¨å¯åŠ¨åä¼šè¿›å…¥å…¶å‘½ä»¤è¡Œã€‚åŠ å…¥è¿™ä¸¤ä¸ªå‚æ•°åï¼Œå®¹å™¨åˆ›å»ºå°±èƒ½ç™»å½•è¿›å»ã€‚å³åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ã€‚ â€“name :ä¸ºåˆ›å»ºçš„å®¹å™¨å‘½åã€‚ -vï¼šè¡¨ç¤ºç›®å½•æ˜ å°„å…³ç³»ï¼ˆå‰è€…æ˜¯å®¿ä¸»æœºç›®å½•ï¼Œåè€…æ˜¯æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªï¼våšå¤šä¸ªç›®å½•æˆ–æ–‡ä»¶æ˜ å°„ã€‚æ³¨æ„ï¼šæœ€å¥½åšç›®å½•æ˜ å°„ï¼Œåœ¨å®¿ä¸»æœºä¸Šåšä¿®æ”¹ï¼Œç„¶åå…±äº«åˆ°å®¹å™¨ä¸Šã€‚ -dï¼šåœ¨runåé¢åŠ ä¸Š-då‚æ•°,åˆ™ä¼šåˆ›å»ºä¸€ä¸ªå®ˆæŠ¤å¼å®¹å™¨åœ¨åå°è¿è¡Œï¼ˆè¿™æ ·åˆ›å»ºå®¹å™¨åä¸ä¼šè‡ªåŠ¨ç™»å½•å®¹å™¨ï¼Œå¦‚æœåªåŠ -i -tä¸¤ä¸ªå‚æ•°ï¼Œåˆ›å»ºåå°±ä¼šè‡ªåŠ¨è¿›å»å®¹å™¨ï¼‰ã€‚ -pï¼šè¡¨ç¤ºç«¯å£æ˜ å°„ï¼Œå‰è€…æ˜¯å®¿ä¸»æœºç«¯å£ï¼Œåè€…æ˜¯å®¹å™¨å†…çš„æ˜ å°„ç«¯å£ã€‚å¯ä»¥ä½¿ç”¨å¤šä¸ª-påšå¤šä¸ªç«¯å£æ˜ å°„ ï¼ˆ1ï¼‰äº¤äº’å¼æ–¹å¼åˆ›å»ºå®¹å™¨ docker run -it --name=å®¹å™¨åç§° é•œåƒåç§°:æ ‡ç­¾ /bin/bash è¿™æ—¶æˆ‘ä»¬é€šè¿‡pså‘½ä»¤æŸ¥çœ‹ï¼Œå‘ç°å¯ä»¥çœ‹åˆ°å¯åŠ¨çš„å®¹å™¨ï¼ŒçŠ¶æ€ä¸ºå¯åŠ¨çŠ¶æ€ é€€å‡ºå½“å‰å®¹å™¨ exit ï¼ˆ2ï¼‰å®ˆæŠ¤å¼æ–¹å¼åˆ›å»ºå®¹å™¨ï¼š docker run -di --name=å®¹å™¨åç§° é•œåƒåç§°:æ ‡ç­¾ ç™»å½•å®ˆæŠ¤å¼å®¹å™¨æ–¹å¼ï¼š docker exec -it å®¹å™¨åç§° (æˆ–è€…å®¹å™¨ID) /bin/bash åœæ­¢ä¸å¯åŠ¨å®¹å™¨åœæ­¢å®¹å™¨ï¼š docker stop å®¹å™¨åç§°ï¼ˆæˆ–è€…å®¹å™¨IDï¼‰ å¯åŠ¨å®¹å™¨ï¼š docker start å®¹å™¨åç§°ï¼ˆæˆ–è€…å®¹å™¨IDï¼‰ æ–‡ä»¶æ‹·è´å¦‚æœæˆ‘ä»¬éœ€è¦å°†æ–‡ä»¶æ‹·è´åˆ°å®¹å™¨å†…å¯ä»¥ä½¿ç”¨cpå‘½ä»¤ docker cp éœ€è¦æ‹·è´çš„æ–‡ä»¶æˆ–ç›®å½• å®¹å™¨åç§°:å®¹å™¨ç›®å½• ä¹Ÿå¯ä»¥å°†æ–‡ä»¶ä»å®¹å™¨å†…æ‹·è´å‡ºæ¥ docker cp å®¹å™¨åç§°:å®¹å™¨ç›®å½• éœ€è¦æ‹·è´çš„æ–‡ä»¶æˆ–ç›®å½• ç›®å½•æŒ‚è½½æˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºå®¹å™¨çš„æ—¶å€™ï¼Œå°†å®¿ä¸»æœºçš„ç›®å½•ä¸å®¹å™¨å†…çš„ç›®å½•è¿›è¡Œæ˜ å°„ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹å®¿ä¸»æœºæŸä¸ªç›®å½•çš„æ–‡ä»¶ä»è€Œå»å½±å“å®¹å™¨ã€‚åˆ›å»ºå®¹å™¨ æ·»åŠ -vå‚æ•° åè¾¹ä¸º å®¿ä¸»æœºç›®å½•:å®¹å™¨ç›®å½•ï¼Œä¾‹å¦‚ï¼š docker run -di -v /usr/local/myhtml:/usr/local/myhtml --name=mycentos3 centos:7 å¦‚æœä½ å…±äº«çš„æ˜¯å¤šçº§çš„ç›®å½•ï¼Œå¯èƒ½ä¼šå‡ºç°æƒé™ä¸è¶³çš„æç¤ºã€‚ è¿™æ˜¯å› ä¸ºCentOS7ä¸­çš„å®‰å…¨æ¨¡å—selinuxæŠŠæƒé™ç¦æ‰äº†ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ å‚æ•° â€“privileged=true æ¥è§£å†³æŒ‚è½½çš„ç›®å½•æ²¡æœ‰æƒé™çš„é—®é¢˜ æŸ¥çœ‹å®¹å™¨IPåœ°å€æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å®¹å™¨è¿è¡Œçš„å„ç§æ•°æ® docker inspect å®¹å™¨åç§°ï¼ˆå®¹å™¨IDï¼‰ ä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ç›´æ¥è¾“å‡ºIPåœ°å€ docker inspect --format='{{.NetworkSettings.IPAddress}}' å®¹å™¨åç§°ï¼ˆå®¹å™¨IDï¼‰ åˆ é™¤å®¹å™¨åˆ é™¤æŒ‡å®šçš„å®¹å™¨ï¼š docker rm å®¹å™¨åç§°ï¼ˆå®¹å™¨IDï¼‰ åº”ç”¨éƒ¨ç½²MySQLéƒ¨ç½²ï¼ˆ1ï¼‰æ‹‰å–mysqlé•œåƒ docker pull centos/mysql-57-centos7 ï¼ˆ2ï¼‰åˆ›å»ºå®¹å™¨ docker run -di --name=tensquare_mysql -p 33306:3306 -e MYSQL_ROOT_PASSWORD=123456 mysql -p ä»£è¡¨ç«¯å£æ˜ å°„ï¼Œæ ¼å¼ä¸º å®¿ä¸»æœºæ˜ å°„ç«¯å£:å®¹å™¨è¿è¡Œç«¯å£ -e ä»£è¡¨æ·»åŠ ç¯å¢ƒå˜é‡ MYSQL_ROOT_PASSWORD æ˜¯rootç”¨æˆ·çš„ç™»é™†å¯†ç  ï¼ˆ3ï¼‰è¿œç¨‹ç™»å½•mysql è¿æ¥å®¿ä¸»æœºçš„IP ,æŒ‡å®šç«¯å£ä¸º33306 tomcatéƒ¨ç½²ï¼ˆ1ï¼‰æ‹‰å–é•œåƒ docker pull tomcat:7-jre7 ï¼ˆ2ï¼‰åˆ›å»ºå®¹å™¨ åˆ›å»ºå®¹å™¨ -pè¡¨ç¤ºåœ°å€æ˜ å°„ docker run -di --name=mytomcat -p 9000:8080 -v /usr/local/webapps:/usr/local/tomcat/webapps tomcat:7-jre7 Nginxéƒ¨ç½²ï¼ˆ1ï¼‰æ‹‰å–é•œåƒ docker pull nginx ï¼ˆ2ï¼‰åˆ›å»ºNginxå®¹å™¨ docker run -di --name=mynginx -p 80:80 nginx Rediséƒ¨ç½²ï¼ˆ1ï¼‰æ‹‰å–é•œåƒ docker pull redis ï¼ˆ2ï¼‰åˆ›å»ºå®¹å™¨ docker run -di --name=myredis -p 6379:6379 redis è¿ç§»ä¸å¤‡ä»½å®¹å™¨ä¿å­˜ä¸ºé•œåƒæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å°†å®¹å™¨ä¿å­˜ä¸ºé•œåƒ docker commit mynginx mynginx_i é•œåƒå¤‡ä»½æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å°†é•œåƒä¿å­˜ä¸ºtar æ–‡ä»¶ docker save -o mynginx.tar mynginx_i é•œåƒæ¢å¤ä¸è¿ç§»é¦–å…ˆæˆ‘ä»¬å…ˆåˆ é™¤æ‰mynginx_imgé•œåƒ ç„¶åæ‰§è¡Œæ­¤å‘½ä»¤è¿›è¡Œæ¢å¤ docker load -i mynginx.tar -i è¾“å…¥çš„æ–‡ä»¶ æ‰§è¡Œåå†æ¬¡æŸ¥çœ‹é•œåƒï¼Œå¯ä»¥çœ‹åˆ°é•œåƒå·²ç»æ¢å¤ Dockerfile Dockerfileæ–‡ä»¶è¯¦è§£ ä»€ä¹ˆæ˜¯DockerfileDockerfileæ˜¯ç”±ä¸€ç³»åˆ—å‘½ä»¤å’Œå‚æ•°æ„æˆçš„è„šæœ¬ï¼Œè¿™äº›å‘½ä»¤åº”ç”¨äºåŸºç¡€é•œåƒå¹¶æœ€ç»ˆåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒã€‚ å¯¹äºå¼€å‘äººå‘˜ï¼šå¯ä»¥ä¸ºå¼€å‘å›¢é˜Ÿæä¾›ä¸€ä¸ªå®Œå…¨ä¸€è‡´çš„å¼€å‘ç¯å¢ƒï¼› å¯¹äºæµ‹è¯•äººå‘˜ï¼šå¯ä»¥ç›´æ¥æ‹¿å¼€å‘æ—¶æ‰€æ„å»ºçš„é•œåƒæˆ–è€…é€šè¿‡Dockerfileæ–‡ä»¶æ„å»ºä¸€ä¸ªæ–°çš„é•œåƒå¼€å§‹å·¥ä½œäº†ï¼› å¯¹äºè¿ç»´äººå‘˜ï¼šåœ¨éƒ¨ç½²æ—¶ï¼Œå¯ä»¥å®ç°åº”ç”¨çš„æ— ç¼ç§»æ¤ã€‚ å¸¸ç”¨å‘½ä»¤ å‘½ä»¤ ä½œç”¨ FROM image_name:tag å®šä¹‰äº†ä½¿ç”¨å“ªä¸ªåŸºç¡€é•œåƒå¯åŠ¨æ„å»ºæµç¨‹ MAINTAINER user_name å£°æ˜é•œåƒçš„åˆ›å»ºè€… ENV key value è®¾ç½®ç¯å¢ƒå˜é‡ (å¯ä»¥å†™å¤šæ¡) RUN command æ˜¯Dockerfileçš„æ ¸å¿ƒéƒ¨åˆ†(å¯ä»¥å†™å¤šæ¡) ADD source_dir/file dest_dir/file å°†å®¿ä¸»æœºçš„æ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨å†…ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œå°†ä¼šåœ¨å¤åˆ¶åè‡ªåŠ¨è§£å‹ COPY source_dir/file dest_dir/file å’ŒADDç›¸ä¼¼ï¼Œä½†æ˜¯å¦‚æœæœ‰å‹ç¼©æ–‡ä»¶å¹¶ä¸èƒ½è§£å‹ WORKDIR path_dir è®¾ç½®å·¥ä½œç›®å½• ä½¿ç”¨è„šæœ¬åˆ›å»ºé•œåƒæ­¥éª¤ï¼š ï¼ˆ1ï¼‰åˆ›å»ºç›®å½• mkdir â€“p /usr/local/dockerjdk8 ï¼ˆ2ï¼‰ä¸‹è½½jdk-8u171-linux-x64.tar.gzå¹¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼ˆè™šæ‹Ÿæœºï¼‰ä¸­çš„/usr/local/dockerjdk8ç›®å½• ï¼ˆ3ï¼‰åˆ›å»ºæ–‡ä»¶Dockerfile vi Dockerfile #ä¾èµ–é•œåƒåç§°å’ŒID FROM centos:7 #æŒ‡å®šé•œåƒåˆ›å»ºè€…ä¿¡æ¯ MAINTAINER ITCAST #åˆ‡æ¢å·¥ä½œç›®å½• WORKDIR /usr RUN mkdir /usr/local/java #ADD æ˜¯ç›¸å¯¹è·¯å¾„jar,æŠŠjavaæ·»åŠ åˆ°å®¹å™¨ä¸­ ADD jdk-8u171-linux-x64.tar.gz /usr/local/java/ #é…ç½®javaç¯å¢ƒå˜é‡ ENV JAVA_HOME /usr/local/java/jdk1.8.0_171 ENV JRE_HOME $JAVA_HOME/jre ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH ENV PATH $JAVA_HOME/bin:$PATH ï¼ˆ4ï¼‰æ‰§è¡Œå‘½ä»¤æ„å»ºé•œåƒ docker build -t='jdk1.8' . æ³¨æ„åè¾¹çš„ç©ºæ ¼å’Œç‚¹ï¼Œä¸è¦çœç•¥ ï¼ˆ5ï¼‰æŸ¥çœ‹é•œåƒæ˜¯å¦å»ºç«‹å®Œæˆ docker images Dockerç§æœ‰ä»“åº“ç§æœ‰ä»“åº“æ­å»ºä¸é…ç½®ï¼ˆ1ï¼‰æ‹‰å–ç§æœ‰ä»“åº“é•œåƒï¼ˆæ­¤æ­¥çœç•¥ï¼‰ docker pull registry ï¼ˆ2ï¼‰å¯åŠ¨ç§æœ‰ä»“åº“å®¹å™¨ docker run -di --name=registry -p 5000:5000 registry ï¼ˆ3ï¼‰æ‰“å¼€æµè§ˆå™¨ è¾“å…¥åœ°å€http://192.168.184.141:5000/v2/_catalogçœ‹åˆ°`{"repositories":[]}` è¡¨ç¤ºç§æœ‰ä»“åº“æ­å»ºæˆåŠŸå¹¶ä¸”å†…å®¹ä¸ºç©º ï¼ˆ4ï¼‰ä¿®æ”¹daemon.json vi /etc/docker/daemon.json æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œä¿å­˜é€€å‡ºã€‚ {"insecure-registries":["192.168.184.141:5000"]} æ­¤æ­¥ç”¨äºè®© dockerä¿¡ä»»ç§æœ‰ä»“åº“åœ°å€ ï¼ˆ5ï¼‰é‡å¯docker æœåŠ¡ systemctl restart docker é•œåƒä¸Šä¼ è‡³ç§æœ‰ä»“åº“ï¼ˆ1ï¼‰æ ‡è®°æ­¤é•œåƒä¸ºç§æœ‰ä»“åº“çš„é•œåƒ docker tag jdk1.8 192.168.184.141:5000/jdk1.8 ï¼ˆ2ï¼‰å†æ¬¡å¯åŠ¨ç§æœå®¹å™¨ docker start registry ï¼ˆ3ï¼‰ä¸Šä¼ æ ‡è®°çš„é•œåƒ docker push 192.168.184.141:5000/jdk1.8 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>docker</tag>
        <tag>è¿ç»´</tag>
        <tag>åç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux Installs]]></title>
    <url>%2F2020%2F10%2F23%2Flinux-installs%2F</url>
    <content type="text"><![CDATA[Linux è½¯ä»¶å·¥å…·å®‰è£… å®‰è£…Javaé€šè¿‡yumæ–¹å¼å®‰è£…JavaæŸ¥çœ‹JDKæ˜¯å¦å·²å®‰è£…# yum list installed | grep java è‹¥å·²ç»å®‰è£…äº†JDKï¼Œå¦‚ä½•å¸è½½Javaç¯å¢ƒï¼Ÿ å¸è½½JDKç›¸å…³æ–‡ä»¶ï¼š# yum -y remove java-1.7.0-openjdk* å¸è½½tzdata-javaï¼š# yum -y remove tzdata-java.noarch æ³¨ï¼šâ€œ*â€è¡¨ç¤ºå¸è½½æ‰java 1.7.0çš„æ‰€æœ‰openjdkç›¸å…³æ–‡ä»¶æŸ¥çœ‹yumåº“ä¸­çš„Javaå®‰è£…åŒ…# yum -y list java* å®‰è£…Javaå®‰è£…åŒ… ä»¥yumåº“ä¸­java-1.8.0ä¸ºä¾‹ï¼š # yum -y install java-1.8.0-openjdk* æ³¨ï¼šâ€œ*â€è¡¨ç¤ºå°†java-1.8.0çš„æ‰€æœ‰ç›¸å…³Javaç¨‹åºéƒ½å®‰è£…ä¸Š æŸ¥çœ‹åˆšåˆšå®‰è£…ç‰ˆæœ¬# java -version ç¯å¢ƒå˜é‡é…ç½®1.ä¿®æ”¹é…ç½®æ–‡ä»¶ # vim /etc/profile # export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk # export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar # export PATH=$PATH:$JAVA_HOME/bin 2.ç”Ÿæ•ˆä¿®æ”¹ # source /etc/profile é€šè¿‡å‹ç¼©åŒ…å®‰è£…Java####å‡†å¤‡å·¥ä½œï¼š jdk-8u11-linux-x64.tar.gzä¸‹è½½åœ°å€ï¼šhttps://pan.baidu.com/s/1smNHABN (psï¼šä¹Ÿå¯åœ¨å®˜ç½‘ä¸‹è½½æœ€æ–°jdk:http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html) shellåœ¨windowsä¸‹è½½å®Œæˆjdkåï¼Œé€šè¿‡shellå‘é€åˆ°Linuxä¸Š ç™»å½•Linuxï¼Œåˆ‡æ¢åˆ°rootç”¨æˆ·# su root ---è·å–rootç”¨æˆ·æƒé™ï¼Œå½“å‰å·¥ä½œç›®å½•ä¸å˜(éœ€è¦rootå¯†ç ) æˆ–è€… # sudo -i ---ä¸éœ€è¦rootå¯†ç ç›´æ¥åˆ‡æ¢æˆrootï¼ˆéœ€è¦å½“å‰ç”¨æˆ·å¯†ç ï¼‰ åœ¨usrç›®å½•ä¸‹å»ºç«‹Javaå®‰è£…ç›®å½•# cd /usr/local/src/ # mkdir java è§£å‹jdkåˆ°å½“å‰ç›®å½•,å¾—åˆ°æ–‡ä»¶å¤¹ jdk1.8.0_11# tar -zxvf jdk-8u11-linux-x64.tar.gz è§£å‹å®Œå»ºç«‹ä¸€ä¸ªé“¾æ¥ä»¥èŠ‚çœç›®å½•é•¿åº¦# ln -s /usr/local/src/java/jdk1.8.0_11/ /usr/local/src/jdk ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œé…ç½®ç¯å¢ƒå˜é‡# vim /etc/profile åœ¨æ–‡æœ«æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š # JAVA_HOME=/usr/local/src/jdk # CLASSPATH=$JAVA_HOME/lib/ # PATH=$PATH:$JAVA_HOME/bin # export PATH JAVA_HOME CLASSPATH é‡å¯æœºå™¨æˆ–æ‰§è¡Œå‘½ä»¤# sudo shutdown -r now æŸ¥çœ‹åˆšåˆšå®‰è£…ç‰ˆæœ¬# java -version å®‰è£…Mavenåœ¨çº¿ä¸‹è½½å®‰è£…å®‰è£…wgetå‘½ä»¤# yum -y install wget ä¸‹è½½mavenå®‰è£…åŒ…# cd /usr/local/src/ # wget http://mirrors.cnnic.cn/apache/maven/maven-3/3.5.4/binaries/apache-maven-3.5.4-bin.tar.gz è§£å‹mavenå®‰è£…åŒ…# tar -zxvf apache-maven-3.5.4-bin.tar.gz é…ç½®maven# vi /etc/profile åœ¨é…ç½®æ–‡ä»¶é…ç½® # export MAVEN_HOME=/usr/local/src/apache-maven-3.5.4 # export PATH=$MAVEN_HOME/bin:$PATH é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ # source /etc/profile æŸ¥çœ‹maven# mvn -version å®‰è£…åŒ…å®‰è£… Mavenä¸‹è½½åœ°å€ å®‰è£…Nexus3å‡†å¤‡å·¥ä½œ å®‰è£…Java å®‰è£…Maven åœ¨çº¿ä¸‹è½½å®‰è£…åœ¨çº¿ä¸‹è½½å®‰è£…ä¼ é€é—¨ å®‰è£…åŒ…å®‰è£… Nexusä¸‹è½½åœ°å€1Nexusä¸‹è½½åœ°å€2 dockerå®‰è£…æºç ä¸‹è½½ä¸åŠ¨,æ— è€æƒ³åˆ°æ­¤æ³•,æ¨è Dockerå®‰è£…ä¼ é€é—¨ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>è¿ç»´</tag>
        <tag>åç«¯</tag>
        <tag>linux</tag>
      </tags>
  </entry>
</search>
